import{S as hc,i as cc,s as dc,k as As,l as Os,m as Cs,h as St,n as Ps,b as vi,H as To,o as sp,w as op,y as uc,a as Mo,q as ss,e as Ya,z as pc,c as Eo,r as os,A as fc,G as wr,g as Br,d as Ts,f as np,B as mc,I as ap,v as lp}from"../chunks/index.4dc351e2.js";import"../chunks/singletons.95df4c48.js";import{G as Do}from"../chunks/traductions.d21edd28.js";import{s as hp}from"../chunks/detailMode.9ca0f4bb.js";import{H as cp}from"../chunks/H1.ff19513d.js";import{L as gc,F as mn,S as Za,a as dp,B as Pe,b as ze,C as yt,T as ia,M as me,V as T,c as X,O as er,d as Li,e as vc,R as ra,f as tr,g as yc,h as up,i as ge,j as bc,k as Mi,l as pp,E as fp,m as Ue,n as Bs,o as Qe,p as hi,q as $t,Q as ir,A as mp,D as gp,P as vp,r as yp,s as xc,t as bp,H as xp,u as wc,U as Lo,v as _c,w as gn,x as wp,y as _p,z as Sp,G as Kr,I as Rt,J as Ap,K as Op,N as Ka,W as Cp,X as Pp,Y as js,Z as Tp,_ as Mp,$ as Qa,a0 as Sc,a1 as Ep,a2 as Dp,a3 as Ms,a4 as Us,a5 as Ac,a6 as Oc,a7 as Rs,a8 as Lp,a9 as Ip,aa as zp,ab as Np,ac as Bp,ad as jp,ae as Up,af as Rp,ag as kp,ah as Cc,ai as Fp,aj as Vp,ak as Pc,al as Gp,am as Hp,an as Wp,ao as Io,ap as qp,aq as $p,ar as Xp}from"../chunks/three.module.5693092b.js";import{_ as Tc}from"../chunks/preload-helper.41c905a7.js";import{m as Mc}from"../chunks/BufferGeometryUtils.e400a2d4.js";let Yp=!0,Zp=!0;const Kp=!0,tA=Object.freeze(Object.defineProperty({__proto__:null,csr:Yp,prerender:Kp,ssr:Zp},Symbol.toStringTag,{value:"Module"})),zo=new WeakMap;class Qp extends gc{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,i,r,s){const o=new mn(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,n=>{this.parse(n,i,s)},r,s)}parse(t,i,r){this.decodeDracoFile(t,i,null,null,Za).catch(r)}decodeDracoFile(t,i,r,s,o=dp){const n={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!r,vertexColorSpace:o};return this.decodeGeometry(t,n).then(i)}decodeGeometry(t,i){const r=JSON.stringify(i);if(zo.has(t)){const a=zo.get(t);if(a.key===r)return a.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const o=this.workerNextTaskID++,n=t.byteLength,h=this._getWorker(o,n).then(a=>(s=a,new Promise((c,u)=>{s._callbacks[o]={resolve:c,reject:u},s.postMessage({type:"decode",id:o,taskConfig:i,buffer:t},[t])}))).then(a=>this._createGeometry(a.geometry));return h.catch(()=>!0).then(()=>{s&&o&&this._releaseTask(s,o)}),zo.set(t,{key:r,promise:h}),h}_createGeometry(t){const i=new Pe;t.index&&i.setIndex(new ze(t.index.array,1));for(let r=0;r<t.attributes.length;r++){const s=t.attributes[r],o=s.name,n=s.array,h=s.itemSize,a=new ze(n,h);o==="color"&&this._assignVertexColorSpace(a,s.vertexColorSpace),i.setAttribute(o,a)}return i}_assignVertexColorSpace(t,i){if(i!==Za)return;const r=new yt;for(let s=0,o=t.count;s<o;s++)r.fromBufferAttribute(t,s).convertSRGBToLinear(),t.setXYZ(s,r.r,r.g,r.b)}_loadLibrary(t,i){const r=new mn(this.manager);return r.setPath(this.decoderPath),r.setResponseType(i),r.setWithCredentials(this.withCredentials),new Promise((s,o)=>{r.load(t,s,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",i=[];return t?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(r=>{const s=r[0];t||(this.decoderConfig.wasmBinary=r[1]);const o=Jp.toString(),n=["/* draco decoder */",s,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(t,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(o){const n=o.data;switch(n.type){case"decode":s._callbacks[n.id].resolve(n);break;case"error":s._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,o){return s._taskLoad>o._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[t]=i,r._taskLoad+=i,r})}_releaseTask(t,i){t._taskLoad-=t._taskCosts[i],delete t._callbacks[i],delete t._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function Jp(){let e,t;onmessage=function(n){const h=n.data;switch(h.type){case"init":e=h.decoderConfig,t=new Promise(function(u){e.onModuleLoaded=function(l){u({draco:l})},DracoDecoderModule(e)});break;case"decode":const a=h.buffer,c=h.taskConfig;t.then(u=>{const l=u.draco,d=new l.Decoder;try{const p=i(l,d,new Int8Array(a),c),f=p.attributes.map(v=>v.array.buffer);p.index&&f.push(p.index.array.buffer),self.postMessage({type:"decode",id:h.id,geometry:p},f)}catch(p){console.error(p),self.postMessage({type:"error",id:h.id,error:p.message})}finally{l.destroy(d)}});break}};function i(n,h,a,c){const u=c.attributeIDs,l=c.attributeTypes;let d,p;const f=h.GetEncodedGeometryType(a);if(f===n.TRIANGULAR_MESH)d=new n.Mesh,p=h.DecodeArrayToMesh(a,a.byteLength,d);else if(f===n.POINT_CLOUD)d=new n.PointCloud,p=h.DecodeArrayToPointCloud(a,a.byteLength,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const v={index:null,attributes:[]};for(const g in u){const m=self[l[g]];let y,w;if(c.useUniqueIDs)w=u[g],y=h.GetAttributeByUniqueId(d,w);else{if(w=h.GetAttributeId(d,n[u[g]]),w===-1)continue;y=h.GetAttribute(d,w)}const x=s(n,h,d,g,m,y);g==="color"&&(x.vertexColorSpace=c.vertexColorSpace),v.attributes.push(x)}return f===n.TRIANGULAR_MESH&&(v.index=r(n,h,d)),n.destroy(d),v}function r(n,h,a){const u=a.num_faces()*3,l=u*4,d=n._malloc(l);h.GetTrianglesUInt32Array(a,l,d);const p=new Uint32Array(n.HEAPF32.buffer,d,u).slice();return n._free(d),{array:p,itemSize:1}}function s(n,h,a,c,u,l){const d=l.num_components(),f=a.num_points()*d,v=f*u.BYTES_PER_ELEMENT,g=o(n,u),m=n._malloc(v);h.GetAttributeDataArrayForAllPoints(a,l,g,v,m);const y=new u(n.HEAPF32.buffer,m,f).slice();return n._free(m),{name:c,array:y,itemSize:d}}function o(n,h){switch(h){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32}}}var ef=Object.create,sa=Object.defineProperty,tf=Object.getOwnPropertyDescriptor,rf=Object.getOwnPropertyNames,sf=Object.getPrototypeOf,of=Object.prototype.hasOwnProperty,co=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),nf=(e,t)=>{for(var i in t)sa(e,i,{get:t[i],enumerable:!0})},af=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of rf(t))!of.call(e,s)&&s!==i&&sa(e,s,{get:()=>t[s],enumerable:!(r=tf(t,s))||r.enumerable});return e},uo=(e,t,i)=>(i=e!=null?ef(sf(e)):{},af(t||!e||!e.__esModule?sa(i,"default",{value:e,enumerable:!0}):i,e)),lf=co((e,t)=>{(function(i,r){typeof e=="object"?t.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(e,function(){return i.importState=function(s){var o=new i;return o.importState(s),o},i;function i(){return function(s){var o=0,n=0,h=0,a=1;s.length==0&&(s=[+new Date]);var c=r();o=c(" "),n=c(" "),h=c(" ");for(var u=0;u<s.length;u++)o-=c(s[u]),o<0&&(o+=1),n-=c(s[u]),n<0&&(n+=1),h-=c(s[u]),h<0&&(h+=1);c=null;var l=function(){var d=2091639*o+a*23283064365386963e-26;return o=n,n=h,h=d-(a=d|0)};return l.next=l,l.uint32=function(){return l()*4294967296},l.fract53=function(){return l()+(l()*2097152|0)*11102230246251565e-32},l.version="Alea 0.9",l.args=s,l.exportState=function(){return[o,n,h,a]},l.importState=function(d){o=+d[0]||0,n=+d[1]||0,h=+d[2]||0,a=+d[3]||0},l}(Array.prototype.slice.call(arguments))}function r(){var s=4022871197,o=function(n){n=n.toString();for(var h=0;h<n.length;h++){s+=n.charCodeAt(h);var a=.02519603282416938*s;s=a>>>0,a-=s,a*=s,s=a>>>0,a-=s,s+=a*4294967296}return(s>>>0)*23283064365386963e-26};return o.version="Mash 0.9",o}})}),hf=co((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?r(e):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(e,function(i){i.SVD=function(r,s,o,n,h){if(s=s===void 0||s,o=o===void 0||o,h=1e-64/(n=n||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var a,c,u,l,d,p,f,v,g,m,y,w,x=r[0].length,S=r.length;if(S<x)throw new TypeError("Invalid matrix: m < n");for(var b=[],A=[],O=[],P=s==="f"?S:x,_=m=f=0;_<S;_++)A[_]=new Array(P).fill(0);for(_=0;_<x;_++)O[_]=new Array(x).fill(0);var C,M=new Array(x).fill(0);for(_=0;_<S;_++)for(a=0;a<x;a++)A[_][a]=r[_][a];for(_=0;_<x;_++){for(b[_]=f,g=0,u=_+1,a=_;a<S;a++)g+=Math.pow(A[a][_],2);if(g<h)f=0;else for(v=(p=A[_][_])*(f=p<0?Math.sqrt(g):-Math.sqrt(g))-g,A[_][_]=p-f,a=u;a<x;a++){for(g=0,c=_;c<S;c++)g+=A[c][_]*A[c][a];for(p=g/v,c=_;c<S;c++)A[c][a]=A[c][a]+p*A[c][_]}for(M[_]=f,g=0,a=u;a<x;a++)g+=Math.pow(A[_][a],2);if(g<h)f=0;else{for(v=(p=A[_][_+1])*(f=p<0?Math.sqrt(g):-Math.sqrt(g))-g,A[_][_+1]=p-f,a=u;a<x;a++)b[a]=A[_][a]/v;for(a=u;a<S;a++){for(g=0,c=u;c<x;c++)g+=A[a][c]*A[_][c];for(c=u;c<x;c++)A[a][c]=A[a][c]+g*b[c]}}m<(y=Math.abs(M[_])+Math.abs(b[_]))&&(m=y)}if(o)for(_=x-1;0<=_;_--){if(f!==0){for(v=A[_][_+1]*f,a=u;a<x;a++)O[a][_]=A[_][a]/v;for(a=u;a<x;a++){for(g=0,c=u;c<x;c++)g+=A[_][c]*O[c][a];for(c=u;c<x;c++)O[c][a]=O[c][a]+g*O[c][_]}}for(a=u;a<x;a++)O[_][a]=0,O[a][_]=0;O[_][_]=1,f=b[_],u=_}if(s){if(s==="f")for(_=x;_<S;_++){for(a=x;a<S;a++)A[_][a]=0;A[_][_]=1}for(_=x-1;0<=_;_--){for(u=_+1,f=M[_],a=u;a<P;a++)A[_][a]=0;if(f!==0){for(v=A[_][_]*f,a=u;a<P;a++){for(g=0,c=u;c<S;c++)g+=A[c][_]*A[c][a];for(p=g/v,c=_;c<S;c++)A[c][a]=A[c][a]+p*A[c][_]}for(a=_;a<S;a++)A[a][_]=A[a][_]/f}else for(a=_;a<S;a++)A[a][_]=0;A[_][_]=A[_][_]+1}}for(n*=m,c=x-1;0<=c;c--)for(var N=0;N<50;N++){for(C=!1,u=c;0<=u;u--){if(Math.abs(b[u])<=n){C=!0;break}if(Math.abs(M[u-1])<=n)break}if(!C){for(d=0,l=u-(g=1),_=u;_<c+1&&(p=g*b[_],b[_]=d*b[_],!(Math.abs(p)<=n));_++)if(f=M[_],M[_]=Math.sqrt(p*p+f*f),d=f/(v=M[_]),g=-p/v,s)for(a=0;a<S;a++)y=A[a][l],w=A[a][_],A[a][l]=y*d+w*g,A[a][_]=-y*g+w*d}if(w=M[c],u===c){if(w<0&&(M[c]=-w,o))for(a=0;a<x;a++)O[a][c]=-O[a][c];break}for(m=M[u],p=(((y=M[c-1])-w)*(y+w)+((f=b[c-1])-(v=b[c]))*(f+v))/(2*v*y),f=Math.sqrt(p*p+1),p=((m-w)*(m+w)+v*(y/(p<0?p-f:p+f)-v))/m,_=u+(g=d=1);_<c+1;_++){if(f=b[_],y=M[_],v=g*f,f*=d,w=Math.sqrt(p*p+v*v),p=m*(d=p/(b[_-1]=w))+f*(g=v/w),f=-m*g+f*d,v=y*g,y*=d,o)for(a=0;a<x;a++)m=O[a][_-1],w=O[a][_],O[a][_-1]=m*d+w*g,O[a][_]=-m*g+w*d;if(w=Math.sqrt(p*p+v*v),p=(d=p/(M[_-1]=w))*f+(g=v/w)*y,m=-g*f+d*y,s)for(a=0;a<S;a++)y=A[a][_-1],w=A[a][_],A[a][_-1]=y*d+w*g,A[a][_]=-y*g+w*d}b[u]=0,b[c]=p,M[c]=m}for(_=0;_<x;_++)M[_]<n&&(M[_]=0);return{u:A,q:M,v:O}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),cf=co(e=>{(function(){var t=function(){this.init()};t.prototype={init:function(){var l=this||i;return l._counter=1e3,l._html5AudioPool=[],l.html5PoolSize=10,l._codecs={},l._howls=[],l._muted=!1,l._volume=1,l._canPlayEvent="canplaythrough",l._navigator=typeof window<"u"&&window.navigator?window.navigator:null,l.masterGain=null,l.noAudio=!1,l.usingWebAudio=!0,l.autoSuspend=!0,l.ctx=null,l.autoUnlock=!0,l._setup(),l},volume:function(l){var d=this||i;if(l=parseFloat(l),d.ctx||u(),typeof l<"u"&&l>=0&&l<=1){if(d._volume=l,d._muted)return d;d.usingWebAudio&&d.masterGain.gain.setValueAtTime(l,i.ctx.currentTime);for(var p=0;p<d._howls.length;p++)if(!d._howls[p]._webAudio)for(var f=d._howls[p]._getSoundIds(),v=0;v<f.length;v++){var g=d._howls[p]._soundById(f[v]);g&&g._node&&(g._node.volume=g._volume*l)}return d}return d._volume},mute:function(l){var d=this||i;d.ctx||u(),d._muted=l,d.usingWebAudio&&d.masterGain.gain.setValueAtTime(l?0:d._volume,i.ctx.currentTime);for(var p=0;p<d._howls.length;p++)if(!d._howls[p]._webAudio)for(var f=d._howls[p]._getSoundIds(),v=0;v<f.length;v++){var g=d._howls[p]._soundById(f[v]);g&&g._node&&(g._node.muted=l?!0:g._muted)}return d},stop:function(){for(var l=this||i,d=0;d<l._howls.length;d++)l._howls[d].stop();return l},unload:function(){for(var l=this||i,d=l._howls.length-1;d>=0;d--)l._howls[d].unload();return l.usingWebAudio&&l.ctx&&typeof l.ctx.close<"u"&&(l.ctx.close(),l.ctx=null,u()),l},codecs:function(l){return(this||i)._codecs[l.replace(/^x-/,"")]},_setup:function(){var l=this||i;if(l.state=l.ctx&&l.ctx.state||"suspended",l._autoSuspend(),!l.usingWebAudio)if(typeof Audio<"u")try{var d=new Audio;typeof d.oncanplaythrough>"u"&&(l._canPlayEvent="canplay")}catch{l.noAudio=!0}else l.noAudio=!0;try{var d=new Audio;d.muted&&(l.noAudio=!0)}catch{}return l.noAudio||l._setupCodecs(),l},_setupCodecs:function(){var l=this||i,d=null;try{d=typeof Audio<"u"?new Audio:null}catch{return l}if(!d||typeof d.canPlayType!="function")return l;var p=d.canPlayType("audio/mpeg;").replace(/^no$/,""),f=l._navigator?l._navigator.userAgent:"",v=f.match(/OPR\/([0-6].)/g),g=v&&parseInt(v[0].split("/")[1],10)<33,m=f.indexOf("Safari")!==-1&&f.indexOf("Chrome")===-1,y=f.match(/Version\/(.*?) /),w=m&&y&&parseInt(y[1],10)<15;return l._codecs={mp3:!!(!g&&(p||d.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!p,opus:!!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(d.canPlayType('audio/wav; codecs="1"')||d.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!d.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!d.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(d.canPlayType("audio/x-m4b;")||d.canPlayType("audio/m4b;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(d.canPlayType("audio/x-mp4;")||d.canPlayType("audio/mp4;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!w&&d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!w&&d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!d.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(d.canPlayType("audio/x-flac;")||d.canPlayType("audio/flac;")).replace(/^no$/,"")},l},_unlockAudio:function(){var l=this||i;if(!(l._audioUnlocked||!l.ctx)){l._audioUnlocked=!1,l.autoUnlock=!1,!l._mobileUnloaded&&l.ctx.sampleRate!==44100&&(l._mobileUnloaded=!0,l.unload()),l._scratchBuffer=l.ctx.createBuffer(1,1,22050);var d=function(p){for(;l._html5AudioPool.length<l.html5PoolSize;)try{var f=new Audio;f._unlocked=!0,l._releaseHtml5Audio(f)}catch{l.noAudio=!0;break}for(var v=0;v<l._howls.length;v++)if(!l._howls[v]._webAudio)for(var g=l._howls[v]._getSoundIds(),m=0;m<g.length;m++){var y=l._howls[v]._soundById(g[m]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}l._autoResume();var w=l.ctx.createBufferSource();w.buffer=l._scratchBuffer,w.connect(l.ctx.destination),typeof w.start>"u"?w.noteOn(0):w.start(0),typeof l.ctx.resume=="function"&&l.ctx.resume(),w.onended=function(){w.disconnect(0),l._audioUnlocked=!0,document.removeEventListener("touchstart",d,!0),document.removeEventListener("touchend",d,!0),document.removeEventListener("click",d,!0),document.removeEventListener("keydown",d,!0);for(var x=0;x<l._howls.length;x++)l._howls[x]._emit("unlock")}};return document.addEventListener("touchstart",d,!0),document.addEventListener("touchend",d,!0),document.addEventListener("click",d,!0),document.addEventListener("keydown",d,!0),l}},_obtainHtml5Audio:function(){var l=this||i;if(l._html5AudioPool.length)return l._html5AudioPool.pop();var d=new Audio().play();return d&&typeof Promise<"u"&&(d instanceof Promise||typeof d.then=="function")&&d.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(l){var d=this||i;return l._unlocked&&d._html5AudioPool.push(l),d},_autoSuspend:function(){var l=this;if(!(!l.autoSuspend||!l.ctx||typeof l.ctx.suspend>"u"||!i.usingWebAudio)){for(var d=0;d<l._howls.length;d++)if(l._howls[d]._webAudio){for(var p=0;p<l._howls[d]._sounds.length;p++)if(!l._howls[d]._sounds[p]._paused)return l}return l._suspendTimer&&clearTimeout(l._suspendTimer),l._suspendTimer=setTimeout(function(){if(l.autoSuspend){l._suspendTimer=null,l.state="suspending";var f=function(){l.state="suspended",l._resumeAfterSuspend&&(delete l._resumeAfterSuspend,l._autoResume())};l.ctx.suspend().then(f,f)}},3e4),l}},_autoResume:function(){var l=this;if(!(!l.ctx||typeof l.ctx.resume>"u"||!i.usingWebAudio))return l.state==="running"&&l.ctx.state!=="interrupted"&&l._suspendTimer?(clearTimeout(l._suspendTimer),l._suspendTimer=null):l.state==="suspended"||l.state==="running"&&l.ctx.state==="interrupted"?(l.ctx.resume().then(function(){l.state="running";for(var d=0;d<l._howls.length;d++)l._howls[d]._emit("resume")}),l._suspendTimer&&(clearTimeout(l._suspendTimer),l._suspendTimer=null)):l.state==="suspending"&&(l._resumeAfterSuspend=!0),l}};var i=new t,r=function(l){var d=this;if(!l.src||l.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}d.init(l)};r.prototype={init:function(l){var d=this;return i.ctx||u(),d._autoplay=l.autoplay||!1,d._format=typeof l.format!="string"?l.format:[l.format],d._html5=l.html5||!1,d._muted=l.mute||!1,d._loop=l.loop||!1,d._pool=l.pool||5,d._preload=typeof l.preload=="boolean"||l.preload==="metadata"?l.preload:!0,d._rate=l.rate||1,d._sprite=l.sprite||{},d._src=typeof l.src!="string"?l.src:[l.src],d._volume=l.volume!==void 0?l.volume:1,d._xhr={method:l.xhr&&l.xhr.method?l.xhr.method:"GET",headers:l.xhr&&l.xhr.headers?l.xhr.headers:null,withCredentials:l.xhr&&l.xhr.withCredentials?l.xhr.withCredentials:!1},d._duration=0,d._state="unloaded",d._sounds=[],d._endTimers={},d._queue=[],d._playLock=!1,d._onend=l.onend?[{fn:l.onend}]:[],d._onfade=l.onfade?[{fn:l.onfade}]:[],d._onload=l.onload?[{fn:l.onload}]:[],d._onloaderror=l.onloaderror?[{fn:l.onloaderror}]:[],d._onplayerror=l.onplayerror?[{fn:l.onplayerror}]:[],d._onpause=l.onpause?[{fn:l.onpause}]:[],d._onplay=l.onplay?[{fn:l.onplay}]:[],d._onstop=l.onstop?[{fn:l.onstop}]:[],d._onmute=l.onmute?[{fn:l.onmute}]:[],d._onvolume=l.onvolume?[{fn:l.onvolume}]:[],d._onrate=l.onrate?[{fn:l.onrate}]:[],d._onseek=l.onseek?[{fn:l.onseek}]:[],d._onunlock=l.onunlock?[{fn:l.onunlock}]:[],d._onresume=[],d._webAudio=i.usingWebAudio&&!d._html5,typeof i.ctx<"u"&&i.ctx&&i.autoUnlock&&i._unlockAudio(),i._howls.push(d),d._autoplay&&d._queue.push({event:"play",action:function(){d.play()}}),d._preload&&d._preload!=="none"&&d.load(),d},load:function(){var l=this,d=null;if(i.noAudio){l._emit("loaderror",null,"No audio support.");return}typeof l._src=="string"&&(l._src=[l._src]);for(var p=0;p<l._src.length;p++){var f,v;if(l._format&&l._format[p])f=l._format[p];else{if(v=l._src[p],typeof v!="string"){l._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}f=/^data:audio\/([^;,]+);/i.exec(v),f||(f=/\.([^.]+)$/.exec(v.split("?",1)[0])),f&&(f=f[1].toLowerCase())}if(f||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),f&&i.codecs(f)){d=l._src[p];break}}if(!d){l._emit("loaderror",null,"No codec support for selected audio sources.");return}return l._src=d,l._state="loading",window.location.protocol==="https:"&&d.slice(0,5)==="http:"&&(l._html5=!0,l._webAudio=!1),new s(l),l._webAudio&&n(l),l},play:function(l,d){var p=this,f=null;if(typeof l=="number")f=l,l=null;else{if(typeof l=="string"&&p._state==="loaded"&&!p._sprite[l])return null;if(typeof l>"u"&&(l="__default",!p._playLock)){for(var v=0,g=0;g<p._sounds.length;g++)p._sounds[g]._paused&&!p._sounds[g]._ended&&(v++,f=p._sounds[g]._id);v===1?l=null:f=null}}var m=f?p._soundById(f):p._inactiveSound();if(!m)return null;if(f&&!l&&(l=m._sprite||"__default"),p._state!=="loaded"){m._sprite=l,m._ended=!1;var y=m._id;return p._queue.push({event:"play",action:function(){p.play(y)}}),y}if(f&&!m._paused)return d||p._loadQueue("play"),m._id;p._webAudio&&i._autoResume();var w=Math.max(0,m._seek>0?m._seek:p._sprite[l][0]/1e3),x=Math.max(0,(p._sprite[l][0]+p._sprite[l][1])/1e3-w),S=x*1e3/Math.abs(m._rate),b=p._sprite[l][0]/1e3,A=(p._sprite[l][0]+p._sprite[l][1])/1e3;m._sprite=l,m._ended=!1;var O=function(){m._paused=!1,m._seek=w,m._start=b,m._stop=A,m._loop=!!(m._loop||p._sprite[l][2])};if(w>=A){p._ended(m);return}var P=m._node;if(p._webAudio){var _=function(){p._playLock=!1,O(),p._refreshBuffer(m);var W=m._muted||p._muted?0:m._volume;P.gain.setValueAtTime(W,i.ctx.currentTime),m._playStart=i.ctx.currentTime,typeof P.bufferSource.start>"u"?m._loop?P.bufferSource.noteGrainOn(0,w,86400):P.bufferSource.noteGrainOn(0,w,x):m._loop?P.bufferSource.start(0,w,86400):P.bufferSource.start(0,w,x),S!==1/0&&(p._endTimers[m._id]=setTimeout(p._ended.bind(p,m),S)),d||setTimeout(function(){p._emit("play",m._id),p._loadQueue()},0)};i.state==="running"&&i.ctx.state!=="interrupted"?_():(p._playLock=!0,p.once("resume",_),p._clearTimer(m._id))}else{var C=function(){P.currentTime=w,P.muted=m._muted||p._muted||i._muted||P.muted,P.volume=m._volume*i.volume(),P.playbackRate=m._rate;try{var W=P.play();if(W&&typeof Promise<"u"&&(W instanceof Promise||typeof W.then=="function")?(p._playLock=!0,O(),W.then(function(){p._playLock=!1,P._unlocked=!0,d?p._loadQueue():p._emit("play",m._id)}).catch(function(){p._playLock=!1,p._emit("playerror",m._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),m._ended=!0,m._paused=!0})):d||(p._playLock=!1,O(),p._emit("play",m._id)),P.playbackRate=m._rate,P.paused){p._emit("playerror",m._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}l!=="__default"||m._loop?p._endTimers[m._id]=setTimeout(p._ended.bind(p,m),S):(p._endTimers[m._id]=function(){p._ended(m),P.removeEventListener("ended",p._endTimers[m._id],!1)},P.addEventListener("ended",p._endTimers[m._id],!1))}catch(Q){p._emit("playerror",m._id,Q)}};P.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(P.src=p._src,P.load());var M=window&&window.ejecta||!P.readyState&&i._navigator.isCocoonJS;if(P.readyState>=3||M)C();else{p._playLock=!0,p._state="loading";var N=function(){p._state="loaded",C(),P.removeEventListener(i._canPlayEvent,N,!1)};P.addEventListener(i._canPlayEvent,N,!1),p._clearTimer(m._id)}}return m._id},pause:function(l){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"pause",action:function(){d.pause(l)}}),d;for(var p=d._getSoundIds(l),f=0;f<p.length;f++){d._clearTimer(p[f]);var v=d._soundById(p[f]);if(v&&!v._paused&&(v._seek=d.seek(p[f]),v._rateSeek=0,v._paused=!0,d._stopFade(p[f]),v._node))if(d._webAudio){if(!v._node.bufferSource)continue;typeof v._node.bufferSource.stop>"u"?v._node.bufferSource.noteOff(0):v._node.bufferSource.stop(0),d._cleanBuffer(v._node)}else(!isNaN(v._node.duration)||v._node.duration===1/0)&&v._node.pause();arguments[1]||d._emit("pause",v?v._id:null)}return d},stop:function(l,d){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"stop",action:function(){p.stop(l)}}),p;for(var f=p._getSoundIds(l),v=0;v<f.length;v++){p._clearTimer(f[v]);var g=p._soundById(f[v]);g&&(g._seek=g._start||0,g._rateSeek=0,g._paused=!0,g._ended=!0,p._stopFade(f[v]),g._node&&(p._webAudio?g._node.bufferSource&&(typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),p._cleanBuffer(g._node)):(!isNaN(g._node.duration)||g._node.duration===1/0)&&(g._node.currentTime=g._start||0,g._node.pause(),g._node.duration===1/0&&p._clearSound(g._node))),d||p._emit("stop",g._id))}return p},mute:function(l,d){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"mute",action:function(){p.mute(l,d)}}),p;if(typeof d>"u")if(typeof l=="boolean")p._muted=l;else return p._muted;for(var f=p._getSoundIds(d),v=0;v<f.length;v++){var g=p._soundById(f[v]);g&&(g._muted=l,g._interval&&p._stopFade(g._id),p._webAudio&&g._node?g._node.gain.setValueAtTime(l?0:g._volume,i.ctx.currentTime):g._node&&(g._node.muted=i._muted?!0:l),p._emit("mute",g._id))}return p},volume:function(){var l=this,d=arguments,p,f;if(d.length===0)return l._volume;if(d.length===1||d.length===2&&typeof d[1]>"u"){var v=l._getSoundIds(),g=v.indexOf(d[0]);g>=0?f=parseInt(d[0],10):p=parseFloat(d[0])}else d.length>=2&&(p=parseFloat(d[0]),f=parseInt(d[1],10));var m;if(typeof p<"u"&&p>=0&&p<=1){if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"volume",action:function(){l.volume.apply(l,d)}}),l;typeof f>"u"&&(l._volume=p),f=l._getSoundIds(f);for(var y=0;y<f.length;y++)m=l._soundById(f[y]),m&&(m._volume=p,d[2]||l._stopFade(f[y]),l._webAudio&&m._node&&!m._muted?m._node.gain.setValueAtTime(p,i.ctx.currentTime):m._node&&!m._muted&&(m._node.volume=p*i.volume()),l._emit("volume",m._id))}else return m=f?l._soundById(f):l._sounds[0],m?m._volume:0;return l},fade:function(l,d,p,f){var v=this;if(v._state!=="loaded"||v._playLock)return v._queue.push({event:"fade",action:function(){v.fade(l,d,p,f)}}),v;l=Math.min(Math.max(0,parseFloat(l)),1),d=Math.min(Math.max(0,parseFloat(d)),1),p=parseFloat(p),v.volume(l,f);for(var g=v._getSoundIds(f),m=0;m<g.length;m++){var y=v._soundById(g[m]);if(y){if(f||v._stopFade(g[m]),v._webAudio&&!y._muted){var w=i.ctx.currentTime,x=w+p/1e3;y._volume=l,y._node.gain.setValueAtTime(l,w),y._node.gain.linearRampToValueAtTime(d,x)}v._startFadeInterval(y,l,d,p,g[m],typeof f>"u")}}return v},_startFadeInterval:function(l,d,p,f,v,g){var m=this,y=d,w=p-d,x=Math.abs(w/.01),S=Math.max(4,x>0?f/x:f),b=Date.now();l._fadeTo=p,l._interval=setInterval(function(){var A=(Date.now()-b)/f;b=Date.now(),y+=w*A,y=Math.round(y*100)/100,w<0?y=Math.max(p,y):y=Math.min(p,y),m._webAudio?l._volume=y:m.volume(y,l._id,!0),g&&(m._volume=y),(p<d&&y<=p||p>d&&y>=p)&&(clearInterval(l._interval),l._interval=null,l._fadeTo=null,m.volume(p,l._id),m._emit("fade",l._id))},S)},_stopFade:function(l){var d=this,p=d._soundById(l);return p&&p._interval&&(d._webAudio&&p._node.gain.cancelScheduledValues(i.ctx.currentTime),clearInterval(p._interval),p._interval=null,d.volume(p._fadeTo,l),p._fadeTo=null,d._emit("fade",l)),d},loop:function(){var l=this,d=arguments,p,f,v;if(d.length===0)return l._loop;if(d.length===1)if(typeof d[0]=="boolean")p=d[0],l._loop=p;else return v=l._soundById(parseInt(d[0],10)),v?v._loop:!1;else d.length===2&&(p=d[0],f=parseInt(d[1],10));for(var g=l._getSoundIds(f),m=0;m<g.length;m++)v=l._soundById(g[m]),v&&(v._loop=p,l._webAudio&&v._node&&v._node.bufferSource&&(v._node.bufferSource.loop=p,p&&(v._node.bufferSource.loopStart=v._start||0,v._node.bufferSource.loopEnd=v._stop,l.playing(g[m])&&(l.pause(g[m],!0),l.play(g[m],!0)))));return l},rate:function(){var l=this,d=arguments,p,f;if(d.length===0)f=l._sounds[0]._id;else if(d.length===1){var v=l._getSoundIds(),g=v.indexOf(d[0]);g>=0?f=parseInt(d[0],10):p=parseFloat(d[0])}else d.length===2&&(p=parseFloat(d[0]),f=parseInt(d[1],10));var m;if(typeof p=="number"){if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"rate",action:function(){l.rate.apply(l,d)}}),l;typeof f>"u"&&(l._rate=p),f=l._getSoundIds(f);for(var y=0;y<f.length;y++)if(m=l._soundById(f[y]),m){l.playing(f[y])&&(m._rateSeek=l.seek(f[y]),m._playStart=l._webAudio?i.ctx.currentTime:m._playStart),m._rate=p,l._webAudio&&m._node&&m._node.bufferSource?m._node.bufferSource.playbackRate.setValueAtTime(p,i.ctx.currentTime):m._node&&(m._node.playbackRate=p);var w=l.seek(f[y]),x=(l._sprite[m._sprite][0]+l._sprite[m._sprite][1])/1e3-w,S=x*1e3/Math.abs(m._rate);(l._endTimers[f[y]]||!m._paused)&&(l._clearTimer(f[y]),l._endTimers[f[y]]=setTimeout(l._ended.bind(l,m),S)),l._emit("rate",m._id)}}else return m=l._soundById(f),m?m._rate:l._rate;return l},seek:function(){var l=this,d=arguments,p,f;if(d.length===0)l._sounds.length&&(f=l._sounds[0]._id);else if(d.length===1){var v=l._getSoundIds(),g=v.indexOf(d[0]);g>=0?f=parseInt(d[0],10):l._sounds.length&&(f=l._sounds[0]._id,p=parseFloat(d[0]))}else d.length===2&&(p=parseFloat(d[0]),f=parseInt(d[1],10));if(typeof f>"u")return 0;if(typeof p=="number"&&(l._state!=="loaded"||l._playLock))return l._queue.push({event:"seek",action:function(){l.seek.apply(l,d)}}),l;var m=l._soundById(f);if(m)if(typeof p=="number"&&p>=0){var y=l.playing(f);y&&l.pause(f,!0),m._seek=p,m._ended=!1,l._clearTimer(f),!l._webAudio&&m._node&&!isNaN(m._node.duration)&&(m._node.currentTime=p);var w=function(){y&&l.play(f,!0),l._emit("seek",f)};if(y&&!l._webAudio){var x=function(){l._playLock?setTimeout(x,0):w()};setTimeout(x,0)}else w()}else if(l._webAudio){var S=l.playing(f)?i.ctx.currentTime-m._playStart:0,b=m._rateSeek?m._rateSeek-m._seek:0;return m._seek+(b+S*Math.abs(m._rate))}else return m._node.currentTime;return l},playing:function(l){var d=this;if(typeof l=="number"){var p=d._soundById(l);return p?!p._paused:!1}for(var f=0;f<d._sounds.length;f++)if(!d._sounds[f]._paused)return!0;return!1},duration:function(l){var d=this,p=d._duration,f=d._soundById(l);return f&&(p=d._sprite[f._sprite][1]/1e3),p},state:function(){return this._state},unload:function(){for(var l=this,d=l._sounds,p=0;p<d.length;p++)d[p]._paused||l.stop(d[p]._id),l._webAudio||(l._clearSound(d[p]._node),d[p]._node.removeEventListener("error",d[p]._errorFn,!1),d[p]._node.removeEventListener(i._canPlayEvent,d[p]._loadFn,!1),d[p]._node.removeEventListener("ended",d[p]._endFn,!1),i._releaseHtml5Audio(d[p]._node)),delete d[p]._node,l._clearTimer(d[p]._id);var f=i._howls.indexOf(l);f>=0&&i._howls.splice(f,1);var v=!0;for(p=0;p<i._howls.length;p++)if(i._howls[p]._src===l._src||l._src.indexOf(i._howls[p]._src)>=0){v=!1;break}return o&&v&&delete o[l._src],i.noAudio=!1,l._state="unloaded",l._sounds=[],l=null,null},on:function(l,d,p,f){var v=this,g=v["_on"+l];return typeof d=="function"&&g.push(f?{id:p,fn:d,once:f}:{id:p,fn:d}),v},off:function(l,d,p){var f=this,v=f["_on"+l],g=0;if(typeof d=="number"&&(p=d,d=null),d||p)for(g=0;g<v.length;g++){var m=p===v[g].id;if(d===v[g].fn&&m||!d&&m){v.splice(g,1);break}}else if(l)f["_on"+l]=[];else{var y=Object.keys(f);for(g=0;g<y.length;g++)y[g].indexOf("_on")===0&&Array.isArray(f[y[g]])&&(f[y[g]]=[])}return f},once:function(l,d,p){var f=this;return f.on(l,d,p,1),f},_emit:function(l,d,p){for(var f=this,v=f["_on"+l],g=v.length-1;g>=0;g--)(!v[g].id||v[g].id===d||l==="load")&&(setTimeout(function(m){m.call(this,d,p)}.bind(f,v[g].fn),0),v[g].once&&f.off(l,v[g].fn,v[g].id));return f._loadQueue(l),f},_loadQueue:function(l){var d=this;if(d._queue.length>0){var p=d._queue[0];p.event===l&&(d._queue.shift(),d._loadQueue()),l||p.action()}return d},_ended:function(l){var d=this,p=l._sprite;if(!d._webAudio&&l._node&&!l._node.paused&&!l._node.ended&&l._node.currentTime<l._stop)return setTimeout(d._ended.bind(d,l),100),d;var f=!!(l._loop||d._sprite[p][2]);if(d._emit("end",l._id),!d._webAudio&&f&&d.stop(l._id,!0).play(l._id),d._webAudio&&f){d._emit("play",l._id),l._seek=l._start||0,l._rateSeek=0,l._playStart=i.ctx.currentTime;var v=(l._stop-l._start)*1e3/Math.abs(l._rate);d._endTimers[l._id]=setTimeout(d._ended.bind(d,l),v)}return d._webAudio&&!f&&(l._paused=!0,l._ended=!0,l._seek=l._start||0,l._rateSeek=0,d._clearTimer(l._id),d._cleanBuffer(l._node),i._autoSuspend()),!d._webAudio&&!f&&d.stop(l._id,!0),d},_clearTimer:function(l){var d=this;if(d._endTimers[l]){if(typeof d._endTimers[l]!="function")clearTimeout(d._endTimers[l]);else{var p=d._soundById(l);p&&p._node&&p._node.removeEventListener("ended",d._endTimers[l],!1)}delete d._endTimers[l]}return d},_soundById:function(l){for(var d=this,p=0;p<d._sounds.length;p++)if(l===d._sounds[p]._id)return d._sounds[p];return null},_inactiveSound:function(){var l=this;l._drain();for(var d=0;d<l._sounds.length;d++)if(l._sounds[d]._ended)return l._sounds[d].reset();return new s(l)},_drain:function(){var l=this,d=l._pool,p=0,f=0;if(!(l._sounds.length<d)){for(f=0;f<l._sounds.length;f++)l._sounds[f]._ended&&p++;for(f=l._sounds.length-1;f>=0;f--){if(p<=d)return;l._sounds[f]._ended&&(l._webAudio&&l._sounds[f]._node&&l._sounds[f]._node.disconnect(0),l._sounds.splice(f,1),p--)}}},_getSoundIds:function(l){var d=this;if(typeof l>"u"){for(var p=[],f=0;f<d._sounds.length;f++)p.push(d._sounds[f]._id);return p}else return[l]},_refreshBuffer:function(l){var d=this;return l._node.bufferSource=i.ctx.createBufferSource(),l._node.bufferSource.buffer=o[d._src],l._panner?l._node.bufferSource.connect(l._panner):l._node.bufferSource.connect(l._node),l._node.bufferSource.loop=l._loop,l._loop&&(l._node.bufferSource.loopStart=l._start||0,l._node.bufferSource.loopEnd=l._stop||0),l._node.bufferSource.playbackRate.setValueAtTime(l._rate,i.ctx.currentTime),d},_cleanBuffer:function(l){var d=this,p=i._navigator&&i._navigator.vendor.indexOf("Apple")>=0;if(i._scratchBuffer&&l.bufferSource&&(l.bufferSource.onended=null,l.bufferSource.disconnect(0),p))try{l.bufferSource.buffer=i._scratchBuffer}catch{}return l.bufferSource=null,d},_clearSound:function(l){var d=/MSIE |Trident\//.test(i._navigator&&i._navigator.userAgent);d||(l.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var s=function(l){this._parent=l,this.init()};s.prototype={init:function(){var l=this,d=l._parent;return l._muted=d._muted,l._loop=d._loop,l._volume=d._volume,l._rate=d._rate,l._seek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++i._counter,d._sounds.push(l),l.create(),l},create:function(){var l=this,d=l._parent,p=i._muted||l._muted||l._parent._muted?0:l._volume;return d._webAudio?(l._node=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),l._node.gain.setValueAtTime(p,i.ctx.currentTime),l._node.paused=!0,l._node.connect(i.masterGain)):i.noAudio||(l._node=i._obtainHtml5Audio(),l._errorFn=l._errorListener.bind(l),l._node.addEventListener("error",l._errorFn,!1),l._loadFn=l._loadListener.bind(l),l._node.addEventListener(i._canPlayEvent,l._loadFn,!1),l._endFn=l._endListener.bind(l),l._node.addEventListener("ended",l._endFn,!1),l._node.src=d._src,l._node.preload=d._preload===!0?"auto":d._preload,l._node.volume=p*i.volume(),l._node.load()),l},reset:function(){var l=this,d=l._parent;return l._muted=d._muted,l._loop=d._loop,l._volume=d._volume,l._rate=d._rate,l._seek=0,l._rateSeek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++i._counter,l},_errorListener:function(){var l=this;l._parent._emit("loaderror",l._id,l._node.error?l._node.error.code:0),l._node.removeEventListener("error",l._errorFn,!1)},_loadListener:function(){var l=this,d=l._parent;d._duration=Math.ceil(l._node.duration*10)/10,Object.keys(d._sprite).length===0&&(d._sprite={__default:[0,d._duration*1e3]}),d._state!=="loaded"&&(d._state="loaded",d._emit("load"),d._loadQueue()),l._node.removeEventListener(i._canPlayEvent,l._loadFn,!1)},_endListener:function(){var l=this,d=l._parent;d._duration===1/0&&(d._duration=Math.ceil(l._node.duration*10)/10,d._sprite.__default[1]===1/0&&(d._sprite.__default[1]=d._duration*1e3),d._ended(l)),l._node.removeEventListener("ended",l._endFn,!1)}};var o={},n=function(l){var d=l._src;if(o[d]){l._duration=o[d].duration,c(l);return}if(/^data:[^;]+;base64,/.test(d)){for(var p=atob(d.split(",")[1]),f=new Uint8Array(p.length),v=0;v<p.length;++v)f[v]=p.charCodeAt(v);a(f.buffer,l)}else{var g=new XMLHttpRequest;g.open(l._xhr.method,d,!0),g.withCredentials=l._xhr.withCredentials,g.responseType="arraybuffer",l._xhr.headers&&Object.keys(l._xhr.headers).forEach(function(m){g.setRequestHeader(m,l._xhr.headers[m])}),g.onload=function(){var m=(g.status+"")[0];if(m!=="0"&&m!=="2"&&m!=="3"){l._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");return}a(g.response,l)},g.onerror=function(){l._webAudio&&(l._html5=!0,l._webAudio=!1,l._sounds=[],delete o[d],l.load())},h(g)}},h=function(l){try{l.send()}catch{l.onerror()}},a=function(l,d){var p=function(){d._emit("loaderror",null,"Decoding audio data failed.")},f=function(v){v&&d._sounds.length>0?(o[d._src]=v,c(d,v)):p()};typeof Promise<"u"&&i.ctx.decodeAudioData.length===1?i.ctx.decodeAudioData(l).then(f).catch(p):i.ctx.decodeAudioData(l,f,p)},c=function(l,d){d&&!l._duration&&(l._duration=d.duration),Object.keys(l._sprite).length===0&&(l._sprite={__default:[0,l._duration*1e3]}),l._state!=="loaded"&&(l._state="loaded",l._emit("load"),l._loadQueue())},u=function(){if(i.usingWebAudio){try{typeof AudioContext<"u"?i.ctx=new AudioContext:typeof webkitAudioContext<"u"?i.ctx=new webkitAudioContext:i.usingWebAudio=!1}catch{i.usingWebAudio=!1}i.ctx||(i.usingWebAudio=!1);var l=/iP(hone|od|ad)/.test(i._navigator&&i._navigator.platform),d=i._navigator&&i._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),p=d?parseInt(d[1],10):null;if(l&&p&&p<9){var f=/safari/.test(i._navigator&&i._navigator.userAgent.toLowerCase());i._navigator&&!f&&(i.usingWebAudio=!1)}i.usingWebAudio&&(i.masterGain=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),i.masterGain.gain.setValueAtTime(i._muted?0:i._volume,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination)),i._setup()}};typeof define=="function"&&define.amd&&define([],function(){return{Howler:i,Howl:r}}),typeof e<"u"&&(e.Howler=i,e.Howl=r),typeof global<"u"?(global.HowlerGlobal=t,global.Howler=i,global.Howl=r,global.Sound=s):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=i,window.Howl=r,window.Sound=s)})(),function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(i){var r=this;if(!r.ctx||!r.ctx.listener)return r;for(var s=r._howls.length-1;s>=0;s--)r._howls[s].stereo(i);return r},HowlerGlobal.prototype.pos=function(i,r,s){var o=this;if(!o.ctx||!o.ctx.listener)return o;if(r=typeof r!="number"?o._pos[1]:r,s=typeof s!="number"?o._pos[2]:s,typeof i=="number")o._pos=[i,r,s],typeof o.ctx.listener.positionX<"u"?(o.ctx.listener.positionX.setTargetAtTime(o._pos[0],Howler.ctx.currentTime,.1),o.ctx.listener.positionY.setTargetAtTime(o._pos[1],Howler.ctx.currentTime,.1),o.ctx.listener.positionZ.setTargetAtTime(o._pos[2],Howler.ctx.currentTime,.1)):o.ctx.listener.setPosition(o._pos[0],o._pos[1],o._pos[2]);else return o._pos;return o},HowlerGlobal.prototype.orientation=function(i,r,s,o,n,h){var a=this;if(!a.ctx||!a.ctx.listener)return a;var c=a._orientation;if(r=typeof r!="number"?c[1]:r,s=typeof s!="number"?c[2]:s,o=typeof o!="number"?c[3]:o,n=typeof n!="number"?c[4]:n,h=typeof h!="number"?c[5]:h,typeof i=="number")a._orientation=[i,r,s,o,n,h],typeof a.ctx.listener.forwardX<"u"?(a.ctx.listener.forwardX.setTargetAtTime(i,Howler.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(r,Howler.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(s,Howler.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(o,Howler.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(n,Howler.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(h,Howler.ctx.currentTime,.1)):a.ctx.listener.setOrientation(i,r,s,o,n,h);else return c;return a},Howl.prototype.init=function(i){return function(r){var s=this;return s._orientation=r.orientation||[1,0,0],s._stereo=r.stereo||null,s._pos=r.pos||null,s._pannerAttr={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:360,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:360,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:0,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:"inverse",maxDistance:typeof r.maxDistance<"u"?r.maxDistance:1e4,panningModel:typeof r.panningModel<"u"?r.panningModel:"HRTF",refDistance:typeof r.refDistance<"u"?r.refDistance:1,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:1},s._onstereo=r.onstereo?[{fn:r.onstereo}]:[],s._onpos=r.onpos?[{fn:r.onpos}]:[],s._onorientation=r.onorientation?[{fn:r.onorientation}]:[],i.call(this,r)}}(Howl.prototype.init),Howl.prototype.stereo=function(i,r){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"stereo",action:function(){s.stereo(i,r)}}),s;var o=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof r>"u")if(typeof i=="number")s._stereo=i,s._pos=[i,0,0];else return s._stereo;for(var n=s._getSoundIds(r),h=0;h<n.length;h++){var a=s._soundById(n[h]);if(a)if(typeof i=="number")a._stereo=i,a._pos=[i,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",(!a._panner||!a._panner.pan)&&t(a,o),o==="spatial"?typeof a._panner.positionX<"u"?(a._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(i,0,0):a._panner.pan.setValueAtTime(i,Howler.ctx.currentTime)),s._emit("stereo",a._id);else return a._stereo}return s},Howl.prototype.pos=function(i,r,s,o){var n=this;if(!n._webAudio)return n;if(n._state!=="loaded")return n._queue.push({event:"pos",action:function(){n.pos(i,r,s,o)}}),n;if(r=typeof r!="number"?0:r,s=typeof s!="number"?-.5:s,typeof o>"u")if(typeof i=="number")n._pos=[i,r,s];else return n._pos;for(var h=n._getSoundIds(o),a=0;a<h.length;a++){var c=n._soundById(h[a]);if(c)if(typeof i=="number")c._pos=[i,r,s],c._node&&((!c._panner||c._panner.pan)&&t(c,"spatial"),typeof c._panner.positionX<"u"?(c._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(r,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):c._panner.setPosition(i,r,s)),n._emit("pos",c._id);else return c._pos}return n},Howl.prototype.orientation=function(i,r,s,o){var n=this;if(!n._webAudio)return n;if(n._state!=="loaded")return n._queue.push({event:"orientation",action:function(){n.orientation(i,r,s,o)}}),n;if(r=typeof r!="number"?n._orientation[1]:r,s=typeof s!="number"?n._orientation[2]:s,typeof o>"u")if(typeof i=="number")n._orientation=[i,r,s];else return n._orientation;for(var h=n._getSoundIds(o),a=0;a<h.length;a++){var c=n._soundById(h[a]);if(c)if(typeof i=="number")c._orientation=[i,r,s],c._node&&(c._panner||(c._pos||(c._pos=n._pos||[0,0,-.5]),t(c,"spatial")),typeof c._panner.orientationX<"u"?(c._panner.orientationX.setValueAtTime(i,Howler.ctx.currentTime),c._panner.orientationY.setValueAtTime(r,Howler.ctx.currentTime),c._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):c._panner.setOrientation(i,r,s)),n._emit("orientation",c._id);else return c._orientation}return n},Howl.prototype.pannerAttr=function(){var i=this,r=arguments,s,o,n;if(!i._webAudio)return i;if(r.length===0)return i._pannerAttr;if(r.length===1)if(typeof r[0]=="object")s=r[0],typeof o>"u"&&(s.pannerAttr||(s.pannerAttr={coneInnerAngle:s.coneInnerAngle,coneOuterAngle:s.coneOuterAngle,coneOuterGain:s.coneOuterGain,distanceModel:s.distanceModel,maxDistance:s.maxDistance,refDistance:s.refDistance,rolloffFactor:s.rolloffFactor,panningModel:s.panningModel}),i._pannerAttr={coneInnerAngle:typeof s.pannerAttr.coneInnerAngle<"u"?s.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:typeof s.pannerAttr.coneOuterAngle<"u"?s.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:typeof s.pannerAttr.coneOuterGain<"u"?s.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:typeof s.pannerAttr.distanceModel<"u"?s.pannerAttr.distanceModel:i._distanceModel,maxDistance:typeof s.pannerAttr.maxDistance<"u"?s.pannerAttr.maxDistance:i._maxDistance,refDistance:typeof s.pannerAttr.refDistance<"u"?s.pannerAttr.refDistance:i._refDistance,rolloffFactor:typeof s.pannerAttr.rolloffFactor<"u"?s.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:typeof s.pannerAttr.panningModel<"u"?s.pannerAttr.panningModel:i._panningModel});else return n=i._soundById(parseInt(r[0],10)),n?n._pannerAttr:i._pannerAttr;else r.length===2&&(s=r[0],o=parseInt(r[1],10));for(var h=i._getSoundIds(o),a=0;a<h.length;a++)if(n=i._soundById(h[a]),n){var c=n._pannerAttr;c={coneInnerAngle:typeof s.coneInnerAngle<"u"?s.coneInnerAngle:c.coneInnerAngle,coneOuterAngle:typeof s.coneOuterAngle<"u"?s.coneOuterAngle:c.coneOuterAngle,coneOuterGain:typeof s.coneOuterGain<"u"?s.coneOuterGain:c.coneOuterGain,distanceModel:typeof s.distanceModel<"u"?s.distanceModel:c.distanceModel,maxDistance:typeof s.maxDistance<"u"?s.maxDistance:c.maxDistance,refDistance:typeof s.refDistance<"u"?s.refDistance:c.refDistance,rolloffFactor:typeof s.rolloffFactor<"u"?s.rolloffFactor:c.rolloffFactor,panningModel:typeof s.panningModel<"u"?s.panningModel:c.panningModel};var u=n._panner;u?(u.coneInnerAngle=c.coneInnerAngle,u.coneOuterAngle=c.coneOuterAngle,u.coneOuterGain=c.coneOuterGain,u.distanceModel=c.distanceModel,u.maxDistance=c.maxDistance,u.refDistance=c.refDistance,u.rolloffFactor=c.rolloffFactor,u.panningModel=c.panningModel):(n._pos||(n._pos=i._pos||[0,0,-.5]),t(n,"spatial"))}return i},Sound.prototype.init=function(i){return function(){var r=this,s=r._parent;r._orientation=s._orientation,r._stereo=s._stereo,r._pos=s._pos,r._pannerAttr=s._pannerAttr,i.call(this),r._stereo?s.stereo(r._stereo):r._pos&&s.pos(r._pos[0],r._pos[1],r._pos[2],r._id)}}(Sound.prototype.init),Sound.prototype.reset=function(i){return function(){var r=this,s=r._parent;return r._orientation=s._orientation,r._stereo=s._stereo,r._pos=s._pos,r._pannerAttr=s._pannerAttr,r._stereo?s.stereo(r._stereo):r._pos?s.pos(r._pos[0],r._pos[1],r._pos[2],r._id):r._panner&&(r._panner.disconnect(0),r._panner=void 0,s._refreshBuffer(r)),i.call(this)}}(Sound.prototype.reset);var t=function(i,r){r=r||"spatial",r==="spatial"?(i._panner=Howler.ctx.createPanner(),i._panner.coneInnerAngle=i._pannerAttr.coneInnerAngle,i._panner.coneOuterAngle=i._pannerAttr.coneOuterAngle,i._panner.coneOuterGain=i._pannerAttr.coneOuterGain,i._panner.distanceModel=i._pannerAttr.distanceModel,i._panner.maxDistance=i._pannerAttr.maxDistance,i._panner.refDistance=i._pannerAttr.refDistance,i._panner.rolloffFactor=i._pannerAttr.rolloffFactor,i._panner.panningModel=i._pannerAttr.panningModel,typeof i._panner.positionX<"u"?(i._panner.positionX.setValueAtTime(i._pos[0],Howler.ctx.currentTime),i._panner.positionY.setValueAtTime(i._pos[1],Howler.ctx.currentTime),i._panner.positionZ.setValueAtTime(i._pos[2],Howler.ctx.currentTime)):i._panner.setPosition(i._pos[0],i._pos[1],i._pos[2]),typeof i._panner.orientationX<"u"?(i._panner.orientationX.setValueAtTime(i._orientation[0],Howler.ctx.currentTime),i._panner.orientationY.setValueAtTime(i._orientation[1],Howler.ctx.currentTime),i._panner.orientationZ.setValueAtTime(i._orientation[2],Howler.ctx.currentTime)):i._panner.setOrientation(i._orientation[0],i._orientation[1],i._orientation[2])):(i._panner=Howler.ctx.createStereoPanner(),i._panner.pan.setValueAtTime(i._stereo,Howler.ctx.currentTime)),i._panner.connect(i._node),i._paused||i._parent.pause(i._id,!0).play(i._id,!0)}}()}),df=co((e,t)=>{t.exports=function(i,r){for(var s=i.split("."),o=r.split("."),n=0;n<3;n++){var h=Number(s[n]),a=Number(o[n]);if(h>a)return 1;if(a>h)return-1;if(!isNaN(h)&&isNaN(a))return 1;if(isNaN(h)&&!isNaN(a))return-1}return 0}}),ke=class{modifyById(e,t){let i=this;if(i[e]===void 0)throw new Error("not expected");{let r={...i,[e]:t};return Object.setPrototypeOf(r,ke.prototype),r}}add(e,t){var i;return((i=this.runOp({type:1,id:e,data:t}))==null?void 0:i.data)??this}runOp(e){let t=this;if(e.type===1){let i=t[e.id],r;i===void 0?r={type:2,id:e.id}:r={type:1,id:e.id,data:i};let{id:s,data:o}=e,n={...t,[s]:o};return Object.setPrototypeOf(n,ke.prototype),{data:n,actual:e,reverse:r}}else if(e.type===2){let{id:i}=e,r=t[i];if(r===void 0)return null;{let s={...t};return Object.setPrototypeOf(s,ke.prototype),delete s[i],{data:s,actual:e,reverse:{type:1,id:i,data:r}}}}return null}};function oa(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let i of t){let r=e[i];r&&typeof r=="object"&&oa(r)}return Object.freeze(e)}function uf(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var Ec=class extends Error{};function No(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function ii(e,t,i){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let o=e;e=t,t=o}let r=[],s=1/(i+1);for(let o=0;o<i;o++){let n=e+(t-e)*(o+.75+Math.random()*.5)*s;r.push(n)}return r}function na(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function pf(){return typeof process<"u"}function Dc(e,t){for(let i of e)t(i.id,i.data)!==!0&&Dc(i.children,t)}function Lc(e,t){if(t(e.id,e.data)!==!0)for(let i of e.children)Lc(i,t)}var Ot=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Ot.prototype)}deepFreeze(){let e=0;for(;e<this.length;)oa(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){var t;return(t=this.get(e))==null?void 0:t.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return e===null?this:(t=this.get(e))==null?void 0:t.children}traverseFrom(e,t){if(e===null)this.traverse(t);else{let i=this.get(e);i&&Lc(i,t)}}traverse(e){Dc(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this.parent(e),r=this.childrenArray(i),s=r.findIndex(n=>n.id===e);if(s<0)throw new Error("not expected");let o=r[s];return r=[...r],r[s]={...o,data:t},this.modifyArrayBy(i,r)}}modifyArrayBy(e,t){let i=e,r=t;for(;i!==null;){let o=r,n=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let h=r.findIndex(a=>a.id===n);if(h<0)throw new Error;r=[...r],r[h]={...r[h],children:o}}Object.setPrototypeOf(r,Ot.prototype);let s=r;return s.fillCaches(),s}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(this.get(e)!==void 0)return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:r,data:s,children:o}=e;if(t!==null&&this.get(t)===void 0||this.checkDuplicatedIdRec(e))return null;{let n=t,h=this.childrenArray(n),a={fi:i,id:r,data:s,children:o};return h=[...h,a],h.sort((c,u)=>c.fi-u.fi),e.localIndex=h.indexOf(a),{data:this.modifyArrayBy(n,h),actual:e,reverse:{type:8,id:r}}}}deleteOp(e){let{id:t}=e;if(this.get(t)===null)return null;{let i=this.parent(t);if(i===void 0)return null;let r=this.childrenArray(i),s=r.findIndex(n=>n.id===t);e.localIndex=s,r=[...r];let o=r.splice(s,1)[0];return{data:this.modifyArrayBy(i,r),actual:e,reverse:{type:7,...o,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:r}=e;if(t!==null&&this.get(t)===void 0)return this.deleteOp({type:8,id:r});if(t!==null){let l=t;for(;l!==null;){if(l===void 0)throw new Error;if(l===r)throw new Ec("cyclic tree");l=this.parent(l)}}let s=this.parent(r);if(s===void 0)return null;let o=s,n=this.childrenArray(s),h=n.findIndex(l=>l.id===r);n=[...n];let a=n.splice(h,1)[0],c=this.modifyArrayBy(s,n);s=t,n=c.childrenArray(s);let u=a.fi;return a={...a,fi:i},n=[...n,a],n.sort((l,d)=>l.fi-d.fi),e.localIndex=n.indexOf(a),c=c.modifyArrayBy(s,n),{data:c,actual:e,reverse:{type:9,parent:o,fi:u,id:r}}}previous(e,t){if(t===null){let r=this.childrenArray(e);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(e)){if(r.id===t)return i;i=r.id}return null}traverseSortNext(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(s=>s.id===e)+1;if(r<i.length)return i[r].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(s=>s.id===e)-1;return r>=0?this.traverseSortPrevious(i[r].id):t}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push({...i,...r})}t.sort((i,r)=>uf(i.sortKey,r.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],r=this.get(t),s=r;if(r!==void 0){for(;t;)i.splice(0,0,r.fi),t=this.parent(t),t!==null&&(r=this.get(t));return{...s,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let r=this.childrenArray(e);if(t===null){if(r.length===0)return ii(0,i,i);{let s=r[0].fi;return ii(s-i,s,i)}}else{let s=this.get(t);if(s===void 0||this.parent(t)!==e)throw new Error("illegal args");let o=r.find(n=>n.fi>s.fi);if(o===void 0){let n=r[r.length-1].fi;return ii(n,n+i,i)}else return ii(s.fi,o.fi,i)}}},ks;(e=>{function t(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let s=r.props,o={},n=[...i],h=!1;if(s)for(let a of Object.keys(s)){let c=parseInt(a);if(isNaN(c))throw new Error("wrong index");o[a]=n[c],n[c]=s[a],h=!0}return h?{data:n,actual:r,reverse:{type:0,props:o}}:null}else{let s=r.props,o={},n={...i},h=!1;if(s)for(let a of Object.keys(s)){o[a]=n[a];let c=s[a];c===void 0?delete n[a]:n[a]=c,h=!0}return h?{data:n,actual:r,reverse:{type:0,props:o}}:null}}e.runOp=t})(ks||(ks={}));var Ce=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Ce.prototype)}deepFreeze(){let e=0;for(;e<this.length;)oa(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return(t=this.get(e))==null?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(o=>o.id===e);if(r<0)throw new Error("not expected");let s=i[r];return i=[...i],i[r]={...s,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,Ce.prototype);let t=e;return pf()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:r}=e,s=this,o={fi:t,id:i,data:r};return s=[...s,o],s.sort((n,h)=>n.fi-h.fi),e.localIndex=s.indexOf(o),{data:this.modifyArrayBy(s),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,r=i.findIndex(o=>o.id===t);if(r===-1)return null;e.localIndex=r,i=[...i];let s=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...s}}}moveOp(e){let{fi:t,id:i}=e,r=this;r=[...r];let s=r.findIndex(h=>h.id===i);if(s===-1)return null;let o=r[s].fi,n={...r[s],fi:t};return r[s]=n,r.sort((h,a)=>h.fi-a.fi),e.localIndex=r.indexOf(n),{data:this.modifyArrayBy(r),actual:e,reverse:{type:6,fi:o,id:i}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(e===null){if(i.length===0)return ii(0,t,t);{let r=i[0].fi;return ii(r-t,r,t)}}else{let r=this.get(e);if(r===void 0)throw new Error("illegal args");let s=i.find(o=>o.fi>r.fi);if(s===void 0){let o=i[i.length-1].fi;return ii(o,o+t,t)}else return ii(r.fi,s.fi,t)}}};function rr(e){return e&&typeof e=="object"&&e instanceof qe}var qe=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,r=0,s={};for(;r<e.path.length;){if(t.push(i),i=i===void 0?void 0:i[e.path[r]],i!==void 0&&!rr(i))return null;r+=1}i=i?No(i):new qe;for(let[h,a]of Object.entries(e.props)){let c=i[h];s[h]=c,a===void 0?delete i[h]:i[h]=a}for(;r>0;){if(Object.keys(i).length===0){let h=t[r-1];h&&(i=No(h),delete i[e.path[r-1]])}else{let h=t[r-1];if(h){let a=No(h);a[e.path[r-1]]=i,i=a}else{let a=new qe;a[e.path[r-1]]=i,i=a}}r-=1}let o=Object.setPrototypeOf(i,qe.prototype),n={...e,props:s};return{data:o,actual:e,reverse:n}}},Ci;(e=>{function t(s,o){return Wr(s,o)??s}e.apply=t;function i(s,o){return la(s,o)}e.merge=i;function r(s,o){let n=0,h=o.path,a=s;for(;n<h.length&&a!==void 0;){if(a=kt.zoomOnce(a,h[n]),a===void 0)return o;if(!rr(a))return;n+=1}if(a===void 0)return o;if(rr(a))if(o.type===0){let c={...o.props};for(let u of Object.keys(a))delete c[u];return{...o,props:c}}else if(o.type===1||o.type===4||o.type===7){let c=aa([o],a);return c?(console.log(c),c):o}else return o}e.filterOp=r})(Ci||(Ci={}));function aa(e,t){if(t===void 0)return;let i=!1,r=e.map(s=>{let o=s.id,n=Wr(s.data,t[o]);if(i=i||n!==void 0,n===void 0&&(n=s.data),s.children){let h=aa(s.children,t);return h!==void 0?i=!0:h=s.children,{...s,id:o,data:n,children:h}}else return{...s,id:o,data:n}});if(i)return r}function ff(e,t){if(t===void 0)return;let i=!1,r=e.map(s=>{let o=s.id,n=Wr(s.data,t[o]);return i=i||n!==void 0,n===void 0&&(n=s.data),{...s,id:o,data:n}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}function Wr(e,t){if(!rr(t))return t;if(e instanceof Ot){let i=aa(e,t);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof Ce)return ff(e,t);if(Array.isArray(e)){let i=!1,r=e.map((s,o)=>{let n=Wr(s,t[o]);return i=i||n!==void 0,n===void 0&&(n=s),n});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else{if(e instanceof qe)return la(e,t);if(e&&typeof e=="object"){let i={},r=!1;for(let[s,o]of Object.entries(e)){let n=Wr(o,t[s]);r=r||n!==void 0,n===void 0&&(n=o),i[s]=n}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}}}function la(e,t){if(e===void 0)return t;if(t===void 0)return e;if(!rr(t))return t;if(!rr(e))return Ci.apply(e,t);let i=new Set;for(let s of Object.keys(e))i.add(s);for(let s of Object.keys(t))i.add(s);let r=new qe;for(let s of i){let o=la(e===void 0?void 0:e[s],t===void 0?void 0:t[s]);r[s]=o}return r}function mf(e,t){let i={cur:[],result:[],len:0};return e=qr(e,t,i)??e,[e,i.result]}function Fs(e,t){return e===null?null:(e.cur[e.len]=t,e.len+=1,e)}function Vs(e){e&&(e.len-=1)}function gf(e){if(e===null)return null;e.result.push(e.cur.slice(0,e.len))}function Ic(e,t,i){let r=!1,s=e.map(o=>{let n=o.id,h=t[n];if(h!==void 0&&typeof h=="string"&&(r=!0,n=h,i!==null))throw new Error("not supported");let a=qr(o.data,t,Fs(i,n));Vs(i),r=r||a!==void 0,a===void 0&&(a=o.data);let c=Ic(o.children,t,i);return c!==void 0?r=!0:c=o.children,{...o,id:n,data:a,children:c}});if(r)return s}function vf(e,t,i){let r=!1,s=e.map(o=>{let n=o.id,h=t[n];if(h!==void 0&&typeof h=="string"&&(r=!0,n=h,i!==null))throw new Error("not supported");let a=qr(o.data,t,Fs(i,n));return Vs(i),r=r||a!==void 0,a===void 0&&(a=o.data),{...o,id:n,data:a}});if(r)return Object.setPrototypeOf(s,Object.getPrototypeOf(e)),s}function qr(e,t,i){if(e instanceof Ot){let r=Ic(e,t,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}else{if(e instanceof Ce)return vf(e,t,i);if(Array.isArray(e)){let r=!1,s=e.map((o,n)=>{let h=qr(o,t,Fs(i,n));return Vs(i),r=r||h!==void 0,h===void 0&&(h=o),h});return r?(Object.setPrototypeOf(s,Object.getPrototypeOf(e)),s):void 0}else if(e&&typeof e=="object"&&!na(e)){let r={},s=!1;for(let[o,n]of Object.entries(e))if(o!=="name"&&o!=="text"){let h=t[o];if(typeof h=="string"){if(i!==null)throw new Error("not supported");s=!0,o=h}let a=qr(n,t,Fs(i,o));Vs(i),s=s||a!==void 0,a===void 0&&(a=n),r[o]=a}else r[o]=n;return s?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else if(typeof e=="string"){let r=t[e];if(r!==void 0){if(e.length!==36)throw new Error("for now you should only call this method when the key is a uuid");gf(i)}return r}else return}}var vn;(e=>{function t(i,r){let s=kt.zoom(r,i.path);if(typeof s=="object"){let o={};for(let n of Object.keys(i.props))o[n]=s[n];return{...i,props:o}}else return{...i,props:{}}}e.replaceProps=t})(vn||(vn={}));var st;(e=>{function t(a,c){return{...a,path:a.path.slice(c)}}e.drop=t;function i(a,c){var u;return((u=r(a,c))==null?void 0:u.data)??a}e.applySimple=i;function r(a,c){var d,p;let u=c.path;for(var l=[];;){let f;if(a instanceof qe&&c.type===0&&(f=a.runOp({...c,path:u.slice(l.length)}),f===null&&(f=void 0)),f===void 0&&l.length===u.length&&(a instanceof Ot||a instanceof Ce||a instanceof ke?f=a.runOp(c):f=ks.runOp(a,c)),f!==void 0)if(f!==null){let m=f.data;for(let y=l.length-1;y>=0;y--){let w=u[y],x=l[y];if(x instanceof Ot){if(typeof w=="number")throw new Error("illegal arg");m=x.modifyById(w,m)}else if(x instanceof Ce){if(typeof w=="number")throw new Error("illegal arg");m=x.modifyById(w,m)}else if(x instanceof ke){if(typeof w=="number")throw new Error("illegal arg");m=x.modifyById(w,m)}else if(x instanceof qe){let S={...x,[w]:m};m=Object.setPrototypeOf(S,qe.prototype)}else if(typeof x=="object")if(Array.isArray(x)){if(typeof w=="string"&&(w=parseInt(w),isNaN(w)))throw new Error("Invalid path");let S=m;m=[...x],m[w]=S}else m={...x,[w]:m};else return null}return{data:m,actual:{...f.actual,path:u},reverse:{...f.reverse,path:u}}}else return null;let v=u[l.length],g;if(a instanceof Ot){if(typeof v=="number")throw new Error("");g=(d=a.get(v))==null?void 0:d.data}else if(a instanceof Ce){if(typeof v=="number")throw new Error("");g=(p=a.get(v))==null?void 0:p.data}else a!==null&&(g=a[v]);if(g!==void 0)l.push(a),a=g;else return null}}e.apply=r;function s(a,c){for(let u=0;u<a.length&&u<c.length;u++)if(a[u]!==c[u])return!0;return!1}e.pathDisjoint=s;function o(a,c){if(a.length!==c.length)return!1;for(let u=0;u<a.length;u++)if(a[u]!==c[u])return!1;return!0}e.pathEq=o;function n(a,c){return s(a.path,c.path)}e.commutative=n;function h(a,c){return a.type===0&&c.type===0&&o(a.path,c.path)?Object.keys(a.props).every(u=>c.props[u]!==void 0):!1}e.subsumed=h})(st||(st={}));var Ja;(e=>{function t(){return[]}e.empty=t;function i(c,u){let l=[];for(let d of c){let[p,...f]=d.path;p===u&&l.push({...d,path:f})}return l}e.removePrefix=i;function r(c,u){return c.map(l=>({...l,path:[u,...l.path]}))}e.addPrefix=r;function s(c,u){return[...c,...u]}e.concat=s;function o(c,u){return[...c.filter(l=>!u.some(d=>st.subsumed(l,d))),...u]}e.compress=o;function n(c,u){return c.every(l=>u.every(d=>st.commutative(l,d)))}e.commutative=n;function h(c,u){for(let l of u){let d=a(c,l);d!==null&&(c=d.data)}return c}e.applyAll=h;function a(c,u){var l=c;let d=[],p=[];for(let f of u)try{if(f.type===3){let v=kt.zoom(l,[...f.path,f.id]),g=st.apply(l,{...f,type:2});if(g!==null){l=g.data;let[m,y]=mf(l,{[f.id]:v});l=m;for(let w of y){let x=w[w.length-1];w.splice(w.length-1,1),d.push({type:0,path:w,props:{[x]:v}}),p.push({type:0,path:w,props:{[x]:f.id}})}p.push(g.reverse),d.push(g.actual)}}else{let v=st.apply(l,f);v!==null&&(d.push(v.actual),l=v.data,p.push(v.reverse))}}catch(v){if(v instanceof Ec)return null;throw v}return{data:l,actual:d,reverse:p.reverse()}}e.apply=a})(Ja||(Ja={}));var zc=Symbol(),yf=Symbol(),po=Symbol(),Qr=class{reportOp(e,t,i=[]){let r=this;if(t===null)return;r._current=t.data;let s=i;for(;!(r instanceof Bc);){let o=r._path,n=r._current;if(o!==""&&s.splice(0,0,o),r=r._parent,r===null)return;r.update(o,n)}r.push(s,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[po];i&&i(),delete this._children[e]}}}},bf=class extends Qr{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,ks.runOp(this._current,e),e.path)}},xf=class extends Qr{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,ke.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},Nc={get(e,t){if(t===po)return()=>{e._parent=null};if(t===zc)return e._current;if(t===yf)return e;let{_current:i,_children:r}=e;if(t==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let s=r===void 0?void 0:r[t];if(s!==void 0)return s;let o=i[t],n=fo(e,t,o);return n!==o?(r===void 0&&(r={},e._children=r),r[t]=n,n):o},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[t]}}},wf={...Nc,set(e,t,i){let r={type:0,props:{[t]:$e(i)??i}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},_f={...Nc,set(e,t,i){return i===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}},ha=class extends Qr{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[po]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){var n;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let s=(n=t.get(e))==null?void 0:n.data,o=fo(this,e,s);return o!==s?(i===void 0&&(i={},this._children=i),i[e]=o,o):s}add(e,t,i,r,s){this.runOp({type:7,parent:e,fi:t,id:i,data:r,children:s})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let s=0;s<i.length;s++){let o=i[s];this.add(e,r[s],o.id,o.data,o.children)}}insertBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let s=0;s<i.length;s++){let o=i[s];this.add(e,r[s],o.id,o.data,o.children)}}moveAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let s=0;s<i.length;s++){let o=i[s];this.move(e,r[s],o)}}moveBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let s=0;s<i.length;s++){let o=i[s];this.move(e,r[s],o)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},ca=class extends Qr{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[po]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id,s=this._current[i].fi;e(this.data(this._current[i].id),r,s)}}find(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id;if(e(this.data(r),r))return this.get(r)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var n;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let s=(n=t.get(e))==null?void 0:n.data,o=fo(this,e,s);return o!==s?(i===void 0&&(i={},this._children=i),i[e]=o,o):s}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let s=t[r];this.add(i[r],s.id,s.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let s=t[r];this.add(i[r],s.id,s.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let s=t[r];this.move(i[r],s)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let s=t[r];this.move(i[r],s)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function Bo(e,t,i){if(e.length>0){let r=e[e.length-1];if(r.type===0&&t.type===0&&kt.equal(r.path,i)){Object.assign(r.props,t.props);return}}e.push({...t,path:i})}var Bc=class extends Qr{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,i,r){Bo(this.ts,t,e),Bo(this.actual,i,e),Bo(this.reverse,r,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function fo(e,t,i){return i instanceof Ot?new ha(e,t,i):i instanceof Ce?new ca(e,t,i):i instanceof ke?new Proxy(new xf(e,t,i),_f):i!==null&&typeof i=="object"?na(i)?i:new Proxy(new bf(e,t,i),wf):i}function jc(e){let t=new Bc(e);return[fo(t,"",e),t]}function Gs(e,t){let[i,r]=jc(e);return t(i),r.result()}function $e(e){return e instanceof ha||e instanceof ca?e._current:e!==null&&typeof e=="object"?e[zc]:e}var kt;(e=>{function t(o,n){if(n.length===o.length)for(var h=0;h<o.length;){if(o[h]!==n[h])return!1;h+=1}else return!1;return!0}e.equal=t;function i(o,n,h){let a=s(h,o);if(a!==void 0&&typeof a=="object"&&a!==null){let c={...n};return Object.keys(a).forEach(u=>{delete c[u]}),c}else return n}e.removeOverridden=i;function r(o,n){if((o instanceof Ot||o instanceof ha)&&typeof n=="string"||(o instanceof Ce||o instanceof ca)&&typeof n=="string")return o.data(n);if(typeof n=="number"&&Array.isArray(o)||typeof n=="string"&&typeof o=="object"&&o!==null)return o[n]}e.zoomOnce=r;function s(o,n,h=0){for(;h<n.length&&o!==void 0;)o=r(o,n[h]),h+=1;return o}e.zoom=s})(kt||(kt={}));function Sf(e,t){let i=[];if(t.length===e.length)for(var r=0;r<e.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}function ti(e,t){let i=[];if(t.length<=e.length)for(var r=0;r<t.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}var Uc=class{},el=class extends Uc{constructor(e){super(),this.id=e}},tl=class extends Uc{constructor(e){super(),this.data=e}},yn;try{yn=new TextDecoder}catch{}var ie,ci,E=0,Je={},ye,ri,dt=0,Bt=0,rt,Yt,Ze=[],be,il={useRecords:!1,mapsAsObjects:!0},Rc=class{},kc=new Rc;kc.name="MessagePack 0xC1";var sr=!1,Hs=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(ie)return qc(()=>(xn(),this?this.unpack(e,t):Hs.prototype.unpack.call(il,e,t)));ci=t>-1?t:e.length,E=0,Bt=0,ri=null,rt=null,ie=e;try{be=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw ie=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof Hs){if(Je=this,this.structures)return ye=this.structures,ns();(!ye||ye.length>0)&&(ye=[])}else Je=il,(!ye||ye.length>0)&&(ye=[]);return ns()}unpackMultiple(e,t){let i,r=0;try{sr=!0;let s=e.length,o=this?this.unpack(e,s):go.unpack(e,s);if(t){for(t(o);E<s;)if(r=E,t(ns())===!1)return}else{for(i=[o];E<s;)r=E,i.push(ns());return i}}catch(s){throw s.lastPosition=r,s.values=i,s}finally{sr=!1,xn()}}_mergeStructures(e,t){e=e||[];for(let i=0,r=e.length;i<r;i++){let s=e[i];s&&(s.isShared=!0,i>=32&&(s.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let r=e[i],s=t[i];s&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[i]=r),e[i]=s)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function ns(){try{if(!Je.trusted&&!sr){let t=ye.sharedLength||0;t<ye.length&&(ye.length=t)}let e=Ne();if(E==ci)ye.restoreStructures&&rl(),ye=null,ie=null,Yt&&(Yt=null);else if(E>ci){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!sr)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw ye.restoreStructures&&rl(),xn(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function rl(){for(let e in ye.restoreStructures)ye[e]=ye.restoreStructures[e];ye.restoreStructures=null}function Ne(){let e=ie[E++];if(e<160)if(e<128){if(e<64)return e;{let t=ye[e&63]||Je.getStructures&&Fc()[e&63];return t?(t.read||(t.read=da(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,Je.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[Gc()]=Ne();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Ne(),Ne());return t}else{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=Ne();return t}else if(e<192){let t=e-160;if(Bt>=E)return ri.slice(E-dt,(E+=t)-dt);if(Bt==0&&ci<140){let i=t<16?ua(t):Vc(t);if(i!=null)return i}return bn(t)}else{let t;switch(e){case 192:return null;case 193:return rt?(t=Ne(),t>0?rt[1].slice(rt.position1,rt.position1+=t):rt[0].slice(rt.position0,rt.position0-=t)):kc;case 194:return!1;case 195:return!0;case 196:return jo(ie[E++]);case 197:return t=be.getUint16(E),E+=2,jo(t);case 198:return t=be.getUint32(E),E+=4,jo(t);case 199:return mi(ie[E++]);case 200:return t=be.getUint16(E),E+=2,mi(t);case 201:return t=be.getUint32(E),E+=4,mi(t);case 202:if(t=be.getFloat32(E),Je.useFloat32>2){let i=pa[(ie[E]&127)<<1|ie[E+1]>>7];return E+=4,(i*t+(t>0?.5:-.5)>>0)/i}return E+=4,t;case 203:return t=be.getFloat64(E),E+=8,t;case 204:return ie[E++];case 205:return t=be.getUint16(E),E+=2,t;case 206:return t=be.getUint32(E),E+=4,t;case 207:return Je.int64AsNumber?(t=be.getUint32(E)*4294967296,t+=be.getUint32(E+4)):t=be.getBigUint64(E),E+=8,t;case 208:return be.getInt8(E++);case 209:return t=be.getInt16(E),E+=2,t;case 210:return t=be.getInt32(E),E+=4,t;case 211:return Je.int64AsNumber?(t=be.getInt32(E)*4294967296,t+=be.getUint32(E+4)):t=be.getBigInt64(E),E+=8,t;case 212:if(t=ie[E++],t==114)return ll(ie[E++]&63);{let i=Ze[t];if(i)return i.read?(E++,i.read(Ne())):i.noBuffer?(E++,i()):i(ie.subarray(E,++E));throw new Error("Unknown extension "+t)}case 213:return t=ie[E],t==114?(E++,ll(ie[E++]&63,ie[E++])):mi(2);case 214:return mi(4);case 215:return mi(8);case 216:return mi(16);case 217:return t=ie[E++],Bt>=E?ri.slice(E-dt,(E+=t)-dt):Of(t);case 218:return t=be.getUint16(E),E+=2,Bt>=E?ri.slice(E-dt,(E+=t)-dt):Cf(t);case 219:return t=be.getUint32(E),E+=4,Bt>=E?ri.slice(E-dt,(E+=t)-dt):Pf(t);case 220:return t=be.getUint16(E),E+=2,ol(t);case 221:return t=be.getUint32(E),E+=4,ol(t);case 222:return t=be.getUint16(E),E+=2,nl(t);case 223:return t=be.getUint32(E),E+=4,nl(t);default:if(e>=224)return e-256;if(e===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var Af=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function da(e,t){function i(){if(i.count++>2){let s=e.read=new Function("r","return function(){return {"+e.map(o=>Af.test(o)?o+":r()":"["+JSON.stringify(o)+"]:r()").join(",")+"}}")(Ne);return e.highByte===0&&(e.read=sl(t,e.read)),s()}let r={};for(let s=0,o=e.length;s<o;s++){let n=e[s];r[n]=Ne()}return r}return i.count=0,e.highByte===0?sl(t,i):i}var sl=(e,t)=>function(){let i=ie[E++];if(i===0)return t();let r=e<32?-(e+(i<<5)):e+(i<<5),s=ye[r]||Fc()[r];if(!s)throw new Error("Record id is not defined for "+r);return s.read||(s.read=da(s,e)),s.read()};function Fc(){let e=qc(()=>(ie=null,Je.getStructures()));return ye=Je._mergeStructures(e,ye)}var bn=mo,Of=mo,Cf=mo,Pf=mo;function mo(e){let t;if(e<16&&(t=ua(e)))return t;if(e>64&&yn)return yn.decode(ie.subarray(E,E+=e));let i=E+e,r=[];for(t="";E<i;){let s=ie[E++];if(!(s&128))r.push(s);else if((s&224)===192){let o=ie[E++]&63;r.push((s&31)<<6|o)}else if((s&240)===224){let o=ie[E++]&63,n=ie[E++]&63;r.push((s&31)<<12|o<<6|n)}else if((s&248)===240){let o=ie[E++]&63,n=ie[E++]&63,h=ie[E++]&63,a=(s&7)<<18|o<<12|n<<6|h;a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|a&1023),r.push(a)}else r.push(s);r.length>=4096&&(t+=He.apply(String,r),r.length=0)}return r.length>0&&(t+=He.apply(String,r)),t}function ol(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=Ne();return t}function nl(e){if(Je.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[Gc()]=Ne();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Ne(),Ne());return t}}var He=String.fromCharCode;function Vc(e){let t=E,i=new Array(e);for(let r=0;r<e;r++){let s=ie[E++];if((s&128)>0){E=t;return}i[r]=s}return He.apply(String,i)}function ua(e){if(e<4)if(e<2){if(e===0)return"";{let t=ie[E++];if((t&128)>1){E-=1;return}return He(t)}}else{let t=ie[E++],i=ie[E++];if((t&128)>0||(i&128)>0){E-=2;return}if(e<3)return He(t,i);let r=ie[E++];if((r&128)>0){E-=3;return}return He(t,i,r)}else{let t=ie[E++],i=ie[E++],r=ie[E++],s=ie[E++];if((t&128)>0||(i&128)>0||(r&128)>0||(s&128)>0){E-=4;return}if(e<6){if(e===4)return He(t,i,r,s);{let o=ie[E++];if((o&128)>0){E-=5;return}return He(t,i,r,s,o)}}else if(e<8){let o=ie[E++],n=ie[E++];if((o&128)>0||(n&128)>0){E-=6;return}if(e<7)return He(t,i,r,s,o,n);let h=ie[E++];if((h&128)>0){E-=7;return}return He(t,i,r,s,o,n,h)}else{let o=ie[E++],n=ie[E++],h=ie[E++],a=ie[E++];if((o&128)>0||(n&128)>0||(h&128)>0||(a&128)>0){E-=8;return}if(e<10){if(e===8)return He(t,i,r,s,o,n,h,a);{let c=ie[E++];if((c&128)>0){E-=9;return}return He(t,i,r,s,o,n,h,a,c)}}else if(e<12){let c=ie[E++],u=ie[E++];if((c&128)>0||(u&128)>0){E-=10;return}if(e<11)return He(t,i,r,s,o,n,h,a,c,u);let l=ie[E++];if((l&128)>0){E-=11;return}return He(t,i,r,s,o,n,h,a,c,u,l)}else{let c=ie[E++],u=ie[E++],l=ie[E++],d=ie[E++];if((c&128)>0||(u&128)>0||(l&128)>0||(d&128)>0){E-=12;return}if(e<14){if(e===12)return He(t,i,r,s,o,n,h,a,c,u,l,d);{let p=ie[E++];if((p&128)>0){E-=13;return}return He(t,i,r,s,o,n,h,a,c,u,l,d,p)}}else{let p=ie[E++],f=ie[E++];if((p&128)>0||(f&128)>0){E-=14;return}if(e<15)return He(t,i,r,s,o,n,h,a,c,u,l,d,p,f);let v=ie[E++];if((v&128)>0){E-=15;return}return He(t,i,r,s,o,n,h,a,c,u,l,d,p,f,v)}}}}}function jo(e){return Je.copyBuffers?Uint8Array.prototype.slice.call(ie,E,E+=e):ie.subarray(E,E+=e)}function mi(e){let t=ie[E++];if(Ze[t])return Ze[t](ie.subarray(E,E+=e));throw new Error("Unknown extension type "+t)}var al=new Array(4096);function Gc(){let e=ie[E++];if(e>=160&&e<192){if(e=e-160,Bt>=E)return ri.slice(E-dt,(E+=e)-dt);if(!(Bt==0&&ci<180))return bn(e)}else return E--,Ne();let t=(e<<5^(e>1?be.getUint16(E):e>0?ie[E]:0))&4095,i=al[t],r=E,s=E+e-3,o,n=0;if(i&&i.bytes==e){for(;r<s;){if(o=be.getUint32(r),o!=i[n++]){r=1879048192;break}r+=4}for(s+=3;r<s;)if(o=ie[r++],o!=i[n++]){r=1879048192;break}if(r===s)return E=r,i.string;s-=3,r=E}for(i=[],al[t]=i,i.bytes=e;r<s;)o=be.getUint32(r),i.push(o),r+=4;for(s+=3;r<s;)o=ie[r++],i.push(o);let h=e<16?ua(e):Vc(e);return h!=null?i.string=h:i.string=bn(e)}var ll=(e,t)=>{var i=Ne();let r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let s=ye[e];return s&&s.isShared&&((ye.restoreStructures||(ye.restoreStructures=[]))[e]=s),ye[e]=i,i.read=da(i,r),i.read()},Hc=typeof self=="object"?self:global;Ze[0]=()=>{};Ze[0].noBuffer=!0;Ze[101]=()=>{let e=Ne();return(Hc[e[0]]||Error)(e[1])};Ze[105]=e=>{let t=be.getUint32(E-4);Yt||(Yt=new Map);let i=ie[E],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let s={target:r};Yt.set(t,s);let o=Ne();return s.used?Object.assign(r,o):(s.target=o,o)};Ze[112]=e=>{let t=be.getUint32(E-4),i=Yt.get(t);return i.used=!0,i.target};Ze[115]=()=>new Set(Ne());var Wc=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");Ze[116]=e=>{let t=e[0],i=Wc[t];if(!i)throw new Error("Could not find typed array for code "+t);return new Hc[i](Uint8Array.prototype.slice.call(e,1).buffer)};Ze[120]=()=>{let e=Ne();return new RegExp(e[0],e[1])};Ze[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=E;E+=t-4,rt=[Ne(),Ne()],rt.position0=0,rt.position1=0;let r=E;E=i;try{return Ne()}finally{E=r}};Ze[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function qc(e){let t=ci,i=E,r=dt,s=Bt,o=ri,n=Yt,h=rt,a=new Uint8Array(ie.slice(0,ci)),c=ye,u=ye.slice(0,ye.length),l=Je,d=sr,p=e();return ci=t,E=i,dt=r,Bt=s,ri=o,Yt=n,rt=h,ie=a,sr=d,ye=c,ye.splice(0,ye.length,...u),Je=l,be=new DataView(ie.buffer,ie.byteOffset,ie.byteLength),p}function xn(){ie=null,Yt=null,ye=null}function Tf(e){e.unpack?Ze[e.type]=e.unpack:Ze[e.type]=e}var pa=new Array(147);for(let e=0;e<256;e++)pa[e]=+("1e"+Math.floor(45.15-e*.30103));var go=new Hs({useRecords:!1});go.unpack;go.unpackMultiple;go.unpack;var Mf=new Float32Array(1);new Uint8Array(Mf.buffer,0,4);var Es;try{Es=new TextEncoder}catch{}var Ws,fa,vo=typeof Buffer<"u",Uo=vo?Buffer.allocUnsafeSlow:Uint8Array,$c=vo?Buffer:Uint8Array,hl=vo?4294967296:2144337920,j,Re,D=0,Mt,Et=null,Ef=/[\u0080-\uFFFF]/,_r=Symbol("record-id"),Xc=class extends Hs{constructor(e){super(e),this.offset=0;let t,i,r,s,o,n=0,h=$c.prototype.utf8Write?function(b,A,O){return j.utf8Write(b,A,O)}:Es&&Es.encodeInto?function(b,A){return Es.encodeInto(b,j.subarray(A)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,u=e.structures||e.saveStructures,l=e.maxSharedStructures;if(l==null&&(l=u?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=e.maxOwnStructures;d==null&&(d=u?32:64),c&&!e.saveStructures&&(this.structures=[]);let p=l>32||d+l>64,f=l+64,v=l+d+64;if(v>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],m=0,y=0;this.pack=this.encode=function(b,A){if(j||(j=new Uo(8192),Re=new DataView(j.buffer,0,8192),D=0),Mt=j.length-10,Mt-D<2048?(j=new Uo(j.length),Re=new DataView(j.buffer,0,j.length),Mt=j.length-10,D=0):D=D+7&2147483640,t=D,o=a.structuredClone?new Map:null,a.bundleStrings?(Et=["",""],j[D++]=214,j[D++]=98,Et.position=D-t,D+=4):Et=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let O=i.sharedLength||0;if(O>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let P=0;P<O;P++){let _=i[P];if(!_)continue;let C,M=i.transitions;for(let N=0,W=_.length;N<W;N++){let Q=_[N];C=M[Q],C||(C=M[Q]=Object.create(null)),M=C}M[_r]=P+64}n=O}c||(i.nextId=O+64)}r&&(r=!1),s=i||[];try{if(w(b),Et){Re.setUint32(Et.position+t,D-Et.position-t);let O=Et;Et=null,w(O[0]),w(O[1])}if(a.offset=D,o&&o.idsToInsert){D+=o.idsToInsert.length*6,D>Mt&&S(D),a.offset=D;let O=Lf(j.subarray(t,D),o.idsToInsert);return o=null,O}return A&If?(j.start=t,j.end=D,j):j.subarray(t,D)}finally{if(i){if(y<10&&y++,m>1e4)i.transitions=null,y=0,m=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let O=0,P=g.length;O<P;O++)g[O][_r]=0;g=[]}if(r&&a.saveStructures){let O=i.sharedLength||l;i.length>O&&(i=i.slice(0,O));let P=j.subarray(t,D);return a.saveStructures(i,n)===!1?(a._mergeStructures(a.getStructures()),a.pack(b)):(n=O,P)}}A&zf&&(D=t)}};let w=b=>{D>Mt&&(j=S(D));var A=typeof b,O;if(A==="string"){let P=b.length;if(Et&&P>=8&&P<4096){let M=Ef.test(b);Et[M?0:1]+=b,j[D++]=193,w(M?-P:P);return}let _;P<32?_=1:P<256?_=2:P<65536?_=3:_=5;let C=P*3;if(D+C>Mt&&(j=S(D+C)),P<64||!h){let M,N,W,Q=D+_;for(M=0;M<P;M++)N=b.charCodeAt(M),N<128?j[Q++]=N:N<2048?(j[Q++]=N>>6|192,j[Q++]=N&63|128):(N&64512)===55296&&((W=b.charCodeAt(M+1))&64512)===56320?(N=65536+((N&1023)<<10)+(W&1023),M++,j[Q++]=N>>18|240,j[Q++]=N>>12&63|128,j[Q++]=N>>6&63|128,j[Q++]=N&63|128):(j[Q++]=N>>12|224,j[Q++]=N>>6&63|128,j[Q++]=N&63|128);O=Q-D-_}else O=h(b,D+_,C);O<32?j[D++]=160|O:O<256?(_<2&&j.copyWithin(D+2,D+1,D+1+O),j[D++]=217,j[D++]=O):O<65536?(_<3&&j.copyWithin(D+3,D+2,D+2+O),j[D++]=218,j[D++]=O>>8,j[D++]=O&255):(_<5&&j.copyWithin(D+5,D+3,D+3+O),j[D++]=219,Re.setUint32(D,O),D+=4),D+=O}else if(A==="number")if(b>>>0===b)b<64?j[D++]=b:b<256?(j[D++]=204,j[D++]=b):b<65536?(j[D++]=205,j[D++]=b>>8,j[D++]=b&255):(j[D++]=206,Re.setUint32(D,b),D+=4);else if(b>>0===b)b>=-32?j[D++]=256+b:b>=-128?(j[D++]=208,j[D++]=b+256):b>=-32768?(j[D++]=209,Re.setInt16(D,b),D+=2):(j[D++]=210,Re.setInt32(D,b),D+=4);else{let P;if((P=this.useFloat32)>0&&b<4294967296&&b>=-2147483648){j[D++]=202,Re.setFloat32(D,b);let _;if(P<4||(_=b*pa[(j[D]&127)<<1|j[D+1]>>7])>>0===_){D+=4;return}else D--}j[D++]=203,Re.setFloat64(D,b),D+=8}else if(A==="object")if(!b)j[D++]=192;else{if(o){let _=o.get(b);if(_){if(!_.id){let C=o.idsToInsert||(o.idsToInsert=[]);_.id=C.push(_)}j[D++]=214,j[D++]=112,Re.setUint32(D,_.id),D+=4;return}else o.set(b,{offset:D-t})}let P=b.constructor;if(P===Object)x(b,!0);else if(P===Array){O=b.length,O<16?j[D++]=144|O:O<65536?(j[D++]=220,j[D++]=O>>8,j[D++]=O&255):(j[D++]=221,Re.setUint32(D,O),D+=4);for(let _=0;_<O;_++)w(b[_])}else if(P===Map){O=b.size,O<16?j[D++]=128|O:O<65536?(j[D++]=222,j[D++]=O>>8,j[D++]=O&255):(j[D++]=223,Re.setUint32(D,O),D+=4);for(let[_,C]of b)w(_),w(C)}else{for(let _=0,C=Ws.length;_<C;_++){let M=fa[_];if(b instanceof M){let N=Ws[_];if(N.write){N.type&&(j[D++]=212,j[D++]=N.type,j[D++]=0),w(N.write.call(this,b));return}let W=j,Q=Re,re=D;j=null;let $;try{$=N.pack.call(this,b,V=>(j=W,W=null,D+=V,D>Mt&&S(D),{target:j,targetView:Re,position:D-V}),w)}finally{W&&(j=W,Re=Q,D=re,Mt=j.length-10)}$&&($.length+D>Mt&&S($.length+D),D=Df($,j,D,N.type));return}}x(b,!b.hasOwnProperty)}}else if(A==="boolean")j[D++]=b?195:194;else if(A==="bigint"){if(b<BigInt(1)<<BigInt(63)&&b>=-(BigInt(1)<<BigInt(63)))j[D++]=211,Re.setBigInt64(D,b);else if(b<BigInt(1)<<BigInt(64)&&b>0)j[D++]=207,Re.setBigUint64(D,b);else if(this.largeBigIntToFloat)j[D++]=203,Re.setFloat64(D,Number(b));else throw new RangeError(b+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");D+=8}else if(A==="undefined")this.encodeUndefinedAsNil?j[D++]=192:(j[D++]=212,j[D++]=0,j[D++]=0);else if(A==="function")w(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+A)},x=this.useRecords===!1?this.variableMapSize?b=>{let A=Object.keys(b),O=A.length;O<16?j[D++]=128|O:O<65536?(j[D++]=222,j[D++]=O>>8,j[D++]=O&255):(j[D++]=223,Re.setUint32(D,O),D+=4);let P;for(let _=0;_<O;_++)w(P=A[_]),w(b[P])}:(b,A)=>{j[D++]=222;let O=D-t;D+=2;let P=0;for(let _ in b)(A||b.hasOwnProperty(_))&&(w(_),w(b[_]),P++);j[O+++t]=P>>8,j[O+t]=P&255}:b=>{let A=Object.keys(b),O,P=s.transitions||(s.transitions=Object.create(null)),_=0;for(let M=0,N=A.length;M<N;M++){let W=A[M];O=P[W],O||(O=P[W]=Object.create(null),_++),P=O}let C=P[_r];if(C)C>=96&&p?(j[D++]=((C-=96)&31)+96,j[D++]=C>>5):j[D++]=C;else{C=s.nextId,C||(C=64),C<f&&this.shouldShareStructure&&!this.shouldShareStructure(A)?(C=s.nextOwnId,C<v||(C=f),s.nextOwnId=C+1):(C>=v&&(C=f),s.nextId=C+1);let M=A.highByte=C>=96&&p?C-96>>5:-1;P[_r]=C,s[C-64]=A,C<f?(A.isShared=!0,s.sharedLength=C-63,r=!0,M>=0?(j[D++]=(C&31)+96,j[D++]=M):j[D++]=C):(M>=0?(j[D++]=213,j[D++]=114,j[D++]=(C&31)+96,j[D++]=M):(j[D++]=212,j[D++]=114,j[D++]=C),_&&(m+=y*_),g.length>=d&&(g.shift()[_r]=0),g.push(P),w(A))}for(let M=0,N=A.length;M<N;M++)w(b[A[M]])},S=b=>{let A;if(b>16777216){if(b-t>hl)throw new Error("Packed buffer would be larger than maximum buffer size");A=Math.min(hl,Math.round(Math.max((b-t)*(b>67108864?1.25:2),4194304)/4096)*4096)}else A=(Math.max(b-t<<2,j.length-1)>>12)+1<<12;let O=new Uo(A);return Re=new DataView(O.buffer,0,A),j.copy?j.copy(O,0,t,b):O.set(j.slice(t,b)),D-=t,t=0,Mt=O.length-10,j=O}}useBuffer(e){j=e,Re=new DataView(j.buffer,j.byteOffset,j.byteLength),D=0}};fa=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Rc];Ws=[{pack(e,t,i){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:s,targetView:o,position:n}=t(6);s[n++]=214,s[n++]=255,o.setUint32(n,r)}else if(r>0&&r<17179869184){let{target:s,targetView:o,position:n}=t(10);s[n++]=215,s[n++]=255,o.setUint32(n,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),o.setUint32(n+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:s,targetView:o,position:n}=t(3);s[n++]=212,s[n++]=255,s[n++]=255}else{let{target:s,targetView:o,position:n}=t(15);s[n++]=199,s[n++]=12,s[n++]=255,o.setUint32(n,e.getMilliseconds()*1e6),o.setBigInt64(n+4,BigInt(Math.floor(r)))}}},{pack(e,t,i){let r=Array.from(e),{target:s,position:o}=t(this.structuredClone?3:0);this.structuredClone&&(s[o++]=212,s[o++]=115,s[o++]=0),i(r)}},{pack(e,t,i){let{target:r,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=101,r[s++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:r,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=120,r[s++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?cl(e,16,t):dl(vo?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==$c&&this.structuredClone?cl(e,Wc.indexOf(i.name),t):dl(e,t)}},{pack(e,t){let{target:i,position:r}=t(1);i[r]=193}}];function cl(e,t,i,r){let s=e.byteLength;if(s+1<256){var{target:o,position:n}=i(4+s);o[n++]=199,o[n++]=s+1}else if(s+1<65536){var{target:o,position:n}=i(5+s);o[n++]=200,o[n++]=s+1>>8,o[n++]=s+1&255}else{var{target:o,position:n,targetView:h}=i(7+s);o[n++]=201,h.setUint32(n,s+1),n+=4}o[n++]=116,o[n++]=t,o.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n)}function dl(e,t){let i=e.byteLength;var r,s;if(i<256){var{target:r,position:s}=t(i+2);r[s++]=196,r[s++]=i}else if(i<65536){var{target:r,position:s}=t(i+3);r[s++]=197,r[s++]=i>>8,r[s++]=i&255}else{var{target:r,position:s,targetView:o}=t(i+5);r[s++]=198,o.setUint32(s,i),s+=4}r.set(e,s)}function Df(e,t,i,r){let s=e.length;switch(s){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:s<256?(t[i++]=199,t[i++]=s):s<65536?(t[i++]=200,t[i++]=s>>8,t[i++]=s&255):(t[i++]=201,t[i++]=s>>24,t[i++]=s>>16&255,t[i++]=s>>8&255,t[i++]=s&255)}return t[i++]=r,t.set(e,i),i+=s,i}function Lf(e,t){let i,r=t.length*6,s=e.length-r;for(t.sort((o,n)=>o.offset>n.offset?1:-1);i=t.pop();){let o=i.offset,n=i.id;e.copyWithin(o+r,o,s),r-=6;let h=o+r;e[h++]=214,e[h++]=105,e[h++]=n>>24,e[h++]=n>>16&255,e[h++]=n>>8&255,e[h++]=n&255,s=o}return e}function dr(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");fa.unshift(e.Class),Ws.unshift(e)}Tf(e)}var Yc=new Xc({useRecords:!1});Yc.pack;Yc.pack;var If=512,zf=1024,ul=new Xc({structuredClone:!0});dr({Class:ke.prototype.constructor,type:1,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,ke.prototype),e}});dr({Class:Ce.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,Ce.prototype),e}});dr({Class:Ot.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,Ot.prototype),e}});dr({Class:el.prototype.constructor,type:4,write(e){return e.id},read(e){return new el(e)}});dr({Class:tl.prototype.constructor,type:5,write(e){return e.data},read(e){return new tl(e)}});dr({Class:qe.prototype.constructor,type:6,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,qe.prototype),e}});function Nf(e){var t=0;if(e.length===0)return t;for(let i=0;i<e.length;i++){let r=e[i];t=(t<<5)-t+r,t=t&t}return t}function wn(e){if(na(e))return e;if(Array.isArray(e))return e.map(wn);if(typeof e=="object"&&e!==null){let t={};for(let i of Object.keys(e).sort())t[i]=wn(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var _n;(e=>{function t(s){return ul.pack(s)}e.serialize=t;function i(s){return ul.unpack(s)}e.deserialize=i;function r(s){return Nf(t(wn(s))).toString()}e.checksum=r})(_n||(_n={}));var pl;(e=>{function t(r,s){return r[0]===s[0]&&r[1]===s[1]}e.isEqual=t;function i(r,s,o){return[r[0]+(s[0]-r[0])*o,r[1]+(s[1]-r[1])*o]}e.lerp=i})(pl||(pl={}));var Wi;(e=>{function t(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]}e.isEqual=t;function i(a,c){return[a[0]+c[0],a[1]+c[1],a[2]+c[2]]}e.add=i;function r(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2]]}e.sub=r;function s(a,c){return[a[0]/c[0],a[1]/c[1],a[2]/c[2]]}e.div=s;function o(a,c){return[a[0]*c[0],a[1]*c[1],a[2]*c[2]]}e.mul=o;function n(a,c){return Math.hypot(a[0]-c[0],a[1]-c[1],a[2]-c[2])}e.dist=n;function h(a,c,u){return[a[0]+(c[0]-a[0])*u,a[1]+(c[1]-a[1])*u,a[2]+(c[2]-a[2])*u]}e.lerp=h})(Wi||(Wi={}));var fl;(e=>{function t(r,s){return r[0]===s[0]&&r[1]===s[1]&&r[2]===s[2]&&r[3]===s[3]}e.isEqual=t;function i(r,s,o){return[r[0]+(s[0]-r[0])*o,r[1]+(s[1]-r[1])*o,r[2]+(s[2]-r[2])*o,r[3]+(s[3]-r[3])*o]}e.lerp=i})(fl||(fl={}));var or;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(s,o){for(let n=0;n<16;n++)if(s[n]!==o[n])return!1;return!0}e.isEqual=t;function i(s){return s??e.identity}e.simplify=i;function r(s,o){let n=o.slice(0);for(var h=0,a=o.length;h<a;h+=3){let c=s[3]*o[h]+s[7]*o[h+1]+s[11]*o[h+2]+s[15];n[h]=(s[0]*o[h]+s[4]*o[h+1]+s[8]*o[h+2]+s[12])/c,n[h+1]=(s[1]*o[h]+s[5]*o[h+1]+s[9]*o[h+2]+s[13])/c,n[h+2]=(s[2]*o[h]+s[6]*o[h+1]+s[10]*o[h+2]+s[14])/c}return n}e.applyMatrix4=r})(or||(or={}));var gt;(e=>{function t(h){return typeof h=="object"&&typeof h.r=="number"&&typeof h.g=="number"&&typeof h.b=="number"}e.isRGB=t,e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function i(h){return{r:Math.round(h.r*255),g:Math.round(h.g*255),b:Math.round(h.b*255),a:1}}e.toRgb255a1=i;function r(h){return{r:h.r,g:h.g,b:h.b}}e.clone=r;function s(h){return h=Math.floor(h),{r:(h>>16&255)/255,g:(h>>8&255)/255,b:(h&255)/255}}e.fromHex=s;function o(h,a){return h.r===a.r&&h.g===a.g&&h.b===a.b}e.equals=o;function n(h,a,c){return{r:h.r+(a.r-h.r)*c,g:h.g+(a.g-h.g)*c,b:h.b+(a.b-h.b)*c}}e.lerp=n})(gt||(gt={}));var Xt;(e=>{e.white={...gt.white,a:1},e.transparent={...gt.white,a:0};function t(n){return{r:n[0],g:n[1],b:n[2],a:n[3]}}e.from0to1=t;function i(n,h){return{...gt.fromHex(n),a:h}}e.fromHexAndA=i;function r(n){return{r:Math.round(n.r*255),g:Math.round(n.g*255),b:Math.round(n.b*255),a:n.a}}e.toRgb255a1=r;function s(n,h){return gt.equals(n,h)&&n.a===h.a}e.equals=s;function o(n,h,a){return{r:n.r+(h.r-n.r)*a,g:n.g+(h.g-n.g)*a,b:n.b+(h.b-n.b)*a,a:n.a+(h.a-n.a)*a}}e.lerp=o})(Xt||(Xt={}));var Sn;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(Sn||(Sn={}));var ml;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(ml||(ml={}));var gl;(e=>e.defaultData={control1:[.5,.05],control2:[.1,.3]})(gl||(gl={}));var Ei;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(i){return e.all.includes(i)}e.is=t})(Ei||(Ei={}));var $r;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1,autoZoom:!1,autoZoomFrustumSize:790},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(i){return i.type==="PerspectiveCamera"?i.perspective.zoom:i.orthographic.zoom}e.getZoom=t})($r||($r={}));var si;(e=>{function t(r,s=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*s,0,0]},grid:{count:[2,2,2],size:r.map(o=>o*(1+s)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}e.defaultData=t;function i(r,s){let o={...r};if(Bf.forEach(n=>{Object.assign(o,{[n]:s[n]??r[n]})}),o.radial={...r.radial},s.radial){let n=r.radial,h=s.radial;jf.forEach(a=>{Object.assign(o.radial,{[a]:h[a]??n[a]})})}if(o.linear={...r.linear},s.linear){let n=r.linear,h=s.linear;Uf.forEach(a=>{Object.assign(o.linear,{[a]:h[a]??n[a]})})}if(o.grid={...r.grid},s.grid){let n=r.grid,h=s.grid;Rf.forEach(a=>{Object.assign(o.grid,{[a]:h[a]??n[a]})})}if(o.toObject={...r.toObject},s.toObject){let n=r.toObject,h=s.toObject;kf.forEach(a=>{Object.assign(o.toObject,{[a]:h[a]??n[a]})})}if(o.randomnessObject={...r.randomnessObject},s.randomnessObject){let n=r.randomnessObject,h=s.randomnessObject;Ff.forEach(a=>{Object.assign(o.randomnessObject,{[a]:h[a]??n[a]})})}return o}e.merge=i})(si||(si={}));var An;(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];function i(r,s){let o=[];r.count!==void 0&&o.push({type:0,path:s,props:{count:r.count}});for(let n of t){let h=r[n];h&&Object.keys(h).length>0&&o.push({type:0,path:[...s,n],props:h})}return o}e.toOps=i})(An||(An={}));var Bf=["count"],jf=["radius","start","end","position","scale","rotation"],Uf=["position","scale","rotation"],Rf=["count","size"],kf=["count","position","scale","rotation"],Ff=["strength","scale","rotation","position","movement","seed","freqScale"],On;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(i){return e.all.includes(i)}e.is=t})(On||(On={}));var Cn;(e=>{function t(r){return i(r)}e.defaultData=t;function i(r){if(r==="PointLight")return{type:r,color:Xt.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,depth:1e5};if(r==="SpotLight")return{type:r,color:Xt.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:Xt.white,intensity:1,shadows:!0,size:2e3,depth:1e5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(Cn||(Cn={}));var Pn;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}e.equals=t})(Pn||(Pn={}));var Tn;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}e.equals=t})(Tn||(Tn={}));var Mn;(e=>e.defaultData={...Tn.defaultData,...Pn.defaultData})(Mn||(Mn={}));var qs;(e=>(e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7))(qs||(qs={}));var vl;(e=>{function t(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="transmission"||i==="matcap"||i==="displace"||i==="light"}e.is=t})(vl||(vl={}));var yl;(e=>{function t(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}e.is=t})(yl||(yl={}));var Vf=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],Gf=["wrapping","image","video"],ft;(e=>{function t(o,n){let{texture:h,...a}=n;if(Object.assign(o,a),h){let c=o.texture;c&&Object.assign(c,h)}}e.patch=t;function i(o,n){return o==="light"&&n?r(n):s(o)}e.defaultData=i;function r(o){switch(o){case"phong":return{category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",alpha:.6,visible:!0,mode:0};case"toon":return{category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1,visible:!0,mode:0};case"lambert":return{category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0};case"physical":return{category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0}}}function s(o){switch(o){case"texture":return{alpha:1,visible:!0,size:[128,128],mode:0,axis:"x",side:2,type:"texture",projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0]},crop:!1};case"video":return{alpha:1,visible:!0,size:[128,128],mode:0,axis:"x",side:2,type:"video",projection:0,texture:{video:qs.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0]},crop:!0};case"color":return{type:"color",alpha:1,visible:!0,mode:0,color:gt.fromHex(5526619)};case"depth":return{type:"depth",alpha:1,visible:!0,mode:0,gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{type:"normal",alpha:1,visible:!0,mode:0,cnormal:[1,1,1]};case"gradient":return{type:"gradient",alpha:1,visible:!0,mode:0,gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{type:"noise",alpha:1,visible:!0,mode:0,size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...gt.fromHex(6710886),a:1},colorB:{...gt.fromHex(6710886),a:1},colorC:{...gt.fromHex(16777215),a:1},colorD:{...gt.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8]};case"fresnel":return{type:"fresnel",alpha:1,visible:!0,mode:0,color:Xt.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{type:"rainbow",alpha:1,visible:!0,mode:0,filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{type:"toon",alpha:1,visible:!0,mode:0,positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:Xt.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{type:"outline",alpha:1,visible:!0,mode:0,outlineColor:Xt.fromHexAndA(0,1),contourColor:Xt.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{type:"matcap",alpha:1,visible:!0,mode:0,texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0]}};case"transmission":return{type:"transmission",alpha:1,visible:!0,mode:0,thickness:10,ior:1.5,roughness:1};case"displace":return{type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,visible:!0}}}})(ft||(ft={}));var Ft;(e=>{function t(c){return!c.layers.some(u=>u.data.type==="texture"&&u.data.projection!==0||u.data.type==="depth"&&!u.data.isWorldSpace||u.data.type==="noise"||u.data.type==="displace")}e.isMergable=t;function i(c){let u="";return c.layers.forEach(l=>{Object.entries(l.data).forEach(([d,p])=>{u+=`${d}${p}`,Array.isArray(p)?p.forEach(f=>u+=`${f}`):typeof p=="object"?Object.values(p).forEach(f=>{typeof f=="number"?u+=`${f.toFixed(4)}`:u+=`${f}`}):u+=`${p}`})}),u}e.getHash=i;function r(){return{layers:new Ce}}e.defaultEmptyData=r;function s(c="layer1",u="layer2"){return n("phong",c,u)}e.defaultData=s;function o(c,u){return{...c,name:u}}e.withName=o;function n(c,u="layer1",l="layer2"){let d=new Ce;return d.push({fi:0,data:ft.defaultData("light",c),id:u}),d.push({fi:1,data:ft.defaultData("color"),id:l}),{layers:d}}e.defaultTwoLayerData=n;function h(c,u="phong",l="layer1",d="layer2"){let p=ft.defaultData("texture");Object.assign(p.texture,{image:c});let f=new Ce;return f.push({fi:0,data:p,id:l}),f.push({fi:1,data:ft.defaultData("light",u),id:d}),{layers:f}}e.defaultTwoLayerTextureData=h;function a(c,u="phong",l="layer1",d="layer2"){let p=ft.defaultData("video");Object.assign(p.texture,{video:c});let f=new Ce;return f.push({fi:0,data:p,id:l}),f.push({fi:1,data:ft.defaultData("light",u),id:d}),{layers:f}}e.defaultTwoLayerVideoTextureData=a})(Ft||(Ft={}));var $s;(e=>{function t(){return{points:new Ce,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})($s||($s={}));var Xs;(e=>{function t(){return{points:new Ce,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}e.defaultData=t})(Xs||(Xs={}));var Zc={type:"Ellipse",width:100,height:100,spikes:64,angle:360,innerRadius:0},En;(e=>{function t(i,r){let s={...i};return Hf.forEach(o=>{Object.assign(s,{[o]:r[o]??i[o]})}),s}e.merge=t})(En||(En={}));var Kc={shape:Zc,depth:1,offset:0,bevel:0,bevelSides:1,angle:0,twist:0,startScale:1,endScale:1},Hf=["depth","offset","angle","twist","startScale","endScale"],Ys;(e=>{function t(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"}e.is2DParametricMesh=t;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"}e.isParametricMesh=i})(Ys||(Ys={}));var Dn;(e=>{function t(i,r){let s={...i};return Object.assign(s,r),s.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(s.extrusion={...i.extrusion},Object.assign(s.extrusion,En.merge(s.extrusion,r.extrusion))),s}e.merge=t})(Dn||(Dn={}));var qi;(e=>{function t(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:Xs.defaultData(),extrusion:Kc};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:$s.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:"",textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};throw new Error("not implemented")}e.defaultData=t})(qi||(qi={}));function Wf(e){for(let t of Object.keys(e))e[t]===void 0&&delete e[t];return e}function nr(e,t){return Object.setPrototypeOf(e,t),e}function Qc(e){return Array.isArray(e)?e:[e]}function qf(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var $f=typeof global=="object"&&global&&global.Object===Object&&global,Jc=$f,Xf=typeof self=="object"&&self&&self.Object===Object&&self,Yf=Jc||Xf||Function("return this")(),Vt=Yf,Zf=Vt.Symbol,xt=Zf,ed=Object.prototype,Kf=ed.hasOwnProperty,Qf=ed.toString,Sr=xt?xt.toStringTag:void 0;function Jf(e){var t=Kf.call(e,Sr),i=e[Sr];try{e[Sr]=void 0;var r=!0}catch{}var s=Qf.call(e);return r&&(t?e[Sr]=i:delete e[Sr]),s}var em=Jf,tm=Object.prototype,im=tm.toString;function rm(e){return im.call(e)}var sm=rm,om="[object Null]",nm="[object Undefined]",bl=xt?xt.toStringTag:void 0;function am(e){return e==null?e===void 0?nm:om:bl&&bl in Object(e)?em(e):sm(e)}var Ii=am;function lm(e){return e!=null&&typeof e=="object"}var Zt=lm,hm="[object Symbol]";function cm(e){return typeof e=="symbol"||Zt(e)&&Ii(e)==hm}var ma=cm;function dm(e,t){for(var i=-1,r=e==null?0:e.length,s=Array(r);++i<r;)s[i]=t(e[i],i,e);return s}var td=dm,um=Array.isArray,Pt=um,pm=1/0,xl=xt?xt.prototype:void 0,wl=xl?xl.toString:void 0;function id(e){if(typeof e=="string")return e;if(Pt(e))return td(e,id)+"";if(ma(e))return wl?wl.call(e):"";var t=e+"";return t=="0"&&1/e==-pm?"-0":t}var fm=id;function mm(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Di=mm;function gm(e){return e}var vm=gm,ym="[object AsyncFunction]",bm="[object Function]",xm="[object GeneratorFunction]",wm="[object Proxy]";function _m(e){if(!Di(e))return!1;var t=Ii(e);return t==bm||t==xm||t==ym||t==wm}var rd=_m,Sm=Vt["__core-js_shared__"],Ro=Sm,_l=function(){var e=/[^.]+$/.exec(Ro&&Ro.keys&&Ro.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Am(e){return!!_l&&_l in e}var Om=Am,Cm=Function.prototype,Pm=Cm.toString;function Tm(e){if(e!=null){try{return Pm.call(e)}catch{}try{return e+""}catch{}}return""}var zi=Tm,Mm=/[\\^$.*+?()[\]{}|]/g,Em=/^\[object .+?Constructor\]$/,Dm=Function.prototype,Lm=Object.prototype,Im=Dm.toString,zm=Lm.hasOwnProperty,Nm=RegExp("^"+Im.call(zm).replace(Mm,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Bm(e){if(!Di(e)||Om(e))return!1;var t=rd(e)?Nm:Em;return t.test(zi(e))}var jm=Bm;function Um(e,t){return e==null?void 0:e[t]}var Rm=Um;function km(e,t){var i=Rm(e,t);return jm(i)?i:void 0}var Ni=km,Fm=Ni(Vt,"WeakMap"),Ln=Fm,Sl=Object.create,Vm=function(){function e(){}return function(t){if(!Di(t))return{};if(Sl)return Sl(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),Gm=Vm;function Hm(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var Wm=Hm;function qm(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}var $m=qm,Xm=800,Ym=16,Zm=Date.now;function Km(e){var t=0,i=0;return function(){var r=Zm(),s=Ym-(r-i);if(i=r,s>0){if(++t>=Xm)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var Qm=Km;function Jm(e){return function(){return e}}var eg=Jm,tg=function(){try{var e=Ni(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Zs=tg,ig=Zs?function(e,t){return Zs(e,"toString",{configurable:!0,enumerable:!1,value:eg(t),writable:!0})}:vm,rg=ig,sg=Qm(rg),og=sg;function ng(e,t){for(var i=-1,r=e==null?0:e.length;++i<r&&t(e[i],i,e)!==!1;);return e}var ag=ng,lg=9007199254740991,hg=/^(?:0|[1-9]\d*)$/;function cg(e,t){var i=typeof e;return t=t??lg,!!t&&(i=="number"||i!="symbol"&&hg.test(e))&&e>-1&&e%1==0&&e<t}var ga=cg;function dg(e,t,i){t=="__proto__"&&Zs?Zs(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var sd=dg;function ug(e,t){return e===t||e!==e&&t!==t}var va=ug,pg=Object.prototype,fg=pg.hasOwnProperty;function mg(e,t,i){var r=e[t];(!(fg.call(e,t)&&va(r,i))||i===void 0&&!(t in e))&&sd(e,t,i)}var ya=mg;function gg(e,t,i,r){var s=!i;i||(i={});for(var o=-1,n=t.length;++o<n;){var h=t[o],a=r?r(i[h],e[h],h,i,e):void 0;a===void 0&&(a=e[h]),s?sd(i,h,a):ya(i,h,a)}return i}var Jr=gg,Al=Math.max;function vg(e,t,i){return t=Al(t===void 0?e.length-1:t,0),function(){for(var r=arguments,s=-1,o=Al(r.length-t,0),n=Array(o);++s<o;)n[s]=r[t+s];s=-1;for(var h=Array(t+1);++s<t;)h[s]=r[s];return h[t]=i(n),Wm(e,this,h)}}var yg=vg,bg=9007199254740991;function xg(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=bg}var ba=xg;function wg(e){return e!=null&&ba(e.length)&&!rd(e)}var od=wg,_g=Object.prototype;function Sg(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||_g;return e===i}var xa=Sg;function Ag(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}var Og=Ag,Cg="[object Arguments]";function Pg(e){return Zt(e)&&Ii(e)==Cg}var Ol=Pg,nd=Object.prototype,Tg=nd.hasOwnProperty,Mg=nd.propertyIsEnumerable,Eg=Ol(function(){return arguments}())?Ol:function(e){return Zt(e)&&Tg.call(e,"callee")&&!Mg.call(e,"callee")},wa=Eg;function Dg(){return!1}var Lg=Dg,ad=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Cl=ad&&typeof module=="object"&&module&&!module.nodeType&&module,Ig=Cl&&Cl.exports===ad,Pl=Ig?Vt.Buffer:void 0,zg=Pl?Pl.isBuffer:void 0,Ng=zg||Lg,Ks=Ng,Bg="[object Arguments]",jg="[object Array]",Ug="[object Boolean]",Rg="[object Date]",kg="[object Error]",Fg="[object Function]",Vg="[object Map]",Gg="[object Number]",Hg="[object Object]",Wg="[object RegExp]",qg="[object Set]",$g="[object String]",Xg="[object WeakMap]",Yg="[object ArrayBuffer]",Zg="[object DataView]",Kg="[object Float32Array]",Qg="[object Float64Array]",Jg="[object Int8Array]",e0="[object Int16Array]",t0="[object Int32Array]",i0="[object Uint8Array]",r0="[object Uint8ClampedArray]",s0="[object Uint16Array]",o0="[object Uint32Array]",Le={};Le[Kg]=Le[Qg]=Le[Jg]=Le[e0]=Le[t0]=Le[i0]=Le[r0]=Le[s0]=Le[o0]=!0;Le[Bg]=Le[jg]=Le[Yg]=Le[Ug]=Le[Zg]=Le[Rg]=Le[kg]=Le[Fg]=Le[Vg]=Le[Gg]=Le[Hg]=Le[Wg]=Le[qg]=Le[$g]=Le[Xg]=!1;function n0(e){return Zt(e)&&ba(e.length)&&!!Le[Ii(e)]}var a0=n0;function l0(e){return function(t){return e(t)}}var _a=l0,ld=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Fr=ld&&typeof module=="object"&&module&&!module.nodeType&&module,h0=Fr&&Fr.exports===ld,ko=h0&&Jc.process,c0=function(){try{var e=Fr&&Fr.require&&Fr.require("util").types;return e||ko&&ko.binding&&ko.binding("util")}catch{}}(),ar=c0,Tl=ar&&ar.isTypedArray,d0=Tl?_a(Tl):a0,hd=d0,u0=Object.prototype,p0=u0.hasOwnProperty;function f0(e,t){var i=Pt(e),r=!i&&wa(e),s=!i&&!r&&Ks(e),o=!i&&!r&&!s&&hd(e),n=i||r||s||o,h=n?Og(e.length,String):[],a=h.length;for(var c in e)(t||p0.call(e,c))&&!(n&&(c=="length"||s&&(c=="offset"||c=="parent")||o&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||ga(c,a)))&&h.push(c);return h}var cd=f0;function m0(e,t){return function(i){return e(t(i))}}var dd=m0,g0=dd(Object.keys,Object),v0=g0,y0=Object.prototype,b0=y0.hasOwnProperty;function x0(e){if(!xa(e))return v0(e);var t=[];for(var i in Object(e))b0.call(e,i)&&i!="constructor"&&t.push(i);return t}var w0=x0;function _0(e){return od(e)?cd(e):w0(e)}var Sa=_0;function S0(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t}var A0=S0,O0=Object.prototype,C0=O0.hasOwnProperty;function P0(e){if(!Di(e))return A0(e);var t=xa(e),i=[];for(var r in e)r=="constructor"&&(t||!C0.call(e,r))||i.push(r);return i}var T0=P0;function M0(e){return od(e)?cd(e,!0):T0(e)}var Aa=M0,E0=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,D0=/^\w*$/;function L0(e,t){if(Pt(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||ma(e)?!0:D0.test(e)||!E0.test(e)||t!=null&&e in Object(t)}var I0=L0,z0=Ni(Object,"create"),Xr=z0;function N0(){this.__data__=Xr?Xr(null):{},this.size=0}var B0=N0;function j0(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var U0=j0,R0="__lodash_hash_undefined__",k0=Object.prototype,F0=k0.hasOwnProperty;function V0(e){var t=this.__data__;if(Xr){var i=t[e];return i===R0?void 0:i}return F0.call(t,e)?t[e]:void 0}var G0=V0,H0=Object.prototype,W0=H0.hasOwnProperty;function q0(e){var t=this.__data__;return Xr?t[e]!==void 0:W0.call(t,e)}var $0=q0,X0="__lodash_hash_undefined__";function Y0(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Xr&&t===void 0?X0:t,this}var Z0=Y0;function ur(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}ur.prototype.clear=B0;ur.prototype.delete=U0;ur.prototype.get=G0;ur.prototype.has=$0;ur.prototype.set=Z0;var Ml=ur;function K0(){this.__data__=[],this.size=0}var Q0=K0;function J0(e,t){for(var i=e.length;i--;)if(va(e[i][0],t))return i;return-1}var yo=J0,ev=Array.prototype,tv=ev.splice;function iv(e){var t=this.__data__,i=yo(t,e);if(i<0)return!1;var r=t.length-1;return i==r?t.pop():tv.call(t,i,1),--this.size,!0}var rv=iv;function sv(e){var t=this.__data__,i=yo(t,e);return i<0?void 0:t[i][1]}var ov=sv;function nv(e){return yo(this.__data__,e)>-1}var av=nv;function lv(e,t){var i=this.__data__,r=yo(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this}var hv=lv;function pr(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}pr.prototype.clear=Q0;pr.prototype.delete=rv;pr.prototype.get=ov;pr.prototype.has=av;pr.prototype.set=hv;var bo=pr,cv=Ni(Vt,"Map"),Yr=cv;function dv(){this.size=0,this.__data__={hash:new Ml,map:new(Yr||bo),string:new Ml}}var uv=dv;function pv(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var fv=pv;function mv(e,t){var i=e.__data__;return fv(t)?i[typeof t=="string"?"string":"hash"]:i.map}var xo=mv;function gv(e){var t=xo(this,e).delete(e);return this.size-=t?1:0,t}var vv=gv;function yv(e){return xo(this,e).get(e)}var bv=yv;function xv(e){return xo(this,e).has(e)}var wv=xv;function _v(e,t){var i=xo(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this}var Sv=_v;function fr(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}fr.prototype.clear=uv;fr.prototype.delete=vv;fr.prototype.get=bv;fr.prototype.has=wv;fr.prototype.set=Sv;var wo=fr,Av="Expected a function";function Oa(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Av);var i=function(){var r=arguments,s=t?t.apply(this,r):r[0],o=i.cache;if(o.has(s))return o.get(s);var n=e.apply(this,r);return i.cache=o.set(s,n)||o,n};return i.cache=new(Oa.Cache||wo),i}Oa.Cache=wo;var Ov=Oa,Cv=500;function Pv(e){var t=Ov(e,function(r){return i.size===Cv&&i.clear(),r}),i=t.cache;return t}var Tv=Pv,Mv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ev=/\\(\\)?/g,Dv=Tv(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Mv,function(i,r,s,o){t.push(s?o.replace(Ev,"$1"):r||i)}),t}),Lv=Dv;function Iv(e){return e==null?"":fm(e)}var zv=Iv;function Nv(e,t){return Pt(e)?e:I0(e,t)?[e]:Lv(zv(e))}var mr=Nv,Bv=1/0;function jv(e){if(typeof e=="string"||ma(e))return e;var t=e+"";return t=="0"&&1/e==-Bv?"-0":t}var _o=jv;function Uv(e,t){t=mr(t,e);for(var i=0,r=t.length;e!=null&&i<r;)e=e[_o(t[i++])];return i&&i==r?e:void 0}var ud=Uv;function Rv(e,t){for(var i=-1,r=t.length,s=e.length;++i<r;)e[s+i]=t[i];return e}var Ca=Rv,El=xt?xt.isConcatSpreadable:void 0;function kv(e){return Pt(e)||wa(e)||!!(El&&e&&e[El])}var Fv=kv;function pd(e,t,i,r,s){var o=-1,n=e.length;for(i||(i=Fv),s||(s=[]);++o<n;){var h=e[o];t>0&&i(h)?t>1?pd(h,t-1,i,r,s):Ca(s,h):r||(s[s.length]=h)}return s}var Vv=pd;function Gv(e){var t=e==null?0:e.length;return t?Vv(e,1):[]}var Hv=Gv;function Wv(e){return og(yg(e,void 0,Hv),e+"")}var fd=Wv,qv=dd(Object.getPrototypeOf,Object),Pa=qv,$v="[object Object]",Xv=Function.prototype,Yv=Object.prototype,md=Xv.toString,Zv=Yv.hasOwnProperty,Kv=md.call(Object);function Qv(e){if(!Zt(e)||Ii(e)!=$v)return!1;var t=Pa(e);if(t===null)return!0;var i=Zv.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&md.call(i)==Kv}var Jv=Qv;function ey(e,t,i){var r=-1,s=e.length;t<0&&(t=-t>s?0:s+t),i=i>s?s:i,i<0&&(i+=s),s=t>i?0:i-t>>>0,t>>>=0;for(var o=Array(s);++r<s;)o[r]=e[r+t];return o}var ty=ey;function iy(){this.__data__=new bo,this.size=0}var ry=iy;function sy(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var oy=sy;function ny(e){return this.__data__.get(e)}var ay=ny;function ly(e){return this.__data__.has(e)}var hy=ly,cy=200;function dy(e,t){var i=this.__data__;if(i instanceof bo){var r=i.__data__;if(!Yr||r.length<cy-1)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new wo(r)}return i.set(e,t),this.size=i.size,this}var uy=dy;function gr(e){var t=this.__data__=new bo(e);this.size=t.size}gr.prototype.clear=ry;gr.prototype.delete=oy;gr.prototype.get=ay;gr.prototype.has=hy;gr.prototype.set=uy;var Ds=gr;function py(e,t){return e&&Jr(t,Sa(t),e)}var fy=py;function my(e,t){return e&&Jr(t,Aa(t),e)}var gy=my,gd=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Dl=gd&&typeof module=="object"&&module&&!module.nodeType&&module,vy=Dl&&Dl.exports===gd,Ll=vy?Vt.Buffer:void 0,Il=Ll?Ll.allocUnsafe:void 0;function yy(e,t){if(t)return e.slice();var i=e.length,r=Il?Il(i):new e.constructor(i);return e.copy(r),r}var by=yy;function xy(e,t){for(var i=-1,r=e==null?0:e.length,s=0,o=[];++i<r;){var n=e[i];t(n,i,e)&&(o[s++]=n)}return o}var wy=xy;function _y(){return[]}var vd=_y,Sy=Object.prototype,Ay=Sy.propertyIsEnumerable,zl=Object.getOwnPropertySymbols,Oy=zl?function(e){return e==null?[]:(e=Object(e),wy(zl(e),function(t){return Ay.call(e,t)}))}:vd,Ta=Oy;function Cy(e,t){return Jr(e,Ta(e),t)}var Py=Cy,Ty=Object.getOwnPropertySymbols,My=Ty?function(e){for(var t=[];e;)Ca(t,Ta(e)),e=Pa(e);return t}:vd,yd=My;function Ey(e,t){return Jr(e,yd(e),t)}var Dy=Ey;function Ly(e,t,i){var r=t(e);return Pt(e)?r:Ca(r,i(e))}var bd=Ly;function Iy(e){return bd(e,Sa,Ta)}var In=Iy;function zy(e){return bd(e,Aa,yd)}var xd=zy,Ny=Ni(Vt,"DataView"),zn=Ny,By=Ni(Vt,"Promise"),Nn=By,jy=Ni(Vt,"Set"),Bn=jy,Nl="[object Map]",Uy="[object Object]",Bl="[object Promise]",jl="[object Set]",Ul="[object WeakMap]",Rl="[object DataView]",Ry=zi(zn),ky=zi(Yr),Fy=zi(Nn),Vy=zi(Bn),Gy=zi(Ln),yi=Ii;(zn&&yi(new zn(new ArrayBuffer(1)))!=Rl||Yr&&yi(new Yr)!=Nl||Nn&&yi(Nn.resolve())!=Bl||Bn&&yi(new Bn)!=jl||Ln&&yi(new Ln)!=Ul)&&(yi=function(e){var t=Ii(e),i=t==Uy?e.constructor:void 0,r=i?zi(i):"";if(r)switch(r){case Ry:return Rl;case ky:return Nl;case Fy:return Bl;case Vy:return jl;case Gy:return Ul}return t});var Zr=yi,Hy=Object.prototype,Wy=Hy.hasOwnProperty;function qy(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&Wy.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var $y=qy,Xy=Vt.Uint8Array,Qs=Xy;function Yy(e){var t=new e.constructor(e.byteLength);return new Qs(t).set(new Qs(e)),t}var Ma=Yy;function Zy(e,t){var i=t?Ma(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}var Ky=Zy,Qy=/\w*$/;function Jy(e){var t=new e.constructor(e.source,Qy.exec(e));return t.lastIndex=e.lastIndex,t}var e1=Jy,kl=xt?xt.prototype:void 0,Fl=kl?kl.valueOf:void 0;function t1(e){return Fl?Object(Fl.call(e)):{}}var i1=t1;function r1(e,t){var i=t?Ma(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var s1=r1,o1="[object Boolean]",n1="[object Date]",a1="[object Map]",l1="[object Number]",h1="[object RegExp]",c1="[object Set]",d1="[object String]",u1="[object Symbol]",p1="[object ArrayBuffer]",f1="[object DataView]",m1="[object Float32Array]",g1="[object Float64Array]",v1="[object Int8Array]",y1="[object Int16Array]",b1="[object Int32Array]",x1="[object Uint8Array]",w1="[object Uint8ClampedArray]",_1="[object Uint16Array]",S1="[object Uint32Array]";function A1(e,t,i){var r=e.constructor;switch(t){case p1:return Ma(e);case o1:case n1:return new r(+e);case f1:return Ky(e,i);case m1:case g1:case v1:case y1:case b1:case x1:case w1:case _1:case S1:return s1(e,i);case a1:return new r;case l1:case d1:return new r(e);case h1:return e1(e);case c1:return new r;case u1:return i1(e)}}var O1=A1;function C1(e){return typeof e.constructor=="function"&&!xa(e)?Gm(Pa(e)):{}}var P1=C1,T1="[object Map]";function M1(e){return Zt(e)&&Zr(e)==T1}var E1=M1,Vl=ar&&ar.isMap,D1=Vl?_a(Vl):E1,L1=D1,I1="[object Set]";function z1(e){return Zt(e)&&Zr(e)==I1}var N1=z1,Gl=ar&&ar.isSet,B1=Gl?_a(Gl):N1,j1=B1,U1=1,R1=2,k1=4,wd="[object Arguments]",F1="[object Array]",V1="[object Boolean]",G1="[object Date]",H1="[object Error]",_d="[object Function]",W1="[object GeneratorFunction]",q1="[object Map]",$1="[object Number]",Sd="[object Object]",X1="[object RegExp]",Y1="[object Set]",Z1="[object String]",K1="[object Symbol]",Q1="[object WeakMap]",J1="[object ArrayBuffer]",eb="[object DataView]",tb="[object Float32Array]",ib="[object Float64Array]",rb="[object Int8Array]",sb="[object Int16Array]",ob="[object Int32Array]",nb="[object Uint8Array]",ab="[object Uint8ClampedArray]",lb="[object Uint16Array]",hb="[object Uint32Array]",Me={};Me[wd]=Me[F1]=Me[J1]=Me[eb]=Me[V1]=Me[G1]=Me[tb]=Me[ib]=Me[rb]=Me[sb]=Me[ob]=Me[q1]=Me[$1]=Me[Sd]=Me[X1]=Me[Y1]=Me[Z1]=Me[K1]=Me[nb]=Me[ab]=Me[lb]=Me[hb]=!0;Me[H1]=Me[_d]=Me[Q1]=!1;function Ls(e,t,i,r,s,o){var n,h=t&U1,a=t&R1,c=t&k1;if(i&&(n=s?i(e,r,s,o):i(e)),n!==void 0)return n;if(!Di(e))return e;var u=Pt(e);if(u){if(n=$y(e),!h)return $m(e,n)}else{var l=Zr(e),d=l==_d||l==W1;if(Ks(e))return by(e,h);if(l==Sd||l==wd||d&&!s){if(n=a||d?{}:P1(e),!h)return a?Dy(e,gy(n,e)):Py(e,fy(n,e))}else{if(!Me[l])return s?e:{};n=O1(e,l,h)}}o||(o=new Ds);var p=o.get(e);if(p)return p;o.set(e,n),j1(e)?e.forEach(function(g){n.add(Ls(g,t,i,g,e,o))}):L1(e)&&e.forEach(function(g,m){n.set(m,Ls(g,t,i,m,e,o))});var f=c?a?xd:In:a?Aa:Sa,v=u?void 0:f(e);return ag(v||e,function(g,m){v&&(m=g,g=e[m]),ya(n,m,Ls(g,t,i,m,e,o))}),n}var Ad=Ls,cb=1,db=4;function ub(e){return Ad(e,cb|db)}var So=ub,pb="__lodash_hash_undefined__";function fb(e){return this.__data__.set(e,pb),this}var mb=fb;function gb(e){return this.__data__.has(e)}var vb=gb;function Js(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new wo;++t<i;)this.add(e[t])}Js.prototype.add=Js.prototype.push=mb;Js.prototype.has=vb;var yb=Js;function bb(e,t){for(var i=-1,r=e==null?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}var xb=bb;function wb(e,t){return e.has(t)}var _b=wb,Sb=1,Ab=2;function Ob(e,t,i,r,s,o){var n=i&Sb,h=e.length,a=t.length;if(h!=a&&!(n&&a>h))return!1;var c=o.get(e),u=o.get(t);if(c&&u)return c==t&&u==e;var l=-1,d=!0,p=i&Ab?new yb:void 0;for(o.set(e,t),o.set(t,e);++l<h;){var f=e[l],v=t[l];if(r)var g=n?r(v,f,l,t,e,o):r(f,v,l,e,t,o);if(g!==void 0){if(g)continue;d=!1;break}if(p){if(!xb(t,function(m,y){if(!_b(p,y)&&(f===m||s(f,m,i,r,o)))return p.push(y)})){d=!1;break}}else if(!(f===v||s(f,v,i,r,o))){d=!1;break}}return o.delete(e),o.delete(t),d}var Od=Ob;function Cb(e){var t=-1,i=Array(e.size);return e.forEach(function(r,s){i[++t]=[s,r]}),i}var Pb=Cb;function Tb(e){var t=-1,i=Array(e.size);return e.forEach(function(r){i[++t]=r}),i}var Mb=Tb,Eb=1,Db=2,Lb="[object Boolean]",Ib="[object Date]",zb="[object Error]",Nb="[object Map]",Bb="[object Number]",jb="[object RegExp]",Ub="[object Set]",Rb="[object String]",kb="[object Symbol]",Fb="[object ArrayBuffer]",Vb="[object DataView]",Hl=xt?xt.prototype:void 0,Fo=Hl?Hl.valueOf:void 0;function Gb(e,t,i,r,s,o,n){switch(i){case Vb:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Fb:return!(e.byteLength!=t.byteLength||!o(new Qs(e),new Qs(t)));case Lb:case Ib:case Bb:return va(+e,+t);case zb:return e.name==t.name&&e.message==t.message;case jb:case Rb:return e==t+"";case Nb:var h=Pb;case Ub:var a=r&Eb;if(h||(h=Mb),e.size!=t.size&&!a)return!1;var c=n.get(e);if(c)return c==t;r|=Db,n.set(e,t);var u=Od(h(e),h(t),r,s,o,n);return n.delete(e),u;case kb:if(Fo)return Fo.call(e)==Fo.call(t)}return!1}var Hb=Gb,Wb=1,qb=Object.prototype,$b=qb.hasOwnProperty;function Xb(e,t,i,r,s,o){var n=i&Wb,h=In(e),a=h.length,c=In(t),u=c.length;if(a!=u&&!n)return!1;for(var l=a;l--;){var d=h[l];if(!(n?d in t:$b.call(t,d)))return!1}var p=o.get(e),f=o.get(t);if(p&&f)return p==t&&f==e;var v=!0;o.set(e,t),o.set(t,e);for(var g=n;++l<a;){d=h[l];var m=e[d],y=t[d];if(r)var w=n?r(y,m,d,t,e,o):r(m,y,d,e,t,o);if(!(w===void 0?m===y||s(m,y,i,r,o):w)){v=!1;break}g||(g=d=="constructor")}if(v&&!g){var x=e.constructor,S=t.constructor;x!=S&&"constructor"in e&&"constructor"in t&&!(typeof x=="function"&&x instanceof x&&typeof S=="function"&&S instanceof S)&&(v=!1)}return o.delete(e),o.delete(t),v}var Yb=Xb,Zb=1,Wl="[object Arguments]",ql="[object Array]",as="[object Object]",Kb=Object.prototype,$l=Kb.hasOwnProperty;function Qb(e,t,i,r,s,o){var n=Pt(e),h=Pt(t),a=n?ql:Zr(e),c=h?ql:Zr(t);a=a==Wl?as:a,c=c==Wl?as:c;var u=a==as,l=c==as,d=a==c;if(d&&Ks(e)){if(!Ks(t))return!1;n=!0,u=!1}if(d&&!u)return o||(o=new Ds),n||hd(e)?Od(e,t,i,r,s,o):Hb(e,t,a,i,r,s,o);if(!(i&Zb)){var p=u&&$l.call(e,"__wrapped__"),f=l&&$l.call(t,"__wrapped__");if(p||f){var v=p?e.value():e,g=f?t.value():t;return o||(o=new Ds),s(v,g,i,r,o)}}return d?(o||(o=new Ds),Yb(e,t,i,r,s,o)):!1}var Jb=Qb;function Cd(e,t,i,r,s){return e===t?!0:e==null||t==null||!Zt(e)&&!Zt(t)?e!==e&&t!==t:Jb(e,t,i,r,Cd,s)}var ex=Cd;function tx(e,t){return e!=null&&t in Object(e)}var ix=tx;function rx(e,t,i){t=mr(t,e);for(var r=-1,s=t.length,o=!1;++r<s;){var n=_o(t[r]);if(!(o=e!=null&&i(e,n)))break;e=e[n]}return o||++r!=s?o:(s=e==null?0:e.length,!!s&&ba(s)&&ga(n,s)&&(Pt(e)||wa(e)))}var sx=rx;function ox(e,t){return e!=null&&sx(e,t,ix)}var nx=ox;function ax(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var lx=ax;function hx(e,t){return t.length<2?e:ud(e,ty(t,0,-1))}var cx=hx;function dx(e,t){return ex(e,t)}var Pd=dx;function ux(e,t){return t=mr(t,e),e=cx(e,t),e==null||delete e[_o(lx(t))]}var px=ux;function fx(e){return Jv(e)?void 0:e}var mx=fx,gx=1,vx=2,yx=4,bx=fd(function(e,t){var i={};if(e==null)return i;var r=!1;t=td(t,function(o){return o=mr(o,e),r||(r=o.length>1),o}),Jr(e,xd(e),i),r&&(i=Ad(i,gx|vx|yx,mx));for(var s=t.length;s--;)px(i,t[s]);return i}),jn=bx;function xx(e,t,i,r){if(!Di(e))return e;t=mr(t,e);for(var s=-1,o=t.length,n=o-1,h=e;h!=null&&++s<o;){var a=_o(t[s]),c=i;if(a==="__proto__"||a==="constructor"||a==="prototype")return e;if(s!=n){var u=h[a];c=r?r(u,a,h):void 0,c===void 0&&(c=Di(u)?u:ga(t[s+1])?[]:{})}ya(h,a,c),h=h[a]}return e}var wx=xx;function _x(e,t,i){for(var r=-1,s=t.length,o={};++r<s;){var n=t[r],h=ud(e,n);i(h,n)&&wx(o,mr(n,e),h)}return o}var Sx=_x;function Ax(e,t){return Sx(e,t,function(i,r){return nx(e,r)})}var Ox=Ax,Cx=fd(function(e,t){return e==null?{}:Ox(e,t)}),eo=Cx,Xl;(e=>{function t(r){return r==="Component"||r==="Instance"}e.isComponentRelated=t;function i(r){return r==="Empty"||r==="Instance"}e.isEmptyOrComponent=i})(Xl||(Xl={}));var lr;(e=>{e.identity={...Sn.identity,hiddenMatrix:or.identity};function t(s){return{position:s.position,rotation:s.rotation,scale:s.scale,hiddenMatrix:s.hiddenMatrix}}e.fromObject=t;function i(s,o){return{position:(o==null?void 0:o.position)||s.position,rotation:(o==null?void 0:o.rotation)||s.rotation,scale:(o==null?void 0:o.scale)||s.scale,hiddenMatrix:(o==null?void 0:o.hiddenMatrix)||s.hiddenMatrix}}e.merge=i;function r(s,o){return Wf({position:Wi.isEqual(s.position,o.position)?void 0:o.position,rotation:Wi.isEqual(s.rotation,o.rotation)?void 0:o.rotation,scale:Wi.isEqual(s.scale,o.scale)?null:o.scale,hiddenMatrix:or.isEqual(s.hiddenMatrix,o.hiddenMatrix)?void 0:o.hiddenMatrix})}e.diff=r})(lr||(lr={}));var Yl;(e=>e.defaultData={fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(Yl||(Yl={}));var bt;(e=>e.defaultData={states:new Ce,events:new Ce,visible:!0,raycastLock:!1,collision:"visibility",physics:null,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...lr.identity,cloner:null})(bt||(bt={}));var Zl;(e=>e.defaultData={type:"Empty",...bt.defaultData})(Zl||(Zl={}));var Kl;(e=>e.defaultData={type:"Component",...bt.defaultData})(Kl||(Kl={}));var $i;(e=>e.defaultData={type:"Mesh",...bt.defaultData,...Mn.defaultData})($i||($i={}));var to;(e=>e.defaultData={...bt.defaultData,...lr.identity,...$r.defaultData})(to||(to={}));var Ql;(e=>{function t(i){return{...bt.defaultData,...Cn.defaultData(i)}}e.defaultData=t})(Ql||(Ql={}));var io;(e=>{function t(r,s,o=0){for(;o<s.length;){let n=r?r[s[o]]:void 0;if(s.length===o+1)return n;if(n)r=n.descendants,o+=1;else return}}e.resolveWithDes=t;function i(r,s,o=0){let n=t(r,s,o);if(n){let h=Object.keys(n);if(h.length===1&&h[0]==="descendants")return}return n}e.resolve=i})(io||(io={}));var hr;(e=>{e.rootOverrideProps=["physics"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"];function t(r,s){return{...bt.defaultData,...s,component:r,overrides:new qe,physics:void 0,type:"Instance"}}e.ofComponent=t;function i(r){let s=lr.fromObject(r.data);return t(r.id,s)}e.fromComponentData=i})(hr||(hr={}));var Jl;(e=>(e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:or.identity,name:"Play Camera",visible:!0,raycastLock:!1,collision:"visibility",physics:null,states:new Ce,events:new Ce,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...$r.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...bt.defaultData,...$i.defaultData,geometry:qi.defaultData("RectangleGeometry"),material:Ft.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...bt.defaultData,...$i.defaultData,geometry:qi.defaultData("BooleanGeometry"),material:Ft.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...bt.defaultData,...$i.defaultData,geometry:qi.defaultData("TextGeometry"),material:Ft.defaultTwoLayerData("phong","layer1","layer2")}))(Jl||(Jl={}));var Gi;(e=>{function t(o,n){let h={name:n};return o.type==="Mesh"?(h.geometry={},"material"in o&&(h.material={layers:new qe}),"materials"in o&&(h.materials=o.materials.map(a=>({layers:new qe})))):Ei.is(o.type)&&(h.perspective={},h.orthographic={}),h}e.newEmpty=t;function i(o,n){if(n===void 0)return o;let h={...o};return"material"in h&&"material"in n&&n.material&&(h.material=Gs(h.material,a=>{if(typeof a!="string")for(let[c,u]of Object.entries(n.material.layers)){let l=a.layers.data(c);l&&ft.patch(l,u)}}).data),h.materials&&n.materials&&(h.materials=Gs(h.materials,a=>{var c,u;for(let l=0;l<h.materials.length;l++){let d=n.materials[l];if(typeof d!="string")for(let[p,f]of Object.entries(d.layers)){let v=(u=(c=a[l])==null?void 0:c.layers)==null?void 0:u.data(p);v&&ft.patch(v,f)}}}).data),h}function r(o,n){let h,a=[],c={orthographic:0,perspective:0,geometry:0};function u(l,d){for(let[p,f]of Object.entries(d.layers)){let{texture:v,...g}=f;if(v!==void 0&&Object.keys(v).length>0){let m={path:[...l,"layers",p,"texture"],props:v,type:0};a.push(m)}if(Object.keys(g).length>0){let m={path:[...l,"layers",p],props:g,type:0};a.push(m)}}}for(let[l,d]of Object.entries(n))if(l!=="name")if(l==="cloner")a.push(...An.toOps(d,["cloner"]));else if(l==="pathSnapping")a.push({path:[l],props:{slide:d.slide,offset:d.offset},type:0});else if(l==="material")u(["material"],d);else if(l==="materials")for(let[p,f]of Object.entries(d))u(["materials",p],f);else if(c[l]===0){if(l==="geometry"&&d.extrusion!==void 0){let p={path:[l,"extrusion"],props:d.extrusion,type:0};a.push(p),d={...d},delete d.extrusion}if(Object.keys(d).length>0){let p={path:[l],props:d,type:0};a.push(p)}}else h===void 0&&(h={path:[],props:{},type:0},a.push(h)),h.props[l]=d;return a}e.toOps=r;function s(o,n){var a,c,u,l,d,p;if(n===void 0)return o;let h={...o};if(Object.assign(h,lr.merge(h,n)),Object.assign(h,{pathSnapping:Object.assign({},h.pathSnapping,{slide:((a=n.pathSnapping)==null?void 0:a.slide)??((c=h.pathSnapping)==null?void 0:c.slide)??0,offset:((u=n.pathSnapping)==null?void 0:u.offset)??((l=h.pathSnapping)==null?void 0:l.offset)??0})}),Ei.is(o.type)){h.orthographic={...h.orthographic},h.perspective={...h.perspective};let f=n;((d=f.orthographic)==null?void 0:d.zoom)!==void 0&&(h.orthographic.zoom=f.orthographic.zoom),((p=f.perspective)==null?void 0:p.zoom)!==void 0&&(h.perspective.zoom=f.perspective.zoom),f.isUpVectorFlipped!==void 0&&(h.isUpVectorFlipped=f.isUpVectorFlipped),f.targetOffset!==void 0&&(h.targetOffset=f.targetOffset)}else if(o.type==="Mesh")"geometry"in n&&Object.assign(h,{geometry:Dn.merge(h.geometry,n.geometry)}),(n.material||n.materials)&&(h=i(h,n)),h.cloner&&"cloner"in n&&Object.assign(h,{cloner:si.merge(h.cloner,n.cloner)});else if(o.type==="Empty")h.cloner&&"cloner"in n&&Object.assign(h,{cloner:si.merge(h.cloner,n.cloner)});else if(On.is(o.type)){let f=n;f.intensity!==void 0&&(h.intensity=f.intensity),f.color!==void 0&&(typeof f.color=="string"?h.color=f.color:h.color=gt.clone(f.color))}return h}e.patch=s})(Gi||(Gi={}));var ro;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0,autoZoom:!1})(ro||(ro={}));var Un;(e=>e.defaultData={orbitControls:ro.defaultData,playCamera:null,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1}},stopRaycast:!0,joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let r=0,s=0;return i<5?s=-30:i<10&&(s=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,s],"show"]}),gameControlObject:null})(Un||(Un={}));var so;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII="})(so||(so={}));var Rn;(e=>{function t(){let s={};return s["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},nr(s,ke.prototype)}e.defaultColors=t;function i(s){let o={};return s!=null&&s.withAITexture&&(o["a1b10010-844c-a8a3-11ec-0242ac2011ec"]={...so.emptyImage,name:"AI generated image"}),nr(o,ke.prototype)}e.defaultImages=i;function r(){return{materials:new ke,images:new ke,videos:new ke,colors:new ke,audios:new ke,fonts:new ke,penumbraSize:[2,2,2]}}e.emptyData=r})(Rn||(Rn={}));function eh(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let i=t.colorA,r=t.colorB,s=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],o=[0,1];for(let h=2;h<10;h++)s.push(s[1]),o.push(1);let n={...eo($e(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:s,steps:o,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,n)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let i={...$e(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function Is(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function zs(e,t){e.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach(s=>{typeof s!="string"&&t(s)}):"material"in r&&typeof r.material!="string"&&t(r.material)})}function Px(e){Object.assign(e.scene.publish,{orbitControls:{...ro.defaultData,...$e(e.scene.publish.orbitControls)}})}function Tx(e){Object.assign(e.scene.publish.settings,{video:{...Un.defaultData.settings.video,...$e(e.scene.publish.settings.video)}})}function Mx(e){function t(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[s,o]of Object.entries(r))if((Vf.includes(s)||typeof o=="boolean")&&delete r[s],s==="texture")for(let[n,h]of Object.entries(o))(Gf.includes(n)||typeof h=="boolean")&&delete o[n]}}}e.scene.objects.traverse((i,r)=>{r.states.forEach(s=>{let o=s;o.material?t(o.material):o.materials&&o.materials.forEach(n=>{t(n)})})})}function Ex(e){e.scene.publish.withBackground=!0}function Dx(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function Lx(e){e.scene.objects.traverse((t,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(s=>s+1),r.linear.scale=r.linear.scale.map(s=>s+1))})}function Ix(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function zx(e){e.scene.objects.traverse((t,i)=>{let r=e.scene.objects.unproxy().parent(t);if(r){let s=$e(e.scene.objects.data(r));s&&s.type==="Mesh"&&s.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=$e(i).booleanExclude!==!0)}})}function Nx(e){e.scene.objects.traverse((t,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function Bx(e){function t(r){Object.setPrototypeOf(r,qe.prototype),r.texture&&Object.setPrototypeOf(r.texture,qe.prototype)}function i(r){Object.setPrototypeOf(r,qe.prototype);for(let s in r)t(r[s])}e.scene.objects.traverse((r,s)=>{s.states.forEach(o=>{let n=o;if(n.material){let h=$e(n.material).layers;i(h),n.material.layers=h}if(n.materials)for(let h=0;h<n.materials.length;h++){let a=n.materials[h],c=$e(a).layers;i(c),a.layers=c}})})}function th(e){e.layers===void 0&&Object.assign(e,Ft.defaultTwoLayerData("lambert"))}function Vo(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let i=[...t.colors];i.push(t.colors[9]);let r=[...t.steps];r.push(t.steps[9]);let s={...$e(t),colors:i,steps:r};Object.assign(t,s)}})}function jx(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function ih(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&Vo(r)}):"material"in i&&typeof i.material!="string"&&Vo(i.material)}),Object.values(e.shared.materials).forEach(t=>Vo(t))}function Ux(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function Rx(e){e.shared.audios=nr({},ke.prototype)}function kx(e){e.shared.videos=nr({},ke.prototype)}function Fx(e){let t=e.shared.materials;Object.entries(t).forEach(([i,r])=>{if(!r.layers){let s={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:s})}})}function Vx(e){Object.entries($e(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries($e(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function Gx(e){e.scene.publish.settings.web.preload=!1}function rh(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function Hx(e){e.shared.fonts=nr({},ke.prototype)}function Wx(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function qx(e){let t=[];e.scene.objects.traverse((i,r)=>{let s=r;if(s.type==="TextFrame"){let o=Ft.defaultTwoLayerData("phong"),n=typeof s.color=="string"?e.shared.colors[s.color]:s.color;o.layers[1].data.color={r:n.r,g:n.g,b:n.b},o.layers[1].data.alpha=s.alpha;let h=Wx(s.font);e.shared.fonts[h]===void 0&&(e.shared.fonts[h]={name:h});let a={name:s.name,...bt.defaultData,...$i.defaultData,flatShading:!1,wireframe:!1,geometry:{...qi.defaultData("TextGeometry"),width:s.width,height:s.height,font:h,depth:0,horizontalAlign:s.horizontalAlign,verticalAlign:s.verticalAlign,fontSize:s.fontSize*1.40625,lineHeight:s.lineHeight/1.40625,letterSpacing:s.letterSpacing-1,text:s.text,textTransform:s.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:o,states:$e(s.states),events:$e(s.events),visible:s.visible,raycastLock:s.raycastLock,position:s.position,rotation:s.rotation,scale:s.scale,hiddenMatrix:s.hiddenMatrix},c=$e(e.scene.objects).parent(i);e.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:a,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}function $x(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,r)=>{r.events.forEach(s=>{if(t[Number(s.type)])if(Object.assign(s,{type:t[Number(s.type)]}),s.type==="Audio"&&"audioEvent"in s&&(Object.assign(s,{playAudio:s.audioEvent}),delete s.audioEvent),s.type==="GameControl")Object.assign(s,{gameActions:{idle:new Ce,move:new Ce,jump:new Ce}});else{let o=new Ce;Object.assign(s,{actions:o}),(s.type==="MouseDown"||s.type==="MouseUp"||s.type==="KeyDown"||s.type==="KeyUp")&&"url"in s&&o.push({fi:0,id:Ue.generateUUID(),data:{type:"Link",url:s.url,delay:0}}),"targets"in s&&(s.targets.forEach((n,h,a)=>{let c={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},u={easing:n.easing,duration:n.duration};n.easing===6?Object.assign(u,eo(n,"mass","stiffness","damping","velocity")):n.easing===5&&Object.assign(u,{control1:{...n.control1},control2:{...n.control2}});let l={repeat:n.repeat?-1:0,delay:n.delay,delayDirection:n.delayDirection,direction:n.cycle&&n.rewind?"pingpong-rewind":n.cycle?"pingpong":"normal"},d={state:n.state,...l,...u},p={allowSlerp:!0,type:"Transition",object:n.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new Ce({fi:0,id:Ue.generateUUID(),data:c},{fi:1,id:Ue.generateUUID(),data:d})};o.push({fi:a,id:h,data:p})}),delete s.targets)}})})}function Xx(e){e.scene.objects.traverse((t,i)=>{function r(s,o){var a;let n=new Ce,h=[];if(i.events.forEach((c,u,l)=>{if(c.type==="Audio"&&c.trigger===o){let d;h.push(u),c.interaction==="play"?d={...eo(c,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in c?c.after:void 0,toggle:"after"in c?c.toggle:void 0,type:"Audio"}:(c.interaction==="pause"||c.interaction==="stop")&&(d={...eo(c,"interaction","delay","object","playAudio"),type:"Audio"}),d&&n.push({fi:l,id:u,data:d})}}),h.forEach(c=>i.events.delete(c)),n.length){let c=(a=i.events.find(u=>u.type===s))==null?void 0:a.data;c?"actions"in c&&c.actions.insertBefore(null,n):i.events.insertBefore(null,[{id:Ue.generateUUID(),data:{type:s,actions:n}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function sh(e){var i;let t=(i=e.layers.find(r=>r.type==="light"))==null?void 0:i.data;if((t==null?void 0:t.category)==="basic"){let r=ft.defaultData("light","phong"),s=t;Object.assign(s,r),s.visible=!1}}function oh(e){Is(e,sh),zs(e,sh)}function Yx(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function Zx(e){e.scene.objects.traverse((t,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function Kx(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=Ft.defaultTwoLayerData("phong"))})}function Qx(e){e.scene.publish.orbitControls.autoZoom===void 0&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function Jx(e){e.scene.objects.traverse((t,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function ew(e){e.scene.publish.mouseEventTarget===void 0&&(e.scene.publish.mouseEventTarget="canvas"),e.scene.publish.settings.web.hint===void 0&&(e.scene.publish.settings.web.hint=!1)}function tw(e){let{video:t}=e.scene.publish.settings;t.format==="gif"&&t.fps>48&&(t.fps=15)}function iw(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function rw(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,r)=>{t&&r.physics===null?r.collision=!1:r.collision="visibility"})}var nh=37;function sw(e){let t=e.schema??0;t!==nh&&(console.warn("updating from ",t,"to ",nh),t<1&&(zs(e,eh),Is(e,eh),e.schema=1),t<2&&(Px(e),e.schema=2),t<3&&(Mx(e),e.schema=3),t<4&&(Ex(e),e.schema=4),t<5&&(Dx(e),e.schema=5),t<6&&(Lx(e),e.schema=6),t<7&&(Ix(e),e.schema=7),t<8&&(e.schema=8),t<9&&(ih(e),e.schema=9),t<10&&(jx(e),e.schema=10),t<11&&(Ux(e),e.schema=11),t<12&&(ih(e),e.schema=12),t<13&&(Rx(e),e.schema=13),t<14&&(Fx(e),e.schema=14),t<15&&(Vx(e),e.schema=15),t<16&&(Gx(e),e.schema=16),t<17&&(zs(e,rh),Is(e,rh),e.schema=17),t<18&&(zs(e,th),Is(e,th),e.schema=18),t<19&&(Tx(e),e.schema=19),t<20&&(Hx(e),qx(e),e.schema=20),t<21&&($x(e),Xx(e),e.schema=21),t<22&&(oh(e),e.schema=22),t<23&&(Yx(e),e.schema=23),t<24&&(Zx(e),e.schema=24),(t<25||e.shared.videos===void 0)&&(kx(e),t<25&&(e.schema=25)),t<26&&(zx(e),e.schema=26),t<27&&(Nx(e),e.schema=27),t<28&&(oh(e),e.schema=28),t<29&&(Bx(e),e.schema=29),t<30&&(Kx(e),e.schema=30),t<31&&(Qx(e),e.schema=31),t<33&&(Jx(e),e.schema=33),t<34&&(ew(e),e.schema=34),t<35&&(tw(e),e.schema=35),t<36&&(iw(e),e.schema=36),t<37&&(rw(e),e.schema=37))}var Ar=uo(lf()),ow=.5*(Math.sqrt(3)-1),Or=(3-Math.sqrt(3))/6,nw=1/3,Dt=1/6,Vr=e=>Math.floor(e)|0,ah=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),Go=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function Ho(e=Math.random){let t=Td(e),i=new Float64Array(t).map(s=>ah[s%12*2]),r=new Float64Array(t).map(s=>ah[s%12*2+1]);return function(s,o){let n=0,h=0,a=0,c=(s+o)*ow,u=Vr(s+c),l=Vr(o+c),d=(u+l)*Or,p=u-d,f=l-d,v=s-p,g=o-f,m,y;v>g?(m=1,y=0):(m=0,y=1);let w=v-m+Or,x=g-y+Or,S=v-1+2*Or,b=g-1+2*Or,A=u&255,O=l&255,P=.5-v*v-g*g;if(P>=0){let M=A+t[O],N=i[M],W=r[M];P*=P,n=P*P*(N*v+W*g)}let _=.5-w*w-x*x;if(_>=0){let M=A+m+t[O+y],N=i[M],W=r[M];_*=_,h=_*_*(N*w+W*x)}let C=.5-S*S-b*b;if(C>=0){let M=A+1+t[O+1],N=i[M],W=r[M];C*=C,a=C*C*(N*S+W*b)}return 70*(n+h+a)}}function aw(e=Math.random){let t=Td(e),i=new Float64Array(t).map(o=>Go[o%12*3]),r=new Float64Array(t).map(o=>Go[o%12*3+1]),s=new Float64Array(t).map(o=>Go[o%12*3+2]);return function(o,n,h){let a,c,u,l,d=(o+n+h)*nw,p=Vr(o+d),f=Vr(n+d),v=Vr(h+d),g=(p+f+v)*Dt,m=p-g,y=f-g,w=v-g,x=o-m,S=n-y,b=h-w,A,O,P,_,C,M;x>=S?S>=b?(A=1,O=0,P=0,_=1,C=1,M=0):x>=b?(A=1,O=0,P=0,_=1,C=0,M=1):(A=0,O=0,P=1,_=1,C=0,M=1):S<b?(A=0,O=0,P=1,_=0,C=1,M=1):x<b?(A=0,O=1,P=0,_=0,C=1,M=1):(A=0,O=1,P=0,_=1,C=1,M=0);let N=x-A+Dt,W=S-O+Dt,Q=b-P+Dt,re=x-_+2*Dt,$=S-C+2*Dt,V=b-M+2*Dt,G=x-1+3*Dt,L=S-1+3*Dt,R=b-1+3*Dt,I=p&255,B=f&255,z=v&255,q=.6-x*x-S*S-b*b;if(q<0)a=0;else{let k=I+t[B+t[z]];q*=q,a=q*q*(i[k]*x+r[k]*S+s[k]*b)}let U=.6-N*N-W*W-Q*Q;if(U<0)c=0;else{let k=I+A+t[B+O+t[z+P]];U*=U,c=U*U*(i[k]*N+r[k]*W+s[k]*Q)}let F=.6-re*re-$*$-V*V;if(F<0)u=0;else{let k=I+_+t[B+C+t[z+M]];F*=F,u=F*F*(i[k]*re+r[k]*$+s[k]*V)}let H=.6-G*G-L*L-R*R;if(H<0)l=0;else{let k=I+1+t[B+1+t[z+1]];H*=H,l=H*H*(i[k]*G+r[k]*L+s[k]*R)}return 32*(a+c+u+l)}}function Td(e){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(e()*(256-i)),s=t[i];t[i]=t[r],t[r]=s}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var wt=new ia,lw=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let s=1;wt.a.fromBufferAttribute(e,r),wt.b.fromBufferAttribute(e,r+1),wt.c.fromBufferAttribute(e,r+2),s*=wt.getArea(),t[r/3]=s}this.distribution=new Float32Array(e.count/3);let i=0;for(let r=0;r<t.length;r++)i+=t[r],this.distribution[r]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,r=t.length-1,s=-1;for(;i<=r;){let o=Math.ceil((i+r)/2);if(o===0||t[o-1]<=e&&t[o]>e){s=o;break}else e<t[o]?r=o-1:i=o+1}return s}sampleFace(e,t,i){let r=this.randomFunction(),s=this.randomFunction();return r+s>1&&(r=1-r,s=1-s),wt.a.fromBufferAttribute(this.positionAttribute,e*3),wt.b.fromBufferAttribute(this.positionAttribute,e*3+1),wt.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(wt.a,r).addScaledVector(wt.b,s).addScaledVector(wt.c,1-(r+s)),wt.getNormal(i),this}},hw=uo(hf()),cw=new me,dw=new me,uw=new me,oo;(e=>{function t(i){return i&&i.__isSPEObject}e.is=t})(oo||(oo={}));var Ea=e=>class extends e{constructor(){super(...arguments),this.hiddenMatrix=new me,this.matrixWorldRigid=new me,this.shearScale=new me,this.shearScaleInv=new me}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof er&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let r=this.parent;if(t&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let s of this.children)s.updateWorldMatrix(!1,!0)}traverseObject(t,i=0){if(t(this,i)!==!0)for(let r of this.children)oo.is(r)&&r.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:r,v:s,q:o}=(0,hw.SVD)(i),n=cw.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),h=dw.set(s[0][0],s[0][1],s[0][2],0,s[1][0],s[1][1],s[1][2],0,s[2][0],s[2][1],s[2][2],0,0,0,0,1),a=uw.copy(h).transpose();this.shearScale.makeScale(o[0],o[1],o[2]).multiply(a).premultiply(h),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(n,a).copyPosition(this.matrixWorld),o.every(c=>Math.abs(o[0]-c)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,i){this.updateWorldMatrix(!0,!1);let r=new me().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),r.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof me?t.hiddenMatrix.premultiply(r):t.applyMatrix4(r),t.updateWorldMatrix(!1,!1),this.add(t),i!==void 0&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}},pw=class extends Ea(er){},fw=e=>e.type==="Mesh",jr=class extends pw{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];(i==null?void 0:i.object)!==t&&(i&&this.remove(i),i=new jr(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((e=this.object.dataPatched.cloner)==null?void 0:e.hideBase)===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return fw(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},wi=new T,_i=new T,Xi=new me,Md=[new T(-1,1,1),new T(-1,-1,1),new T(1,-1,1),new T(1,1,1),new T(-1,1,-1),new T(-1,-1,-1),new T(1,-1,-1),new T(1,1,-1)],mw=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],gw=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],lh=(e,t,i)=>{e.updateEntityBoxSize(wi,_i),Xi.copy(t).multiply(e.matrixWorld),_i.x===0&&_i.y===0&&_i.z===0?i.push(new T(wi.x,wi.y,wi.z).applyMatrix4(Xi)):Md.forEach(r=>{i.push(r.clone().multiply(_i).add(wi).applyMatrix4(Xi))})},hh=class extends Li{constructor(){super(...arguments),this.matrix=new me,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=new me().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];return i===!0?e.traverseEntity(s=>{if(s.visible||s.cloner&&s.data.visible){if(!("geometry"in s)){r.push(new T);return}lh(s,t,r)}}):lh(e,t,r),this.setFromPoints(r)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(Xi.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(_i).multiplyScalar(.5),this.getCenter(wi),Xi.copy(this.matrix).setPosition(wi),this.vertices=Md.map(e=>e.clone().multiply(_i).applyMatrix4(Xi))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=mw.map(([e,t])=>new Wp(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new T))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=gw.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},oi={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},vw=class extends qp{constructor(){super()}getPoints(e=12){let t=[],i,r=this.getCurveLengths(),s=r[r.length-1]/r.length;for(let o=0,n=this.curves;o<n.length;o++){let h=n[o],a=o===0?r[o]:r[o]-r[o-1],c=Math.ceil(e*a/s),u=h.getPoints(c);for(let l=0;l<u.length;l++){let d=u[l];i&&i.equals(d)||(t.push(d),i=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},kn=.001;function Fn(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=kn}function Wo(e,t){let i=new T(...e.position),r=new T(...e.controlNext.position),s=new T(...t.controlPrevious.position),o=new T(...t.position);return Fn(i,r,o)&&Fn(i,s,o)}function Ed(e){let t=e.points.map(u=>new T(...u.data.position)),i=[e.points[0]],r=new T(...i[0].data.position);for(let u=0;u<e.points.length-1;u++)Fn(r,t[u],t[u+1])||(i.push(e.points[u]),r=t[u]);i.push(e.points[e.points.length-1]);let s=e.isClosed,o=i.length-(s?0:1),n=i.length,h=[];for(let u=0;u<n;u++){let l=i[u].data,d=new T(...l.position),p=new T(...l.controlPrevious.position),f=new T(...l.controlNext.position),v={position:d,baseRoundness:l.roundness,controlPrevious:p,controlNext:f};if(l.roundness===0||!e.isClosed&&(u===0||u===n-1)){h[u]={...v,removedLength:0};continue}let g=s&&u==0?n-1:u-1,m=s&&u==n-1?0:u+1,y=i[g].data,w=i[m].data,x=new T(...y.position),S=new T(...w.position),b=x.clone().sub(d).normalize(),A=S.clone().sub(d).normalize();Object.assign(v,{prevDir:b,nextDir:A});let O=Wo(y,l),P=Wo(l,w);if(!O||!P)h[u]={...v,removedLength:0};else{let _=b.clone().add(A).normalize(),C=_.clone().cross(b).length()/b.dot(_);h[u]={...v,tan:C,removedLength:l.roundness/C}}}for(let u=0;u<o;u++){let l=u,d=s&&u===n-1?0:u+1,p=h[l],f=h[d];if(p.removedLength!==0||f.removedLength!==0){let v=p.position.distanceTo(f.position);p.removedLength=Math.min(p.removedLength,v/2),f.removedLength=Math.min(f.removedLength,v/2)}}let a=[];for(let u=0;u<o;u++){let l=u,d=s&&u===n-1?0:u+1,p=h[l],f=h[d],v=null;if(!Wo(i[l].data,i[d].data))p.position.distanceTo(f.position)>kn&&(v=new Io(p.position,p.controlNext,f.controlPrevious,f.position));else{let g=p.position.clone(),m=f.position.clone();(p.removedLength!==0||f.removedLength!==0)&&(p.nextDir&&g.add(p.nextDir.clone().setLength(p.removedLength)),f.prevDir&&m.add(f.prevDir.clone().setLength(f.removedLength))),g.distanceTo(m)>kn&&(v=new Io(g,g.clone().lerp(m,.3),m.clone().lerp(g,.3),m))}a[2*u+1]=v}for(let u=0;u<n;u++){let l=h[u];if(l.removedLength===0){a[2*u]=null;continue}let d=l.position,p=l.prevDir.clone().multiplyScalar(l.removedLength).add(d),f=l.nextDir.clone().multiplyScalar(l.removedLength).add(d),v=l.tan*l.removedLength,g=l.prevDir.clone().add(l.nextDir).normalize(),m=p.clone().lerp(f,.5),y=p.distanceTo(f)/2,w=g.clone().multiplyScalar(Math.sqrt(Math.pow(v,2)-Math.pow(y,2))).add(m),x=g.clone().multiplyScalar(-v).add(w),S=d.distanceTo(x)/d.distanceTo(m),b=l.prevDir.clone().multiplyScalar(S*d.distanceTo(p)).add(d),A=b.clone().lerp(x,2),O=p.clone().lerp(b,4/3),P=f.clone().lerp(A,4/3);a[2*u]=new Io(p,O,P,f)}let c=new vw;return a.forEach(u=>{u&&c.add(u)}),c}var Ee;(e=>{function t(i){return i&&i.__isEntity}e.is=t})(Ee||(Ee={}));var Cr=e=>Ee.is(e),yw={type:"completeState",isfromEntity:!0},Dd=e=>class extends Ea(e){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new hh,this._recursiveBBox=new hh,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(Ee.is(i))return i}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let t=this;for(;t.data.type!=="Instance";){let i=t.parent;if(Ee.is(i))t=i;else return}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){typeof t=="string"&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let s of this.data.states)Gi.toOps(this.data,s.data).forEach(o=>{let n=vn.replaceProps(o,this.data);this.dataPatched=this.data,this.updateByPatchedOp(n,this.data,i)});if(t!==null){let s=this.data.states.data(t);s&&(this.dataPatched=Gi.patch(this.data,s),Gi.toOps(this.data,s).forEach(o=>{this.updateByPatchedOp(o,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{Cr(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(r=>{r.uuid===t&&(i=r)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,r=i.indexOf(this)+1;if(Ee.is(i[r]))return i[r];if(Ee.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&Ee.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&i!==null;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,r=this;for(;r!==t;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)Cr(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{Ee.is(i)&&t(i)})}traverseEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Cr(r)&&r.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)Cr(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>Cr(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x,this.rotation.y,this.rotation.z],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return jn(i,t)}updateTransformState(t){let i=!1;return t.position&&(this.position.fromArray(t.position),i=!0),t.rotation&&(this.rotation.fromArray(t.rotation),i=!0),t.scale&&(i=!0,this.scale.fromArray(t.scale)),t.hiddenMatrix!==void 0&&(i=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??or.identity)),i&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(r=>{r.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),i}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)Ee.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{Ee.is(t)&&t.disposeRecursively()})}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return jn(i,t)}updateByOp(t,i,r,s){let o=this.data;this.data=i;let n=t,h=ti(t.path,["states","*"]);if(h!==null){if(t.type===0){let[a]=h;if((this==null?void 0:this.stateSelection)===a){let c={...t.props};if(Object.values(t.props).some(u=>u===void 0)){let u=this.data;if(u!==void 0){let l=kt.zoom(u,t.path.slice(2));if(l)for(let d in t.props)t.props[d]===void 0&&d in l&&(c[d]=l[d])}}n={...t,props:c,path:t.path.slice(2)}}}}else if(t.type===0){let a=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(a!==void 0){if(t.props.name!==void 0&&a.name){let{name:u,...l}=a;a=l}if(t.props.material!==void 0&&"material"in a){let{material:u,...l}=a;a=l}let c=kt.removeOverridden(t.path,t.props,a);n={...t,props:c}}}if(this.updateByPatchedOpBase(n,Gi.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),ti(t.path,["overrides"])){let a=[],c=[...t.path];for(a.push(c[1]),c.splice(0,2);c.length>0&&c[0]==="descendants";)a.push(c[1]),c.splice(0,2);if(a[a.length-1]===void 0){if(t.type===0)for(let u of Object.keys(t.props)){a[a.length-1]=u;let l=r.scene.findInstance([this.uuid,...a]);l&&(l.overrideData=t.props[u],l.updateState(Ci.apply(l.component.data,l.overrideData),r))}}else{let u=r.scene.findInstance([this.uuid,...a]);if(u){let l=kt.zoom(u.component.data,c);if(t={...t,path:c},t.type===0){let d=t.props;if(l)for(let[p,f]of Object.entries(t.props))f===void 0&&(d===t.props&&(d={...t.props}),d[p]=l[p]);t={...t,props:d}}u.overrideData=io.resolve(i.overrides,a),u.updateByOp(t,st.applySimple(u.data,t),r,!1)}}}else if(this.instances.length>0){let a;if(t.path.length===0&&t.type===0){let c;for(let u of hr.rootOverrideProps)u in t.props&&(c===void 0&&(c={}),c[u]=t.props[u]);c&&(a={...t,props:c})}else for(let c of hr.rootOverrideProps)if(ti(t.path,[c])){a=t;break}a!==void 0&&this.instances.forEach(c=>{if(c.isInstanceRoot){let u=Ci.filterOp(c.overrideData,a);u&&c.updateByOp(u,st.applySimple(c.data,u),r,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let u=Ci.filterOp(c.overrideData,t);if(u){let l;o===c.data&&t===u?l=i:l=st.applySimple(c.data,u),c.updateByOp(u,l,r,!0)}}})}}updateByPatchedOpBase(t,i,r){if(this.dataPatched=i,t.path.length===0&&t.type===0)t.props.type!==void 0&&!Ei.is(t.props.type)&&oi.changeEntityProptotype(this,i,r);else if(t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&"type"in t.props){oi.changeEntityProptotype(this,i,r);for(let s of this.children)Ee.is(s)&&s.updateVisible()}this.updateByPatchedOp(t,i,r)}updateByPatchedOp(t,i,r){if(t.path.length===0&&t.type===0&&this.updateState(t.props,r),ti(t.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),ti(t.path,["cloner"])!==null){let s=st.drop(t,1);s.path.length===0&&s.type===0&&s.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible()}}updatePathSnapping(t){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){var f,v,g,m,y;let i=((f=this._updatedPathSnapping)==null?void 0:f.pathId)??this.dataPatched.pathSnapping.pathId,r=((v=this._updatedPathSnapping)==null?void 0:v.slide)??this.dataPatched.pathSnapping.slide??0,s=((g=this._updatedPathSnapping)==null?void 0:g.offset)??this.dataPatched.pathSnapping.offset,o=((m=this._updatedPathSnapping)==null?void 0:m.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let n=t.find(i);if(!n||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let h=n.data,a=Ed(h.geometry.path),c=(r+s)%1;r+s===1&&c===0&&(c=1);let u=a.getPointAt(c),l=this.parent?(y=this.parent)==null?void 0:y.matrixWorld:new me;n.updateMatrixWorld();let d=new me().multiplyMatrices(l.clone().invert(),n.matrixWorld);u.applyMatrix4(d);let p={position:u.toArray(),rotation:h.rotation};if(o==="tangential"){let w=new me().extractRotation(n.matrixWorld),x=a.getTangentAt(c).applyMatrix4(w).add(u),S=new me().lookAt(u,x,new T(0,1,0)),b=new Ms().setFromRotationMatrix(S);p={...p,rotation:[b.x,b.y,b.z]}}this.updateTransformState(p),this.traverseEntity(w=>{w._cameraType&&w.dispatchEvent(yw)})}updateVisible(){var t;this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((t=this.dataPatched.cloner)==null?void 0:t.hideBase)!==!0)}updateState_Entity(t,i){t.name!==void 0&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.visible!==void 0&&(this.updateVisible(),this.resetBBoxNeedsUpdate()),"cloner"in t&&t.cloner!==void 0&&(this.setFromClonerState(t.cloner,i),this.updateVisible()),this.updateTransformState(t)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof oi.Cloner&&t.parameters.type==="toObject")}setFromClonerState(t,i){this.disposed||(t===null||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new oi.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}},bw=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters),r=i.width/2,s=i.radiusTop??r,o=i.radiusBottom??r;return s===o?(s=r,o=r):s>o?(s=r,o=o*r/s):(s=s*r/o,o=r),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),radiusTop:s,radiusBottom:o})}}static build(e){let{width:t,depth:i,height:r,radialSegments:s,heightSegments:o,openEnded:n,thetaStart:h,thetaLength:a,radiusTop:c,radiusBottom:u,cornerRadius:l,cornerSegments:d,hollow:p}=e.parameters,f;return l||p?f=new Ld(c,u,r,s,o,n,h,a*Math.PI/180,l,l,d,p):f=new Lp(c,u,r,s,o,n,h,a*Math.PI/180),f.scale(1,1,i/t),Object.assign(f,{userData:{...e,type:"CylinderGeometry"}})}};function Qt(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function ch(e){return new X(e.y,-e.x)}var Ld=class extends Pe{constructor(e,t,i,r,s,o,n,h,a,c,u,l,d=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,r=Math.floor(r)||8,s=Math.floor(s)||1,o=o!==void 0?o:!1,n=n!==void 0?n:0,h=h!==void 0?h:Math.PI*2,o&&(a=0,c=0);let p=[],f=[],v=[],g=[],m=0,y=i/2,w=new T,x=new T;d&&e==0&&(e=a),d&&t==0&&(t=c);let S=new X(e,y),b=new X(t,-y),A=null,O=null,P=null,_=null,C=S.clone().sub(b),M=0,N=0,W=0;l>0&&(M=Math.min(e,t)*(1-l),N=e-M,W=t-M);let Q=S.clone();Q.x-=M;let re=Math.PI-C.angle(),$=C.angle(),V=Math.tan($/2),G=Math.tan(re/2),L=V+G,R=l?L:G,I=l?L:V;if(a=Math.min(a,(e-N)/R,C.length()/L),c=Math.min(c,(t-W)/I,C.length()/L),a>0){let H=a/V;A=S.clone().sub(new X(H,a)),l&&(P=A.clone(),P.x-=M-L*a),S.sub(C.clone().setLength(H))}if(c>0){let H=c/G;O=b.clone().sub(new X(H,-c)),b.add(C.clone().setLength(H)),l&&(_=O.clone(),_.x-=M-L*c,Q.sub(C.clone().setLength(H)))}C=S.clone().sub(b);let B=C.length()<.5,z=[];for(let H=0;H<=r;H++){let k=[],Z=H/r,J=Z*h+n,Y=new X(Math.sin(J),Math.cos(J));_&&O?(q(k,Z,Y,re,c,_,-1,!0),q(k,Z,Y,$,c,O,-1,!1)):O?(U(k,Y,O.x,0,-1),q(k,Z,Y,$,c,O,-1,!1)):o||U(k,Y,t,W,-1);let ee=ch(C).normalize();if(Qt(ee,Y,w),!B)for(let te=0;te<=s;te++){let K=te/s,ue=C.clone().multiplyScalar(K).add(b);Qt(ue,Y,x),f.push(x.x,x.y,x.z),v.push(w.x,w.y,w.z),g.push(Z,.5+x.y/i),k.push(m++)}if(P&&A?(q(k,Z,Y,re,a,A,1,!1),q(k,Z,Y,$,a,P,1,!0)):A?(q(k,Z,Y,re,a,A,1,!1),U(k,Y,A.x,0,1)):o||U(k,Y,e,N,1),l&&!B){let te=ch(C).multiplyScalar(-1).normalize();Qt(te,Y,w);for(let K=0;K<=s;K++){let ue=K/s,oe=C.clone().multiplyScalar(-ue).add(Q);Qt(oe,Y,x),f.push(x.x,x.y,x.z),v.push(w.x,w.y,w.z),g.push(Z,.5+x.y/i),k.push(m++)}}l&&!o&&k.push(k[0]),z.push(k)}for(let H=0;H<z.length-1;H++)for(let k=0;k<z[0].length-1;k++){if(o&&l&&k==s)continue;let Z=z[H][k],J=z[H+1][k],Y=z[H+1][k+1],ee=z[H][k+1],te=f[Y*3+0],K=f[Y*3+2];p.push(Z,J,ee),(te!=0||K!=0)&&p.push(J,Y,ee)}h<Math.PI*2&&(F(-1,z[0],n),F(1,z[z.length-1],n+h)),this.setIndex(p),this.setAttribute("position",new ge(f,3)),this.setAttribute("normal",new ge(v,3)),this.setAttribute("uv",new ge(g,2));function q(H,k,Z,J,Y,ee,te,K){for(let ue=0;ue<u+1;ue++){let oe=ue/u,le=te<0?oe:1-oe;K&&(le-=1),le*=J;let xe=new X(Math.sin(le),Math.cos(le)*te),ve=xe.clone().multiplyScalar(Y).add(ee);Qt(ve,Z,x),f.push(x.x,x.y,x.z),Qt(xe,Z,w),v.push(w.x,w.y,w.z),g.push(k,.5+x.y/i),H.push(m++)}}function U(H,k,Z,J,Y){let ee=new T,te=new X,K=[Z,J];Y<0&&K.reverse();for(let ue of K)te.set(ue,y*Y),Qt(te,k,ee),f.push(ee.x,ee.y,ee.z),v.push(0,Y,0),g.push(.5,.5),H.push(m++)}function F(H,k,Z){let J=new X(Math.sin(Z),Math.cos(Z)),Y=new X(-Math.cos(Z),Math.sin(Z)),ee=new T,te=H<0?(oe,le,xe)=>p.push(oe,le,xe):(oe,le,xe)=>p.push(oe,xe,le),K=new X((e+t+N+W)/4,0);Qt(K,J,ee),f.push(ee.x,ee.y,ee.z),v.push(Y.x,0,Y.y),g.push(.5,.5);let ue=m++;for(let oe of k){let le=f.slice(oe*3,oe*3+3);f.push(...le),v.push(Y.x,0,Y.y);let xe=g.slice(oe*2,oe*2+2);g.push(...xe),m++}for(let oe=ue+1;oe<m-1;oe++)te(ue,oe,oe+1);te(ue,m-1,ue+1)}}},xw=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,depth:i,height:r,radialSegments:s,heightSegments:o,openEnded:n,thetaStart:h,thetaLength:a,cornerRadiusTop:c,cornerRadiusBottom:u,cornerSegments:l}=e.parameters,d;return c>0||u>0||a<360?d=new Ld(0,t/2,r,s,o,n,h,a*Math.PI/180,c,u,l,0,!0):d=new Ip(t/2,r,s,o,n),d.scale(1,1,i/t),Object.assign(d,{userData:{...e,type:"ConeGeometry"}})}},ww=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,widthSegments:s,heightSegments:o,depthSegments:n,cornerRadius:h,cornerSegments:a}=e.parameters,c;return h==0?c=new Mi(t,i,r,s,o,n):c=new _w(t,i,r,s,o,n,h,a),Object.assign(c,{userData:{...e,type:"CubeGeometry"}})}},qo=Math.PI/2,_w=class extends Pe{constructor(e=1,t=1,i=1,r=1,s=1,o=1,n=0,h=4){super(),this.type="BoxGeometry";let a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o),h=Math.floor(h),n=Math.min(n,e/2,t/2,i/2);let c=[],u=[],l=[],d=[],p=0,f=0;v("z","y","x",-1,-1,i,t,e,o,s,0),v("z","y","x",1,-1,i,t,-e,o,s,1),v("x","z","y",1,1,e,i,t,r,o,2),v("x","z","y",1,-1,e,i,-t,r,o,3),v("x","y","z",1,-1,e,t,i,r,s,4),v("x","y","z",-1,-1,e,t,-i,r,s,5),n>0&&(g("z","y","x",-1,-1,1,i,t,e,o,0),g("z","y","x",1,-1,-1,i,t,e,o,1),g("z","y","x",-1,1,-1,i,t,e,o,1),g("z","y","x",1,1,1,i,t,e,o,0),g("x","y","z",-1,-1,-1,e,t,i,r,0),g("x","y","z",1,-1,1,e,t,i,r,1),g("x","y","z",-1,1,1,e,t,i,r,0),g("x","y","z",1,1,-1,e,t,i,r,1),g("y","x","z",-1,-1,1,t,e,i,s,0),g("y","x","z",1,-1,-1,t,e,i,s,1),g("y","x","z",1,1,1,t,e,i,s,1),g("y","x","z",-1,1,-1,t,e,i,s,0),m(1,1,1),m(-1,1,1),m(1,-1,1),m(-1,-1,1),m(1,1,-1),m(-1,1,-1),m(1,-1,-1),m(-1,-1,-1)),this.setIndex(c),this.setAttribute("position",new ge(u,3)),this.setAttribute("normal",new ge(l,3)),this.setAttribute("uv",new ge(d,2));function v(y,w,x,S,b,A,O,P,_,C,M){let N=(A-2*n)/_,W=(O-2*n)/C,Q=A/2-n,re=O/2-n,$=P/2,V=_+1,G=C+1,L=0,R=0,I=new T;for(let B=0;B<G;B++){let z=B*W-re;for(let q=0;q<V;q++){let U=q*N-Q;I[y]=U*S,I[w]=z*b,I[x]=$,u.push(I.x,I.y,I.z),I[y]=0,I[w]=0,I[x]=P>0?1:-1,l.push(I.x,I.y,I.z),d.push(q/_),d.push(1-B/C),L+=1}}for(let B=0;B<C;B++)for(let z=0;z<_;z++){let q=p+z+V*B,U=p+z+V*(B+1),F=p+(z+1)+V*(B+1),H=p+(z+1)+V*B;c.push(q,U,H),c.push(U,F,H),R+=6}a.addGroup(f,R,M),f+=R,p+=L}function g(y,w,x,S,b,A,O,P,_,C,M){let N=(O-2*n)/C,W=O/2-n,Q=P/2-n,re=_/2,$=C+1,V=0,G=0,L=new T,R=new T;for(let I=0;I<h+1;I++){let B=I/h*qo,z=Math.sin(B)*n,q=(1-Math.cos(B))*n,U=Math.sin(B),F=Math.cos(B);L[w]=(Q+z)*b,L[x]=(re-q)*A,R[y]=0,R[w]=U*Math.sign(L[w]),R[x]=F*Math.sign(L[x]);for(let H=0;H<$;H++){let k=H*N-W;L[y]=k*S,u.push(L.x,L.y,L.z),l.push(R.x,R.y,R.z),d.push(H/C),d.push(0),V+=1}}for(let I=0;I<h;I++)for(let B=0;B<C;B++){let z=p+B+$*I,q=p+B+$*(I+1),U=p+(B+1)+$*(I+1),F=p+(B+1)+$*I;c.push(z,q,F),c.push(q,U,F),G+=6}a.addGroup(f,G,M),f+=G,p+=V}function m(y,w,x){let S=new T,b=new T(e/2,t/2,i/2);b.subScalar(n);let A=[],O=y*w*x>0?(_,C,M)=>c.push(_,C,M):(_,C,M)=>c.push(_,M,C);for(let _=0;_<=h;_++){let C=[],M=qo*(1-_/h),N=Math.cos(M),W=Math.sin(M),Q=0;for(let re=0;re<=_;re++){let $=Math.cos(Q),V=Math.sin(Q);S.x=N*$,S.y=W,S.z=N*V;let G=b.clone().addScaledVector(S,n);u.push(y*G.x,w*G.y,x*G.z),l.push(y*S.x,w*S.y,x*S.z),d.push(0,0),C.push(p++),Q+=qo/_}A.push(C)}let P=A.length-1;for(let _=0;_<P;_++){let C=A[_],M=A[_+1],N=C.length-1;O(C[0],M[1],M[0]);for(let W=1;W<=N;W++)O(C[W-1],C[W],M[W]),O(C[W],M[W+1],M[W])}}}},Da=class extends Pe{constructor(e=[],t=[],i="",r=1,s=.2,o=4){super(),this.type="PolyhedronGeometryRound";let n=[],h=[],a=[];c(),u(),this.setAttribute("position",new ge(n,3)),this.setAttribute("normal",new ge(a,3)),this.setAttribute("uv",new ge(h,2));return;function c(){var $;s=Math.min(1-1e-5,s),s==0&&(o=0);let l={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new T,p=d.clone(),f=new ia,v=s*r,g=r-v,m=o+1,y=new T,w=(V,G)=>y.subVectors(V,G).normalize(),x=(V,G)=>Array(V).fill(void 0).map(G),S=x(e.length/3,(V,G)=>new T().fromArray(e,G*3).setLength(r)),b=[],A=1e6;for(let V=0;V<S.length;V++){let G=S[V],L=[],R,I,B,z=1e10,q=-1;for(;(q=t.indexOf(V,q+1))!=-1;){let k=q-q%3;R=t[k+(q+1)%3],I=t[k+(q+2)%3],B=G.distanceToSquared(S[R]),z=Math.min(z,B),L.push([R,I,B])}z+=1e-6;let U=[],F=0,H=L.length;for(let k=0;k<H;k++){[R,I,B]=L[F];let Z=(($=b[R])==null?void 0:$.includes(V))==!0;B<=z&&U.push(R+ +Z*A),F=L.findIndex(J=>J[0]==I)}b.push(U)}let O=[];{let V=0,G=0,L,R,I=l==3;for(let B=0;B<=o;B++){L=B*(B+1)/2,R=(B+1)*(B+2)/2;for(let z=0;z<o-B;z++)[V,G]=[L+z+B+2,R+z+B+3],O.push(L,R,...I?[G,L]:[V,R],G,V),[L,R]=[V,G];O.push(L,R,L+o+2)}}let P=d.clone(),_=d.clone(),C=d.clone(),M=d.clone(),N=d.clone(),W=[],Q=x(S.length,()=>x(l,()=>d.clone()));for(let V=0;V<S.length;V++){d.copy(S[V]).normalize(),P.copy(d).multiplyScalar(g);let G=b[V];for(let U=0;U<G.length;U++){let F=G[U],H=G[(U+1)%l];f.setFromPointsAndIndices(S,V,F%A,H%A),f.b.sub(f.a).setLength(1e10).add(f.a),f.c.sub(f.a).setLength(1e10).add(f.a),f.closestPointToPoint(P,Q[V][U])}let L=[],R=[],I=[],B=new T;o==0&&[...Q[V]].reduce((U,F)=>U.add(F),B).multiplyScalar(1/l);for(let U=0;U<l;U++){let F=[],H=(U-1+l)%l,k=Q[V][H],Z=Q[V][U];d.copy(k).sub(P),p.copy(Z).sub(P);let J=P.angleTo(d),Y=d.angleTo(p),ee=Math.cos(J)*v;o==0?_.copy(B):_.copy(P).setLength(g+ee),R.push(ee);let te=[_,k,Z];for(let K=0;K<2;K++){let ue=te[K],oe=te[K+1];M.subVectors(ue,P),N.subVectors(oe,P),C.crossVectors(M,N).normalize();for(let le=0;le<m;le++){let xe=[J,Y][K]*le/m;d.copy(M).applyAxisAngle(C,xe).add(P),L.push(d.clone()),K&&(w(d,P),F.push([le==0?ue:d.clone(),y.clone()]))}K&&(w(oe,P),F.push([oe,y.clone()]))}I.push(F)}W.push(I);let z=2*m,q=2;for(let U=0;U<l;U++){let F=z*U,H=z*((U+1)%l),k=[L[F]];for(let J=1;J<m;J++){M=L[F+J],N=L[H+J],k.push(M);for(let Y=1,ee=J-q+1;Y<=ee;Y++)d.lerpVectors(M,N,Y/(ee+1)),d.sub(P).setLength(R[U]).add(P),k.push(d.clone());k.push(N)}for(let J=0;J<m;J++)k.push(L[J+m+F]);k.push(L[H+m]);let Z=O.map(J=>k[J]);n.push(...Z.map(J=>[J.x,J.y,J.z]).flat()),a.push(...Z.map(J=>(w(J,P),[y.x,y.y,y.z])).flat())}}let re=[];for(let V=0;V<b.length;V++)for(let G=0;G<l;G++){let L=b[V][G];if(L<A){let R=b[L].findIndex(z=>z%A==V),I=W[V][G],B=W[L][R];for(let z=0;z<m;z++){let q=I[z],U=B[m-z],F=I[z+1],H=B[m-(z+1)];[q,U,F,F,U,H].forEach(k=>{n.push(k[0].x,k[0].y,k[0].z),a.push(k[1].x,k[1].y,k[1].z)})}re.push(I[0][0],B[m][0],I[m][0],B[0][0])}}for(;re.length;){let V,G,L,R;[V,G]=re.splice(0,2);let I=[V];for(;V!=G;)I.push(G),L=re.indexOf(G),R=L%2,G=re.splice(L-R,2)[1-R];y.subVectors(I[0],I[1]).cross(d.subVectors(I[0],I[2])).normalize();let B=y.dot(I[0])<0;B&&y.negate();for(let z=1;z<=I.length-2;z++)[I[z+ +B],I[z+1-+B],I[0]].forEach(q=>{n.push(q.x,q.y,q.z),a.push(y.x,y.y,y.z)})}}function u(){let l=new T;for(let b=0;b<n.length;b+=3){l.x=n[b+0],l.y=n[b+1],l.z=n[b+2];let A=x(l)/2/Math.PI+.5,O=S(l)/Math.PI+.5;h.push(A,1-O)}let d=new T,p=new T,f=new T,v=new T,g=new X,m=new X,y=new X,w=(b,A,O,P)=>{P<0&&b.x===1&&(h[A]=b.x-1),O.x===0&&O.z===0&&(h[A]=P/2/Math.PI+.5)};for(let b=0,A=0;b<n.length;b+=9,A+=6){d.set(n[b+0],n[b+1],n[b+2]),p.set(n[b+3],n[b+4],n[b+5]),f.set(n[b+6],n[b+7],n[b+8]),g.set(h[A+0],h[A+1]),m.set(h[A+2],h[A+3]),y.set(h[A+4],h[A+5]),v.copy(d).add(p).add(f).divideScalar(3);let O=x(v);w(g,A+0,d,O),w(m,A+2,p,O),w(y,A+4,f,O)}for(let b=0;b<h.length;b+=6){let A=h[b+0],O=h[b+2],P=h[b+4],_=Math.max(A,O,P),C=Math.min(A,O,P);_>.9&&C<.1&&(A<.2&&(h[b+0]+=1),O<.2&&(h[b+2]+=1),P<.2&&(h[b+4]+=1))}function x(b){return Math.atan2(b.z,-b.x)}function S(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}}static fromJSON(e){return new Da(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},Sw=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:s,corner:o,cornerSides:n}=e.parameters,h=s===0&&o!==0?new Id(t*.5,o,n):new zp(t*.5,s);return h.scale(1,i/t,r/t),Object.assign(h,{userData:{...e,type:"DodecahedronGeometry"}})}},Id=class extends Da{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,s=1/r,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-r,0,-s,r,0,s,-r,0,s,r,-s,-r,0,-s,r,0,s,-r,0,s,r,0,-r,0,-s,r,0,-s,-r,0,s,r,0,s],n=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],h="DodecahedronGeometry";super(o,n,h,e,t,i),this.type=h}static fromJSON(e){return new Id(e.radius,e.corner,e.cornerSides)}},Pr=1e-12,La=class{constructor(e){this.position=new X,this.startPosition=new X,this.uuid=Ue.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new La(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},Vn=class extends La{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new Vn(this.parent).copy(this)}},Yi=class extends La{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new Vn(this),new Vn(this))}static create(e,t){let i=new Yi(e,new X(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,r=this.controls.length;i<r;i++){let s=this.controls[i];this.position.distanceTo(s.position)<=t?s.position.copy(this.position):s.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new Yi(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,r;let e=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),t=(r=this.curveAfter)==null?void 0:r.getTangentAt(0);return[e,t]}computeNormals(e=new X,t=new X){let[i,r]=this.computeTangents();return i&&r&&(dh(i,e),dh(r,t)),[e,t]}computeTangent(e=new X){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new X){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function dh(e,t=new X){let i=e.length();return t.set(-e.y/i,e.x/i)}var Ia=e=>e,vr=new X,Ao=new X,Aw=new X,Ow=new X,Cw=new X,Pw=new X,zd=new T,Nd=new T;function Tw(e){let t=new X;t.addVectors(e.v0,vr.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new X;return i.addVectors(e.v2,Ao.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new $t(e.v0,t,i,e.v2)}function Ur(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function Mw(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function Ew(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function Bd(e,t,i){let r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),s=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),o=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((s*s+r*r-o*o)/(2*s*r))}function Dw(e,t,i){return ph(e,t)&&ph(t,i)&&Gn(e.position,t.position,i.position)}function Gn(e,t,i){return vr.copy(t).sub(e).cross(Ao.copy(i).sub(e))===0}function Lw(e,t,i,r,s){let o=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),n=(e.y+t.y)/2,h=(e.x+t.x)/2,a=Math.sqrt(Math.pow(i,2)-Math.pow(o/2,2))*(e.y-t.y)/o,c=Math.sqrt(Math.pow(i,2)-Math.pow(o/2,2))*(t.x-e.x)/o;return r.set(h+a,n+c),s.set(h-a,n-c),[r,s]}function Iw(e,t,i){let r=e.distanceTo(i),s=t.distanceTo(i);return r<s?t:e}function zw(e,t,i,r,s,o){let n=t.x-e.x,h=t.y-e.y,a=i.x-e.x,c=i.y-e.y,u=Math.sqrt((n+a)*(n+a)+(h+c)*(h+c)),l;return Bd(t,e,i)>Math.PI&&(u*=-1),Ur(c,h)?l=(h+c)*(r/u-.5)*8/3/(n-a):l=(n+a)*(r/u-.5)*8/3/(c-h),s.set(t.x-l*h,t.y+l*n),o.set(i.x+l*c,i.y-l*a),[s,o]}function uh(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function ph(e,t){return Gn(e.position,e.controls[1].position,t.position)&&Gn(e.position,t.controls[0].position,t.position)}function Nw(e,t,i,r,s=.5){let o=vr.subVectors(t,e).multiplyScalar(s).add(e),n=Ao.subVectors(i,t).multiplyScalar(s).add(t),h=Aw.subVectors(r,i).multiplyScalar(s).add(i),a=o,c=Ow.subVectors(n,o).multiplyScalar(s).add(o),u=Cw.subVectors(h,n).multiplyScalar(s).add(n),l=h,d=Pw.subVectors(u,c).multiplyScalar(s).add(c);return[e.x,e.y,a.x,a.y,c.x,c.y,d.x,d.y,u.x,u.y,l.x,l.y,r.x,r.y]}function Bw(e,t,i=12,r=!0){let s=Nd.set(0,0,0),o,n=0;for(let h=0;h<t.length;h++){let a=Ia(t[h]),c=vr,u=Pi(a,i);for(let l=0;l<=u;l++)if(a instanceof $t||a instanceof ir||a instanceof hi){if(a.getPoint(l/u,c),s.set(c.x,c.y,0),o!==void 0&&Ew(o,s))continue;o===void 0&&(o=zd),o.copy(s),e.setXYZ(n,s.x,s.y,s.z),n++}}return r&&n>1&&!(e.getX(n-1)===e.getX(0)&&e.getY(n-1)===e.getY(0)&&e.getZ(n-1)===e.getZ(0))&&(e.setXYZ(n,e.getX(0),e.getY(0),e.getZ(0)),n++),e}function jw(e,t,i,r=12,s=!0){let o=Nd.set(0,0,0),n=0,h=[];for(let a=0;a<t.length;a++){if(i[a]===!1)continue;let c,u=Ia(t[a]),l=vr,d=Pi(u,r);h.push(d);for(let p=0;p<=d;p++)if(u instanceof $t||u instanceof ir||u instanceof hi){if(u.getPoint(p/d,l),o.set(l.x,l.y,0),c==null?void 0:c.equals(o))continue;c===void 0?c=zd:(e.setXYZ(n,c.x,c.y,c.z),n++,e.setXYZ(n,o.x,o.y,o.z),n++),c.copy(o)}}return s&&n>1&&!(e.getX(n-1)===e.getX(0)&&e.getY(n-1)===e.getY(0)&&e.getZ(n-1)===e.getZ(0))&&(e.setXYZ(n,e.getX(0),e.getY(0),e.getZ(0)),n++),h}function fh(e,t=12,i=!1){let r=[];for(let s=0,o=e.length;s<o;s++){let n=e[s],h=0;if(i&&n.roundedCurveCorner!==void 0){let a=Pi(n.roundedCurveCorner,t)*.5;s>0&&(r[s-1]+=a),h+=a}n.curveAfter!==void 0&&(h+=Pi(n.curveAfter,t)),r.push(h)}return e.length>0&&i&&e[0].roundedCurveCorner!==void 0&&(r[e.length-1]+=Pi(e[0].roundedCurveCorner,t)*.5),r}function Pi(e,t=12){return e&&e instanceof Np?t*2:e&&(e instanceof hi||e instanceof Bp)?1:e&&e instanceof jp?t*e.points.length:t}function Uw(e,t,i=12,r=!0){let s,o=0;for(let n=0;n<t.length;n++){let h=Ia(t[n]),a=Pi(h,i),c=vr;for(let u=0;u<=a;u++)if(h instanceof $t||h instanceof ir||h instanceof hi){if(h.getPoint(u/a,c),s!==void 0&&Mw(s,c,Pr))continue;s===void 0&&(s=Ao),s.copy(c),e.push(c.x,c.y),o++}}return Ur(e[0],e[e.length-2],Pr)&&Ur(e[1],e[e.length-1],Pr)&&(e.pop(),e.pop()),r&&o>1&&!(Ur(e[o-1],e[1],Pr)&&Ur(e[o-2],e[0],Pr))&&(e.push(e[0],e[1]),o++),e}var $o=new X,Rw=new X,kw=new X,Fw=new X,Vw=new X,Gw=new X,Be=class extends js{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new Ep(new T(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Ue.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let r=new Be;return r.isClosed=e.isClosed,r.points=e.points.map(s=>Yi.create(s.id,s.data)),typeof e.roundness=="number"&&(r.roundness=e.roundness),r.shapeHoles=e.shapeHoles.map(s=>Be.createFromState(s)),t!==void 0&&i!==void 0&&r.applySize(t,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(r=>r.uuid===e);if(i<0){let r=t;for(let s=0,o=this.shapeHoles.length;s<o;s++){let n=this.shapeHoles[s],h=n.points.length,a=n.getPointIndexById(e);if(a<0)r+=h;else return a+r}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let s=this.shapeHoles[i],o=e-t;if(o<=s.points.length-1)return s.points[o];t+=s.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let s=this.shapeHoles[i],o=s.points.indexOf(e);if(o>=0)return t+o;t+=s.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){e===0&&(e=.001),t===0&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=$o.set(e,t);for(let r=0,s=this.points.length;r<s;r++){let o=this.points[r];o.position.multiply(i),o.controls[0].position.multiply(i),o.controls[1].position.multiply(i)}for(let r=0,s=this.shapeHoles.length;r<s;r++)this.shapeHoles[r].applyScale(e,t);this._update()}createPoint(e,t=0,i=Ue.generateUUID()){let r;e instanceof X?r=e:r=new X(e,t);let s=new Yi(i,r);return s.roundness=this.roundness,s}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(r.uuid===e)return r}for(let t=0,i=this.shapeHoles.length;t<i;t++){let r=this.shapeHoles[t].getPointByUuid(e);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t);let r=i?this.roundedCurveDivisions:this.curveDivisions;return Bw(e,i?this.roundedCurves:this.curves,t,this.autoClose),r.reduce((s,o)=>s+o,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=fh(this.points,e,!1),this.roundedCurveDivisions=fh(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return jw(e,this.curves,t,i,this.autoClose).reduce((r,s)=>r+s,0)*2}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t),Uw(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=t?this.roundedCurveDivisions:this.curveDivisions,s=0;t&&this.points[0].roundedCurveCorner!==void 0&&(s=Pi(this.points[0].roundedCurveCorner,this.subdivision)*.5);let o=e-s;o<0&&(o+=r.reduce((n,h)=>n+h,0));for(let n=0,h=r.length;n<h;n++){let a=r[n];if(o<i+a)return[n,(o-i+1)/a];i+=a}return[0,1]}getCurveT(e,t,i){let r=this.points[e],s=this.points[e>=this.points.length-1?0:e+1],o=this.curveDivisions,n=o[e];if(uh(r,s)){let a=r.position.distanceTo(s.position);return r.position.distanceTo($o.set(i.x,i.y))/a}let h=0;for(let a=0;a<e;a++)h+=o[a];return(t-h)/n}dispose(){}_applyCurveForPoint(e,t){uh(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let r=i.clone();e.roundedCurveBefore=r,t.roundedCurveAfter=r,e.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(t===0)this.moveTo(r.position.x,r.position.y);else{let s=this.points[t-1];this._applyCurveForPoint(r,s)}}let e=this.getLastPoint();if(e!=null&&e.curveAfter&&(e.curveAfter=void 0),this.isClosed){let t=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(t,i)}if(this.points.length>2){let t=0;for(let i=0,r=this.points.length;i<r;i++){let s=this.points[i],o=this.points[i-1]??this.points[this.points.length-1],n=this.points[i+1]??this.points[0],h=s.roundness,a=o&&n&&Dw(o,s,n);if(!s.controlsMoved()&&h>0&&!a){let c=s.curveBefore,u=s.curveAfter;if(c===void 0||u===void 0)continue;let l=s.roundedCurveBefore,d=s.roundedCurveAfter,p=c.getLength(),f=u.getLength(),v=Math.min(h,p*.499),g=Math.min(h,f*.499),m=Math.min(v,g),y=1-m/p,w=m/f,x=c.getPointAt(y,$o),S=u.getPointAt(w,Rw);this._subSplitCurve(c,l,y,x,void 0),this._subSplitCurve(u,d,w,void 0,S);let b;if(this.useCubicForRoundedCorners){let A=Bd(x,s.position,S)/2,O=Math.tan(A)*x.distanceTo(s.position),[P,_]=Lw(x,S,O,kw,Fw),C=Iw(P,_,s.position),[M,N]=zw(C,x,S,O,Vw,Gw);b=new $t(x.clone(),M.clone(),N.clone(),S.clone())}else b=new ir(x.clone(),s.position.clone(),S.clone());s.roundedCurveCorner=b,this.roundedCurves.splice(i+t,0,b),t++}}}}_subSplitCurve(e,t,i,r,s){if(e instanceof hi)r!==void 0&&t.v2.copy(r),s!==void 0&&t.v1.copy(s);else{let o=e,n=t,h=o.getUtoTmapping(i,0),a=Nw(o.v0,o.v1,o.v2,o.v3,h);return r!==void 0&&(n.v0.set(a[0],a[1]),n.v1.set(a[2],a[3]),n.v2.set(a[4],a[5]),n.v3.set(a[6],a[7])),s!==void 0&&(n.v0.set(a[6],a[7]),n.v1.set(a[8],a[9]),n.v2.set(a[10],a[11]),n.v3.set(a[12],a[13])),n}return t}clone(){let e=new Be(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var i;this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let r=0;r<t;r++){let s=r*7,o=e.points[s+0],n=e.points[s+1],h=e.points[s+2],a=e.points[s+3],c=e.points[s+4],u=e.points[s+5],l=e.points[s+6],d=new Yi(Ue.generateUUID(),new X(o,n));d.controls[0].position.set(h,a),d.controls[1].position.set(c,u),d.roundness=l,this.points.push(d)}return this.shapeHoles=(i=e.shapeHoles)!=null&&i.length?e.shapeHoles.map(r=>{let s=new Be;return s.fromJSON(r),s}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e){let t=(r,s)=>{s instanceof $t&&s.v3.equals(r.position)&&r.controls[0].position.copy(s.v2)},i=r=>{let s=[],o,n;for(o=0,n=r.length;o<n;o++)r[o]instanceof ir&&(r[o]=Tw(r[o]));for(o=0,n=r.length;o<n;o++){let c=r[o],u=o>0?r[o-1]:null,l;c instanceof $t?(l=this.createPoint(c.v0),l.controls[1].position.copy(c.v1)):c instanceof hi&&(l=this.createPoint(c.v1)),l!==void 0&&(u!==null&&t(l,u),s.push(l))}let h=r[r.length-1],a=!1;return h instanceof $t?h.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(h.v2),a=!0):h instanceof hi&&h.v2.equals(s[0].position)&&(a=!0),this.isClosed=a,s};return this.points=i(e.curves),e instanceof js&&(this.shapeHoles=e.holes.map(r=>{let s=new Be;return s.fromShape(r),s})),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(t.position!==void 0&&i.position.fromArray(t.position),t.roundness!==void 0&&(i.roundness=t.roundness),t.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},Hn=Math.PI*2;function Xo({x:e,y:t},i,r,s,o){return{x:e*i+s,y:t*r+o}}function Hw(e,t){let i=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=Math.cos(e),s=Math.sin(e),o=Math.cos(e+t),n=Math.sin(e+t);return[{x:r-s*i,y:s+r*i},{x:o+n*i,y:n-o*i},{x:o,y:n}]}function mh(e,t,i,r){let s=e*r-t*i<0?-1:1,o=Math.min(1,Math.max(-1,e*i+t*r));return s*Math.acos(o)}function Ww(e,t,i,r,s,o,n,h,a,c){let u=Math.pow(s,2),l=Math.pow(o,2),d=Math.pow(n,2),p=Math.pow(h,2),f=u*l-u*p-l*d;f<0&&(f=0),f/=u*p+l*d,f=Math.sqrt(f)*(a===c?-1:1);let v=f*s/o*h,g=f*-o/s*n,m=v+(e+i)/2,y=g+(t+r)/2,w=(n-v)/s,x=(h-g)/o,S=(-n-v)/s,b=(-h-g)/o,A=mh(1,0,w,x),O=mh(w,x,S,b);return!c&&O>0&&(O-=Hn),c&&O<0&&(O+=Hn),{centerx:m,centery:y,ang1:A,ang2:O}}function qw({px:e,py:t,cx:i,cy:r,rx:s,ry:o,largeArcFlag:n,sweepFlag:h}){let a=[];if(s===0||o===0)return[];let c=(e-i)/2,u=(t-r)/2;if(c===0&&u===0)return[];s=Math.abs(s),o=Math.abs(o);let l=Math.pow(c,2)/Math.pow(s,2)+Math.pow(u,2)/Math.pow(o,2);l>1&&(s*=Math.sqrt(l),o*=Math.sqrt(l));let d=Ww(e,t,i,r,s,o,c,u,n,h),{ang1:p,ang2:f}=d,{centerx:v,centery:g}=d,m=Math.abs(f)/(Hn/4);Math.abs(1-m)<1e-7&&(m=1);let y=Math.max(Math.ceil(m),1);f/=y;for(let w=0;w<y;w++)a.push(Hw(p,f)),p+=f;return a.map(w=>{let{x,y:S}=Xo(w[0],s,o,v,g),{x:b,y:A}=Xo(w[1],s,o,v,g),{x:O,y:P}=Xo(w[2],s,o,v,g);return{x1:x,y1:S,x2:b,y2:A,x:O,y:P}})}var Se;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(Se||(Se={}));var Fe;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(Fe||(Fe={}));function ce(e,t){if(!e)throw t||"Assertion Failed!"}var ae=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,r){ce(e.vertLeq(t,i)&&e.vertLeq(i,r));var s=i.s-t.s,o=r.s-i.s;return s+o>0?s<o?i.t-t.t+(t.t-r.t)*(s/(s+o)):i.t-r.t+(r.t-t.t)*(o/(s+o)):0},e.edgeSign=function(t,i,r){ce(e.vertLeq(t,i)&&e.vertLeq(i,r));var s=i.s-t.s,o=r.s-i.s;return s+o>0?(i.t-r.t)*s+(i.t-t.t)*o:0},e.transEval=function(t,i,r){ce(e.transLeq(t,i)&&e.transLeq(i,r));var s=i.t-t.t,o=r.t-i.t;return s+o>0?s<o?i.s-t.s+(t.s-r.s)*(s/(s+o)):i.s-r.s+(r.s-t.s)*(o/(s+o)):0},e.transSign=function(t,i,r){ce(e.transLeq(t,i)&&e.transLeq(i,r));var s=i.t-t.t,o=r.t-i.t;return s+o>0?(i.s-r.s)*s+(i.s-t.s)*o:0},e.vertCCW=function(t,i,r){return t.s*(i.t-r.t)+i.s*(r.t-t.t)+r.s*(t.t-i.t)>=0},e.interpolate=function(t,i,r,s){return t=t<0?0:t,r=r<0?0:r,t<=r?r===0?(i+s)/2:i+(s-i)*(t/(t+r)):s+(i-s)*(r/(t+r))},e.intersect=function(t,i,r,s,o){var n,h,a;e.vertLeq(t,i)||(a=t,t=i,i=a),e.vertLeq(r,s)||(a=r,r=s,s=a),e.vertLeq(t,r)||(a=t,t=r,r=a,a=i,i=s,s=a),e.vertLeq(r,i)?e.vertLeq(i,s)?(n=e.edgeEval(t,r,i),h=e.edgeEval(r,i,s),n+h<0&&(n=-n,h=-h),o.s=e.interpolate(n,r.s,h,i.s)):(n=e.edgeSign(t,r,i),h=-e.edgeSign(t,s,i),n+h<0&&(n=-n,h=-h),o.s=e.interpolate(n,r.s,h,s.s)):o.s=(r.s+i.s)/2,e.transLeq(t,i)||(a=t,t=i,i=a),e.transLeq(r,s)||(a=r,r=s,s=a),e.transLeq(t,r)||(a=t,t=r,r=a,a=i,i=s,s=a),e.transLeq(r,i)?e.transLeq(i,s)?(n=e.transEval(t,r,i),h=e.transEval(r,i,s),n+h<0&&(n=-n,h=-h),o.t=e.interpolate(n,r.t,h,i.t)):(n=e.transSign(t,r,i),h=-e.transSign(t,s,i),n+h<0&&(n=-n,h=-h),o.t=e.interpolate(n,r.t,h,s.t)):o.t=(r.t+i.t)/2},e}(),Tr=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e}(),ls=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),ki=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e}(),gh=function(){function e(){var t=new ki,i=new Tr,r=new ls(0),s=new ls(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=s,s.next=s,s.Sym=r,this.vHead=t,this.fHead=i,this.eHead=r,this.eHeadSym=s}return e.prototype.makeEdge_=function(t){var i=new ls(0),r=new ls(1);t.Sym.side<t.side&&(t=t.Sym);var s=t.Sym.next;return r.next=s,s.Sym.next=i,i.next=t,t.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},e.prototype.splice_=function(t,i){var r=t.Onext,s=i.Onext;r.Sym.Lnext=i,s.Sym.Lnext=t,t.Onext=s,i.Onext=r},e.prototype.makeVertex_=function(t,i,r){var s=t;ce(s,"Vertex can't be null!");var o=r.prev;s.prev=o,o.next=s,s.next=r,r.prev=s,s.anEdge=i;var n=i;do n.Org=s,n=n.Onext;while(n!==i)},e.prototype.makeFace_=function(t,i,r){var s=t;ce(s,"Face can't be null");var o=r.prev;s.prev=o,o.next=s,s.next=r,r.prev=s,s.anEdge=i,s.trail=null,s.marked=!1,s.inside=r.inside;var n=i;do n.Lface=s,n=n.Lnext;while(n!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,r=t.Sym.next;i.Sym.next=r,r.Sym.next=i},e.prototype.killVertex_=function(t,i){var r=t.anEdge,s=r;do s.Org=i,s=s.Onext;while(s!==r);var o=t.prev,n=t.next;n.prev=o,o.next=n},e.prototype.killFace_=function(t,i){var r=t.anEdge,s=r;do s.Lface=i,s=s.Lnext;while(s!==r);var o=t.prev,n=t.next;n.prev=o,o.next=n},e.prototype.makeEdge=function(){var t=new ki,i=new ki,r=new Tr,s=this.makeEdge_(this.eHead);return this.makeVertex_(t,s,this.vHead),this.makeVertex_(i,s.Sym,this.vHead),this.makeFace_(r,s,this.fHead),s},e.prototype.splice=function(t,i){var r=!1,s=!1;if(t!==i){if(i.Org!==t.Org&&(s=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!s){var o=new ki;this.makeVertex_(o,i,t.Org),t.Org.anEdge=t}if(!r){var n=new Tr;this.makeFace_(n,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,r=!1;if(t.Lface!==t.Rface&&(r=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!r){var s=new Tr;this.makeFace_(s,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),r=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var s=new ki;return this.makeVertex_(s,r,i.Org),i.Lface=r.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var i=this.addEdgeVertex(t),r=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,r),t.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=t.Rface,r.winding=t.winding,r.Sym.winding=t.Sym.winding,r.idx=t.idx,r.Sym.idx=t.Sym.idx,r},e.prototype.connect=function(t,i){var r=!1,s=this.makeEdge_(t),o=s.Sym;if(i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(s,t.Lnext),this.splice_(o,i),s.Org=t.Dst,o.Org=i.Org,s.Lface=o.Lface=t.Lface,t.Lface.anEdge=o,!r){var n=new Tr;this.makeFace_(n,s,t.Lface)}return s},e.prototype.zapFace=function(t){var i=t.anEdge,r,s,o,n,h;s=i.Lnext;do r=s,s=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),o=r.Sym,o.Onext===o?this.killVertex_(o.Org,null):(o.Org.anEdge=o.Onext,this.splice_(o,o.Oprev)),this.killEdge_(r));while(r!=i);n=t.prev,h=t.next,h.prev=n,n.next=h},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,r=0;do r++,i=i.Lnext;while(i!==t.anEdge);return r},e.prototype.mergeConvexFaces=function(t){var i,r,s,o,n,h,a;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,n=r.Org;s=r.Lnext,o=r.Sym,o&&o.Lface&&o.Lface.inside&&(h=this.countFaceVerts_(i),a=this.countFaceVerts_(o.Lface),h+a-2<=t&&ae.vertCCW(r.Lprev.Org,r.Org,o.Lnext.Lnext.Org)&&ae.vertCCW(o.Lprev.Org,o.Org,r.Lnext.Lnext.Org)&&(s=o.Lnext,this.delete(o),r=null,o=null)),!(r&&r.Lnext.Org===n);)r=s;return!0},e.prototype.check=function(){var t=this.fHead,i=this.vHead,r=this.eHead,s,o,n,h,a,c;for(o=t,o=t;(s=o.next)!==t;o=s){ce(s.prev===o),a=s.anEdge;do ce(a.Sym!==a),ce(a.Sym.Sym===a),ce(a.Lnext.Onext.Sym===a),ce(a.Onext.Sym.Lnext===a),ce(a.Lface===s),a=a.Lnext;while(a!==s.anEdge)}for(ce(s.prev===o&&s.anEdge===null),h=i,h=i;(n=h.next)!==i;h=n){ce(n.prev===h),a=n.anEdge;do ce(a.Sym!==a),ce(a.Sym.Sym===a),ce(a.Lnext.Onext.Sym===a),ce(a.Onext.Sym.Lnext===a),ce(a.Org===n),a=a.Onext;while(a!==n.anEdge)}for(ce(n.prev===h&&n.anEdge===null),c=r,c=r;(a=c.next)!==r;c=a)ce(a.Sym.next===c.Sym),ce(a.Sym!==a),ce(a.Sym.Sym===a),ce(a.Org!==null),ce(a.Dst!==null),ce(a.Lnext.Onext.Sym===a),ce(a.Onext.Sym.Lnext===a);ce(a.Sym.next===c.Sym&&a.Sym===this.eHeadSym&&a.Sym.Sym===a&&a.Org===null&&a.Dst===null&&a.Lface===null&&a.Rface===null)},e}(),vh=function(){function e(){this.handle=null}return e}(),yh=function(){function e(){this.key=null,this.node=0}return e}(),$w=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var r=0;r<t+1;r++)this.nodes[r]=new vh,this.handles[r]=new yh;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var i=this.nodes,r=this.handles,s,o,n;for(s=i[t].handle;;){if(n=t<<1,n<this.size&&this.leq(r[i[n+1].handle].key,r[i[n].handle].key)&&++n,ce(n<=this.max),o=i[n].handle,n>this.size||this.leq(r[s].key,r[o].key)){i[t].handle=s,r[s].node=t;break}i[t].handle=o,r[o].node=t,t=n}},e.prototype.floatUp_=function(t){var i=this.nodes,r=this.handles,s,o,n;for(s=i[t].handle;;){if(n=t>>1,o=i[n].handle,n===0||this.leq(r[o].key,r[s].key)){i[t].handle=s,r[s].node=t;break}i[t].handle=o,r[o].node=t,t=n}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var s,o;for(o=this.nodes.length,this.nodes.length=this.max+1,s=o;s<this.nodes.length;s++)this.nodes[s]=new vh;for(o=this.handles.length,this.handles.length=this.max+1,s=o;s<this.handles.length;s++)this.handles[s]=new yh}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=t,this.initialized&&this.floatUp_(i),r},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,r=t[1].handle,s=i[r].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),s},e.prototype.delete=function(t){var i=this.nodes,r=this.handles,s;ce(t>=1&&t<=this.max&&r[t].key!==null),s=r[t].node,i[s].handle=i[this.size].handle,r[i[s].handle].node=s,--this.size,s<=this.size&&(s<=1||this.leq(r[i[s>>1].handle].key,r[i[s].handle].key)?this.floatDown_(s):this.floatUp_(s)),r[t].key=null,r[t].node=this.freeList,this.freeList=t},e}(),Yo=function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e}(),bh=function(){function e(){this.key=null,this.next=null,this.prev=null}return e}(),Xw=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new bh,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,i));var r=new bh;return r.key=i,r.next=t.next,t.next.prev=r,r.prev=t,t.next=r,r},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),Yw=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,r){var s=t.event,o=i.eUp,n=r.eUp;if(o.Dst===s)return n.Dst===s?ae.vertLeq(o.Org,n.Org)?ae.edgeSign(n.Dst,o.Org,n.Org)<=0:ae.edgeSign(o.Dst,n.Org,o.Org)>=0:ae.edgeSign(n.Dst,s,n.Org)<=0;if(n.Dst===s)return ae.edgeSign(o.Dst,s,o.Org)>=0;var h=ae.edgeEval(o.Dst,s,o.Org),a=ae.edgeEval(n.Dst,s,n.Org);return h>=a},e.deleteRegion=function(t,i){i.fixUpperEdge&&ce(i.eUp.winding===0),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,r){ce(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},e.topLeftRegion=function(t,i){var r=i.eUp.Org,s;do i=e.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(s=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext),s===null)return null;e.fixUpperEdge(t,i,s),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,r){var s=new Yo;return s.eUp=r,s.nodeUp=t.dict.insertBefore(i.nodeUp,s),s.fixUpperEdge=!1,s.sentinel=!1,s.dirty=!1,r.activeRegion=s,s},e.isWindingInside=function(t,i){switch(t.windingRule){case Se.ODD:return(i&1)!==0;case Se.NONZERO:return i!==0;case Se.POSITIVE:return i>0;case Se.NEGATIVE:return i<0;case Se.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var r=i.eUp,s=r.Lface;s.inside=i.inside,s.anEdge=r,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,r){for(var s,o=null,n=i,h=i.eUp;n!==r;){if(n.fixUpperEdge=!1,o=e.regionBelow(n),s=o.eUp,s.Org!=h.Org){if(!o.fixUpperEdge){e.finishRegion(t,n);break}s=t.mesh.connect(h.Lprev,s.Sym),e.fixUpperEdge(t,o,s)}h.Onext!==s&&(t.mesh.splice(s.Oprev,s),t.mesh.splice(h,s)),e.finishRegion(t,n),h=o.eUp,n=o}return h},e.addRightEdges=function(t,i,r,s,o,n){var h,a,c,u,l=!0;c=r;do ce(ae.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,i,c.Sym),c=c.Onext;while(c!==s);for(o===null&&(o=e.regionBelow(i).eUp.Rprev),a=i,u=o;h=e.regionBelow(a),c=h.eUp.Sym,c.Org===u.Org;)c.Onext!==u&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(u.Oprev,c)),h.windingNumber=a.windingNumber-c.winding,h.inside=e.isWindingInside(t,h.windingNumber),a.dirty=!0,!l&&e.checkForRightSplice(t,a)&&(e.addWinding(c,u),e.deleteRegion(t,a),t.mesh.delete(u)),l=!1,a=h,u=c;a.dirty=!0,ce(a.windingNumber-c.winding===h.windingNumber),n&&e.walkDirtyRegions(t,a)},e.spliceMergeVertices=function(t,i,r){t.mesh.splice(i,r)},e.vertexWeights=function(t,i,r){var s=ae.vertL1dist(i,t),o=ae.vertL1dist(r,t),n=.5*o/(s+o),h=.5*s/(s+o);t.coords[0]+=n*i.coords[0]+h*r.coords[0],t.coords[1]+=n*i.coords[1]+h*r.coords[1],t.coords[2]+=n*i.coords[2]+h*r.coords[2]},e.getIntersectData=function(t,i,r,s,o,n){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,r,s),e.vertexWeights(i,o,n)},e.checkForRightSplice=function(t,i){var r=e.regionBelow(i),s=i.eUp,o=r.eUp;if(ae.vertLeq(s.Org,o.Org)){if(ae.edgeSign(o.Dst,s.Org,o.Org)>0)return!1;ae.vertEq(s.Org,o.Org)?s.Org!==o.Org&&(t.pq.delete(s.Org.pqHandle),e.spliceMergeVertices(t,o.Oprev,s)):(t.mesh.splitEdge(o.Sym),t.mesh.splice(s,o.Oprev),i.dirty=r.dirty=!0)}else{if(ae.edgeSign(s.Dst,o.Org,s.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(s.Sym),t.mesh.splice(o.Oprev,s)}return!0},e.checkForLeftSplice=function(t,i){var r=e.regionBelow(i),s=i.eUp,o=r.eUp,n;if(ce(!ae.vertEq(s.Dst,o.Dst)),ae.vertLeq(s.Dst,o.Dst)){if(ae.edgeSign(s.Dst,o.Dst,s.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,n=t.mesh.splitEdge(s),t.mesh.splice(o.Sym,n),n.Lface.inside=i.inside}else{if(ae.edgeSign(o.Dst,s.Dst,o.Org)>0)return!1;i.dirty=r.dirty=!0,n=t.mesh.splitEdge(o),t.mesh.splice(s.Lnext,o.Sym),n.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var r=e.regionBelow(i),s=i.eUp,o=r.eUp,n=s.Org,h=o.Org,a=s.Dst,c=o.Dst,u,l,d=new ki,p,f;if(ce(!ae.vertEq(c,a)),ce(ae.edgeSign(a,t.event,n)<=0),ce(ae.edgeSign(c,t.event,h)>=0),ce(n!==t.event&&h!==t.event),ce(!i.fixUpperEdge&&!r.fixUpperEdge),n===h||(u=Math.min(n.t,a.t),l=Math.max(h.t,c.t),u>l))return!1;if(ae.vertLeq(n,h)){if(ae.edgeSign(c,n,h)>0)return!1}else if(ae.edgeSign(a,h,n)<0)return!1;return e.debugEvent(t),ae.intersect(a,n,c,h,d),ce(Math.min(n.t,a.t)<=d.t),ce(d.t<=Math.max(h.t,c.t)),ce(Math.min(c.s,a.s)<=d.s),ce(d.s<=Math.max(h.s,n.s)),ae.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),p=ae.vertLeq(n,h)?n:h,ae.vertLeq(p,d)&&(d.s=p.s,d.t=p.t),ae.vertEq(d,n)||ae.vertEq(d,h)?(e.checkForRightSplice(t,i),!1):!ae.vertEq(a,t.event)&&ae.edgeSign(a,t.event,d)>=0||!ae.vertEq(c,t.event)&&ae.edgeSign(c,t.event,d)<=0?c===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(o.Sym,s),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),r),e.addRightEdges(t,i,s.Oprev,s,s,!0),!0):a===t.event?(t.mesh.splitEdge(o.Sym),t.mesh.splice(s.Lnext,o.Oprev),r=i,i=e.topRightRegion(i),f=e.regionBelow(i).eUp.Rprev,r.eUp=o.Oprev,o=e.finishLeftRegions(t,r,null),e.addRightEdges(t,i,o.Onext,s.Rprev,f,!0),!0):(ae.edgeSign(a,t.event,d)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),ae.edgeSign(c,t.event,d)<=0&&(i.dirty=r.dirty=!0,t.mesh.splitEdge(o.Sym),o.Org.s=t.event.s,o.Org.t=t.event.t),!1):(t.mesh.splitEdge(s.Sym),t.mesh.splitEdge(o.Sym),t.mesh.splice(o.Oprev,s),s.Org.s=d.s,s.Org.t=d.t,s.Org.pqHandle=t.pq.insert(s.Org),e.getIntersectData(t,s.Org,n,a,h,c),e.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r=e.regionBelow(i),s,o;;){for(;r.dirty;)i=r,r=e.regionBelow(r);if(!i.dirty&&(r=i,i=e.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,s=i.eUp,o=r.eUp,s.Dst!==o.Dst&&e.checkForLeftSplice(t,i)&&(r.fixUpperEdge?(e.deleteRegion(t,r),t.mesh.delete(o),r=e.regionBelow(i),o=r.eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(s),i=e.regionAbove(r),s=i.eUp)),s.Org!==o.Org)if(s.Dst!==o.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(s.Dst===t.event||o.Dst===t.event)){if(e.checkForIntersect(t,i))return}else e.checkForRightSplice(t,i);s.Org===o.Org&&s.Dst===o.Dst&&(e.addWinding(o,s),e.deleteRegion(t,i),t.mesh.delete(s),i=e.regionAbove(r))}},e.connectRightVertex=function(t,i,r){var s,o=r.Onext,n=e.regionBelow(i),h=i.eUp,a=n.eUp,c=!1;if(h.Dst!==a.Dst&&e.checkForIntersect(t,i),ae.vertEq(h.Org,t.event)&&(t.mesh.splice(o.Oprev,h),i=e.topLeftRegion(t,i),o=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),n),c=!0),ae.vertEq(a.Org,t.event)&&(t.mesh.splice(r,a.Oprev),r=e.finishLeftRegions(t,n,null),c=!0),c){e.addRightEdges(t,i,r.Onext,o,o,!0);return}ae.vertLeq(a.Org,h.Org)?s=a.Oprev:s=h,s=t.mesh.connect(r.Lprev,s),e.addRightEdges(t,i,s,s.Onext,s.Onext,!1),s.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i)},e.connectLeftDegenerate=function(t,i,r){var s,o,n,h,a;if(s=i.eUp,ae.vertEq(s.Org,r)){ce(!1),e.spliceMergeVertices(t,s,r.anEdge);return}if(!ae.vertEq(s.Dst,r)){t.mesh.splitEdge(s.Sym),i.fixUpperEdge&&(t.mesh.delete(s.Onext),i.fixUpperEdge=!1),t.mesh.splice(r.anEdge,s),e.sweepEvent(t,r);return}ce(!1),i=e.topRightRegion(i),a=e.regionBelow(i),n=a.eUp.Sym,o=h=n.Onext,a.fixUpperEdge&&(ce(o!==n),e.deleteRegion(t,a),t.mesh.delete(n),n=o.Oprev),t.mesh.splice(r.anEdge,n),ae.edgeGoesLeft(o)||(o=null),e.addRightEdges(t,i,n.Onext,h,o,!0)},e.connectLeftVertex=function(t,i){var r,s,o,n,h,a,c=new Yo;if(c.eUp=i.anEdge.Sym,r=t.dict.search(c).key,s=e.regionBelow(r),!!s){if(n=r.eUp,h=s.eUp,ae.edgeSign(n.Dst,i,n.Org)===0){e.connectLeftDegenerate(t,r,i);return}if(o=ae.vertLeq(h.Dst,n.Dst)?r:s,r.inside||o.fixUpperEdge){if(o===r)a=t.mesh.connect(i.anEdge.Sym,n.Lnext);else{var u=t.mesh.connect(h.Dnext,i.anEdge);a=u.Sym}o.fixUpperEdge?e.fixUpperEdge(t,o,a):e.computeWinding(t,e.addRegionBelow(t,r,a)),e.sweepEvent(t,i)}else e.addRightEdges(t,r,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){e.connectLeftVertex(t,i);return}var s=e.topLeftRegion(t,r.activeRegion);ce(s!==null);var o=e.regionBelow(s),n=o.eUp,h=e.finishLeftRegions(t,o,null);h.Onext===n?e.connectRightVertex(t,s,h):e.addRightEdges(t,s,h.Onext,n,n,!0)},e.addSentinel=function(t,i,r,s){var o=new Yo,n=t.mesh.makeEdge();n.Org.s=r,n.Org.t=s,n.Dst.s=i,n.Dst.t=s,t.event=n.Dst,o.eUp=n,o.windingNumber=0,o.inside=!1,o.fixUpperEdge=!1,o.sentinel=!0,o.dirty=!1,o.nodeUp=t.dict.insert(o)},e.initEdgeDict=function(t){t.dict=new Xw(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],s=t.bmin[0]-i,o=t.bmax[0]+i,n=t.bmin[1]-r,h=t.bmax[1]+r;e.addSentinel(t,s,o,n),e.addSentinel(t,s,o,h)},e.doneEdgeDict=function(t){for(var i,r=0;(i=t.dict.min().key)!==null;)i.sentinel||(ce(i.fixUpperEdge),ce(++r===1)),ce(i.windingNumber===0),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,r,s,o=t.mesh.eHead;for(i=o.next;i!==o;i=r)r=i.next,s=i.Lnext,ae.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,s,i),t.mesh.delete(i),i=s,s=i.Lnext),s.Lnext===i&&(s!==i&&((s===r||s===r.Sym)&&(r=r.next),t.mesh.delete(s)),(i===r||i===r.Sym)&&(r=r.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,r,s,o=0;for(s=t.mesh.vHead,r=s.next;r!==s;r=r.next)o++;for(o+=8,i=t.pq=new $w(o,ae.vertLeq),s=t.mesh.vHead,r=s.next;r!==s;r=r.next)r.pqHandle=i.insert(r);return r!==s?!1:(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var r,s,o;for(r=i.fHead.next;r!==i.fHead;r=s)s=r.next,o=r.anEdge,ce(o.Lnext!==o),o.Lnext.Lnext===o&&(e.addWinding(o.Onext,o),t.mesh.delete(o));return!0},e.computeInterior=function(t,i){i===void 0&&(i=!0);var r,s;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(r=t.pq.extractMin())!==null;){for(;s=t.pq.min(),!(s===null||!ae.vertEq(s,r));)s=t.pq.extractMin(),e.spliceMergeVertices(t,r.anEdge,s.anEdge);e.sweepEvent(t,r)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(i&&t.mesh.check(),!0):!1},e}(),Zw=function(){function e(){this.mesh=new gh,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=Se.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,r,s,o,n,h,a=[0,0,0],c=[0,0,0],u=[0,0,0],l=[0,0,0],d=[0,0,0],p=[null,null,null],f=[null,null,null],v=this.mesh.vHead;i=v.next;for(var g=0;g<3;++g)o=i.coords[g],c[g]=o,f[g]=i,a[g]=o,p[g]=i;for(i=v.next;i!==v;i=i.next)for(var m=0;m<3;++m)o=i.coords[m],o<c[m]&&(c[m]=o,f[m]=i),o>a[m]&&(a[m]=o,p[m]=i);var y=0;if(a[1]-c[1]>a[0]-c[0]&&(y=1),a[2]-c[2]>a[y]-c[y]&&(y=2),c[y]>=a[y]){t[0]=0,t[1]=0,t[2]=1;return}for(h=0,r=f[y],s=p[y],u[0]=r.coords[0]-s.coords[0],u[1]=r.coords[1]-s.coords[1],u[2]=r.coords[2]-s.coords[2],i=v.next;i!==v;i=i.next)l[0]=i.coords[0]-s.coords[0],l[1]=i.coords[1]-s.coords[1],l[2]=i.coords[2]-s.coords[2],d[0]=u[1]*l[2]-u[2]*l[1],d[1]=u[2]*l[0]-u[0]*l[2],d[2]=u[0]*l[1]-u[1]*l[0],n=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],n>h&&(h=n,t[0]=d[0],t[1]=d[1],t[2]=d[2]);h<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(u)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,i,r=this.mesh.vHead,s,o=0,n=t.next;n!==t;n=n.next)if(s=n.anEdge,!(s.winding<=0))do o+=(s.Org.s-s.Dst.s)*(s.Org.t+s.Dst.t),s=s.Lnext;while(s!==n.anEdge);if(o<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,i=[0,0,0],r,s,o=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),o=!0),r=this.sUnit,s=this.tUnit;var n=this.longAxis_(i);r[n]=0,r[(n+1)%3]=1,r[(n+2)%3]=0,s[n]=0,s[(n+1)%3]=0,s[(n+2)%3]=i[n]>0?1:-1;for(var h=t.next;h!==t;h=h.next)h.s=this.dot_(h.coords,r),h.t=this.dot_(h.coords,s);o&&this.checkOrientation_();for(var a=!0,c=t.next;c!==t;c=c.next)a?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,a=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var r,s;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;ae.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;ae.vertLeq(r.Org,r.Dst);r=r.Lnext);s=r.Lprev;for(var o=void 0;r.Lnext!==s;)if(ae.vertLeq(r.Dst,s.Org)){for(;s.Lnext!==r&&(ae.edgeGoesLeft(s.Lnext)||ae.edgeSign(s.Org,s.Dst,s.Lnext.Dst)<=0);)o=t.connect(s.Lnext,s),s=o.Sym;s=s.Lprev}else{for(;s.Lnext!==r&&(ae.edgeGoesRight(r.Lprev)||ae.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)o=t.connect(r,r.Lprev),r=o.Sym;r=r.Lnext}if(s.Lnext===r)throw"Mono region invalid";for(;s.Lnext.Lnext!==r;)o=t.connect(s.Lnext,s),s=o.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(t,r))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)i=r.next,r.inside||t.zapFace(r)},e.prototype.setWindingNumber_=function(t,i,r){for(var s,o=t.eHead.next;o!==t.eHead;o=s)s=o.next,o.Rface.inside!==o.Lface.inside?o.winding=o.Lface.inside?i:-i:r?t.delete(o):o.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,i,r,s){var o,n=0,h=0,a;r>3&&t.mergeConvexFaces(r);for(var c=t.vHead.next;c!==t.vHead;c=c.next)c.n=-1;for(var u=t.fHead.next;u!==t.fHead;u=u.next)if(u.n=-1,!!u.inside){o=u.anEdge,a=0;do{var c=o.Org;c.n===-1&&(c.n=h,h++),a++,o=o.Lnext}while(o!==u.anEdge);if(a>r)throw"Face vertex greater that support polygon";u.n=n,++n}this.elementCount=n,i===Fe.CONNECTED_POLYGONS&&(n*=2),this.elements=[],this.elements.length=n*r,this.vertexCount=h,this.vertices=[],this.vertices.length=h*s,this.vertexIndices=[],this.vertexIndices.length=h;for(var c=t.vHead.next;c!==t.vHead;c=c.next)if(c.n!==-1){var l=c.n*s;this.vertices[l+0]=c.coords[0],this.vertices[l+1]=c.coords[1],s>2&&(this.vertices[l+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}for(var d=0,u=t.fHead.next;u!==t.fHead;u=u.next)if(u.inside){o=u.anEdge,a=0;do{var c=o.Org;this.elements[d++]=c.n,a++,o=o.Lnext}while(o!==u.anEdge);for(var p=a;p<r;++p)this.elements[d++]=-1;if(i===Fe.CONNECTED_POLYGONS){o=u.anEdge;do this.elements[d++]=this.getNeighbourFace_(o),o=o.Lnext;while(o!==u.anEdge);for(var f=a;f<r;++f)this.elements[d++]=-1}}},e.prototype.outputContours_=function(t,i){var r,s,o=0,n=0;this.vertexCount=0,this.elementCount=0;for(var h=t.fHead.next;h!==t.fHead;h=h.next)if(h.inside){s=r=h.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==s);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var a=0,c=0,u=0;o=0;for(var h=t.fHead.next;h!==t.fHead;h=h.next)if(h.inside){n=0,s=r=h.anEdge;do this.vertices[a++]=r.Org.coords[0],this.vertices[a++]=r.Org.coords[1],i>2&&(this.vertices[a++]=r.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,n++,r=r.Lnext;while(r!==s);this.elements[u++]=o,this.elements[u++]=n,o+=n}},e.prototype.addContour=function(t,i){this.mesh===null&&(this.mesh=new gh),t<2&&(t=2),t>3&&(t=3);for(var r=null,s=0;s<i.length;s+=t)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[s+0],r.Org.coords[1]=i[s+1],t>2?r.Org.coords[2]=i[s+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(t,i,r,s,o,n){if(t===void 0&&(t=Se.ODD),i===void 0&&(i=Fe.POLYGONS),n===void 0&&(n=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,o&&(this.normal[0]=o[0],this.normal[1]=o[1],this.normal[2]=o[2]),this.windingRule=t,s<2&&(s=2),s>3&&(s=3),!this.mesh)return!1;this.projectPolygon_(),Yw.computeInterior(this,n);var h=this.mesh;return i===Fe.BOUNDARY_CONTOURS?this.setWindingNumber_(h,1,!0):this.tessellateInterior_(h),n&&h.check(),i===Fe.BOUNDARY_CONTOURS?this.outputContours_(h,s):this.outputPolymesh_(h,i,r,s),!0},e}();function ni(e){var t=e.windingRule,i=t===void 0?Se.ODD:t,r=e.elementType,s=r===void 0?Fe.POLYGONS:r,o=e.polySize,n=o===void 0?3:o,h=e.vertexSize,a=h===void 0?2:h,c=e.normal,u=c===void 0?[0,0,1]:c,l=e.contours,d=l===void 0?[]:l,p=e.strict,f=p===void 0?!0:p,v=e.debug,g=v===void 0?!1:v;if(!d&&f)throw new Error("Contours can't be empty");if(d){var m=new Zw;e.edgeCreateCallback&&(m.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(m.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<d.length;y++)m.addContour(a||2,d[y]);return m.tesselate(i,s,n,a,u,f),{vertices:m.vertices,vertexIndices:m.vertexIndices,vertexCount:m.vertexCount,elements:m.elements,elementCount:m.elementCount,mesh:g?m.mesh:void 0}}}Se.ODD;Se.NONZERO;Se.POSITIVE;Se.NEGATIVE;Se.ABS_GEQ_TWO;Fe.POLYGONS;Fe.CONNECTED_POLYGONS;Fe.BOUNDARY_CONTOURS;var Wn=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*Wn.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,s=0;this.positions=new Float32Array(this.buffer,s*r,3*e),s+=3*e,this.normals=new Float32Array(this.buffer,s*r,3*e),s+=3*e,this.uvs=new Float32Array(this.buffer,s*r,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity}  ${e}`);let i=e*Wn.eSize,r=new ArrayBuffer(i),s=Float32Array.BYTES_PER_ELEMENT,o=0,n=new Float32Array(r,o*s,3*e);o+=3*e;let h=new Float32Array(r,o*s,3*e);o+=3*e;let a=new Float32Array(r,o*s,2*e);n.set(this.positions.slice(0,this.size*3)),h.set(this.normals.slice(0,this.size*3)),a.set(this.uvs.slice(0,this.size*2)),this.buffer=r,this.positions=n,this.normals=h,this.uvs=a,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let r=this.capacity;for(;t>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity}  ${this.size}`),this.realloc(this.size,!0)}},jd=Wn;jd.eSize=(3+3+2)*Float32Array.BYTES_PER_ELEMENT;var za={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},Ud={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},Rd={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},Zo=(e,t)=>([i,r])=>(r<i&&(r+=t),(e>=i?e:e+t)<=r),kd=class extends Pe{constructor(e,t,i=0,r=12,s=3,o=Se.ODD){super(),this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._bevel=i,this._curveSegments=r,this._bevelSegmentsInput=s,i<=0?(this._bevelSize=0,this._bevelSegments=0):(this._bevelSize=Math.min(i,t/2-1e-12),this._bevelSegments=Math.floor(s));let n=this._shape.extractShapePointsToFlatArray([],r),h=this._shape.shapeHoles.map(S=>{let b=S.extractShapePointsToFlatArray([],r),A=[];for(let O=b.length-1;O>=1;O-=2){let P=b[O-1],_=b[O-0];A.push(P,_)}return A}),a;try{a=ni({windingRule:o,elementType:Fe.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[n]})}catch{a=za}let c;try{c=ni({windingRule:Se.ODD,elementType:Fe.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...h]})}catch{c=Ud}if(!a)throw new Error("error generating geometry");let u=a.elementCount;if(c){a.elementCount+=c.elementCount;for(let S=0;S<c.elements.length;S++){let b=c.elements[S],A=S%2===0?a.vertexCount:0;a.elements.push(b+A)}for(let S=0;S<c.vertexIndices.length;S++){let b=c.vertexIndices[S],A=a.vertexCount;a.vertexIndices.push(b+A)}for(let S=0;S<c.vertices.length;S++){let b=c.vertices[S];a.vertices.push(b)}}let l=1/0,d=-1/0,p=1/0,f=-1/0;for(let S=0,b=a.vertexCount;S<b;S++){let A=S*2,O=a.vertices[A+0],P=a.vertices[A+1];O<l&&(l=O),O>d&&(d=O),P<p&&(p=P),P>f&&(f=P)}this._minX=l,this._minY=p,this._width=d-l,this._height=f-p,this._buffer=new jd(this._computeBufferEstimatedSize(a));let v=[],g=[];for(let S=a.elementCount-1;S>=0;S--){let b=S>=u,A=S*2,O=a.elements[A+0],P=a.elements[A+1],_=O+P,C={start:O,count:P,normals:[],continuous:[],concave:[]},M=O,N=_-1,W=O+1,Q=this._shape.roundedCurves.length;do{let G=M-O,L=a.vertices[N*2+0],R=a.vertices[N*2+1],I=a.vertices[M*2+0],B=a.vertices[M*2+1],z=a.vertices[W*2+0],q=a.vertices[W*2+1],U=I-L,F=B-R,H=Math.sqrt(U*U+F*F);U/=H,F/=H;let k=I-z,Z=B-q,J=Math.sqrt(k*k+Z*Z);k/=J,Z/=J,C.normals[G*2+0]=-Z,C.normals[G*2+1]=k,C.concave[G]=U*Z-F*k>0;let Y=a.vertexIndices[M];if(Array.isArray(Y))C.continuous[G]=!1;else{let[ee,te]=this._shape.getCurveIndexFromVertexId(Y-1,!0);if(te>0&&te<1)C.continuous[G]=!0;else{let K=te===1?ee+1:ee-1;K=(K+Q)%Q;let ue=te===1?0:1,oe=this._shape.roundedCurves[ee].getTangent(te),le=this._shape.roundedCurves[K].getTangent(ue);C.continuous[G]=oe.dot(le)>.95}}b&&(C.normals[G*2+0]*=-1,C.normals[G*2+1]*=-1),[N,M,W]=[M,W,W+1],W>=_&&(W-=P)}while(W!==O+1);let re=[];re.push({bevelI:0,angle:0,size:0,boundary:{vertices:a.vertices.slice(O*2,_*2),vertexCount:P,vertexIndices:new Array(P).fill(!0).map((G,L)=>[L,L]),elements:[0,P],elementCount:1,mesh:null},reverseMap:[],insetPoints:a.vertices.slice(O*2,_*2)});for(let G=1;G<=this._bevelSegments;G++){let L=G/this._bevelSegments*Math.PI/2,R=(1-Math.cos(L))*this._bevelSize,I=[],B=[],z=0;for(let U=0;U<P;U++){let F=U*2,H=(U-1+P)%P*2,k=a.vertices[C.start*2+F+0],Z=a.vertices[C.start*2+F+1],J=-C.normals[H+0]*R,Y=-C.normals[H+1]*R,ee=-C.normals[F+0]*R,te=-C.normals[F+1]*R;if(C.concave[U]||!C.concave[U]&&b){let K=Math.atan2(Y,J),ue=Math.atan2(te,ee);ue>K&&(ue-=Math.PI*2);let oe=ue-K;if(C.continuous[U]||b){let le=K+oe/2,xe=Math.cos(le)*R,ve=Math.sin(le)*R;I[2*z+0]=k+xe*(b?-1:1),I[2*z+1]=Z+ve*(b?-1:1),B[z]=U,z++}else{let le=Math.max(1,Math.floor(r/4*Math.abs(oe)/Math.PI));for(let xe=0;xe<=le;xe++){let ve=K+oe*(xe/le),Oe=Math.cos(ve)*R,De=Math.sin(ve)*R;I[2*z+0]=k+Oe,I[2*z+1]=Z+De,B[z]=U,z++}}}else I[2*z+0]=k+J,I[2*z+1]=Z+Y,B[z]=U,z++,I[2*z+0]=k,I[2*z+1]=Z,B[z]=U,z++,I[2*z+0]=k+ee,I[2*z+1]=Z+te,B[z]=U,z++}let q=ni({windingRule:Se.POSITIVE,elementType:Fe.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[I],edgeCreateCallback:U=>{let F=U.Org.idx,H=B[F],k=B[(F+1)%B.length];U.idx=[H,k],U.Sym.idx=[k,H]},vertexIdCallback:U=>{let F=U.Lprev.idx;return[F?F[1]:0,U.idx?U.idx[0]:0]}});if(!q)throw console.log("Error"),new Error(`error generating bevel geometry for ${G}'th loop`);if(!q.vertexCount)break;for(let U=0;U<q.vertexIndices.length;U++){let[F,H]=q.vertexIndices[U];if(F===H)continue;let k=H;H<F&&(k+=P);for(let Z=F;Z<k;Z++){let J=Z%P,Y=(Z+1)%P;if(!C.continuous[J]||!C.continuous[Y]){q.vertexIndices[U]=[F,J],q.vertexIndices.splice(U+1,0,[Y,H]),q.vertices.splice((U+1)*2,0,q.vertices[U*2],q.vertices[U*2+1]);break}}}re.push({bevelI:G,angle:L,size:R,boundary:q,reverseMap:B,insetPoints:I})}let $=(G,L,R)=>{let I=0,B=G.boundary.vertexIndices.length;for(;I<B&&R(G.boundary.vertexIndices[L]);)L=(L+1)%B,I++;return I},V=v.length;for(let G=1;G<re.length;G++){let L=re[G-1],R=re[G],I=L.boundary.vertexIndices.length,B=R.boundary.vertexIndices.length;if(!I||!B)break;let z=C.concave.length,q=0,U=Zo(q,P);for(;!L.boundary.vertexIndices.filter(U).length||!R.boundary.vertexIndices.filter(U).length;)q++,U=Zo(q,P);let F=L.boundary.vertexIndices.findIndex(U),H=R.boundary.vertexIndices.findIndex(U);do F=(F+1)%I;while(U(L.boundary.vertexIndices[F]));do H=(H+1)%B;while(U(R.boundary.vertexIndices[H]));q=(q+1)%P;let k=q,Z=this._buildBevelVert(C,L,(F-1+I)%I),J=this._buildBevelVert(C,R,(H-1+B)%B),Y=Z,ee=J,te,K,ue=!1;do{U=Zo(q,P);let oe=$(L,F,U),le=$(R,H,U),xe=ue;if(ue=!1,oe&&!le){for(let ve=0;ve<oe;ve++)te=this._buildBevelVert(C,L,(F+ve)%I,ve/(oe-1)),v.push(Y.topN,te.topP,ee.topN),v.push(te.bottomP,Y.bottomN,ee.bottomN),Y=te;ue=!0}else if(!oe&&le)for(let ve=0;ve<le;ve++)K=this._buildBevelVert(C,R,(H+ve)%B,ve/(le-1)),v.push(ee.topN,Y.topP,K.topP),v.push(Y.bottomP,ee.bottomN,K.bottomP),ee=K;else if(oe&&le)if(te=this._buildBevelVert(C,L,F,0),K=this._buildBevelVert(C,R,H,0),xe?(v.push(Y.topN,K.topP,ee.topN),v.push(Y.topN,te.topP,K.topP),v.push(K.bottomP,Y.bottomN,ee.bottomN),v.push(K.bottomP,te.bottomP,Y.bottomN)):(v.push(ee.topN,Y.topN,te.topP),v.push(ee.topN,te.topP,K.topP),v.push(te.bottomP,Y.bottomN,ee.bottomN),v.push(te.bottomP,ee.bottomN,K.bottomP)),Y=te,ee=K,oe===le)for(let ve=1;ve<oe;ve++)te=this._buildBevelVert(C,L,(F+ve)%I,ve/(oe-1)),K=this._buildBevelVert(C,R,(H+ve)%B,ve/(le-1)),v.push(Y.topN,te.topP,ee.topN),v.push(ee.topN,te.topP,K.topP),v.push(te.bottomP,Y.bottomN,ee.bottomN),v.push(te.bottomP,ee.bottomN,K.bottomP),Y=te,ee=K;else if(oe>le){let ve=oe/le,Oe=0;for(let De=1;De<oe;De++)te=this._buildBevelVert(C,L,(F+De)%I,De/(oe-1)),v.push(Y.topN,te.topP,ee.topN),v.push(te.bottomP,Y.bottomN,ee.bottomN),Y=te,De>(Oe+1)*ve&&(Oe++,K=this._buildBevelVert(C,R,(H+Oe)%B,Oe/(le-1)),v.push(ee.topN,te.topP,K.topP),v.push(te.bottomP,ee.bottomN,K.bottomP),ee=K)}else{let ve=le/oe,Oe=0;for(let De=1;De<le;De++)K=this._buildBevelVert(C,R,(H+De)%B,De/(le-1)),v.push(ee.topN,te.topP,K.topP),v.push(te.bottomP,ee.bottomN,K.bottomP),ee=K,De>(Oe+1)*ve&&(Oe++,te=this._buildBevelVert(C,L,(F+Oe)%I,Oe/(oe-1)),v.push(Y.topN,te.topP,ee.topN),v.push(te.bottomP,Y.bottomN,ee.bottomN),Y=te)}F=(F+oe)%I,H=(H+le)%B,q=(q+1)%z}while(q!==k)}if(this._buildWall(re,C,v),b){let G=[];for(let L=v.length-1;L>=V+2;L-=3){let R=v[L-2],I=v[L-1],B=v[L-0];G.push(B,I,R)}v.splice(V,v.length-V,...G)}if(b){let G=[];for(let L=re[re.length-1].boundary.vertices.length-1;L>=1;L-=2){let R=re[re.length-1].boundary.vertices[L-1],I=re[re.length-1].boundary.vertices[L-0];G.push(R,I)}g.push(G)}if(!b){let G=re[re.length-1],L;try{L=ni({windingRule:re.length>1?Se.POSITIVE:Se.ODD,elementType:Fe.POLYGONS,vertexSize:2,strict:!0,contours:[G.insetPoints,...g]})}catch{L=Rd}if(!L)throw new Error("Error generating geometry for surface");h.length===0&&Object.assign(this,{capStartIndex:v.length});for(let R=0;R<L.elementCount*3;R+=3){let I=this._buildSurfaceVert(L,L.elements[R+0]),B=this._buildSurfaceVert(L,L.elements[R+1]),z=this._buildSurfaceVert(L,L.elements[R+2]);v.push(I.top,B.top,z.top),v.push(z.bottom,B.bottom,I.bottom)}}this.vertexCache={}}this._buffer.shrink();let m=new ze(Uint32Array.from(v),1),y=new ze(this._buffer.positions,3),w=new ze(this._buffer.normals,3),x=new ze(this._buffer.uvs,2);y.needsUpdate=!0,w.needsUpdate=!0,x.needsUpdate=!0,m.needsUpdate=!0,this.setAttribute("position",y),this.setAttribute("normal",w),this.setAttribute("uv",x),this.setIndex(m)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let s=0,o=r.boundary.vertexCount;s<o;s++){let n=this._buildBevelVert(t,r,s),h=this._buildBevelVert(t,r,(s+1)%o);i.push(h.topP,n.topN,n.bottomN),i.push(h.topP,n.bottomN,h.bottomP)}}_buildSurfaceVert(e,t){let i=t.toString();if(i in this.vertexCache)return this.vertexCache[i];let r=e.vertices[t*2+0],s=e.vertices[t*2+1],o=(r-this._minX)/this._width,n=(s-this._minY)/this._height,h=this._buffer.get(2),a=h*3,c=h*2,u={top:h+0,bottom:h+1};return this._buffer.positions[a+0]=r,this._buffer.positions[a+1]=s,this._buffer.positions[a+2]=this._depth,this._buffer.normals[a+0]=0,this._buffer.normals[a+1]=0,this._buffer.normals[a+2]=1,this._buffer.uvs[c+0]=o,this._buffer.uvs[c+1]=n,this._buffer.positions[a+3]=r,this._buffer.positions[a+4]=s,this._buffer.positions[a+5]=0,this._buffer.normals[a+3]=0,this._buffer.normals[a+4]=0,this._buffer.normals[a+5]=-1,this._buffer.uvs[c+2]=o,this._buffer.uvs[c+3]=n,this.vertexCache[i]=u,u}_buildBevelVert(e,t,i,r=1){let s=`${t.bevelI}:${i}`;if(s in this.vertexCache)return this.vertexCache[s];let[o,n]=t.boundary.vertexIndices[i],h,a,c,u;o!==n?(a=o,h=n,u=!1,c=e.continuous[a]&&e.continuous[h]):(h=o,a=(h-1+e.count)%e.count,u=e.concave[h]&&t.bevelI>0,c=e.continuous[h]||u);let l=Math.cos(t.angle),d=Math.sin(t.angle),p=i*2,f=h*2,v=a*2,g=t.boundary.vertices[p+0],m=t.boundary.vertices[p+1],y=(1-d)*this._bevelSize,w=(g-this._minX)/this._width,x=(m-this._minY)/this._height,S=e.normals[f+0],b=e.normals[f+1],A=e.normals[v+0],O=e.normals[v+1];if(u){let N=A-S,W=O-b;S=S+N*(1-r),b=b+W*(1-r);let Q=Math.sqrt(S*S+b*b);S/=Q,b/=Q}let P=this._buffer.get(c?2:4),_=P*3,C=P*2,M={i,fi:h,topP:P+0,topN:P+0,bottomP:P+1,bottomN:P+1};return this._buffer.positions[_+0]=g,this._buffer.positions[_+1]=m,this._buffer.positions[_+2]=this._depth-y,this._buffer.normals[_+0]=S*l,this._buffer.normals[_+1]=b*l,this._buffer.normals[_+2]=d,this._buffer.uvs[C+0]=w,this._buffer.uvs[C+1]=x,this._buffer.positions[_+3]=g,this._buffer.positions[_+4]=m,this._buffer.positions[_+5]=y,this._buffer.normals[_+3]=S*l,this._buffer.normals[_+4]=b*l,this._buffer.normals[_+5]=-d,this._buffer.uvs[C+2]=x,this._buffer.uvs[C+3]=w,c||(P+=2,_+=6,C+=4,M.topP=P+0,M.bottomP=P+1,this._buffer.positions[_+0]=g,this._buffer.positions[_+1]=m,this._buffer.positions[_+2]=this._depth-y,this._buffer.normals[_+0]=A*l,this._buffer.normals[_+1]=O*l,this._buffer.normals[_+2]=d,this._buffer.uvs[C+0]=w,this._buffer.uvs[C+1]=x,this._buffer.positions[_+3]=g,this._buffer.positions[_+4]=m,this._buffer.positions[_+5]=y,this._buffer.normals[_+3]=A*l,this._buffer.normals[_+4]=O*l,this._buffer.normals[_+5]=-d,this._buffer.uvs[C+2]=x,this._buffer.uvs[C+3]=w),this.vertexCache[s]=M,M}clone(){let e=new kd(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=So(this.userData),e}},Fd=class extends Pe{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=Se.ODD,this.elementType=Fe.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:Se.ODD,elementType:Fe.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),s=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),o,n=!0,h=!0,a,c;for(let d=0,p=r.length/2;d<p;d++){let f=d*2,v=r[f+0],g=r[f+1];if(a!==void 0&&v!==a&&(n=!1),c!==void 0&&g!==c&&(h=!1),a=v,c=g,!n&&!h)break}if(!n&&!h)try{o=ni({contours:[r,...s],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{o=za}let u=(o==null?void 0:o.vertexCount)??1,l=(o==null?void 0:o.elementCount)??1;if(this._positionAttribute=new ze(new Float32Array(u*3),3),this._normalAttribute=new ze(new Float32Array(u*3),3),this._uvAttribute=new ze(new Float32Array(u*2),2),this._indexAttribute=new ze(new Uint32Array(l*3),1),o){let d=1/0,p=-1/0,f=1/0,v=-1/0;for(let y=0,w=u;y<w;y++){let x=y*2,S=o.vertices[x+0],b=o.vertices[x+1];S<d&&(d=S),S>p&&(p=S),b<f&&(f=b),b>v&&(v=b)}let g=p-d,m=v-f;for(let y=0,w=u;y<w;y++){let x=y*2,S=o.vertices[x+0],b=o.vertices[x+1],A=(S-d)/g,O=(b-f)/m;this._positionAttribute.setXYZ(y,S,b,0),this._normalAttribute.setXYZ(y,0,0,1),this._uvAttribute.setXY(y,A,O)}for(let y=0,w=l;y<w;y++){let x=y*3,S=o.elements[x+0],b=o.elements[x+1],A=o.elements[x+2];this._indexAttribute.setX(x+0,S),this._indexAttribute.setX(x+1,b),this._indexAttribute.setX(x+2,A)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((o==null?void 0:o.elementCount)??1)*3)}clone(){let e=new Fd(this._shape,this._curveSegments);return e.userData=So(this.userData),e}},Vd=class extends kd{constructor(e,t,i=0,r=12,s=3,o=Se.ODD){super(e,t,i,r,s,o),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let s=0,o=r.boundary.vertexCount;s<o;s++){let n=this._buildBevelVert(t,r,s),h=this._buildBevelVert(t,r,(s+1)%o);i.push(h.topP,n.topN,n.bottomN),i.push(h.topP,n.bottomN,h.bottomP)}}clone(){let e=new Vd(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=So(this.userData),e}},Bi=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var c,u;let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:Se.ODD},e.parameters),r=Math.abs(i.width),s=Math.abs(i.height??i.width),o=Math.abs(i.depth??0),n=e.shape??(t==null?void 0:t.shape),h=(n==null?void 0:n.roundness)??i.roundness;n!==void 0&&(n instanceof Be?(n.width!==r||n.height!==s)&&n.applySize(r,s):n=new Be(r,s).fromJSON(n),((c=e.parameters)==null?void 0:c.roundness)!==void 0&&((u=e.parameters)==null?void 0:u.roundness)>0&&n.update());let a=n??new Be(r,s);return{parameters:Object.assign(i,{width:r,height:s,depth:o,roundness:h}),shape:a}}static build(e){let{depth:t,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:s,roundness:o,windingRule:n}=e.parameters;e.shape.roundness=o;let h;return t<=0?h=new Fd(e.shape,s,{windingRule:n}):h=new Vd(e.shape,t,i,s,r,n),Object.assign(h,{userData:{...e,type:"VectorGeometry"}})}},Gd=Math.PI*2,Na=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof Be?e.shape:new Be,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,angle:s,innerRadius:o,depth:n,extrudeBevelSize:h,extrudeBevelSegments:a}=e.parameters,c=e.shape,u=t*.5,l=i*.5,d=Kw(c,u,l,s*Math.PI/180,r,o);c.isClosed=!0,c.update();let p=Bi.create({shape:c,parameters:{subdivisions:d,depth:n,extrudeBevelSize:h,extrudeBevelSegments:a}});return Object.assign(p,{userData:{...e,type:"EllipseGeometry"}})}};function Kw(e,t,i,r,s,o){if(r>=Gd)return s>30||s%4===0?(Jw(e,t,i,o),Math.round(s/4)):xh(e,r,s,t,i,o);r=Math.max(r,.001);let n={x:0,y:i},h=r+Math.PI*.5,a={x:Math.cos(h)*t,y:Math.sin(h)*i},c=qw({px:n.x,py:n.y,cx:a.x,cy:a.y,rx:t,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return s>30||s%c.length===0?Qw(e,n.x,n.y,c,s,t,i,o):xh(e,r,s,t,i,o)}function Qw(e,t,i,r,s,o,n,h){let a=Math.round(s/r.length);e.addPoint(Zi(t,i));for(let c=0,u=r.length;c<u;c++){let l=r[c],d=e.points[c],p=Zi(l.x,l.y);d.controls[1].position.set(l.x1,l.y1),p.controls[0].position.set(l.x2,l.y2),e.addPoint(p)}return h>0?Hd(e,o,n,h):e.addPoint(Zi(0,0)),a}function xh(e,t,i,r,s,o){let n=-t/i;for(let h=0;h<=i;h++){let a=n*h,c=Math.sin(a)*r,u=Math.cos(a)*s;e.addPoint(Zi(c,u))}return t<Gd?o>0?Hd(e,r,s,o):e.addPoint(Zi(0,0)):(e.removePoint(e.points[e.points.length-1]),o>0&&Wd(e,r,s,o)),1}function Jw(e,t,i,r=0,s=0,o=0){let n=.5522847498,h=t*n,a=i*n;e.addPoint(hs(s-t,o,s-t,o-a,s-t,o+a)),e.addPoint(hs(s,o+i,s-h,o+i,s+h,o+i)),e.addPoint(hs(s+t,o,s+t,o+a,s+t,o-a)),e.addPoint(hs(s,o-i,s+h,o-i,s-h,o-i)),r>0&&Wd(e,t,i,r)}function Zi(e,t){return new Yi(Ue.generateUUID(),new X(e,t))}function hs(e,t,i,r,s,o){let n=Zi(e,t);return n.controls[0].position.set(i,r),n.controls[1].position.set(s,o),n}function Hd(e,t,i,r){qd(e,t,i,r).forEach(s=>e.addPoint(s))}function Wd(e,t,i,r){let s=qd(e,t,i,r),o=new Be;s.forEach(n=>o.addPoint(n)),o.isClosed=!0,e.shapeHoles.push(o)}function qd(e,t,i,r){let s=r*t/100,o=s*(Math.abs(i)/Math.abs(t)),n=new X(s/t,o/i),h=e.points.map(a=>{let c=a.clone();return c.uuid=Ue.generateUUID(),c}).reverse();return h.forEach(a=>{a.position.multiply(n);let c=a.controls[0].position.clone().multiply(n),u=a.controls[1].position.clone().multiply(n);a.controls[0].position.copy(u),a.controls[1].position.copy(c)}),h}var e_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),r=Math.abs(i.width),s=Math.abs(i.height??r),o=Math.abs(i.depth??r),n=Math.abs(Math.min(r,o))/2;return{parameters:Object.assign(i,{width:r,height:s,depth:o,radius:n,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:r,radius:s,revolutions:o,segments:n,pathRadius:h,pathType:a,pathSegments:c,cornerRadius:u,cornerSegments:l}=e.parameters,d=new $d(!1,t,i,r,s,o,n,h,a,c,u,l);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},$d=class extends Pe{constructor(e=!0,t=1,i=1,r=1,s=1,o=1,n=1,h=1,a=1,c=1,u=1,l=1){if(super(),o===0)return;let d=e&&o===1;d&&(l=0),u>100&&(u=100),u===0&&(l=0);let p=()=>new T,f=new T,v=p(),g=p(),m=p(),y,w,x,S,b,A,O,P,_=p(),C=p(),M=p(),N=p(),W=p(),Q=p(),re=p(),$=p(),V=i-2*h+.001,G=V/o,L=Math.ceil(n*o),R=L+1,I=V/L,B=-V/2,z=c+1,q=2*Math.PI/c,U=Math.PI/2/l,F=.01,H=Math.min((1-u/100)*h,h-F),k=h-H,Z=0,J=2,Y=l*J+J,ee=z*Y/J,te=ee+z*R,K=z*(R+Y),[ue,oe,le]=[3,3,2].map(Ve=>Array(K*Ve).fill(0)),xe=[],ve=s-h;function Oe(Ve,it){let Tt=Math.PI/2;A=it*I,P=2*Math.PI*(A%G)/G+Tt,A+=B,O=Math.sin(P)*ve,b=Math.cos(P)*ve,e?Ve.set(b,O,A):Ve.set(b,A,O)}Oe(f,-1e-10),Oe(v,0),_.copy(f),Oe(f,1);let De=f.distanceTo(v),at=d?0:k+H,Kt=De*L+2*at,lt=H,yr=Kt-at;for(let Ve=0;Ve<=L;Ve++){Oe(g,Ve),$.subVectors(g,_).normalize(),_.copy(g),Q.copy(g).setComponent(+e+1,0).normalize(),re.crossVectors($,Q).normalize();let it=Ve===0,Tt=Ve===L,Ku=it?3*Math.PI/2:U,Qu=it?lt:yr,Ju=it?z:te,ep=it?0:K-z,tp=$.clone().multiplyScalar(it?-k:k).add(g),ip=$.clone().multiplyScalar(it?-1:1).normalize();for(let Ht=0;Ht<z;Ht++){let Xa=Ht*q;if(C.addVectors(f.copy(Q).multiplyScalar(h*Math.cos(Xa)),v.copy(re).multiplyScalar(h*Math.sin(Xa))),M.copy(C).normalize(),it||Tt){d||(Z=ep+Ht,[0,1,2].forEach(Ke=>{ue[Z*3+Ke]=tp.getComponent(Ke),oe[Z*3+Ke]=ip.getComponent(Ke)}),le[Z*2]=+Tt,le[Z*2+1]=Ht/c),v.copy(M).multiplyScalar(H),m.addVectors(g,v);for(let Ke=0;Ke<l;Ke++){let Po=Ke*U+Ku;N.addVectors(f.copy($).multiplyScalar(k*Math.sin(Po)),v.copy(M).multiplyScalar(k*Math.cos(Po))),W.copy(N).normalize(),v.addVectors(m,N),N.normalize(),Z=Ju+Ke*z+Ht,[0,1,2].forEach(rs=>{ue[Z*3+rs]=v.getComponent(rs),oe[Z*3+rs]=W.getComponent(rs)});let rp=+it+Math.sin(Po);le[Z*2]=(Qu+k*rp)/Kt,le[Z*2+1]=Ht/c}}v.addVectors(g,C),Z=ee+Ve*z+Ht,[0,1,2].forEach(Ke=>{ue[Z*3+Ke]=v.getComponent(Ke),oe[Z*3+Ke]=M.getComponent(Ke)}),le[Z*2]=(at+Ve*De)/Kt,le[Z*2+1]=Ht/c}}let br=R+2*l+J,[Co,xr]=[+d,br-1];d&&(xr-=1);for(let Ve=Co;Ve<=xr-1;Ve++){let it=d&&Ve===xr-1;for(let Tt=0;Tt<z-1;Tt++)y=Ve*z+Tt,w=y+1,x=(it?Tt:y)+z,S=(it?Tt+1:w)+z,Ve===0?xe.push(w,S,x):Ve===br-2?xe.push(y,w,x):xe.push(y,w,x,w,S,x)}this.setIndex(xe),this.setAttribute("position",new ge(ue,3)),this.setAttribute("normal",new ge(oe,3)),this.setAttribute("uv",new ge(le,2))}},t_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:s,corner:o,cornerSides:n}=e.parameters,h=s===0&&o!==0?new Xd(t*.5,o,n):new Up(t*.5,s);return h.scale(1,i/t,r/t),Object.assign(h,{userData:{...e,type:"IcosahedronGeometry"}})}},Xd=class extends Da{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,s=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],n="IcosahedronGeometry";super(s,o,n,e,t,i),this.type=n}static fromJSON(e){return new Xd(e.radius,e.corner,e.cornerSides)}},i_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r;(((r=e.parameters)==null?void 0:r.points)??[]).forEach(s=>{Array.isArray(s)&&(s.x=s[0],s.y=s[1])});let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:r}=e.parameters,s=new js;s.moveTo(t[0].x,t[0].y),s.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let o=new Rp(s.extractPoints(r).shape,i);return o.rotateZ(Math.PI),Object.assign(o,{userData:{...e,type:"LatheGeometry"}})}},Lt=new me,Ko=new er,cs=new T,no=class extends fp{constructor(){super(),this.uuid=Ue.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new Bs().getNormalMatrix(e);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(e);for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i];s.normal.applyMatrix3(t).normalize();for(let o=0,n=s.vertexNormals.length;o<n;o++)s.vertexNormals[o].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return Lt.makeRotationX(e),this.applyMatrix4(Lt),this}rotateY(e){return Lt.makeRotationY(e),this.applyMatrix4(Lt),this}rotateZ(e){return Lt.makeRotationZ(e),this.applyMatrix4(Lt),this}translate(e,t,i){return Lt.makeTranslation(e,t,i),this.applyMatrix4(Lt),this}scale(e,t,i){return Lt.makeScale(e,t,i),this.applyMatrix4(Lt),this}lookAt(e){return Ko.lookAt(e),Ko.updateMatrix(),this.applyMatrix4(Ko.matrix),this}fromBufferGeometry(e){let t=this,i=e.index!==null?e.index:void 0,r=e.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let s=r.position,o=r.normal,n=r.color,h=r.uv,a=r.uv2;a!==void 0&&(this.faceVertexUvs[1]=[]);for(let l=0;l<s.count;l++)t.vertices.push(new T().fromBufferAttribute(s,l)),n!==void 0&&t.colors.push(new yt().fromBufferAttribute(n,l));function c(l,d,p,f){let v=n===void 0?[]:[t.colors[l].clone(),t.colors[d].clone(),t.colors[p].clone()],g=o===void 0?[]:[new T().fromBufferAttribute(o,l),new T().fromBufferAttribute(o,d),new T().fromBufferAttribute(o,p)],m=new qn(l,d,p,g,v,f);t.faces.push(m),h!==void 0&&t.faceVertexUvs[0].push([new X().fromBufferAttribute(h,l),new X().fromBufferAttribute(h,d),new X().fromBufferAttribute(h,p)]),a!==void 0&&t.faceVertexUvs[1].push([new X().fromBufferAttribute(a,l),new X().fromBufferAttribute(a,d),new X().fromBufferAttribute(a,p)])}let u=e.groups;if(u.length>0)for(let l=0;l<u.length;l++){let d=u[l],p=d.start,f=d.count;for(let v=p,g=p+f;v<g;v+=3)i!==void 0?c(i.getX(v),i.getX(v+1),i.getX(v+2),d.materialIndex):c(v,v+1,v+2,d.materialIndex)}else if(i!==void 0)for(let l=0;l<i.count;l+=3)c(i.getX(l),i.getX(l+1),i.getX(l+2));else for(let l=0;l<s.count;l+=3)c(l,l+1,l+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(cs).negate(),this.translate(cs.x,cs.y,cs.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,r=new me;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let e=new T,t=new T;for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i],o=this.vertices[s.a],n=this.vertices[s.b],h=this.vertices[s.c];e.subVectors(h,n),t.subVectors(o,n),e.cross(t),e.normalize(),s.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)t[i]=new T;if(e){let i=new T,r=new T;for(let s=0,o=this.faces.length;s<o;s++){let n=this.faces[s],h=this.vertices[n.a],a=this.vertices[n.b],c=this.vertices[n.c];i.subVectors(c,a),r.subVectors(h,a),i.cross(r),t[n.a].add(i),t[n.b].add(i),t[n.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i];t[s.a].add(s.normal),t[s.b].add(s.normal),t[s.c].add(s.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)t[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i],o=s.vertexNormals;o.length===3?(o[0].copy(t[s.a]),o[1].copy(t[s.b]),o[2].copy(t[s.c])):(o[0]=t[s.a].clone(),o[1]=t[s.b].clone(),o[2]=t[s.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let s=0,o=r.vertexNormals.length;s<o;s++)r.__originalVertexNormals[s]?r.__originalVertexNormals[s].copy(r.vertexNormals[s]):r.__originalVertexNormals[s]=r.vertexNormals[s].clone()}let e=new no;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let s=this.morphNormals[t].faceNormals,o=this.morphNormals[t].vertexNormals;for(let n=0,h=this.faces.length;n<h;n++){let a=new T,c={a:new T,b:new T,c:new T};s.push(a),o.push(c)}}let r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let s=0,o=this.faces.length;s<o;s++){let n=this.faces[s],h=r.faceNormals[s],a=r.vertexNormals[s];h.copy(n.normal),a.a.copy(n.vertexNormals[0]),a.b.copy(n.vertexNormals[1]),a.c.copy(n.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Li),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new tr),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let r,s=this.vertices.length,o=this.vertices,n=e.vertices,h=this.faces,a=e.faces,c=this.colors,u=e.colors;t!==void 0&&(r=new Bs().getNormalMatrix(t));for(let l=0,d=n.length;l<d;l++){let p=n[l].clone();t!==void 0&&p.applyMatrix4(t),o.push(p)}for(let l=0,d=u.length;l<d;l++)c.push(u[l].clone());for(let l=0,d=a.length;l<d;l++){let p=a[l],f,v,g=p.vertexNormals,m=p.vertexColors,y=new qn(p.a+s,p.b+s,p.c+s);y.normal.copy(p.normal),r!==void 0&&y.normal.applyMatrix3(r).normalize();for(let w=0,x=g.length;w<x;w++)f=g[w].clone(),r!==void 0&&f.applyMatrix3(r).normalize(),y.vertexNormals.push(f);y.color.copy(p.color);for(let w=0,x=m.length;w<x;w++)v=m[w],y.vertexColors.push(v.clone());y.materialIndex=p.materialIndex+i,h.push(y)}for(let l=0,d=e.faceVertexUvs.length;l<d;l++){let p=e.faceVertexUvs[l];this.faceVertexUvs[l]===void 0&&(this.faceVertexUvs[l]=[]);for(let f=0,v=p.length;f<v;f++){let g=p[f],m=[];for(let y=0,w=g.length;y<w;y++)m.push(g[y].clone());this.faceVertexUvs[l].push(m)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},i=[],r=[],s=Math.pow(10,e);for(let h=0,a=this.vertices.length;h<a;h++){let c=this.vertices[h],u=Math.round(c.x*s)+"_"+Math.round(c.y*s)+"_"+Math.round(c.z*s);t[u]===void 0?(t[u]=h,i.push(this.vertices[h]),r[h]=i.length-1):r[h]=r[t[u]]}let o=[];for(let h=0,a=this.faces.length;h<a;h++){let c=this.faces[h];c.a=r[c.a],c.b=r[c.b],c.c=r[c.c];let u=[c.a,c.b,c.c];for(let l=0;l<3;l++)if(u[l]===u[(l+1)%3]){o.push(h);break}}for(let h=o.length-1;h>=0;h--){let a=o[h];this.faces.splice(a,1);for(let c=0,u=this.faceVertexUvs.length;c<u;c++)this.faceVertexUvs[c].splice(a,1)}let n=this.vertices.length-i.length;return this.vertices=i,n}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let r=e[t];this.vertices.push(new T(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let h=0;h<t;h++)e[h]._id=h;function i(h,a){return h.materialIndex-a.materialIndex}e.sort(i);let r=this.faceVertexUvs[0],s=this.faceVertexUvs[1],o,n;r&&r.length===t&&(o=[]),s&&s.length===t&&(n=[]);for(let h=0;h<t;h++){let a=e[h]._id;o&&o.push(r[a]),n&&n.push(s[a])}o&&(this.faceVertexUvs[0]=o),n&&(this.faceVertexUvs[1]=n)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let p=this.parameters;for(let f in p)p[f]!==void 0&&(e[f]=p[f]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let f=this.vertices[p];t.push(f.x,f.y,f.z)}let i=[],r=[],s={},o=[],n={},h=[],a={};for(let p=0;p<this.faces.length;p++){let f=this.faces[p],v=!0,g=!1,m=this.faceVertexUvs[0][p]!==void 0,y=f.normal.length()>0,w=f.vertexNormals.length>0,x=f.color.r!==1||f.color.g!==1||f.color.b!==1,S=f.vertexColors.length>0,b=0;if(b=c(b,0,0),b=c(b,1,v),b=c(b,2,g),b=c(b,3,m),b=c(b,4,y),b=c(b,5,w),b=c(b,6,x),b=c(b,7,S),i.push(b),i.push(f.a,f.b,f.c),i.push(f.materialIndex),m){let A=this.faceVertexUvs[0][p];i.push(d(A[0]),d(A[1]),d(A[2]))}if(y&&i.push(u(f.normal)),w){let A=f.vertexNormals;i.push(u(A[0]),u(A[1]),u(A[2]))}if(x&&i.push(l(f.color)),S){let A=f.vertexColors;i.push(l(A[0]),l(A[1]),l(A[2]))}}function c(p,f,v){return v?p|1<<f:p&~(1<<f)}function u(p){let f=p.x.toString()+p.y.toString()+p.z.toString();return s[f]!==void 0||(s[f]=r.length/3,r.push(p.x,p.y,p.z)),s[f]}function l(p){let f=p.r.toString()+p.g.toString()+p.b.toString();return n[f]!==void 0||(n[f]=o.length,o.push(p.getHex())),n[f]}function d(p){let f=p.x.toString()+p.y.toString();return a[f]!==void 0||(a[f]=h.length/2,h.push(p.x,p.y)),a[f]}return e.data={},e.data.vertices=t,e.data.normals=r,o.length>0&&(e.data.colors=o),h.length>0&&(e.data.uvs=[h]),e.data.faces=i,e}clone(){return new no().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let l=0,d=t.length;l<d;l++)this.vertices.push(t[l].clone());let i=e.colors;for(let l=0,d=i.length;l<d;l++)this.colors.push(i[l].clone());let r=e.faces;for(let l=0,d=r.length;l<d;l++)this.faces.push(r[l].clone());for(let l=0,d=e.faceVertexUvs.length;l<d;l++){let p=e.faceVertexUvs[l];this.faceVertexUvs[l]===void 0&&(this.faceVertexUvs[l]=[]);for(let f=0,v=p.length;f<v;f++){let g=p[f],m=[];for(let y=0,w=g.length;y<w;y++){let x=g[y];m.push(x.clone())}this.faceVertexUvs[l].push(m)}}let s=e.morphTargets;for(let l=0,d=s.length;l<d;l++){let p={};if(p.name=s[l].name,s[l].vertices!==void 0){p.vertices=[];for(let f=0,v=s[l].vertices.length;f<v;f++)p.vertices.push(s[l].vertices[f].clone())}if(s[l].normals!==void 0){p.normals=[];for(let f=0,v=s[l].normals.length;f<v;f++)p.normals.push(s[l].normals[f].clone())}this.morphTargets.push(p)}let o=e.morphNormals;for(let l=0,d=o.length;l<d;l++){let p={};if(o[l].vertexNormals!==void 0){p.vertexNormals=[];for(let f=0,v=o[l].vertexNormals.length;f<v;f++){let g=o[l].vertexNormals[f],m={};m.a=g.a.clone(),m.b=g.b.clone(),m.c=g.c.clone(),p.vertexNormals.push(m)}}if(o[l].faceNormals!==void 0){p.faceNormals=[];for(let f=0,v=o[l].faceNormals.length;f<v;f++)p.faceNormals.push(o[l].faceNormals[f].clone())}this.morphNormals.push(p)}let n=e.skinWeights;for(let l=0,d=n.length;l<d;l++)this.skinWeights.push(n[l].clone());let h=e.skinIndices;for(let l=0,d=h.length;l<d;l++)this.skinIndices.push(h[l].clone());let a=e.lineDistances;for(let l=0,d=a.length;l<d;l++)this.lineDistances.push(a[l]);let c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());let u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new r_().fromGeometry(this),t=new Pe,i=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",ds.call(new ze(i,3),e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);t.setAttribute("normal",ds.call(new ze(r,3),e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);t.setAttribute("color",wh.call(new ze(r,3),e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);t.setAttribute("uv",_h.call(new ze(r,2),e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",_h.call(new ze(r,2),e.uvs2))}t.groups=e.groups;for(let r in e.morphTargets){let s=[],o=e.morphTargets[r];for(let n=0,h=o.length;n<h;n++){let a=o[n],c=new ge(a.data.length*3,3);c.name=a.name,s.push(ds.call(c,a.data))}t.morphAttributes[r]=s}if(e.skinIndices.length>0){let r=new ge(e.skinIndices.length*4,4);t.setAttribute("skinIndex",Sh.call(r,e.skinIndices))}if(e.skinWeights.length>0){let r=new ge(e.skinWeights.length*4,4);t.setAttribute("skinWeight",Sh.call(r,e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new Pe,i=e.geometry;if(e.isPoints||e.isLine){let r=new ge(i.vertices.length*3,3),s=new ge(i.colors.length*3,3);if(t.setAttribute("position",ds.call(r,i.vertices)),t.setAttribute("color",wh.call(s,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let o=new ge(i.lineDistances.length,1);t.setAttribute("lineDistance",s_.call(o,i.lineDistances))}i.boundingSphere!==null&&(t.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};no.prototype.isGeometry=!0;var r_=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],i,r,s,o=e.faces;for(r=0;r<o.length;r++){let n=o[r];n.materialIndex!==s&&(s=n.materialIndex,i!==void 0&&(i.count=r*3-i.start,t.push(i)),i={start:r*3,materialIndex:s})}i!==void 0&&(i.count=r*3-i.start,t.push(i)),this.groups=t}fromGeometry(e){let t=e.faces,i=e.vertices,r=e.faceVertexUvs,s=r[0]&&r[0].length>0,o=r[1]&&r[1].length>0,n=e.morphTargets,h=n.length,a;if(h>0){a=[];for(let g=0;g<h;g++)a[g]={name:n[g].name,data:[]};this.morphTargets.position=a}let c=e.morphNormals,u=c.length,l;if(u>0){l=[];for(let g=0;g<u;g++)l[g]={name:c[g].name,data:[]};this.morphTargets.normal=l}let d=e.skinIndices,p=e.skinWeights,f=d.length===i.length,v=p.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<t.length;g++){let m=t[g];this.vertices.push(i[m.a],i[m.b],i[m.c]);let y=m.vertexNormals;if(y.length===3)this.normals.push(y[0],y[1],y[2]);else{let x=m.normal;this.normals.push(x,x,x)}let w=m.vertexColors;if(w.length===3)this.colors.push(w[0],w[1],w[2]);else{let x=m.color;this.colors.push(x,x,x)}if(s===!0){let x=r[0][g];x!==void 0?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new X,new X,new X))}if(o===!0){let x=r[1][g];x!==void 0?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new X,new X,new X))}for(let x=0;x<h;x++){let S=n[x].vertices;a[x].data.push(S[m.a],S[m.b],S[m.c])}for(let x=0;x<u;x++){let S=c[x].vertexNormals[g];l[x].data.push(S.a,S.b,S.c)}f&&this.skinIndices.push(d[m.a],d[m.b],d[m.c]),v&&this.skinWeights.push(p[m.a],p[m.b],p[m.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},qn=class{constructor(e,t,i,r,s,o=0){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new T,this.vertexNormals=Array.isArray(r)?r:[],this.color=s&&s.isColor?s:new yt,this.vertexColors=Array.isArray(s)?s:[],this.materialIndex=o}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function s_(e){return this.array.set(e),this}function wh(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new yt),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this}function _h(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new X),t[i++]=o.x,t[i++]=o.y}return this}function ds(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new T),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z}return this}function Sh(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let o=e[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new Qe),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this}var o_=["a","b","c"];function n_(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function Qo(e,t,i){let r=Math.min(e,t),s=Math.max(e,t),o=r+"_"+s;return i.get(o)}function Jo(e,t,i,r,s,o){let n=Math.min(e,t),h=Math.max(e,t),a=n+"_"+h,c;if(r.has(a))c=r.get(a);else{let u=i[n],l=i[h];c={a:u,b:l,newEdge:null,faces:[]},r.set(a,c)}c.faces.push(s),o[e].edges.push(c),o[t].edges.push(c)}function a_(e,t,i,r){let s,o,n;for(s=0,o=e.length;s<o;s++)i[s]={edges:[]};for(s=0,o=t.length;s<o;s++)n=t[s],Jo(n.a,n.b,e,r,n,i),Jo(n.b,n.c,e,r,n,i),Jo(n.c,n.a,e,r,n,i)}function us(e,t,i,r,s){e.push(new qn(t,i,r,void 0,void 0,s))}function ji(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function ps(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}var l_=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof Pe?e=new no().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new T,i,r,s,o,n,h=e.vertices,a=e.faces,c=e.faceVertexUvs[0],u=c!==void 0&&c.length>0,l=[],d=new Map;a_(h,a,l,d);let p=[],f,v,g,m,y,w,x;for(let F of Array.from(d.keys())){for(v=d.get(F),g=new T,y=3/8,w=1/8,x=v.faces.length,x!=2&&(y=.5,w=0,x!=1),g.addVectors(v.a,v.b).multiplyScalar(y),t.set(0,0,0),o=0;o<x;o++){for(m=v.faces[o],n=0;n<3&&(f=h[n_(m,o_[n])],!(f!==v.a&&f!==v.b));n++);f&&t.add(f)}t.multiplyScalar(w),g.add(t),v.newEdge=p.length,p.push(g)}let S,b,A,O,P,_,C,M=[];for(r=0,s=h.length;r<s;r++){for(_=h[r],P=l[r].edges,i=P.length,i==3?S=3/16:i>3&&(S=3/(8*i)),b=1-i*Number(S),A=S,i<=2&&(i==2?(b=3/4,A=1/8):i==1||i==0),C=_.clone().multiplyScalar(b),t.set(0,0,0),o=0;o<i;o++)O=P[o],f=O.a!==_?O.a:O.b,t.add(f);t.multiplyScalar(Number(A)),C.add(t),M.push(C)}let N=M.concat(p),W=M.length,Q,re,$,V=[],G=[],L,R,I,B,z=new X,q=new X,U=new X;for(r=0,s=a.length;r<s;r++)m=a[r],Q=Number(Qo(m.a,m.b,d).newEdge)+W,re=Number(Qo(m.b,m.c,d).newEdge)+W,$=Number(Qo(m.c,m.a,d).newEdge)+W,us(V,Q,re,$,m.materialIndex),us(V,m.a,Q,$,m.materialIndex),us(V,m.b,re,Q,m.materialIndex),us(V,m.c,$,re,m.materialIndex),u&&(L=c[r],R=L[0],I=L[1],B=L[2],z.set(ji(R.x,I.x),ji(R.y,I.y)),q.set(ji(I.x,B.x),ji(I.y,B.y)),U.set(ji(R.x,B.x),ji(R.y,B.y)),ps(G,z,q,U),ps(G,R,z,U),ps(G,I,q,z),ps(G,B,U,q));e.vertices=N,e.faces=V,u&&(e.faceVertexUvs[0]=G)}},Ge=new T,h_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.geometry??(t==null?void 0:t.geometry)??new Pe().copy(new Mi(100,100,100)),r;t===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(Ge),r={width:Ge.x,height:Ge.y,depth:Ge.z,subdivisions:0}):r=t.parameters;let s={...r,...e.parameters};return{parameters:{width:Math.abs(s.width),height:Math.abs(s.height),depth:Math.abs(s.depth),subdivisions:Math.abs(s.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:r,subdivisions:s}=e.parameters,o=e.geometry??new Pe().copy(new Mi(100,100,100)),n=o.userData.parameters;n===void 0?(o.computeBoundingBox(),o.boundingBox.getSize(Ge)):Ge.set(n.width,n.height,n.depth),(t!==Ge.x||i!==Ge.y||r!==Ge.z)&&o.scale(Ge.x===0?1:t/Ge.x,Ge.y===0?1:i/Ge.y,Ge.z===0?1:r/Ge.z);let h=o.originalGeometry;try{s>0?(h===void 0||(n==null?void 0:n.subdivisions)!==s)&&(h===void 0&&(h=o),o=new l_(s).modify(h).toBufferGeometry()):(h!==void 0&&(o=h),h=void 0,o.getAttribute("normal")===void 0&&o.computeVertexNormals())}catch{h!==void 0&&(o=h),h=void 0,o.getAttribute("normal")===void 0&&o.computeVertexNormals()}return h!==void 0&&Object.assign(o,{originalGeometry:h}),delete e.geometry,Object.assign(o,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new wc(i).load(e,r=>{let s=this.normalizeInputs({geometry:r});r.boundingBox.getSize(Ge);let o=100/Ge.x;Object.assign(s.parameters,{width:100,height:Ge.y*o,depth:Ge.z*o}),t(this.build(s))})}},Yd=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof Be?e.shape:new Be,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,cornerRadius:s,depth:o,extrudeBevelSize:n,extrudeBevelSegments:h}=e.parameters,a=e.shape,c=t*.5,u=i*.5,l=0,d=0,p=2*Math.PI/r;for(let v=0;v<r;v++){let g=p*v,m=l+Math.sin(g)*c,y=d+Math.cos(g)*u;a.addPoint(a.createPoint(m,y))}a.isClosed=!0;for(let v=0,g=a.points.length;v<g;v++)a.points[v].roundness=s;a.roundness=s,a.update();let f=Bi.create({shape:a,parameters:{roundness:s,depth:o,extrudeBevelSize:n,extrudeBevelSegments:h}});return Object.assign(f,{userData:{...e,type:"PolygonGeometry"}})}},c_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,radialSegments:s,heightSegments:o,openEnded:n,cornerRadius:h,cornerSegments:a}=e.parameters,c=new u_(t*.5,i,s,o,n,h,a);return c.scale(1,1,r/t),Object.assign(c,{userData:{...e,type:"PyramidGeometry"}})}};function Mr(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function en(e,t,i,r,s,o){let n=t.clone().sub(e),h=i.clone().sub(e),a=n.angleTo(h);if(n.normalize(),h.normalize(),r===s){let c=n.add(h).normalize();o.copy(e).addScaledVector(c,r/Math.sin(a/2))}else{let c=n.angleTo(h);o.copy(e),o.addScaledVector(n,s/Math.sin(c)),o.addScaledVector(h,r/Math.sin(c))}}function d_(e,t,i){let r=e.clone().sub(t),s=i.clone().sub(t);return r.projectOnVector(s),r.add(t)}var u_=class extends Pe{constructor(e=.5,t=1,i=4,r=1,s=!1,o=0,n=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),n=Math.floor(n);let h=[],a=[],c=[],u=[],l=0,d=t/2,p=Math.PI/i,f=e*Math.cos(Math.PI/i),v=2*Math.PI/i,g=(i-2)*Math.PI/i,m=Math.PI-g,y=new T(0,-d,0),w=new T(0,d,0),x=new X(e,-d),S=new X(f,-d),b=new X(0,w.y).sub(S),A=new X(0,w.y).sub(x),O=new X(b.y,-b.x).normalize(),P=new X(A.y,-A.x).normalize(),_=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-b.angle())/2)-1e-8;o=Math.min(o,_);let C;{let $=new T(O.x,O.y,0),V=new T(Math.cos(v)*$.x,$.y,Math.sin(v)*$.x);C=$.angleTo(V)}let M=o/Math.tan((Math.PI-b.angle())/2),N=o/Math.tan((Math.PI-C)/2),W=new T;if(!s){a.push(y.x,y.y,y.z),c.push(0,-1,0),u.push(0,0);let $=l++,V=[],G=x.clone(),L=M/Math.cos(Math.PI/i);G.x-=L;for(let R=0;R<i;R++){let I=R/i*Math.PI*2+p,B=new X(Math.sin(I),Math.cos(I));Mr(G,B,W),a.push(W.x,W.y,W.z),c.push(0,-1,0),u.push(0,0),V.push(l++)}for(let R=0;R<V.length;R++)h.push(V[R],$,V[(R+1)%V.length])}{let $=new T,V=new T,G=new T,L=new T,R=new T,I=new T;for(let B=0;B<i;B++){let z=B/i*Math.PI*2+p,q=(B+.5)/i*Math.PI*2+p,U=(B+1)/i*Math.PI*2+p,F=new X(Math.sin(z),Math.cos(z)),H=new X(Math.sin(q),Math.cos(q)),k=new X(Math.sin(U),Math.cos(U));Mr(x,F,V),Mr(x,k,G),Mr(O,H,$),en(w,V,G,N,N,L),a.push(L.x,L.y,L.z),en(V,w,G,N,M,R),a.push(R.x,R.y,R.z),en(G,V,w,M,N,I),a.push(I.x,I.y,I.z),c.push($.x,$.y,$.z),c.push($.x,$.y,$.z),c.push($.x,$.y,$.z),u.push(0,0),u.push(0,0),u.push(0,0);let Z=l++,J=l++,Y=l++;if(h.push(Z,J,Y),o>0){{let K=V.clone().add(G).multiplyScalar(.5),ue=w.clone().sub(K).normalize(),oe=y.clone().sub(K).normalize().add(ue).normalize().multiplyScalar(-1),le=I.clone().sub(R);Q(K,le,oe,b.angle())}let ee,te;{let K=new T;Mr(P,k,K);let ue=I.clone().add(L).multiplyScalar(.5);ue=d_(ue,G,w);let oe=I.clone().sub(L);[ee,te]=Q(ue,oe,K,C,L.y)}{let K=ee,ue=K.clone().setY(0).normalize(),oe=new T(0,-1,0),le=ue.clone().cross(oe);re(K,ue,oe,le)}{let K=b.angle(),ue=Math.PI-K,oe=w.clone();oe.y-=o/Math.sin(K-Math.PI/2);let le=new T,xe=[];for(let Oe=0;Oe<n;Oe++){let De=[],at=Math.PI/2-ue*Oe/n,Kt=Math.cos(at),lt=Math.sin(at),yr=q;for(let br=0;br<=Oe;br++){let Co=Math.cos(yr),xr=Math.sin(yr);$.x=Kt*xr,$.y=lt,$.z=Kt*Co,le.copy(oe).addScaledVector($,o),a.push(le.x,le.y,le.z),c.push($.x,$.y,$.z),u.push(0,0),De.push(l++),yr+=Math.PI*2/Oe/i}xe.push(De)}te.reverse(),xe.push(te);let ve=xe.length-1;for(let Oe=0;Oe<ve;Oe++){let De=xe[Oe],at=xe[Oe+1],Kt=De.length-1;h.push(at[1],De[0],at[0]);for(let lt=1;lt<=Kt;lt++)h.push(De[lt],De[lt-1],at[lt]),h.push(at[lt+1],De[lt],at[lt])}}}}}this.setIndex(h),this.setAttribute("position",new ge(a,3)),this.setAttribute("normal",new ge(c,3)),this.setAttribute("uv",new ge(u,2));function Q($,V,G,L,R){let I=-L/2,B=(Math.PI-L)/2,z=V.clone().normalize().cross(G);$.addScaledVector(G,-o/Math.sin(B));let q=new T,U=new T,F=1,H=l,k=[];for(let Z=0;Z<=n;Z++){let J=I+Z/n*L;U.set(0,0,0),U.addScaledVector(z,Math.sin(J)),U.addScaledVector(G,Math.cos(J));for(let Y=0;Y<=F;Y++){let ee=Y/F-.5;if(q.copy($),q.addScaledVector(V,ee),q.addScaledVector(U,o),R!=null){let te=Math.max(0,q.y-R);q.addScaledVector(V,-te/V.y)}a.push(q.x,q.y,q.z),c.push(U.x,U.y,U.z),u.push(0,0),Y===0&&k.push(l),l++}}for(let Z=0;Z<n;Z++)for(let J=0;J<F;J++){let Y=H+J+(F+1)*Z,ee=Y+(F+1),te=ee+1,K=Y+1;h.push(Y,ee,K),h.push(ee,te,K)}return[$.clone().addScaledVector(V,.5),k]}function re($,V,G,L){let R=Math.PI/2,I=A.angle()-R,B=[],z=new T,q=new T;for(let F=0;F<=n;F++){let H=[],k=F/n;for(let Z=0;Z<=F;Z++){let J=((F?Z/F:0)-.5)*m,Y=Math.cos(J),ee=Math.sin(J),te=Math.atan(Math.tan(I)*Y),K=(R+te)*k,ue=Math.cos(K),oe=Math.sin(K);z.set(0,0,0),z.addScaledVector(V,oe*Y),z.addScaledVector(G,ue),z.addScaledVector(L,oe*ee),q.copy($).addScaledVector(z,o),a.push(q.x,q.y,q.z),c.push(z.x,z.y,z.z),u.push(0,0),H.push(l++)}B.push(H)}let U=B.length-1;for(let F=0;F<U;F++){let H=B[F],k=B[F+1],Z=H.length-1;h.push(H[0],k[1],k[0]);for(let J=1;J<=Z;J++)h.push(H[J-1],H[J],k[J]),h.push(H[J],k[J+1],k[J])}}}},Zd=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),r=Object.assign((t==null?void 0:t.ui)??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof Be?e.shape:new Be,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(e){let t=e.shape,{width:i,height:r,cornerRadius:s,cornerType:o,depth:n,extrudeBevelSize:h,extrudeBevelSegments:a}=e.parameters,c={x:i*.5,y:r*.5},u={x:-c.x,y:-c.y},l={x:c.x,y:c.y};function d(x,S,b){return S>i&&b>r?Math.min(x*i/S,x*r/b):S>i?x*i/S:b>r?x*r/b:x}let p=[];p[0]=s[0]===0?0:d(s[0],s[0]+s[3],s[0]+s[1]),p[1]=s[1]===0?0:d(s[1],s[1]+s[2],s[1]+s[0]),p[2]=s[2]===0?0:d(s[2],s[2]+s[1],s[2]+s[3]),p[3]=s[3]===0?0:d(s[3],s[3]+s[0],s[3]+s[2]);let f=u.x,v=l.x,g=l.y,m=u.y;t.addPoint(t.createPoint(f,g)),t.addPoint(t.createPoint(v,g)),t.addPoint(t.createPoint(v,m)),t.addPoint(t.createPoint(f,m)),t.isClosed=!0;let y=!0;for(let x=0,S=t.points.length;x<S;x++)t.points[x].roundness=p[x],x>0&&p[x]!==p[x-1]&&(y=!1);y&&(t.roundness=p[0]),t.useCubicForRoundedCorners=o!==1,t.update();let w=Bi.create({shape:t,parameters:{depth:n,extrudeBevelSize:h,extrudeBevelSegments:a}});return Object.assign(w,{userData:{...e,type:"RectangleGeometry"}})}},p_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t=100,height:i=t,depth:r=t,widthSegments:s=64,heightSegments:o=64,phiStart:n,phiLength:h,thetaStart:a,thetaLength:c}=e.parameters,u=new kp(.5*t,s,o,n,h,a,c);return u.scale(1,i/t,r/t),Object.assign(u,{userData:{...e,type:"SphereGeometry"}})}},f_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:r=8,heightSegments:s=8}=e.parameters,o=new Cc(t,i,r,s);return o.scale(1,1,1),Object.assign(o,{userData:{...e,type:"PlaneGeometry"}})}},m_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,angle:s,cornerRadius:o,cornerSegments:n}=e.parameters,h=new g_(t,i,r,s,o,n);return Object.assign(h,{userData:{...e,type:"BackdropGeometry"}})}},g_=class extends Pe{constructor(e=1,t=1,i=1,r=90,s=10,o=24){super(),this.type="BackdropGeometry";let n=[],h=[],a=[],c=.001;s==0&&(o=1),o=Math.max(1,Math.floor(o)),s=Math.min(s,100),r=Math.min(180-c,r),r*=Math.PI/180;let u=[],l=Math.PI/2,d=(F=0,H=0,k=0)=>new T(F,H,k),p=d(),f=d(),[v,g,m]=[t/2,e/2,i/2],y=-g,w=+g,[x,S,b]=[d(y,-v,+m),d(y,-v,-m),d(y,+v,-m)],A=(F,H=!1)=>Math.sin(F-Math.PI/(1+ +H)),O=(F,H=!1)=>Math.cos(F-Math.PI/(1+ +H));b.y=Math.sin(r)*t-v;let P=Math.cos(r)*t-m,_=x.z-c;r<=l?(b.z=Math.min(P,_),b.z==_&&(b.y-=(P-_)/Math.tan(l-r))):S.z=Math.min(S.z-P-m,x.z-c),p.subVectors(x,S),f.subVectors(b,S);let C=Math.min(p.length(),f.length())*s/100,M=C*Math.tan(r/2),N=C/Math.cos(r/2),W=p.clone().normalize().add(f.normalize()).setLength(N).add(S);p.set(0,A(r,!0),O(r,!0)),u.push([b,p.clone()]);let Q=(Math.PI-r)/o;for(let F=0;F<=o;F++){let H=l+r+F*Q;p.set(0,Math.sin(H)*M,Math.cos(H)*M),p.add(W),f.set(0,A(H),O(H)),u.push([p.clone(),f.clone()])}u.push([x,d(0,1,0)]);let re=Math.sin(Q/2)*M*2,$=u.length-1,V=u[0][0].distanceTo(u[1][0]),G=u[$-1][0].distanceTo(u[$][0]),L=V+re*o+G;u[0].push(1);for(let F=0;F<=o;F++)u[F+1].push(1-(V+F*re)/L);u[$].push(0);let[R,I,B]=u[0],z,q,U;for(let F=1;F<u.length;F++)[z,q,U]=u[F],n.push(y,R.y,R.z,y,z.y,z.z,w,R.y,R.z,w,R.y,R.z,y,z.y,z.z,w,z.y,z.z),h.push(0,I.y,I.z,0,q.y,q.z,0,I.y,I.z,0,I.y,I.z,0,q.y,q.z,0,q.y,q.z),a.push(0,B,0,U,1,B,1,B,0,U,1,U),[R,I,B]=[z,q,U];this.setAttribute("position",new ge(n,3)),this.setAttribute("normal",new ge(h,3)),this.setAttribute("uv",new ge(a,2))}},Kd=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof Be?e.shape:new Be,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:r,spikes:s,cornerRadius:o,angle:n,depth:h,extrudeBevelSize:a,extrudeBevelSegments:c}=e.parameters,u=e.shape,l=t*.5,d=i*.5,p=0,f=0,v=n*Math.PI/360/s,g=Math.PI/2*3*-1,m=l*r/100,y=d*r/100;if(s===3&&r===50){v=2*Math.PI/s;for(let x=0;x<s;x++){let S=v*x,b=p+Math.sin(S)*l,A=f+Math.cos(S)*d;u.addPoint(u.createPoint(b,A))}}else for(let x=0;x<s;x++){let S=p+Math.cos(g)*l,b=f+Math.sin(g)*d;u.addPoint(u.createPoint(S,b)),g+=v,S=p+Math.cos(g)*m,b=f+Math.sin(g)*y,u.addPoint(u.createPoint(S,b)),g+=v}u.isClosed=!0;for(let x=0,S=u.points.length;x<S;x++)u.points[x].roundness=o;u.roundness=o,u.update();let w=Bi.create({shape:u,parameters:{roundness:o,depth:h,extrudeBevelSize:a,extrudeBevelSegments:c}});return Object.assign(w,{userData:{...e,type:"StarGeometry"}})}},v_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,r=new Cc(t,i);return Object.assign(r,{userData:{...e,type:"TextFrameGeometry"}})}},y_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:Math.PI*2,cornerRadius:30,cornerSegments:8},e.parameters),r=Math.abs(i.width),s=Math.abs(i.height??i.width),o=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:s,depth:o})}}static build(e){let{width:t,height:i,depth:r,radialSegments:s,tubularSegments:o,arc:n,cornerRadius:h,cornerSegments:a}=e.parameters,c=b_(t,i,r,t*.5,n,o,0,0,s,h,a);return c.scale(1,i/t,1),Object.assign(c,{userData:{...e,type:"TorusGeometry"}})}};function b_(e,t,i,r,s,o,n,h,a,c,u){return[t,i]=[i,t],n=t/2,s/=2*Math.PI,s==1&&(c=0),new $d(!0,e,t,i,r,s,o,n,h,a,c,u)}var x_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(e){let{width:t,tube:i,tubularSegments:r,radialSegments:s,p:o,q:n}=e.parameters,h=t*.5;h!==i&&(h-=i);let a=new Fp(h,i,r,s,o,n);return Object.assign(a,{userData:{...e,type:"TorusKnotGeometry"}})}},w_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof Be?e.shape:new Be,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:r,depth:s,extrudeBevelSize:o,extrudeBevelSegments:n,isRect:h}=e.parameters,a=e.shape,c=t*.5,u=i*.5;h?(a.addPoint(a.createPoint(-c,u)),a.addPoint(a.createPoint(c,-u)),a.addPoint(a.createPoint(-c,-u))):(a.addPoint(a.createPoint(0,u)),a.addPoint(a.createPoint(c,-u)),a.addPoint(a.createPoint(-c,-u))),a.isClosed=!0;for(let d=0,p=a.points.length;d<p;d++)a.points[d].roundness=r;a.roundness=r,a.update();let l=Bi.create({shape:a,parameters:{roundness:r,depth:s,extrudeBevelSize:o,extrudeBevelSegments:n}});return Object.assign(l,{userData:{...e,type:"TriangleGeometry"}})}};function __(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}function S_(e,t,i){let r=[new T,new T,new T],s=[new T,new T,new T];return e.extractBasis(r[0],r[1],r[2]),t.extractBasis(s[0],s[1],s[2]),r.forEach((o,n)=>{let h=s[n],a=Ue.lerp(o.length(),h.length(),i);o.lerp(h,i).setLength(a)}),new me().makeBasis(r[0],r[1],r[2])}var A_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),r=Math.abs(i.width),s=Math.abs(i.height??i.width),o=Math.abs(i.depth??0),n=(t==null?void 0:t.shapeData)??Na.create({parameters:Zc}).userData.shape;return{path:e.path??Xs.defaultData(),parameters:Object.assign(i,{width:r,height:s,depth:o,extrusion:{...Kc,...i.extrusion}}),shapeData:n}}static build(e){if(e.path.points.length>=2){let t=new O_(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}else return Object.assign(new Pe,{userData:{...e,type:"PathGeometry"}})}},O_=class extends Pe{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!__(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:r}=this.inputs.parameters.extrusion,s=this.inputs.path.isClosed?e.length:e.length-1,o=Math.floor(r*s),n=this.inputs.path.isClosed?Math.ceil((i+r)*s):Math.ceil(Math.min(1,i+r)*s),h=Math.min(Math.max(2,n-o+1),s+2),a=[],c=[];for(let _=0;_<h;_++){let C=this.inputs.path.isClosed?(_+o)%e.length:Math.min(_+o,e.length-1);a.push(e[C].clone()),c.push(t[C].clone())}let u=(_,C,M)=>{a[_]=a[_].clone().lerp(a[C],M),c[_]=S_(c[_],c[C],M)},l=0,d=r*s%1;(!this.inputs.path.isClosed||i<=1)&&(d||r===0)&&(l=d,u(0,1,l));let p=0,f=(r+i)*s%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&f&&(p=f,u(a.length-1,a.length-2,1-p)),i===0){let _=a.length-1;a[_].copy(a[0]),c[_].copy(c[0])}this._applyPathModifiers(c,l,p);let{regions:v,infos:g,vertices:m}=this._computeShapePoints(5),y=0,w=0;g.sort((_,C)=>_.start-C.start),g.forEach(_=>{_.verticesStart=y,_.verticesCount=_.continuous.reduce((C,M,N)=>C+(N===0||!M?2:1),0),w+=_.verticesCount,y=w});let x=w*h,S,b=0;if(this._isOpenEnded()){try{S=ni({windingRule:Se.ODD,elementType:Fe.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:v})}catch{S=Rd}b=S.vertexCount}let A=x+2*b,O={positions:new Float32Array(A*3),normals:new Float32Array(A*3),uvs:new Float32Array(A*2)},P=[];g.forEach(_=>{this._extrudeRegion(_,m,c,a,O,P,this._isGeometryClosed()&&!this._isOpenEnded())}),S&&(this._closeEnd(S,x,P,O,c[0],a[0],!1),this._closeEnd(S,x+b,P,O,c[c.length-1],a[a.length-1],!0)),this.setAttribute("position",new ze(O.positions,3)),this.setAttribute("normal",new ze(O.normals,3)),this.setAttribute("uv",new ze(O.uvs,2)),this.setIndex(P)}_extractPathPoints(){let e=Ed(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,r=this.inputs.path.isClosed,s=new T,o=new T,n=new T,h=new T,a=new T(0,1,0);for(let f=0;f<i;f++){let v=e[f],g;f===0?g=r?e[e.length-2]:v.clone().multiplyScalar(2).sub(e[1]):g=e[f-1];let m;f===i-1?m=r?e[1]:v.clone().multiplyScalar(2).sub(e[f-1]):m=e[f+1];let y=v.clone().sub(g).normalize(),w=m.clone().sub(v).normalize(),x=y.clone().add(w).normalize();n.copy(x),f===0&&(x.equals(a)||x.clone().negate().equals(a))&&a.set(0,0,1);let S=a.clone().cross(x).normalize(),b=x.clone().cross(S).normalize();a.copy(b),h.copy(S),f===0&&(s.copy(b),o.copy(x));let A=new me().makeBasis(S,b,x);t.push(A)}let c=r?o:n,u=r?s:new T(0,1,0),l=c.clone().cross(h).normalize(),d=Math.acos(u.dot(l));if(isNaN(d))return t;let p=u.clone().cross(l);c.dot(p)>0&&(d*=-1);for(let f=1;f<t.length;f++){let v=new me().makeRotationZ(d*f/t.length);t[f].multiply(v)}return t}_applyPathModifiers(e,t,i){let r=e.length,{angle:s,twist:o,startScale:n,endScale:h}=this.inputs.parameters.extrusion,a=new me,c=new me;return e.forEach((u,l)=>{let d=l===0?0:l===r-1?1:(l-t)/(r-(i===0?0:1)-(t+(1-i)));a.makeRotationZ(Ue.lerp(s,s+o,d));let p=Ue.lerp(n,h,d);c.makeScale(p,p,p),u.multiply(a).multiply(c)}),e}_computeShapePoints(e=12,t=Se.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],e),s=i.shapeHoles.map(c=>{let u=c.extractShapePointsToFlatArray([],e),l=[];for(let d=u.length-1;d>=1;d-=2){let p=u[d-1],f=u[d-0];l.push(p,f)}return l}),o;try{o=ni({windingRule:t,elementType:Fe.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{o=za}let n;try{n=ni({windingRule:Se.ODD,elementType:Fe.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...s]})}catch{n=Ud}if(!o)throw new Error("error generating geometry");let h=o.elementCount;if(n){o.elementCount+=n.elementCount;for(let c=0;c<n.elements.length;c++){let u=n.elements[c],l=c%2===0?o.vertexCount:0;o.elements.push(u+l)}for(let c=0;c<n.vertexIndices.length;c++){let u=n.vertexIndices[c],l=o.vertexCount;o.vertexIndices.push(u+l)}for(let c=0;c<n.vertices.length;c++){let u=n.vertices[c];o.vertices.push(u)}}for(let c=0,u=o.vertexCount;c<u;c++){let l=c*2;o.vertices[l+0],o.vertices[l+1]}let a=[];for(let c=o.elementCount-1;c>=0;c--){let u=c>=h,l=c*2,d=o.elements[l+0],p=o.elements[l+1],f=d+p,v={start:d,count:p,normals:[],isHole:u,continuous:[],verticesStart:0,verticesCount:0};a.push(v);let g=d,m=f-1,y=d+1,w=i.roundedCurves.length;do{let x=g-d;o.vertices[m*2+0],o.vertices[m*2+1];let S=o.vertices[g*2+0],b=o.vertices[g*2+1],A=o.vertices[y*2+0],O=o.vertices[y*2+1],P=S-A,_=b-O,C=Math.sqrt(P*P+_*_);P/=C,_/=C,v.normals[x*2+0]=-_,v.normals[x*2+1]=P;let M=o.vertexIndices[g];if(Array.isArray(M))v.continuous[x]=!1;else{let[N,W]=i.getCurveIndexFromVertexId(M-1,!0);if(W>0&&W<1)v.continuous[x]=!0;else{let Q=W===1?N+1:N-1;Q=(Q+w)%w;let re=W===1?0:1,$=i.roundedCurves[N].getTangent(W),V=i.roundedCurves[Q].getTangent(re);v.continuous[x]=$.dot(V)>.95}}u&&(v.normals[x*2+0]*=-1,v.normals[x*2+1]*=-1),[m,g,y]=[g,y,y+1],y>=f&&(y-=p)}while(y!==d+1)}return{regions:[r,...s],infos:a,vertices:o.vertices}}_insertVertex(e,t,i,r,s){let o=t*2,n=t*3;e.positions[n+0]=i.x,e.positions[n+1]=i.y,e.positions[n+2]=i.z,e.normals[n+0]=r.x,e.normals[n+1]=r.y,e.normals[n+2]=r.z,e.uvs[o+0]=s.x,e.uvs[o+1]=s.y}_extrudeRegion(e,t,i,r,s,o,n){let h=new T,a=new T,c=new T,u=new T,l=new X;i.forEach((p,f)=>{let v=r[f],g=e.verticesStart*i.length+e.verticesCount*f;for(let m=0;m<e.count;m++){let y=(e.start+m)*2;if(h.set(t[y+0],t[y+1],0),c.copy(h).applyMatrix4(p).add(v),e.continuous[m])u.set(e.normals[m*2+0],e.normals[m*2+1],0);else{let w=m==0?(e.start+e.count-1)*2:y-2;a.set(t[w+0],t[w+1],0),u.copy(h).sub(a),u.set(-u.y,u.x,0),e.isHole||u.negate()}if(u.applyMatrix4(p).normalize(),l.set(m===0?1:m/e.count,f/(i.length-1)),this._insertVertex(s,g,c,u,l),g++,!e.continuous[m]||m===0){if(m===0)u.set(e.normals[m*2+0],e.normals[m*2+1],0),l.set(0,f/(i.length-1));else{let w=m===e.count-1?e.start*2:y+2;a.set(t[w+0],t[w+1],0),u.copy(a).sub(h),u.set(-u.y,u.x,0),e.isHole||u.negate()}u.applyMatrix4(p).normalize(),this._insertVertex(s,g,c,u,l),g++}}});let d=i.length-1;for(let p=0;p<d;p++){let f=e.verticesStart*i.length+e.verticesCount*p,v=e.verticesStart*i.length+e.verticesCount*(p+1),g=0;for(let m=0;m<e.count;m++){(!e.continuous[m]||m===0)&&g++;let y=m===e.count-1?0:g+1,w=f+g,x=f+y,S=v+y,b=v+g;e.isHole?o.push(w,S,x,w,b,S):o.push(w,x,S,w,S,b),g++}}}_closeEnd(e,t,i,r,s,o,n){let h=e.vertexCount,a=new T(0,0,n?-1:1).applyMatrix4(s),c=new T,u=new X;for(let d=0;d<h;d++){let p=2*d;c.set(e.vertices[p+0],e.vertices[p+1],0).applyMatrix4(s).add(o),this._insertVertex(r,t+d,c,a,u)}let l=e.elements;for(let d=0;d<e.elementCount;d++){let p=3*d,f=l[p+0]+t,v=l[p+(n?1:2)]+t,g=l[p+(n?2:1)]+t;i.push(f,v,g)}}};function Qd(){let e=new Pe;return e.setAttribute("position",new ze(new Float32Array([]),3)),e.setIndex(new ze(new Uint16Array([]),1)),e}var C_=Qd().attributes,P_=12,T_=1,Jd=class extends Pe{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,C_),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i!=null&&i.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t==null||t.requestRender()})}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!(t!=null&&t.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:s,extrudeBevelSize:o,extrudeBevelSegments:n,text:h,textTransform:a}=e,c=a===2?h.toUpperCase():a===3?h.toLowerCase():h,u=M_(e,t,c),{shapes:l,charWidths:d,charCoords:p}=t.generateShapes(u,e),f=i*.5,v=r*.5,g=l.map(w=>new Be().fromShape(w));this.vectorShapes=g;let m=g.map(w=>Bi.create({shape:w,parameters:{depth:s,extrudeBevelSegments:n,extrudeBevelSize:o,windingRule:s<=0?Se.NONZERO:Se.ODD,subdivisions:this.isLowResolution&&s>0?T_:P_}})),y=m.length?Mc(m):Qd();y.translate(-f,v,0),this.dispose(),this.wrappedText=u,this.charCoords=p,this.charWidths=d,this.deleteAttribute("extrudeNormal"),Object.entries(y.attributes).forEach(([w,x])=>{this.setAttribute(w,x)}),this.setIndex(y.index),this.computeBoundingSphere()}clone(){let e=nr(new Pe,Jd.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:e})}get text(){return this.userData.parameters.text??""}};function M_(e,t,i){i=i??e.text;let r=[""],s="";for(let o of i)s+=o,o===" "||o===`
`?(r[r.length-1]+=s,s="",o===`
`&&r.push("")):t.getTextWidth(r[r.length-1]+s,e)>e.width&&(r[r.length-1].length&&r.push(""),t.getTextWidth(r[r.length-1]+s,e)>e.width&&(s.length===1?(r[r.length-1]+=s,s=""):(r[r.length-1]+=s.slice(0,-1),s=s[s.length-1],r.push(""))));return r[r.length-1]+=s,r}var eu,Ba=new Promise(e=>{eu=e}),Ah=!1;async function E_(){if(Ah)return;let e="https://unpkg.com/@splinetool/modelling-wasm@0.9.339/build",[t,i]=await Promise.all([Tc(()=>import("../chunks/process.10f79362.js"),[],import.meta.url),fetch(`${e}/process.wasm`).then(o=>o.arrayBuffer())]),r=t.default,s=await r({wasmBinary:i});eu(s),Ah=!0}function ao(e,t,i){let r={parameters:e,type:e.type};if(e.type==="PathGeometry")r.path=e.path;else if(e.type==="VectorGeometry"){let o=Be.createFromState(e.shape,e.width,e.height);r.shape=o}else if(e.type==="NonParametricGeometry")e.data.groups&&e.data.groups.forEach(o=>o.materialIndex=Math.max(o.materialIndex??0,0)),r.geometry=new wc().parse(e);else{if(e.type==="SubdivGeometry")return new Ye(e,i);if(e.type==="TextGeometry")return new Jd(e,t)}let s;try{s=Mh(r)}catch(o){console.error(o)}if(!s){let o=Be.createFromState($s.defaultData(),100,100);r.shape=o,s=Mh(r)}return s}var D_=new me;function $n(e,t,i,r){let s=e.position.array,o=e.normal.array,n=D_.makeScale(t,i,r).invert().elements,h,a,c;for(var u=0,l=s.length;u<l;u+=3)s[u]*=t,s[u+1]*=i,s[u+2]*=r,h=o[u],a=o[u+1],c=o[u+2],o[u]=n[0]*h+n[4]*a+n[8]*c,o[u+1]=n[1]*h+n[5]*a+n[9]*c,o[u+2]=n[2]*h+n[6]*a+n[10]*c;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var fs=new Li,Ui=new T,he;Ba.then(e=>{he=e});var Oh=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),Ch=new Uint32Array([0,1,2,3]),Ph=new Uint8Array([4]),Ye=class extends Pe{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,r=Wi.div(t,i);this.subdividedGeometry&&$n(this.subdividedGeometry.attributes,...r),this.originalGeometry&&$n(this.originalGeometry.attributes,...r),this.data=e;let s=this.userData.parameters;this.userData.parameters={width:s.width*r[0],height:s.height*r[1],depth:s.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(Ui.fromArray(r));let o=Ui.set(s.width,s.height,s.depth).length();this.originalGeometry.boundingSphere.radius=o/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=Ye.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new Mi(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(Ye.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new tr,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;fs.setFromBufferAttribute(t),fs.getCenter(i),e.boundingSphere.radius=i.distanceTo(fs.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),fs.getSize(Ui);let r={width:Ui.x,height:Ui.y,depth:Ui.z};return this.userData.parameters=r,r}static build(e,t,i,r){let s,o,n,h=(e==null?void 0:e.phongAngle)??35;i===!1&&(h=-1),t&&(he.free_bvh(t),he.free_subdivision_surface(t));try{s=Ye.allocate(e,r)}catch(a){console.error(a,e),s=Ye.allocate({positionWASM:Oh,indexWASM:Ch,verticesPerFaceWASM:Ph},r)}if(he.set_destination_refinement_level(s,0),o=Ye.buildLevel(s,!0,h),e.subdivisions>0)try{he.set_destination_refinement_level(s,e.subdivisions),n=Ye.buildLevel(s,!1,h)}catch{try{he.set_destination_refinement_level(s,e.subdivisions-1),n=Ye.buildLevel(s,!1,h)}catch{n=null}}else n=null;return{subdivPointer:s,originalGeometry:o,subdividedGeometry:n}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let r=e.shape!==void 0?t.geometry:ao(e,i,!1),s,o,n,h;({positions:s,triIndices:h}=tu(r.getAttribute("position"),r.getIndex()));let a;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let c=e.radialSegments*e.heightSegments*3*2,u=c+e.radialSegments*3;a=[c,u]}return{indices:o,verticesPerFace:n}=iu(s,h,r,a),{positions:s,indices:o,verticesPerFace:n}}static allocate(e,t){var w;let i,r,s,o=[],n=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,r=e.indexWASM,s=e.verticesPerFaceWASM):(i=Oh,r=Ch,s=Ph);let h=i.length,a=r.length,c=s.length,u=i.length+o.length+n.length,l=r.length+s.length,d=u*Float32Array.BYTES_PER_ELEMENT+l*Uint32Array.BYTES_PER_ELEMENT,p=u*Float32Array.BYTES_PER_ELEMENT,f=he._malloc(d),v=new Float32Array(he.HEAPF32.buffer,f,u),g=new Uint32Array(he.HEAPU32.buffer,f+p,l);v.set(i,0),v.set(o,i.length),v.set(n,i.length+o.length),g.set(r,0),g.set(s,r.length);let m;(w=e==null?void 0:e.scaleBaked)!=null&&w.some(x=>x!==1)&&(m=new me().makeScale(...e.scaleBaked)),t&&(m?m.premultiply(t):m=t);let y=m?he.alloc_subdivision_surface2(f,h,f+p,a,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c,m.elements):he.alloc_subdivision_surface(f,h,f+p,a,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c);return he._free(f),y}static buildLevel(e,t,i,r,s){let o=s?he.get_mesh_data2(e,t?he.Level.CONTROL:he.Level.REFINED,i,s.elements):he.get_mesh_data(e,t?he.Level.CONTROL:he.Level.REFINED,i),n=8,h=he.HEAPU32.subarray(o>>2,(o>>2)+n),a=h.subarray(4,4+4),c=0,u=he.HEAPU32[h[c]>>2],l=he.HEAPF32.subarray(u>>2,(u>>2)+a[c]);c++;let d=he.HEAPU32[h[c]>>2],p=he.HEAPF32.subarray(d>>2,(d>>2)+a[c]);c++;let f=he.HEAPU32[h[c]>>2],v=he.HEAPU32.subarray(f>>2,(f>>2)+a[c]);c++;let g=he.HEAPU32[h[c]>>2],m=he.HEAPU32.subarray(g>>2,(g>>2)+a[c]);if(c++,r===void 0){let y=new Pe;if(y.setIndex(new Lo(m,1)),y.setAttribute("position",new ge(l,3)),y.setAttribute("normal",new ge(p,3)),t){y.setAttribute("faceMap",new Lo(v,1));let w=new Float32Array(p.length/3*4).fill(0);y.setAttribute("color",new ze(w,4))}return he.free_mesh_data(o),y.userData.type="SubdivGeometry",y}r.getAttribute("position").copyArray(l),r.getAttribute("normal").copyArray(p),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,he.free_mesh_data(o)}static freeSubdivPointer(e){he.free_bvh(e),he.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let r=he.get_wireframe_data_for_base_level(e),s=4,o=he.HEAPU32.subarray(r>>2,(r>>2)+s),n=o.subarray(2,2+2),h=0,a=he.HEAPU32[o[h]>>2],c=he.HEAPF32.subarray(a>>2,(a>>2)+n[h]);h++;let u=he.HEAPU32[o[h]>>2],l=he.HEAPU32.subarray(u>>2,(u>>2)+n[h]);if(t===void 0){let d=new Pe;d.setAttribute("position",new ge(c,3));let p=new Float32Array(c.length);for(let f=0,v=c.length;f<v;)p[f++]=i.r,p[f++]=i.g,p[f++]=i.b;return d.setAttribute("color",new ze(p,3)),d.setIndex(new Lo(l,1)),he.free_wireframe_data_for_base_level(r),d}t.getAttribute("position").copyArray(c),t.attributes.position.needsUpdate=!0,he.free_wireframe_data_for_base_level(r)}static updateCollabMesh(e,t,i){let r=t===0;r||he.set_destination_refinement_level(e,t);let s=i?he.get_topological_data2(e,r?he.Level.CONTROL:he.Level.REFINED,i.elements):he.get_topological_data(e,r?he.Level.CONTROL:he.Level.REFINED),o=6,n=he.HEAPU32.subarray(s>>2,(s>>2)+o),h=n.subarray(3,3+3),a=0,c=he.HEAPU32[n[a]>>2],u=new Float32Array(he.HEAPF32.subarray(c>>2,(c>>2)+h[a]));a++;let l=he.HEAPU32[n[a]>>2],d=new Uint32Array(he.HEAPU32.subarray(l>>2,(l>>2)+h[a]));a++;let p=he.HEAPU32[n[a]>>2],f=new Uint8Array(he.HEAPU32.subarray(p>>2,(p>>2)+h[a]));return he.free_topological_data(s),{positions:u,indices:d,verticesPerFace:f}}},Th=["getX","getY","getZ"];function tu(e,t){let i={},r=t?t.count:e.count,s=0,o=[],n=[],h=1e4;for(let c=0;c<r;c++){let u=t?t.getX(c):c,l="";for(let d=0;d<3;d++)l+=`${~~(e[Th[d]](u)*h)},`;if(l in i)o.push(i[l]);else{for(let d=0;d<3;d++)n.push(e[Th[d]](u));i[l]=s,o.push(s),s++}}let a=[];for(let c=0;c<o.length;c+=3)o[c]===o[c+1]||o[c]===o[c+2]||o[c+1]===o[c+2]||a.push(o[c],o[c+1],o[c+2]);return{positions:n,triIndices:a}}var ms=new T,tn=new T,rn=new T,sn=new T;function iu(e,t,i,r){let s=[],o=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let n=i.userData.shape.extractShapePointsToFlatArray([]),h=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&h<=24&&h%4===0&&i.userData.parameters.angle>=360){let u=n.length/2/h;n=n.filter((l,d)=>Math.floor(d/2)%u===0)}let a=0;for(let u=0;u<n.length;u+=2)a+=(n[u]-n[(u===0?n.length:u)-2])*(n[u+1]+n[(u===0?n.length:u)-1]);e.length=0;let c=0;if(a<0)for(let u=0;u<n.length;u+=2)e.push(n[u],n[u+1],0),s.push(c++);else for(let u=n.length-2;u>=0;u-=2)e.push(n[u],n[u+1],0),s.push(c++);return o.push(c),{indices:s,verticesPerFace:o}}for(let n=0,h=i.capStartIndex??t.length;n<h;)if(t[n+1]===t[n+3]&&t[n+2]===t[n+5]||t[n+0]===t[n+3]&&t[n+2]===t[n+4]){ms.set(e[t[n]*3],e[t[n]*3+1],e[t[n]*3+2]),tn.set(e[t[n+1]*3],e[t[n+1]*3+1],e[t[n+1]*3+2]),rn.set(e[t[n+4]*3],e[t[n+4]*3+1],e[t[n+4]*3+2]),sn.set(e[t[n+5]*3],e[t[n+5]*3+1],e[t[n+5]*3+2]),tn.sub(ms).normalize(),rn.sub(ms).normalize(),sn.sub(ms).normalize();let a=tn.cross(rn).dot(sn);Math.abs(a)>.005||r&&r.some((c,u)=>u%2===1?!1:n>=r[u]&&n<r[u+1])?(s.push(t[n],t[n+1],t[n+2]),o.push(3),n+=3):(s.push(t[n],t[n+1],t[n+4],t[n+5]),o.push(4),n+=6)}else s.push(t[n],t[n+1],t[n+2]),o.push(3),n+=3;if(i.capStartIndex!==void 0){let n=[],h=[],a=0,c=new Float32Array([i.userData.parameters.depth])[0];for(let u=0,l=0;u<e.length;u+=3,l++)e[u+2]===0&&(n.push(l),a++),e[u+2]===c&&h.push(l);if(i.userData.parameters.extrudeBevelSize===0){let u=h[0];h[0]=h[1],h[1]=u}n.reverse(),s.push(...n,...h),o.push(a,a)}return{indices:s,verticesPerFace:o}}var ei={};nf(ei,{calcBoolean:()=>N_,calcBooleanTopological:()=>z_,freeMeshSet:()=>U_,getMeshSet:()=>B_,transformMeshSet:()=>j_});var L_=new Promise(e=>{}),fe,Ki;L_.then(e=>fe=e);function I_(e,t,i){let r,{positions:s,triIndices:o}=tu(e.getAttribute("position"),e.getIndex()),n;if(t&&i){let{indices:h,verticesPerFace:a}=iu(s,o,e);n=a.length,r=[];for(let c=0,u=0;c<n;c++){r.push(a[c]);for(let l=0;l<a[c];l++)r.push(h[u++])}}else{let h=o.length;r=Array(h+h/3),n=0;for(let a=0,c=0;c<r.length;)r[c++]=3,n++,r[c++]=o[a++],r[c++]=o[a++],r[c++]=o[a++]}return{positions:s,faceIndices:r,nFaces:n}}function ru(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,r=t*Float32Array.BYTES_PER_ELEMENT,s=Number.isInteger(e[0])?i:r,o=fe._malloc(s);return(Number.isInteger(e[0])?new Uint32Array(fe.HEAPU32.buffer,o,t):new Float32Array(fe.HEAPF32.buffer,o,t)).set(e,0),o}function su(e){switch(e){case 0:return fe.OP.UNION;case 1:return fe.OP.INTERSECTION;case 2:return fe.OP.A_MINUS_B;case 3:return fe.OP.B_MINUS_A;case 4:return fe.OP.SYMMETRIC_DIFFERENCE;case 5:return fe.OP.ALL;default:throw new Error("Unknown boolean operation "+e)}}function z_(e,t){Ki===void 0&&(Ki=fe.init_csg());let i=ru(e),r=fe.csg_calc_topological(Ki,i,e.length,su(t));fe._free(i);let s=6,o=fe.HEAPU32.subarray(r>>2,(r>>2)+s),n=o.subarray(3,3+3),h=0,a=fe.HEAPU32[o[h]>>2],c=new Float32Array(fe.HEAPF32.subarray(a>>2,(a>>2)+n[h]));h++;let u=fe.HEAPU32[o[h]>>2],l=new Uint32Array(fe.HEAPU32.subarray(u>>2,(u>>2)+n[h]));h++;let d=fe.HEAPU32[o[h]>>2],p=new Uint8Array(fe.HEAPU32.subarray(d>>2,(d>>2)+n[h]));return fe.free_mesh_data(r),{positions:c,indices:l,verticesPerFace:p}}function N_(e,t,i,r){Ki===void 0&&(Ki=fe.init_csg());let s=ru(e),o=fe.csg_calc(Ki,s,e.length,r,su(t));fe._free(s);let n=5,h=fe.HEAPU32.subarray(o>>2,(o>>2)+n),a=h.subarray(2,2+3),c=0,u=fe.HEAPU32[h[c]>>2],l=fe.HEAPF32.subarray(u>>2,(u>>2)+a[c]);c++;let d=fe.HEAPU32[h[c]>>2],p=fe.HEAPF32.subarray(d>>2,(d>>2)+a[c]);c++;let f=a[c];i.setAttribute("position",new ge(l,3)),i.setAttribute("normal",new ge(p,3));let v=fe.HEAPF32.subarray((o>>2)+5,(o>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new tr),i.boundingSphere.center.set(v[0],v[1],v[2]),i.boundingSphere.radius=(v[3]**2+v[4]**2+v[5]**2)**.5,i.userData.parameters={width:v[3]*2,height:v[4]*2,depth:v[5]*2},fe.free_mesh_data(o),f}function B_(e,t,i){if(fe===void 0)return-1;let r,s,o;if(t&&e.userData.positions!==void 0){let v=e.userData;o=v.verticesPerFace.length,r=v.positions,s=Array(v.verticesPerFace.reduce((g,m)=>g+m,0)+o);for(let g=0,m=0,y=0;g<v.verticesPerFace.length;g++){s[y++]=v.verticesPerFace[g];for(let w=0;w<v.verticesPerFace[g];w++)s[y++]=v.indices[m++]}}else({positions:r,faceIndices:s,nFaces:o}=I_(e,t,i));let n=r.length,h=s.length,a=r.length,c=s.length,u=a*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,l=a*Float32Array.BYTES_PER_ELEMENT,d=fe._malloc(u),p=new Float32Array(fe.HEAPF32.buffer,d,a),f=new Uint32Array(fe.HEAPU32.buffer,d+l,c);return p.set(r,0),f.set(s,0),fe.get_csg_mesh(d,n,d+l,h,o)}function j_(e,t){fe.transform_csg_mesh(e,t.elements)}function U_(e){fe.free_csg_mesh(e)}var R_={ConeGeometry:xw,CubeGeometry:ww,CylinderGeometry:bw,DodecahedronGeometry:Sw,EllipseGeometry:Na,HelixGeometry:e_,IcosahedronGeometry:t_,LatheGeometry:i_,NonParametricGeometry:h_,PolygonGeometry:Yd,PyramidGeometry:c_,RectangleGeometry:Zd,SphereGeometry:p_,PlaneGeometry:f_,BackdropGeometry:m_,StarGeometry:Kd,TextFrameGeometry:v_,TorusGeometry:y_,TorusKnotGeometry:x_,TriangleGeometry:w_,PathGeometry:A_,VectorGeometry:Bi},Mh=e=>R_[e.type].create(e);function Er(e){return e!==null&&"booleanOp"in e}var ou=class extends Dd(Vp){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new me}updateVisible(){super.updateVisible(),this.visible=!Er(this.parent)&&this.visible,Er(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(ei.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),Er(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof ou&&(e.freeBooleanPointer(),Er(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e){let t=super.updateTransformState(e);return t&&Er(this.parent)&&this.invalidateDownstreamBooleanData(!0),t}},gs=new Li;function ja(e,t=0,i=e.count,r,s){let o=1/0,n=1/0,h=1/0,a=-1/0,c=-1/0,u=-1/0;for(let l=t;l<i;l++){let d=e.getX(l),p=e.getY(l),f=e.getZ(l);d<o&&(o=d),p<n&&(n=p),f<h&&(h=f),d>a&&(a=d),p>c&&(c=p),f>u&&(u=f)}gs.min.set(o,n,h),gs.max.set(a,c,u),gs.getCenter(r),gs.getSize(s).multiplyScalar(.5)}var k_=new Pe,F_=new vc,di=class extends ou{constructor(e,t){super(k_,F_),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?ja(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Eh=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},fi=class{constructor(e){this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=Ue.generateUUID(),this.type=e,this.name=""}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i??{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i??{},e.addFlow(i.slot,i.cache,i.context);let r={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),r}build(e,t,i){t=t??this.getType(e,t);let r=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,r,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,r,s,o){return""}generate(e,t,i,r,s){return""}parse(e,t,i,r){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let r=e.getTypeLength(i);(r>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=r,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}getHash(){let e="{",t,i;for(t in this)i=this[t],i instanceof fi&&(e+='"'+t+'":'+i.getHash()+",");if(this.hashProperties)for(let r=0;r<this.hashProperties.length;r++)t=this.hashProperties[r],i=this[t],e+='"'+t+'":"'+String(i)+'",';return e+='"id":"'+this.uuid+'"}',e}},V_=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=i!==void 0?i:!0,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},et=new V_,Te=class extends fi{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=t.shared!==void 0?t.shared:!0,this.unique=t.unique!==void 0?t.unique:!1}build(e,t,i,r){if(t=t??this.getType(e),this.getShared(e,t)){let s=this.getUnique(e,t);s&&this.uuid===void 0&&(this.uuid=Ue.generateUUID()),i=e.getUUID(i??this.getUUID(),!s);let o=e.getNodeData(i),n=o.output||this.getType(e);if(e.analyzing)return(o.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,o,t),this.generate(e,t,i)):super.build(e,t,i);if(s)return o.name=o.name||super.build(e,t,i),o.name;if(!this.getLabel()&&(!this.getShared(e,n)||e.context.ignoreCache||o.deps===1))return super.build(e,t,i);i=this.getUUID(!1);let h=this.getTemp(e,i);if(h)return e.format(h,n,t);{h=super.generate(e,t,i,o.output,r);let a=this.generate(e,n,i);return e.addNodeCode(h+" = "+a+";"),e.format(h,n,t)}}return super.build(e,t,i)}getShared(e,t){return t!=="sampler2D"&&t!=="samplerCube"&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return typeof this.scope=="string"&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,r,s){return this.getShared(e,t)||console.error("TempNode is not shared"),i=i??this.uuid,e.getTempVar(i,r??this.getType(e),s,this.getLabel()).name}},nt=class extends Te{constructor(e,t){t=t??{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,r,s,o){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let n=e.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,i,r,s,o):e.isShader("vertex")?(n.vertex||(n.vertex=e.createVertexUniform(r,this,s,o,this.getLabel())),e.format(n.vertex.name,r,t)):(n.fragment||(n.fragment=e.createFragmentUniform(r,this,s,o,this.getLabel())),e.format(n.fragment.name,r,t))}},ut=class extends nt{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof X?e:new X(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,r,s,o){return e.format("vec2("+this.value.x+", "+this.value.y+")",r,t)}},ct=class extends nt{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof T?e:new T(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,r,s,o){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,t)}},Ct=class extends yt{constructor(e,t,i,r){super(e,t,i),this.isColorA=!0,this.a=r}setRGBA(e,t,i,r){super.setRGB(e,t,i),this.a=r}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}setStyle(e,t="srgb"){let i;if(e==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let r,s=i[1],o=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.a=s==="rgba"?parseFloat(r[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.a=s==="hsla"?parseFloat(r[4]):1,super.setStyle(e,t);break}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},Si=class extends nt{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof Ct?e:new Ct(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,r,s,o){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,t)}},G_=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,Dh=/[a-z_0-9]+/gi,ne=class extends Te{constructor(e,t,i,r,s){super(s),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=s===void 0,this.isInterface=!1,this.parse(e,t,i,r)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,r,s){let o,n=0,h=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)e.include(this.includes[c],this);for(let c in this.extensions)e.extensions[c]=!0;let a=[];for(;o=Dh.exec(this.src);)a.push(o);for(let c=0;c<a.length;c++){let u=a[c],l=u[0],d=this.isMethod?!this.getInputByName(l):!0,p=l;if(this.keywords[l]||this.useKeywords&&d&&et.containsKeyword(l)){let f=this.keywords[l];if(!f){let v=et.getKeywordData(l);v.cache&&(f=e.keywords[l]),f=f||et.getKeyword(l,e),v.cache&&(e.keywords[l]=f)}p=f.build(e)}l!==p&&h[u.index+n-1]!=="."&&(h=h.substring(0,u.index+n)+p+h.substring(u.index+l.length+n),n+=p.length-l.length),this.getIncludeByName(p)===void 0&&et.contains(p)&&e.include(et.get(p))}return t==="source"?h:this.isMethod?(this.isInterface||e.include(this,void 0,h),this.name):e.format("( "+h+" )",this.getType(e),t)}parse(e,t,i,r){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let s=G_.exec(this.src);if(this.inputs=[],s&&s.length==4){this.type=s[1],this.name=s[2];let o=s[3].match(Dh);if(o){let n=0;for(;n<o.length;){let h=o[n++],a;h==="in"||h==="out"||h==="inout"?a=o[n++]:(a=h,h="");let c=o[n++];this.inputs.push({name:c,type:a,qualifier:h})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},H_=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,nu=class extends Te{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||nu.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,r,s){this.src=e||"";let o,n,h="",a=H_.exec(e);this.useDefine=s??this.src.charAt(0)==="#",a&&a.length>1?(n=a[1],o=a[2],h=a[3]):(o=this.src,n="f"),this.name=o,this.type=n,this.value=h}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,r,s){return e.format(this.name,this.getType(e),t)}},_e=nu;_e.PI="PI",_e.PI2="PI2",_e.RECIPROCAL_PI="RECIPROCAL_PI",_e.RECIPROCAL_PI2="RECIPROCAL_PI2",_e.LOG2="LOG2",_e.EPSILON="EPSILON";var W_=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),q_=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),au=class extends Te{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,r,s){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=W_.exec(e);if(t){let i=t[2],r;for(;r=q_.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name}},Ua=class extends Te{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(r,this.getType(e),t)}};et.addKeyword("uv",function(){return new Ua});et.addKeyword("uv2",function(){return new Ua(1)});var Fi=class extends Te{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??Fi.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case gn:return["Linear"];case _c:return["sRGB"];default:return[]}}generate(e,t){var n;let i=this.input.build(e,"v4"),r=this.getType(e),s=Fi.Nodes[this.method],o=e.include(s);if(o===Fi.LINEAR_TO_LINEAR)return e.format(i,r,t);if(((n=s.inputs)==null?void 0:n.length)===2){let h=this.factor.build(e,"f");return e.format(o+"( "+i+", "+h+" )",r,t)}else return e.format(o+"( "+i+" )",r,t)}fromEncoding(e){let t=Fi.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=Fi.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},jt=Fi;jt.Nodes={LinearToLinear:new ne(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new ne(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new ne(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},jt.LINEAR_TO_LINEAR="LinearToLinear",jt.SRGB_TO_LINEAR="sRGBToLinear",jt.LINEAR_TO_SRGB="LinearTosRGB";var Ie=class extends ne{constructor(e="",t,i,r,s){super(e,s,r,i,t),this.nodeType="Expression"}},ai=class extends nt{constructor(e=new bc,t,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new Ua,this.bias=i,this.project=r!==void 0?r:!1}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if(t==="sampler2D")return this.getTexture(e,t);let i=this.getTexture(e,t),r=this.uv.build(e,this.project?"v4":"v2"),s=this.bias?this.bias.build(e,"f"):void 0;s===void 0&&e.context.bias&&(s=e.context.bias.setTexture(this).build(e,"f"));let o,n;this.project?o="texture2DProj":o=s?"tex2DBias":"tex2D",s?n=o+"( "+i+", "+r+", "+s+" )":n=o+"( "+i+", "+r+" )";let h={include:e.isShader("vertex"),ignoreCache:!0},a=this.getType(e);return e.addContext(h),this.colorSpace=this.colorSpace??new jt(new Ie("",a)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(n),n=this.colorSpace.build(e,a),e.removeContext(),e.format(n,a,t)}},se=class extends nt{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,r,s,o){return e.format(this.value+(this.value%1?"":".0"),r,t)}},Lh=class extends Te{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,r,s){r=this.getType(e);let o=this.value,n=o.build(e,t)+"( ",h=[];if(o.inputs){for(let a=0;a<o.inputs.length;a++){let c=o.inputs[a],u=this.inputs[a]||this.inputs[c.name];h.push(u.build(e,e.getTypeByFormat(c.type)))}n+=h.join(", ")+" )"}return e.format(n,r,t)}},lu=class extends Te{constructor(e,t,i=lu.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let r=this.a.build(e,i),s=this.b.build(e,i);return e.format("( "+r+" "+this.op+" "+s+" )",i,t)}},Ut=lu;Ut.ADD="+",Ut.SUB="-",Ut.MUL="*",Ut.DIV="/";var we=class extends Te{constructor(e,t=we.ABS,i,r){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:r=t,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case we.MIX:case we.CLAMP:case we.REFRACT:case we.SMOOTHSTEP:case we.FACEFORWARD:return 3;case we.MIN:case we.MAX:case we.MOD:case we.STEP:case we.REFLECT:case we.DISTANCE:case we.DOT:case we.CROSS:case we.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>r?this.a.getType(e):i>r?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case we.LENGTH:case we.DISTANCE:case we.DOT:return"f";case we.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,r,s,o=this.a?e.getTypeLength(this.a.getType(e)):0,n=this.b?e.getTypeLength(this.b.getType(e)):0,h=this.c?e.getTypeLength(this.c.getType(e)):0,a=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case we.NEGATE:return e.format("( -"+this.a.build(e,a)+" )",a,t);case we.INVERT:return e.format("( 1.0 - "+this.a.build(e,a)+" )",a,t);case we.CROSS:i=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case we.STEP:i=this.a.build(e,o===1?"f":a),r=this.b.build(e,a);break;case we.MIN:case we.MAX:case we.MOD:i=this.a.build(e,a),r=this.b.build(e,n===1?"f":a);break;case we.REFRACT:i=this.a.build(e,a),r=this.b.build(e,a),s=this.c.build(e,"f");break;case we.MIX:i=this.a.build(e,a),r=this.b.build(e,a),s=this.c.build(e,h===1?"f":a);break;default:i=this.a.build(e,a),this.b&&(r=this.b.build(e,a)),this.c&&(s=this.c.build(e,a));break}let u=[];u.push(i),r&&u.push(r),s&&u.push(s);let l=this.getNumInputs(e);if(u.length!==l)throw Error(`Arguments not match used in "${this.method}". Require ${l}, currently ${u.length}.`);return e.format(this.method+"( "+u.join(", ")+" )",c,t)}},de=we;de.RAD="radians",de.DEG="degrees",de.EXP="exp",de.EXP2="exp2",de.LOG="log",de.LOG2="log2",de.SQRT="sqrt",de.INV_SQRT="inversesqrt",de.FLOOR="floor",de.CEIL="ceil",de.NORMALIZE="normalize",de.FRACT="fract",de.SATURATE="saturate",de.SIN="sin",de.COS="cos",de.TAN="tan",de.ASIN="asin",de.ACOS="acos",de.ARCTAN="atan",de.ABS="abs",de.SIGN="sign",de.LENGTH="length",de.NEGATE="negate",de.INVERT="invert",de.MIN="min",de.MAX="max",de.MOD="mod",de.STEP="step",de.REFLECT="reflect",de.DISTANCE="distance",de.DOT="dot",de.CROSS="cross",de.POW="pow",de.MIX="mix",de.CLAMP="clamp",de.REFRACT="refract",de.SMOOTHSTEP="smoothstep",de.FACEFORWARD="faceforward";var Rr=class extends Te{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,r){let s=new Lh(Rr.Nodes.bilinearCubeUV,[t,i,r]);this.colorSpaceTL=this.colorSpaceTL??new jt(new Ie("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(s.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new jt(new Ie("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(s.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new jt(new Ie("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(s.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new jt(new Ie("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(s.build(e)+".br");let o={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(o),this.colorSpaceTLExp=new Ie(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new Ie(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new Ie(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new Ie(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let n=new Ie("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return n.keywords.cubeUV_TL=this.colorSpaceTLExp,n.keywords.cubeUV_TR=this.colorSpaceTRExp,n.keywords.cubeUV_BL=this.colorSpaceBLExp,n.keywords.cubeUV_BR=this.colorSpaceBRExp,n.keywords.cubeUV=s,n}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=this.bias||e.context.roughness,s=new Lh(Rr.Nodes.roughnessToMip,[r]),o=new de(s,Rr.Nodes.m0,Rr.Nodes.cubeUV_maxMipLevel,de.CLAMP),n=new de(o,de.FLOOR),h=new de(o,de.FRACT),a=this.bilinearCubeUV(e,this.value,i,n),c=this.bilinearCubeUV(e,this.value,i,new Ut(n,new se(1).setReadonly(!0),Ut.ADD)),u=new de(a,c,h,de.MIX);return e.format(u.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},Xn=Rr;Xn.Nodes=function(){let e=new au(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new _e("float cubeUV_maxMipLevel 8.0",!0),i=new _e("float cubeUV_minMipLevel 4.0",!0),r=new _e("float cubeUV_maxTileSize 256.0",!0),s=new _e("float cubeUV_minTileSize 16.0",!0),o=new ne(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);o.useKeywords=!1;let n=new ne(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);n.useKeywords=!1;let h=new ne(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,o,n,t,i,r,s]);h.useKeywords=!1;let a=new _e("float r0 1.0",!0),c=new _e("float v0 0.339",!0),u=new _e("float m0 -2.0",!0),l=new _e("float r1 0.8",!0),d=new _e("float v1 0.276",!0),p=new _e("float m1 -1.0",!0),f=new _e("float r4 0.4",!0),v=new _e("float v4 0.046",!0),g=new _e("float m4 2.0",!0),m=new _e("float r5 0.305",!0),y=new _e("float v5 0.016",!0),w=new _e("float m5 3.0",!0),x=new _e("float r6 0.21",!0),S=new _e("float v6 0.0038",!0),b=new _e("float m6 4.0",!0),A=[a,c,u,l,d,p,f,v,g,m,y,w,x,S,b],O=new ne(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,A);return{bilinearCubeUV:h,roughnessToMip:O,m0:u,cubeUV_maxMipLevel:t}}();var Vi=class extends Te{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??Vi.VIEW}getShared(){return this.scope===Vi.WORLD}build(e,t,i,r){let s=e.context[this.scope+"Normal"];return s?s.build(e,t,i,r):super.build(e,t,i)}generate(e,t,i,r,s){let o;switch(this.scope){case Vi.VIEW:e.isShader("vertex")?o="transformedNormal":o="geometryNormal";break;case Vi.LOCAL:e.isShader("vertex")?o="objectNormal":(e.requires.normal=!0,o="vObjectNormal");break;case Vi.WORLD:e.isShader("vertex")?o="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,o="vWNormal");break}return e.format(o,this.getType(e),t)}},tt=Vi;tt.LOCAL="local",tt.WORLD="world",tt.VIEW="view",tt.NORMAL="normal";et.addKeyword("viewNormal",function(){return new tt(tt.VIEW)});et.addKeyword("localNormal",function(){return new tt(tt.NORMAL)});et.addKeyword("worldNormal",function(){return new tt(tt.WORLD)});var qt=class extends Te{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??qt.LOCAL}getType(){switch(this.scope){case qt.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case qt.LOCAL:case qt.WORLD:return!1}return!0}generate(e,t,i,r,s){let o;switch(this.scope){case qt.LOCAL:e.isShader("vertex")?o="transformed":(e.requires.position=!0,o="vPosition");break;case qt.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,o="vWPosition";break;case qt.VIEW:o=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case qt.PROJECTION:o=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(o,this.getType(),t)}},At=qt;At.LOCAL="local",At.WORLD="world",At.VIEW="view",At.PROJECTION="projection";et.addKeyword("position",function(){return new At});et.addKeyword("worldPosition",function(){return new At(At.WORLD)});et.addKeyword("viewPosition",function(){return new At(At.VIEW)});var Nt=class extends Te{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??Nt.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case Nt.SPHERE:return"v2"}return this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let r;switch(this.scope){case Nt.VECTOR:{let s=new tt(tt.VIEW),o=e.context.roughness,n=s.build(e,"v3"),h=new At(At.VIEW).build(e,"v3"),a=o?o.build(e,"f"):void 0,c=`reflect( -normalize( ${h} ), ${n} )`;a&&(c=`normalize( mix( ${c}, ${n}, ${a} * ${a} ) )`);let u=`inverseTransformDirection( ${c}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${u};`),r="reflectVec"):r=u;break}case Nt.CUBE:{let s=new Nt(Nt.VECTOR).build(e,"v3"),o="vec3( -"+s+".x, "+s+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${o};`),r="reflectCubeVec"):r=o;break}case Nt.SPHERE:{let s="normalize( ( viewMatrix * vec4( "+new Nt(Nt.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${s};`),r="reflectSphereVec"):r=s;break}}return e.format(r,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},Qi=Nt;Qi.CUBE="cube",Qi.SPHERE="sphere",Qi.VECTOR="vector";var $_=class extends Te{constructor(e=new ai,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new Xn(this.value,t??new Qi(Qi.VECTOR),i),this.irradianceNode=new Xn(this.value,new tt(tt.WORLD),new se(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},X_=class extends nt{constructor(e=new Dp,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new Qi,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var a;if(t==="samplerCube")return this.getTexture(e,t);let i=this.getTexture(e,t),r=(a=this.uv)==null?void 0:a.build(e,"v3"),s=this.bias?this.bias.build(e,"f"):void 0;s===void 0&&e.context.bias&&(s=e.context.bias.setTexture(this).build(e,"f"));let o;s?o="texCubeBias( "+i+", "+r+", "+s+" )":o="texCube( "+i+", "+r+" )";let n={include:e.isShader("vertex"),ignoreCache:!0},h=this.getType(e);return e.addContext(n),this.colorSpace=this.colorSpace??new jt(new Ie("",h)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(o),o=this.colorSpace.build(e,h),e.removeContext(),e.format(o,h,t)}},Ih=["x","y","z","w"],Y_=["float","vec2","vec3","vec4"],Z_={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},K_={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},Q_=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let r=this.getIncludes(t,i);if(!r)return"";let s="";r=r.sort(e);for(let o=0;o<r.length;o++)r[o].src&&(s+=r[o].src+`
`);return s}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,i,r="varying",s="V",o=""){let n=this.getVars(r),h=n[e];if(!h){let a=n.length;h={name:i||"node"+s+a+(o?"_"+o:""),type:t},n.push(h),n[e]=h}return h}getTempVar(e,t,i,r){return this.getVar(e,t,i,this.shader,"T",r)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t??"";let i="";for(let r=0,s=e.length;r<s;++r){let o=e[r],n=o.type,h=o.name,a=o.size,c=this.getFormatByType(n);if(c===void 0)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=t+" "+c.substring(0,c.length-2)+" "+h+`[${a}];
`:i+=t+" "+c+" "+h+`;
`}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof fi?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,r,s,o){if(t.includes("[]")){let n=this.inputs.arrayUniforms,h=n.list.length,a=new Eh({type:t,size:i.size,name:r||"nodeUA"+h+(o?"_"+o:""),node:i,needsUpdate:s});return n.list.push(a),n[e].push(a),n[e][a.name]=a,this.uniforms[a.name]=a,a}else{let n=this.inputs.uniforms,h=n.list.length,a=new Eh({type:t,name:r||"nodeU"+h+(o?"_"+o:""),node:i,needsUpdate:s});return n.list.push(a),n[e].push(a),n[e][a.name]=a,this.uniforms[a.name]=a,a}}createVertexUniform(e,t,i,r,s){return this.createUniform("vertex",e,t,i,r,s)}createFragmentUniform(e,t,i,r,s){return this.createUniform("fragment",e,t,i,r,s)}include(e,t,i){var o;let r;if(e=typeof e=="string"?et.get(e):e,this.context.include===!1)return e.name;e instanceof ne?r=this.includes.functions:e instanceof _e?r=this.includes.consts:e instanceof au&&(r=this.includes.structs);let s=r[this.shader]=r[this.shader]||[];if(e){let n=s[e.name];if(n||(n=s[e.name]={node:e,deps:[]},s.push(n),n.src=e.build(this,"source")),e instanceof ne&&t&&s[t.name]&&s[t.name].deps.indexOf(e)===-1&&(s[t.name].deps.push(e),(o=e.includes)==null?void 0:o.length)){let h=0;do this.include(e.includes[h++],t);while(h<e.includes.length)}return i&&(n.src=i),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return Y_[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!=null&&i.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case Sp:case _p:return new X_(i);case wp:return new $_(new ai(i));default:return new ai(i)}else{if(i.isVector2)return new ut(i);if(i.isVector3)return new ct(i);if(i.isVector4)return new Si(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return Z_[e]||e}getFormatByType(e){return K_[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return Ih[e]}getIndexByElement(e){return Ih.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=gn,t===gn&&this.context.gamma&&(t=_c),t}},je=class extends nt{constructor(e=0,t,i,r){super("c"),this.nodeType="Color",this.value=e instanceof Ct?e:new Ct(e||0,t,i,r)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,r,s,o){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let n=e.getNodeData(i),h=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let a=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${a};`)}return h?this.generateReadonly(e,t,i,r,s,o):e.isShader("vertex")?(n.vertex||(n.vertex=e.createVertexUniform(r,this,s,o,this.getLabel())),e.format(n.vertex.name,r,t)):(n.fragment||(n.fragment=e.createFragmentUniform(r,this,s,o,this.getLabel())),e.format(n.fragment.name,r,t))}generateReadonly(e,t,i,r,s,o){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,t)}},Ae=class extends nt{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,r,s,o){return e.format(this.value.toString(),r,t)}},hu=class extends fi{constructor(){super("basic"),this.nodeType="Basic",this.color=new je(5526619),this.shadingAlpha=new se(1),this.shadingBlend=new Ae(0)}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(Kr.merge([Rt.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{this.color===void 0&&(this.color=new je(5526619)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(e,"f"):void 0,s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=r!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let o=["#include <normal_fragment_begin>",i.code];r&&o.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),s?o.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):o.push(`vec3 finalColor = ${i.result};`),r?o.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} );`):o.push("gl_FragColor = vec4("+i.result+", 1.0 );"),o.push("#include <fog_fragment>","#include <dithering_fragment>"),t=o.join(`
`)}return t}},bi=class extends nt{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},pt={normalRenderTarget:new ai,normalRenderTargetDepth:new ai,transmissionRenderTarget:new ai,transmissionSize:new ut(2048,2048),transmissionRenderTargetDepth:new ai,pixelRatioNode:new se(1),resolution:new ut,penumbraSize:new bi(5,.5)};for(let e of Object.values(pt))e.isRenderGlobal=!0;var J_=class extends fi{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new je(5526619),this.emissive=new je(0),this.emissiveIntensity=new se(1),this.shadingAlpha=new se(1),this.shadingBlend=new Ae(0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(Kr.merge([Rt.fog,Rt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:pt.penumbraSize}),this.color===void 0&&(this.color=new je(5526619)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.emissive.flow(e,"c",{slot:"emissive"}),s=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),o=this.shadingAlpha.flow(e,"f"),n=this.shadingBlend.flow(e,"i"),h=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,a=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=a!==void 0,e.addParsCode(["uniform float penumbraSize[5];","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];c.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),a&&c.push(a.code,"#ifdef ALPHATEST","if ( "+a.result+" <= ALPHATEST ) discard;","#endif"),c.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&c.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+s.result+";"),c.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;"),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result}, ${n.result} );
				}
				`),h&&c.push(h.code,`outgoingLight = spe_blend(outgoingLight, ${h.result}, 1.0, SPE_BLENDING_NORMAL);`),a?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${a.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=c.join(`
`)}return t}},eS=class extends fi{constructor(){super("phong"),this.nodeType="Phong",this.color=new je(5526619),this.specular=new je(1118481),this.shininess=new se(30),this.shadingAlpha=new se(1),this.shadingBlend=new Ae(0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(Kr.merge([Rt.fog,Rt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif


				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:pt.penumbraSize}),this.color===void 0&&(this.color=new je(5526619)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),n=this.shadingBlend.flow(e,"i"),h=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,a=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=a!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];c.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",r.code,"	vec3 specular = "+r.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),a&&c.push(a.code,"#ifdef ALPHATEST","if ( "+a.result+" <= ALPHATEST ) discard;","#endif"),c.push("material.diffuseColor = diffuseColor;"),c.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),c.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;"),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result}, ${n.result} );
				}
				`),h&&c.push(h.code,`outgoingLight = spe_blend(outgoingLight, ${h.result}, 1.0, SPE_BLENDING_NORMAL);`),a?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${a.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=c.join(`
`)}return t}},tS=class extends fi{constructor(){super("standard"),this.nodeType="Standard",this.color=new je(5526619),this.roughness=new se(.3),this.metalness=new se(0),this.reflectivity=new se(.5),this.shadingAlpha=new se(1),this.shadingBlend=new Ae(0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(Kr.merge([Rt.fog,Rt.lights])),Rt.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:pt.penumbraSize});let i={gamma:!0};this.color===void 0&&(this.color=new je(5526619)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let r=this.color.flow(e,"c",{slot:"color",context:i}),s=this.roughness.flow(e,"f"),o=this.metalness.flow(e,"f"),n=this.shadingAlpha.flow(e,"f"),h=this.shadingBlend.flow(e,"i"),a=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let l=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];l.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",s.code,"	float roughnessFactor = "+s.result+";",o.code,"	float metalnessFactor = "+o.result+";"),c&&l.push(c.code,"#ifdef ALPHATEST","	if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),l.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),l.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),u?l.push(u.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+u.result+" ) ), diffuseColor, metalnessFactor );"):l.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),l.push("#include <lights_fragment_begin>"),l.push("#include <lights_fragment_end>"),l.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),l.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${n.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${n.result}, ${h.result} );
				}
				`),a&&l.push(a.code,`outgoingLight = spe_blend(outgoingLight, ${a.result}, 1.0, SPE_BLENDING_NORMAL);`),c?l.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):l.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),l.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=l.join(`
`)}return t}},iS=class extends fi{constructor(){super("toon"),this.nodeType="Toon",this.color=new je(5526619),this.specular=new je(1118481),this.shininess=new se(30),this.shadingAlpha=new se(1),this.shadingBlend=new Ae(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(Kr.merge([Rt.fog,Rt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:pt.penumbraSize}),this.color===void 0&&(this.color=new je(5526619)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),n=this.shadingBlend.flow(e,"i"),h=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,a=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=a!==void 0,e.addParsCode(["uniform float penumbraSize[5];","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];c.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),a&&c.push(a.code,"#ifdef ALPHATEST","if ( "+a.result+" <= ALPHATEST ) discard;","#endif"),c.push("material.diffuseColor = diffuseColor;"),c.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),c.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result}, ${n.result} );
				}
				`),h&&c.push(h.code,`outgoingLight = spe_blend(outgoingLight, ${h.result}, 1.0, SPE_BLENDING_NORMAL);`),a?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${a.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=c.join(`
`)}return t}},Dr=class extends nt{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,r){return e.format(this.value?"true":"false",r,t)}},cu=class extends nt{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new Bs}generateReadonly(e,t,i,r,s,o){return e.format("mat3("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},xi=class extends nt{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof Qe?new Array(e).fill(t):new Array(e).fill(new Qe(0))}},Ra=(e=>(e.SIMPLEX="simplex3d",e.SIMPLEX_FRACTAL="simplex3dFractal",e.ASHIMA="simplexAshima",e.FBM="fbm",e.PERLIN="perlin",e))(Ra||{}),vt=function(){let e=new ne(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new ne(`float simplex3d(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new _e("float F3 0.3333333"),t.keywords.G3=new _e("float G3 0.1666667");let i=new ne(`float simplex3dFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplex3d(m * rot1)
				 + 0.2666667 * simplex3d(2.0 * m * rot2)
				 + 0.1333333 * simplex3d(4.0 * m * rot3)
				 + 0.0666667 * simplex3d(8.0 * m);
		}`,[t]),r=new ne("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new ne("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),o=new ne(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[r,s]),n=new ne("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),h=new ne("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[n]),a=new ne(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[h]),c=new ne(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[a]);c.keywords.NUM_OCTAVES=new _e("int NUM_OCTAVES 5");let u=new ne("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),l=new ne(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[r,s,u]);return{simplex:t,simplexFractal:i,simplexAshima:o,fbm:c,perlin:l}}(),du=class extends Te{constructor(e,t,i,r,s,o,n,h,a,c,u,l){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=r,this.fB=s,this.distortion=o,this.colorA=n,this.colorB=h,this.colorC=a,this.colorD=c,this.alpha=u,this.noiseType=l,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,r,s){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let o=Object.values(Ra)[this.noiseType.value],n=new ne(`vec3 ${o}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, float alpha, out float calpha) {
                vec3 st = position / size;
				st /= scale;
				vec3 q = vec3(${o}(st),
							  ${o}(st + vec3(1.0)),
							  ${o}(st + vec3(1.0)));
				vec3 r = vec3(${o}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
							  ${o}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
							  ${o}(st * q));
				float f = ${o}(st + r);
				vec4 color;
				color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
				color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
				color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));

                float lalpha = alpha * color.a;
                calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );

			    accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return clamp(color, 0.0, 1.0).rgb;
			}`,[vt.simplex,vt.simplexFractal,vt.simplexAshima,vt.fbm,vt.perlin]),h=e.include(n),a=[];return a.push(this.scale.build(e,"f")),a.push(this.size.build(e,"v3")),a.push(this.move.build(e,"f")),a.push(this.fA.build(e,"v2")),a.push(this.fB.build(e,"v2")),a.push(this.distortion.build(e,"v2")),a.push(this.colorA.build(e,"v4")),a.push(this.colorB.build(e,"v4")),a.push(this.colorC.build(e,"v4")),a.push(this.colorD.build(e,"v4")),a.push(this.alpha.build(e,"f")),a.push(this.calpha),e.format(h+"("+a.join(",")+")",this.getType(e),t)}};du.numOctaves=5;var uu=class extends Te{constructor(e,t,i,r,s,o,n){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=r,this.factor=s,this.alpha=o,this.mode=n,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(uu.Nodes.fresnel),r=[];return r.push(this.color.build(e,"c")),r.push(this.bias.build(e,"f")),r.push(this.scale.build(e,"f")),r.push(this.intensity.build(e,"f")),r.push(this.factor.build(e,"f")),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},pu=uu;pu.Nodes=function(){return{fresnel:new ne(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, float alpha, int mode, out float calpha) {
				float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

				float lalpha = clamp( fresnel, 0.0, 1.0 ) * alpha;
				calpha = lalpha / clamp(lalpha + accumAlpha, 0.001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;
				return color;
			}`)}}();var fu=class extends Te{constructor(e,t,i,r,s,o,n){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=s,this.offset=o,this.alpha=n,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(fu.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(e,"f")),r.push(this.movement.build(e,"f")),r.push(this.wavelengths.build(e,"v3")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.offset.build(e,"v3")),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},mu=fu;mu.Nodes=function(){let e=new ne(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
                 vec3 st = position / noiseScale;
				 vec3 q = vec3(simplex3d(st),
							  simplex3d(st + vec3(1.0)),
							  simplex3d(st + vec3(1.0)));

				 vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),
							  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),
							  simplex3d(st * q));

                 float noise = simplex3d(st + r);

                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);
             }`,[vt.simplex]);return{rainbow:new ne(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, float alpha, out float calpha) {
                 vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

                 float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);
                 float lalpha = alpha * rainbowContribution;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

                 return res;
             }`,[e])}}();var gu=class extends Te{constructor(e,t,i,r,s,o,n,h,a,c,u,l,d,p,f,v){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=s,this.outlineThreshold=o,this.contourFrequency=n,this.outlineSmoothing=h,this.contourDirection=a,this.positionalLines=c,this.compensation=u,this.resolution=l,this.normalMap=d,this.depthMap=p,this.pixelRatio=f,this.alpha=v,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.firstTime){let i=this.outlineWidth.build(e,"f"),r=this.resolution.build(e,"v2"),s=this.compensation.build(e,"b"),o=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(i,"uniform float"),e.addVertexParsVariable(r,"uniform vec2"),e.addVertexParsVariable(s,"uniform bool"),e.addVertexParsVariable(o,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float");let n=`g${this.uuid.toString().replace(/-/g,"")}`;e.addVertexFinalCode(`
                vID = randomColor.r;
                if (${s}) {
                    vec4 ${n}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${n}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    vec2 ${n}_offset = normalize(${n}_clipNormal.xy) / ${r} * (${i} / 2.0) * ${n}_clipPosition.w * 2.0 * ${o};
                    ${n}_clipPosition.xy += ${n}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${n}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(gu.Nodes.outline),r=[];return r.push(this.outlineColor.build(e,"c")),r.push(this.contourColor.build(e,"c")),r.push(this.outlineWidth.build(e,"f")),r.push(this.contourWidth.build(e,"f")),r.push(this.contourThreshold.build(e,"f")),r.push(this.outlineThreshold.build(e,"f")),r.push(this.contourFrequency.build(e,"f")),r.push(this.outlineSmoothing.build(e,"f")),r.push(this.contourDirection.build(e,"v3")),r.push(this.positionalLines.build(e,"b")),r.push(this.resolution.build(e,"v2")),r.push(this.normalMap.getTexture(e,"t")),r.push(this.depthMap.getTexture(e,"t")),r.push(this.pixelRatio.build(e,"f")),r.push(this.compensation.build(e,"b")),r.push(this.alpha.build(e,"f")),r.push(this.calpha),this.firstTime=!this.firstTime,e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},vu=gu;vu.Nodes=function(){let e=new ne(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 texelSize = (vec2(1.0) / resolution) * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -texelSize.x, -texelSize.y);
	uvSamples[1] = uv + vec2(0.0, -texelSize.y);
	uvSamples[2] = uv + vec2(  texelSize.x, -texelSize.y);
	uvSamples[3] = uv + vec2( -texelSize.x, 0.0);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  texelSize.x, 0.0);
	uvSamples[6] = uv + vec2( -texelSize.x, texelSize.y);
	uvSamples[7] = uv + vec2(0.0, texelSize.y);
	uvSamples[8] = uv + vec2(  texelSize.x, texelSize.y);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec4 sobel_edge_h = normalSamples[2] + (2.0*normalSamples[5]) + normalSamples[8] - (normalSamples[0] + (2.0*normalSamples[3]) + normalSamples[6]);
  	vec4 sobel_edge_v = normalSamples[0] + (2.0*normalSamples[1]) + normalSamples[2] - (normalSamples[6] + (2.0*normalSamples[7]) + normalSamples[8]);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new ne(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
                 return result;
             }`,[e])}}();var yu=class extends Te{constructor(e,t,i,r,s,o,n,h){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=s,this.transmissionDepthMap=o,this.aspectRatio=n,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",30),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(yu.Nodes.transmission),r=[];return r.push(this.thickness.build(e,"f")),r.push(this.ior.build(e,"f")),r.push(this.roughness.build(e,"f")),r.push(this.transmissionSamplerSize.build(e,"v2")),r.push(this.transmissionSamplerMap.getTexture(e,"t")),r.push(this.transmissionDepthMap.getTexture(e,"t")),r.push(this.aspectRatio.build(e,"v2")),r.push("normal"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},bu=yu;bu.Nodes=function(){let e=new ne(`
            float gaussian(vec2 i) {
                const float sigma = float(NUM_SAMPLES) * .25;
                return exp( -.5* dot(i/=sigma,i) ) / ( 6.28 * sigma*sigma );
            }`),t=new ne(`
            vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

                const int LOD = 2;
                const int sLOD = 4; // tile size = 2^LOD

                vec3 O = vec3(0);
                float a = 0.0;
                const int s = NUM_SAMPLES/sLOD;
                for ( int i = 0; i < s*s; i++ ) {
                    int modulo = (i)-((i)/(s))*(s);
                    vec2 d = vec2(float(modulo), float(i/s))*float(sLOD) - float(NUM_SAMPLES)/2.;
                    vec2 uv = U + (scale * aspectRatio) * d;
                    // What is the depth of the opaque object we're trying to sample
                    float opaqueDepth = unpackRGBAToDepth(texture2D(dm, uv));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU + ((scale * min(lod / 2., 1.)) * aspectRatio) * d;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    float gaussian = gaussian(d);
		            #ifdef TEXTURE_LOD_EXT
                    O += gaussian * texture2DLodEXT( sp, uv, lod).rgb;
                    #else
                    O += gaussian * textureLod( sp, uv, lod).rgb;
                    #endif
                    a += gaussian;
                }
                return O / a;
            }`,[e]),i=new ne(`
            vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        // Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		        // The thickness is specified in local space.
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),r=new ne(`
float applyIorToRoughness( float roughness, float ior ) {
		// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
		// an IOR of 1.5 results in the default amount of microfacet refraction.
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	} `),s=new ne(`
vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
        float lod = applyIorToRoughness(roughness, ior);

        return blur(transmissionSamplerMap, fragCoord, vec2(lod / (transmissionSamplerSize.x / 2.)), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
	}`,[r,t]),o=new ne(`
vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
        vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
        vec3 refractedRayExit = position + transmissionRay;

        // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
        vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
        vec2 refractionCoords = ndcPos.xy / ndcPos.w;
        refractionCoords += 1.0;
        refractionCoords /= 2.0;

        vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
        vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
        unrefractedCoords += 1.0;
        unrefractedCoords /= 2.0;

        // Sample framebuffer to get pixel the refracted ray hits.
        return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    }`,[s,i]);return{transmission:new ne(`
            vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                float lalpha = alpha;

                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
                 return transmission;
            }`,[o])}}();var kr=class extends Te{constructor(e,t,i,r,s,o,n,h,a,c,u){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=r,this.isVector=s,this.isWorldSpace=o,this.origin=n,this.direction=h,this.colors=a,this.steps=c,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new ne(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a;
               calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );

			   accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
               return color.rgb;
			}`,[kr.Nodes.vectorLinearWorldSpaceDepth,kr.Nodes.vectorLinearObjectSpaceDepth,kr.Nodes.vectorSphericalObjectSpaceDepth,kr.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let s=e.include(r),o=[];return o.push(this.near.build(e,"f")),o.push(this.far.build(e,"f")),o.push(this.origin.build(e,"v3")),o.push(this.direction.build(e,"v3")),o.push(this.colors.build(e,"v4[]")),o.push(this.steps.build(e,"f[]")),o.push(this.alpha.build(e,"f")),o.push(this.calpha),e.format(s+"("+o.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},xu=kr;xu.Nodes=function(){let e=new ne(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new ne(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new ne(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new ne(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var zh=class extends Te{constructor(e,t,i,r){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=r}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Yn=(e=>(e.NOISE="noise",e.MAP="map",e))(Yn||{}),wu=class extends Te{constructor(e,t,i,r,s){super("v3"),this.displacementTypeIndex=new Ae(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(Yn)[this.displacementTypeIndex.value]==="map"&&(this.mat=new cu(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=r,this.noiseFunctionIndex=s}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(Yn)[this.displacementTypeIndex.value]){case"map":{i=e.include(wu.Nodes.map),r.push(this.movementOrTexture.getTexture(e,"t")),r.push("uv"),r.push(this.cropOrOffset.build(e,"f")),this.mat&&r.push(this.mat.build(e,"mat3"));break}case"noise":{let s=Object.values(Ra)[this.noiseFunctionIndex.value],o=new ne(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),n=new ne(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement) {
							return p + n * ${s}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
						}`,[vt.simplex,vt.simplexFractal,vt.simplexAshima,vt.fbm,vt.perlin]),h=new ne(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[n,o]);i=e.include(h),r.push(this.scale.build(e,"f")),r.push(this.cropOrOffset.build(e,"v3")),r.push(this.movementOrTexture.build(e,"f"));break}}return r.push(this.intensity.build(e,"f")),r.push("displaced_normal"),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},_u=wu;_u.Nodes=function(){let e=new ne(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new ne(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new ne(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}}();var Su=class extends Te{constructor(e,t,i,r,s,o,n,h){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=r,this.offset=s,this.morph=o,this.angle=n,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(Su.Nodes.gradient),r=[];return r.push(this.gradientType.build(e,"i")),r.push(this.smooth.build(e,"b")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.offset.build(e,"v2")),r.push(this.morph.build(e,"v2")),r.push(this.angle.build(e,"f")),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Au=Su;Au.Nodes=function(){return{gradient:new ne(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return color.xyz;
			}`)}}();var Ns=class extends Te{constructor(e,t,i,r,s,o,n,h,a,c){super("v3"),this.nodeType="CustomTexture",this.firstTime=!0,this.texture=e,this.textureSize=t,this.crop=i,this.projection=r,this.axis=s,this.side=o,this.size=n,this.mat=h,this.alpha=a,this.mode=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=e.include(Ns.Nodes.cylindrical);break;case 2:r=e.include(Ns.Nodes.spherical);break;case 1:let o=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],n=new ne(`
		vec3 ${i}_planarTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {

				vec2 uvs = ( mat * vec3( (${i}_vCustomUv * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, mat * ${o}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}`);r=e.include(n);break;default:r=e.include(Ns.Nodes.uv);break}if(this.projection.value===1&&this.firstTime){e.addVertexParsCode(`varying vec2 ${i}_vCustomUv;`),e.addFragmentParsCode(`varying vec2 ${i}_vCustomUv;`);let o=["zy","xz","xy"][this.axis.value];e.addVertexFinalCode(`${i}_vCustomUv = (1. + (transformed.${o})) / 2.;`)}e.addFragmentVariable(this.calpha,"float");let s=[];return s.push(this.texture.generate(e,"t")),s.push(this.textureSize.build(e,"v2")),s.push(this.crop.build(e,"f")),s.push(this.mat.build(e,"mat3")),s.push(this.size.build(e,"v2")),s.push(this.alpha.build(e,"f")),s.push(this.mode.build(e,"i")),s.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+s.join(",")+")",this.getType(e),t)}},Ou=Ns;Ou.Nodes=function(){let e=new ne(`
vec3 cylindricalTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}
`),t=new ne(`
vec3 sphericalTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}
`),i=new ne(`vec3 uvTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {

				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}`);return{cylindrical:e,spherical:t,uv:i}}();var Cu=class extends Te{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t}generate(e,t){if(e.isShader("fragment")){let i=e.include(Cu.Nodes.customNormal),r=[];return r.push(this.cnormal.build(e,"v3")),r.push("normal"),r.push(this.alpha.build(e,"f")),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Pu=Cu;Pu.Nodes=function(){return{customNormal:new ne(`vec3 customNormal(vec3 cnormal, vec3 norm, float alpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return normal;
			}`)}}();function ot(e,t){return t.color(e)}function rS(e,t){switch(e.type){case"fresnel":return nS(e,t);case"gradient":return aS(e);case"depth":return lS(e);case"normal":return hS(e);case"noise":return cS(e,t);case"rainbow":return dS(e);case"toon":return uS(e,t);case"outline":return pS(e,t);case"transmission":return fS(e);case"color":return oS(e,t)}}function sS(e){return{type:e.type}}function Gt(e){let{alpha:t,mode:i}=e;return{...sS(e),alpha:t,mode:i}}function oS(e,t){return{...Gt(e),color:ot(e.color,t)}}function nS(e,t){let{bias:i,scale:r,intensity:s,factor:o,color:n}=e;return{...Gt(e),color:ot(n,t),bias:i,scale:r,intensity:s,factor:o}}function aS(e){let{gradientType:t,smooth:i,colors:r,steps:s,angle:o,offset:n,morph:h}=e;return{...Gt(e),gradientType:t,smooth:i,colors:r.map(a=>new Qe(a[0],a[1],a[2],a[3])),num:r.length,steps:s,offset:new X(...n),morph:new X(...h),angle:o}}function lS(e){let{gradientType:t,near:i,far:r,isVector:s,isWorldSpace:o,origin:n,direction:h,colors:a,steps:c,smooth:u}=e;return{...Gt(e),gradientType:t,near:i,far:r,isVector:s,isWorldSpace:o,origin:new T(...n),direction:h?new T(...h):new T(1,0,0),colors:a.map(l=>l!==void 0?new Qe(l[0],l[1],l[2],l[3]):new Qe(0,0,0,0)),steps:c.slice(0,a.length),smooth:u}}function hS(e){let{cnormal:t}=e;return{...Gt(e),cnormal:new T(t[0],t[1],t[2])}}function cS(e,t){return{...Gt(e),scale:e.scale,move:e.move,fA:new X(...e.fA),fB:new X(...e.fB),size:new T(...e.size),distortion:new X(...e.distortion),colorA:ot(e.colorA,t),colorB:ot(e.colorB,t),colorC:ot(e.colorC,t),colorD:ot(e.colorD,t),noiseType:e.noiseType}}function dS(e){return{...Gt(e),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new T(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new T(...e.offset)}}function uS(e,t){return{...Gt(e),positioning:e.positioning,colors:e.colors.map(i=>new Qe(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new T(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:ot(e.shadowColor,t),offset:new T(...e.offset)}}function pS(e,t){return{...Gt(e),outlineColor:ot(e.outlineColor,t),contourColor:ot(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new T(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}function fS(e,t){return{...Gt(e),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}var lo=class extends Ct{},mS=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){var t;return(t=this.cache.get(e))==null?void 0:t.data}load(e){let t=Date.now(),i=this.cache.get(e);return i===void 0?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},gS=class extends mS{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},on;function vS(e){return typeof e=="string"?e:(on||(on=new gS),on.load(e))}var yS=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},bS=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return t===void 0&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},Tu=class extends yS{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isVideo=e.type=="video",this.updateSrc(e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;let r=[1e3,1001,1002];for(let s of r){let o=this[s];o&&(o.image=this.img,o.needsUpdate=!0)}this.shared.requestRender()};if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var i=new FileReader;i.readAsDataURL(new Blob([e],{type:"video/mp4"}));let r;await new Promise(s=>{i.onloadend=o=>{var n;r=(n=o.target)==null?void 0:n.result,s(null)}}),this.img.src=r}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=vS(e),this.img.onload=t}getTexture(e){let t=this[e];if(t)return t;{let i;return this.isVideo?i=new Ap(this.img,void 0,e,e):i=new bc(this.img,void 0,e,e),this.loaded&&(i.needsUpdate=!0),this[e]=i,i}}disposeTextures(){var e,t,i;(e=this[1e3])==null||e.dispose(),this[1e3]=void 0,(t=this[1001])==null||t.dispose(),this[1001]=void 0,(i=this[1002])==null||i.dispose(),this[1002]=void 0}dispose(){super.dispose(),this.disposeTextures()}},Oi=class extends Tu{},ka=class extends nt{},Mu={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],depth:["smooth","isWorldSpace","gradientType","isVector"]},Eu={depth:["colors"]};function xS(e,t,i){var o,n;let r=Mu[e.type],s=Eu[e.type];if(s!==void 0){let h=e.color;if(s.includes(t)){let a=(n=(o=h[t])==null?void 0:o.value)==null?void 0:n.length;if(a!==void 0&&a!==i.length)return!0}}return r!==void 0?r.includes(t):!1}function Du(e,t,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let s=!1,o=e;if("image"in o){let n=o.image,h=t.image(n),a=r;a.image instanceof Oi||a.image.deref(),a.image=h}if("video"in o){let n=o.video,h=t.video(n),a=r;a.image instanceof Oi||a.image.deref(),a.image=h}if("wrapping"in o){let n=r;n.wrap=o.wrapping}if("repeat"in o||"offset"in o){let n="mat",h=i.uniforms[`f${i.id}_${n}`];"repeat"in o&&(h.repeat=o.repeat),"offset"in o&&(h.offset=o.offset),h.updateMatrix()}return s}function wS(e,t,i,r){let s=!1;for(let[o,n]of Object.entries(e)){if(!o||n===void 0)continue;if(ju(o,i,r)){o==="visible"&&i.type==="light"&&(s=!0);continue}i.visible=r.visible;let h=i.uniforms[`f${i.id}_${o}`];if(h&&!(h instanceof ka))switch(s=s||xS(i,o,n),h.constructor){case je:if(typeof n=="string"){let a=t.getColor(n);a&&(h.value=a);break}else{let a=n;h.value instanceof lo?h.value=new Ct(a.r,a.g,a.b,a.a):h.setRGBA(a);break}case Si:if(typeof n=="string"){let a=t.getColor(n);a&&(h.value=a);break}else{let a=n;h.value instanceof lo?h.value=new Ct(a.r,a.g,a.b,a.a):h.value.setRGBA(a.r,a.g,a.b,a.a);break}case ut:{let a=n;h.value.setX(a[0]),h.value.setY(a[1]);break}case ct:{let a=n;h.value.setX(a[0]),h.value.setY(a[1]),h.value.setZ(a[2]);break}case ai:{Du(n,t,i);break}case xi:{h.value=n.map(a=>new Qe(...a));break}default:{h.value=n;break}}}return s}var Lu=class extends Te{constructor(e,t,i){super("v3"),this.nodeType="Matcap",this.texture=e,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(Lu.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let r=[];return r.push(this.texture.generate(e,"t")),r.push("normal"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Iu=Lu;Iu.Nodes=function(){return{matcap:new ne(`vec3 matcap(sampler2D matcapTex, vec3 normal, float alpha, int mode, out float calpha) {
                vec3 viewDir = normalize( vViewPosition );
                vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
                vec3 y = cross( viewDir, x );
                vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
                vec4 matcapColor = texture2D( matcapTex, uv );

                calpha =  alpha / clamp( alpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;
                
                return matcapColor.rgb;
            }
            `)}}();var Zn=class extends ka{constructor(e,t){super("t"),this.image=e,this.wrap=t}get value(){return this.image.getTexture(this.wrap)}},_S=class extends ka{constructor(e){super("v3"),this.image=e,this._value=new T}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},zu=class extends Te{constructor(e,t,i,r,s,o,n,h,a,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=r,this.isWorldSpace=s,this.noiseStrength=o,this.noiseScale=n,this.shadowColor=h,this.offset=a,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(zu.Nodes.toon),r=[];return r.push(this.positioning.build(e,"i")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.source.build(e,"v3")),r.push(this.isWorldSpace.build(e,"b")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.shadowColor.build(e,"v4")),r.push(this.offset.build(e,"v3")),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Nu=zu;Nu.Nodes=function(){let e=new ne(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new ne(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new ne(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),r=new ne(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),s=new ne(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new ne(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplex3d(st),
					// 	simplex3d(st + vec3(111.1, 143.89, 217.19)),
					// 	simplex3d(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[vt.simplex,e,i,s])}}();function Nh(e,t,i){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0)}var SS=class extends cu{constructor(e,t){super(new Bs),this.repeat=e,this.offset=t,Nh(this.value,e,t)}updateMatrix(){Nh(this.value,this.repeat,this.offset)}},Ti=class{constructor(e,t,i,r){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let s in r)this.uniforms[`f${this.id}_${s}`]=r[s];for(let s in i)ju(s,this,i)}get type(){return this.data.type}static create(e,t,i,r){if(i.type==="light")return Hi.createLigherLayer(e,t,i,r);if(i.type==="texture"||i.type==="video"){let s=i.type==="texture"?r.image(i.texture.image):r.video(i.texture.video),o=new Zn(s,i.texture.wrapping),n=new _S(s),h=new SS(i.texture.repeat,i.texture.offset),a=new se(i.crop?1:0),c=new Ae(i.projection??0),u=new Ae(["x","y","z"].indexOf(i.axis)??0),l=new Ae(i.side??0),d=new ut(i.size?new X(i.size[0],i.size[1]):new X(100,100)),p=new se(i.alpha??1),f=new Ae(i.mode??0),v=new Ou(o,n,a,c,u,l,d,h,p,f),g=new Ie(v.calpha,"f");return new We(e,t,i,{texture:o,textureSize:n,crop:a,projection:c,axis:u,side:l,size:d,mat:h,alpha:p,mode:f},v,f,g)}else if(i.type==="matcap"){let s=r.image(i.texture.image),o=new Zn(s,i.texture.wrapping),n=new se(i.alpha??1),h=new Ae(i.mode??0),a=new Iu(o,n,h),c=new Ie(a.calpha,"f");return new We(e,t,i,{texture:o,alpha:n,mode:h},a,h,c)}else if(i.type==="displace")if(i.displacementType==="noise"){let s=new ct(new T(...i.offset)),o=new se(i.scale??10),n=new se(i.intensity??8),h=new se(i.movement??1),a=new Ae(i.noiseType??0),c=new _u(n,h,s,o,a);return new Bu(e,t,i,{offset:s,scale:o,intensity:n,movement:h,noiseType:a},c)}else throw new Error;else return CS(e,t,i,r)}updateByOp(e,t,i){var s;let r=e;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props?((s=i.scene)==null||s.markNeedsUpdateRendererDirty(),!0):wS(r.props,i.shared,this,t)}else if(r.path[0]==="texture")return"texture"in t||"video"in t?Du(r.props,i.shared,this):!0;return!1}dispose(){if(AS(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof Oi||t.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&t!==void 0&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},We=class extends Ti{constructor(e,t,i,r,s,o,n){super(e,t,i,r),this.params=r,this.color=s,this.mode=o,this.alpha=n}},Bu=class extends Ti{constructor(e,t,i,r,s){super(e,t,i,r),this.position=s}},Hi=class extends Ti{constructor(e,t,i,r,s){super(e,t,i,s),this.node=r}static createLigherLayer(e,t,i,r){let s,o=new se(i.alpha),n=new Ae(i.mode),h;if(!i.visible)s=new hu,h={};else if(i.category==="lambert"){s=new J_;let a=new je(r.color(i.emissive)??0);h={emissive:a},s.emissive=a}else if(i.category==="toon"){s=new iS;let a=new se(i.shininess??30),c=new je(r.color(i.specular)??1118481);h={shininess:a,specular:c},s.shininess=a,s.specular=c}else if(i.category==="physical"){s=new tS;let a=new se(i.roughness??.3),c=new se(i.metalness??0),u=new se(i.reflectivity??.5);h={roughness:a,metalness:c,reflectivity:u},s.roughness=a,s.metalness=c,s.reflectivity=u}else{s=new eS;let a=new se(i.shininess??30),c=new je(i.specular!==void 0?r.color(i.specular)??1118481:1118481);h={shininess:a,specular:c},s.shininess=a,s.specular=c}return s.alpha=new se(1),s.shadingAlpha=o,s.shadingBlend=n,h.alpha=s.shadingAlpha,h.mode=s.shadingBlend,new Hi(e,t,i,s,h)}get category(){return this.node.category}};function AS(e){let t=e instanceof Ti?e.type:e;return t==="texture"||t==="video"||t==="displace_map"||t==="matcap"}function OS(e,t,i,r){switch(e.type){case"color":{let s=new je(r.color??5526619),o=new se(r.alpha??1),n=new Ie("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");n.keywords.alpha=o;let h=new Ae(r.mode??0);return s.alpha=o,new We(t,i,e,{color:s,alpha:o,mode:h},s,h,n)}case"fresnel":{let s=new je(r.color??16777215),o=new se(r.bias??.1),n=new se(r.scale??1),h=new se(r.intensity??2),a=new se(r.factor??1),c=new se(r.alpha??1),u=new Ae(r.mode??0),l=new pu(s,o,n,h,a,c,u),d=new Ie(l.calpha,"f");return new We(t,i,e,{color:s,bias:o,scale:n,intensity:h,factor:a,alpha:c,mode:u},l,u,d)}case"rainbow":{let s=new se(r.filmThickness??30),o=new se(r.movement??0),n=new ct(r.wavelengths??new T(0,0,0)),h=new se(r.noiseStrength??0),a=new se(r.noiseScale??1),c=new ct(r.offset??new T(0,0,0)),u=new se(r.alpha??1),l=new mu(s,o,n,h,a,c,u),d=new Ie(l.calpha,"f"),p=new Ae(r.mode??0);return new We(t,i,e,{filmThickness:s,movement:o,wavelengths:n,noiseStrength:h,noiseScale:a,offset:c,alpha:u,mode:p},l,p,d)}case"transmission":{let s=new se(r.thickness??10),o=new se(r.ior??1.5),n=new se(r.roughness??.5),h=pt.transmissionSize,a=pt.transmissionRenderTarget,c=pt.transmissionRenderTargetDepth,u=window.innerWidth,l=window.innerHeight,d=u>=l?new ut(l/u,1):new ut(1,u/l),p=new se(r.alpha??1),f=new bu(s,o,n,h,a,c,d,p),v=new Ie(f.calpha,"f"),g=new Ae(r.mode??0);return new We(t,i,e,{thickness:s,ior:o,roughness:n,aspectRatio:d,alpha:p,mode:g},f,g,v)}case"toon":{let s=new Ae(r.positioning??0),o;r.colors?o=new xi(r.colors.length,r.colors):(o=new xi(10,new Qe(0,0,0,1)),o.value[1]=new Qe(1,1,1,1));let n;r.steps?n=new bi(r.steps.length,r.steps):(n=new bi(10,1),n.value[0]=0);let h=new ct(r.source??new T(0,0,0)),a=new Dr(r.isWorldSpace??!0),c=new se(r.noiseStrength??0),u=new se(r.noiseScale??1),l=new Si(r.shadowColor),d=new ct(r.offset??new T(0,0,0)),p=new se(r.alpha??1),f=new Nu(s,o,n,h,a,c,u,l,d,p),v=new Ie(f.calpha,"f"),g=new Ae(r.mode??0);return new We(t,i,e,{positioning:s,colors:o,steps:n,source:h,isWorldSpace:a,noiseStrength:c,noiseScale:u,shadowColor:l,offset:d,alpha:p,mode:g},f,g,v)}case"outline":{let s=new je(r.outlineColor??16777215),o=new je(r.contourColor??16777215),n=new se(r.outlineWidth??.1),h=new se(r.contourWidth??.1),a=new se(r.outlineThreshold??.1),c=new se(r.contourThreshold??.1),u=new se(r.outlineSmoothing??.1),l=new se(r.contourFrequency??.1),d=new ct(r.contourDirection??new T(0,1,0)),p=new Dr(r.positionalLines??!1),f=new Dr(r.compensation??!0),v=pt.normalRenderTarget,g=pt.normalRenderTargetDepth,m=pt.pixelRatioNode,y=pt.resolution,w=new se(r.alpha??1),x=new vu(s,o,n,h,a,c,u,l,d,p,f,y,v,g,m,w),S=new Ie(x.calpha,"f"),b=new Ae(r.mode??0);return new We(t,i,e,{outlineColor:s,contourColor:o,outlineWidth:n,contourWidth:h,outlineThreshold:a,contourThreshold:c,outlineSmoothing:u,contourFrequency:l,contourDirection:d,positionalLines:p,compensation:f,alpha:w,mode:b},x,b,S)}case"depth":{let s=new Ae(r.gradientType??0),o=new Dr(r.smooth??!1),n=new se(r.near??50),h=new se(r.far??200),a=new se(r.isVector??1),c=new se(r.isWorldSpace??0),u=new ct(r.origin??new T),l=new ct(r.direction??new T),d;r.colors?d=new xi(r.colors.length,r.colors):(d=new xi(2,new Qe(0,0,0,1)),d.value[1]=new Qe(1,1,1,1));let p;r.steps?p=new bi(r.steps.length,r.steps):(p=new bi(2,1),p.value[0]=0);let f=new se(r.alpha??1),v=new Ae(r.mode??0),g=new xu(s,o,n,h,a,c,u,l,d,p,f),m=new Ie(g.calpha,"f");return new We(t,i,e,{gradientType:s,smooth:o,near:n,far:h,isVector:a,isWorldSpace:c,origin:u,direction:l,colors:d,steps:p,alpha:f,mode:v},g,v,m)}case"noise":{let s=new se(r.scale??1),o=new ct(r.size??new T(100,100,100)),n=new se(r.move??1),h=new ut(r.fA??new X(1.7,9.2)),a=new ut(r.fB??new X(8.3,2.8)),c=new ut(r.distortion??new X(1,1)),u=new Si(r.colorA),l=new Si(r.colorB),d=new Si(r.colorC),p=new Si(r.colorD),f=new se(r.alpha??1),v=new Ae(r.mode??0),g=new Ae(r.noiseType??0),m=new du(s,o,n,h,a,c,u,l,d,p,f,g),y=new Ie(m.calpha,"f");return new We(t,i,e,{scale:s,size:o,move:n,fA:h,fB:a,distortion:c,colorA:u,colorB:l,colorC:d,colorD:p,alpha:f,mode:v,noiseType:g},m,v,y)}case"normal":{let s=new ct(r.cnormal??new T(1,1,1)),o=new se(r.alpha??1),n=new Ae(r.mode??0),h=new Pu(s,o),a=new Ie("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");return a.keywords.alpha=o,new We(t,i,e,{cnormal:s,alpha:o,mode:n},h,n,a)}case"gradient":{let s=new Ae(r.gradientType??0),o=new Dr(r.smooth??!1),n;r.colors?n=new xi(r.colors.length,r.colors):(n=new xi(10,new Qe(0,0,0,1)),n.value[1]=new Qe(1,1,1,1));let h;r.steps?h=new bi(r.steps.length,r.steps):(h=new bi(10,1),h.value[0]=0);let a=new ut(r.offset??new X(0,0)),c=new ut(r.morph??new X(0,0)),u=new se(r.angle??0),l=new se(r.alpha??1),d=new Ae(r.mode??0),p=new Au(s,o,n,h,a,c,u,l),f=new Ie(p.calpha,"f");return new We(t,i,e,{gradientType:s,smooth:o,colors:n,steps:h,offset:a,morph:c,angle:u,alpha:l,mode:d},p,d,f)}default:{let s=new je(1,0,0,1),o=new se(1),n=new Ie("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");n.keywords.alpha=o;let h=new Ae(0);return s.alpha=o,new We(t,i,e,{color:s,alpha:o,mode:h},s,h,n)}}}function CS(e,t,i,r){let s=rS(i,r);return OS(i,e,t,s)}function ju(e,t,i){if(i.type==="displace"&&(e==="intensity"||e==="visible")){let r=t.uniforms[`f${t.id}_intensity`];return r?(r.value=i.intensity*(i.visible?1:0),r):void 0}if(i.type!=="displace"&&(e==="alpha"||e==="visible")){let r=t.uniforms[`f${t.id}_alpha`];if(!r)return;if(r.value=i.alpha*(i.visible?1:0),i.type==="outline"&&e==="visible"){let s=t.uniforms[`f${t.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return r}}function Bh(e,t){let i=0;for(let r of e.layers)if(r.data.type!=="displace"&&"alpha"in r.data&&r.data.type!=="light"&&r.data.type!=="fresnel"&&r.data.type!=="texture"&&r.data.type!=="matcap"&&r.data.type!=="rainbow"&&r.data.type!=="outline"){let s=r.data.visible?r.data.alpha:0;if(s===1&&r.data.type==="depth"||r.data.type==="gradient"){for(let o of r.data.colors)if(o[3]<1){s=o[3];break}}else if(s===1&&r.data.type==="noise"){let o=t.color(r.data.colorA).a,n=t.color(r.data.colorB).a,h=t.color(r.data.colorC).a,a=t.color(r.data.colorD).a,c=Math.min(o,Math.min(n,Math.min(h,a)));c<1&&(s=c)}i+=(1-i)*s}return i<1}var ui=class extends Op{constructor(){super(void 0),this.flatShading=!1,this.cacheKey="",this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return this.cacheKey}},PS=class extends ui{constructor(e,t,i,r){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=r}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}getFlavor(e,t,i){return this.root.getFlavor(e,t,i)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},Uu=class extends ui{constructor(e,t){super(),this.data=e,this.layerIdGen=0,this.flavors=[],this.type="NodeMaterial",this.updaters=[],this.reset0(e,t)}get nodeMaterial(){return this}getFlavor(e,t,i){let r=i?6:(e?3:0)+t;if(r===0)return this;this.flavors===void 0&&(this.flavors=[]),r-=1;let s=this.flavors[r];return s===void 0&&(s=new PS(e,t,i,this),this.flavors[r]=s,s.flatShading=e,s.side=t,s.updateAfterBuild()),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}reset(e,t){this.data!==e&&this.reset0(e,t)}reset0(e,t){this.data=e;let i=e.layers??Ft.defaultTwoLayerData("phong").layers;this.layers=i.map(r=>Ti.create(this.layerIdGen++,r.id,r.data,t.shared)),this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(),this.transparent=Bh(e,t.shared)}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(){this.cacheKey=this.computeCacheKey(),this.lightLayer=this.layers.find(e=>e instanceof Hi),this.lightLayer===void 0&&(this.lightLayer=new Hi(0,"",{...ft.defaultData("light","phong"),visible:!1},new hu,{})),this.dispose();for(let e of this.flavors)e&&e.dispose();this.blendColors(),this.blendAfterColors(),this.blendPositions()}updateByOp(e,t,i){var r,s,o;if(t!==void 0?this.data=t:t=this.data,this.transparent=Bh(t,i.shared),e.path[0]==="layers"){this.data=t;let n=i.shared,h=e.path[1];if(h===void 0){if(this.layers.reverse(),e.type===4){let a=Ti.create(this.layerIdGen++,e.id,e.data,i.shared);this.layers.splice(e.localIndex,0,a),(r=i.scene)==null||r.markNeedsUpdateRendererDirty()}else if(e.type===5)this.layers.splice(e.localIndex,1)[0].dispose(),(s=i.scene)==null||s.markNeedsUpdateRendererDirty();else if(e.type===6){let a=this.layers.findIndex(u=>u.uuid===e.id),c=this.layers[a];this.layers.splice(a,1),this.layers.splice(e.localIndex,0,c),(o=i.scene)==null||o.markNeedsUpdateRendererDirty()}this.layers.reverse(),this.onUpdate()}else{let a=this.layers.find(c=>c.uuid===h);if(a){let c=t.layers.data(h);if(a.updateByOp({...e,path:e.path.slice(2)},c,i)){let u=Ti.create(this.layerIdGen++,h,c,n);this.layers.splice(this.layers.findIndex(l=>l.uuid===h),1,u),this.onUpdate()}}}}else this.reset(t,i)}blendColors(){let e=this.layers.findIndex(i=>i instanceof We),t=this.layers.findIndex(i=>i instanceof Hi);if(e!==-1&&e<t){let i=this.layers[e].color;for(let r=e+1;r<t;++r){let s=this.layers[r];s instanceof We&&(i=new zh(i,s.color,s.alpha,s.mode))}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new Ie("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof Hi);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let r=this.layers[i];r instanceof We&&(e=new zh(e,r.color,r.alpha,r.mode))}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof Bu);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new Ut(t,e[i].position,Ut.ADD),t=new Ut(t,new se(.5).setReadonly(!0),Ut.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let i=(r,s,o)=>Math.min(Math.max(r,s),o);for(let r of this.layers)if(r.type==="displace"){let s=i(r.uniforms[`f${r.id}_intensity`].value,e,t);r.uniforms[`f${r.id}_intensity`].value=s}}computeCacheKey(){let e="[";for(let{data:t}of this.data.layers)if(t.type==="light")e+=`"${t.visible?t.category.toUpperCase():"Basic"}"`;else{let i=(Mu[t.type]??[]).map(o=>t[o]),r=(Eu[t.type]??[]).map(o=>{var n;return((n=t[o])==null?void 0:n.length)??0}),s=[...i,...r];s.length?e+=`["${t.type}", "${s.join('","')}"],`:e+=`"${t.type}",`}return e=e.slice(0,-1)+"]",e}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new Q_;this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof We){let t=e.params.texture;if(t instanceof Zn&&!t.image.loaded)return!1}return!0}getHash(){let e="{";return e+='"fragment":'+this.fragment.getHash(),e+="}",e}};Object.defineProperties(ui.prototype,{properties:{get:function(){return this.fragment.properties}}});var Kn=class extends Uu{},TS=uo(cf()),jh=new Map;function MS(e){if(typeof e=="string")return e;let t=jh.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},jh.set(e,t)),t.url}var vs=class{constructor({src:e,volume:t,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let s;typeof e=="string"?s={src:e}:s={src:MS(e),format:"wav"},this.sound=new TS.Howl(s),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},ES=class{constructor(){this.type="ShapePath",this.color=new yt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Ka,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var i;return(i=this.currentPath)==null||i.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){var s;return(s=this.currentPath)==null||s.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,s,o){var n;return(n=this.currentPath)==null||n.bezierCurveTo(e,t,i,r,s,o),this}splineThru(e){var t;return(t=this.currentPath)==null||t.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(p,f,v,g){let m=p.x,y=f.x,w=v.x,x=g.x,S=p.y,b=f.y,A=v.y,O=g.y,P=(x-w)*(S-A)-(O-A)*(m-w),_=(y-m)*(S-A)-(b-S)*(m-w),C=(O-A)*(y-m)-(x-w)*(b-S),M=P/C,N=_/C;if(C===0&&P!==0||M<=0||M>=1||N<0||N>1)return null;if(P===0&&C===0){for(let W=0;W<2;W++)if(r(W===0?v:g,p,f),t.loc===e.ORIGIN){let Q=W===0?v:g;return{x:Q.x,y:Q.y,t:t.t}}else if(t.loc===e.BETWEEN){let Q=+(m+t.t*(y-m)).toPrecision(10),re=+(S+t.t*(b-S)).toPrecision(10);return{x:Q,y:re,t:t.t}}return null}else{for(let re=0;re<2;re++)if(r(re===0?v:g,p,f),t.loc===e.ORIGIN){let $=re===0?v:g;return{x:$.x,y:$.y,t:t.t}}let W=+(m+M*(y-m)).toPrecision(10),Q=+(S+M*(b-S)).toPrecision(10);return{x:W,y:Q,t:M}}}function r(p,f,v){let g=v.x-f.x,m=v.y-f.y,y=p.x-f.x,w=p.y-f.y,x=g*w-y*m;if(p.x===f.x&&p.y===f.y){t.loc=e.ORIGIN,t.t=0;return}if(p.x===v.x&&p.y===v.y){t.loc=e.DESTINATION,t.t=1;return}if(x<-Number.EPSILON){t.loc=e.LEFT;return}if(x>Number.EPSILON){t.loc=e.RIGHT;return}if(g*y<0||m*w<0){t.loc=e.BEHIND;return}if(Math.sqrt(g*g+m*m)<Math.sqrt(y*y+w*w)){t.loc=e.BEYOND;return}let S;g!==0?S=y/g:S=w/m,t.loc=e.BETWEEN,t.t=S}function s(p,f){let v=[],g=[];for(let m=1;m<p.length;m++){let y=p[m-1],w=p[m];for(let x=1;x<f.length;x++){let S=f[x-1],b=f[x],A=i(y,w,S,b);A!==null&&v.find(O=>O.t<=A.t+Number.EPSILON&&O.t>=A.t-Number.EPSILON)===void 0&&(v.push(A),g.push(new X(A.x,A.y)))}}return g}function o(p,f,v){let g=new X;f.getCenter(g);let m=[];return v.forEach(y=>{y.boundingBox.containsPoint(g)&&s(p,y.points).forEach(w=>{m.push({identifier:y.identifier,isCW:y.isCW,point:w})})}),m.sort((y,w)=>y.point.x-w.point.x),m}function n(p,f,v,g,m){(m==null||m==="")&&(m="nonzero");let y=new X;p.boundingBox.getCenter(y);let w=[new X(v,y.y),new X(g,y.y)],x=o(w,p.boundingBox,f);x.sort((_,C)=>_.point.x-C.point.x);let S=[],b=[];x.forEach(_=>{_.identifier===p.identifier?S.push(_):b.push(_)});let A=S[0].point.x,O=[],P=0;for(;P<b.length&&b[P].point.x<A;)O.length>0&&O[O.length-1]===b[P].identifier?O.pop():O.push(b[P].identifier),P++;if(O.push(p.identifier),m==="evenodd"){let _=O.length%2===0,C=O[O.length-2];return{identifier:p.identifier,isHole:_,for:C}}else if(m==="nonzero"){let _=!0,C=null,M=null;for(let N=0;N<O.length;N++){let W=O[N];f[W]&&(_?(M=f[W].isCW,_=!1,C=W):M!==f[W].isCW&&(M=f[W].isCW,_=!0))}return{identifier:p.identifier,isHole:_,for:C}}else console.warn('fill-rule: "'+m+'" is currently not implemented.')}let h=0,a=999999999,c=-999999999,u=[];this.subPaths.forEach(p=>{let f=p.getPoints(),v=-999999999,g=999999999,m=-999999999,y=999999999;for(let w=0;w<f.length;w++){let x=f[w];x.y>v&&(v=x.y),x.y<g&&(g=x.y),x.x>m&&(m=x.x),x.x<y&&(y=x.x)}c<=m&&(c=m+1),a>=y&&(a=y-1),f.length&&u.push({curves:p.curves,points:f,isCW:Cp.isClockWise(f),identifier:h++,boundingBox:new Pp(new X(y,g),new X(m,v))})});let l=u.map(p=>{var f;return n(p,u,a,c,(f=this.userData)==null?void 0:f.style.fillRule)}),d=[];return u.forEach(p=>{let f=l[p.identifier];if(f&&!f.isHole){let v=new js;v.curves=p.curves,l.filter(g=>(g==null?void 0:g.isHole)&&g.for===p.identifier).forEach(g=>{if(g){let m=u[g.identifier],y=new Ka;y.curves=m.curves,v.holes.push(y)}}),d.push(v)}}),d}},Ru,Uh=new Promise(e=>{Ru=e}),Rh=!1;async function DS(){if(Rh)return;let e=await Tc(()=>import("../chunks/opentype.fc28cde9.js"),[],import.meta.url);Ru(e),Rh=!0}var LS=class{async load(e,t,i=()=>{}){let{load:r}=await Uh;r(e,(s,o)=>{s||!o?i(s??"Something went wrong"):t(o)})}async parse(e){let{parse:t,Bidi:i}=await Uh;try{let r=t(e),s=new i,o=n=>r.charToGlyphIndex(n.char);return s.registerModifier("glyphIndex",null,o),s.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:s}}catch(r){console.error(r)}}};async function IS(e){return await(await fetch(e)).arrayBuffer()}var zS=new LS;async function kh(e){let t,i,r=!1;if(e.url?(t=await IS(e.url),i=e.url,r=e.url.startsWith("/")):e.data&&(t=e.data.buffer),t){let s=await zS.parse(t);if(s)return{font:s.font,url:i,intercepted:r,arr:t,bidi:s.bidi}}}function NS(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var BS=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=kh(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=kh(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(t);let s=r.tokenizer.tokens,o=[],n=0,h=i.length===s.length;for(let a=0;a<i.length;a++){let c=i[a].index,u=String.fromCharCode(i[a].unicode),l=s[n];if(NS(c,l)||h)o.push({char:u,index:c,replacements:[l.state.glyphIndex],replacementChars:[l.char]}),n++;else{let d=l.char,p="",f=[l.state.glyphIndex],v=[],g=!1;for(;!g;)n++,p=t.charAt(n),d+=p,f.push(e.charToGlyphIndex(p)),v=e.stringToGlyphs(d),v.length===1&&v[0].index===c&&(g=!0),n>t.length&&(g=!0);o.push({char:u,index:c,replacements:f,replacementChars:Array.from(d)}),n++}}return o}generateShapes(e,t){if(!this._isLoaded)return;let i=this.font,r=t.fontSize/this.unitsPerEm,s=t.fontSize*t.lineHeight,o=e.map(m=>this.getTextWidth(m,t)),n=t.width,h=this.getCharWidth(`
`,t),a=t.horizontalAlign===1?h:0,c=this.computeSpaceWidthForLine(e,0,t),u=this.getLineInitialOffsetX(o[0],n,t.horizontalAlign,e[0],h),l=this.getLineInitialOffsetY(s,e.length,t.height,r,t.verticalAlign),d=[],p=e.map(m=>[]),f=e.map(m=>[]),v;for(let m=0;m<e.length;m++){let y=e[m],w={features:{liga:!0}},x=[];try{x=i.stringToGlyphs(y,w)}catch(b){console.warn(b)}u=this.getLineInitialOffsetX(o[m],n,t.horizontalAlign,y,h);let S=[];try{S=this.reverseLigaturesTable(i,y,x)}catch(b){console.warn(b)}c=this.computeSpaceWidthForLine(e,m,t);for(let b=0;b<x.length;b++){let A=x[b],O=A.index===0?`
`:A.unicode?String.fromCharCode(A.unicode):void 0,P=S[b],_=0,C=0;b===0&&t.horizontalAlign===2&&A.leftSideBearing!==void 0&&(C=-A.leftSideBearing*r),v&&(_=i.getKerningValue(A,v)*r),u+=C+_;let M=0;if(O===`
`)M=a;else if(O===" ")M=c;else{let N=this.createPath(A,r,u,l,t);N&&(M=N.offsetX-(_+C),d.push(N.path))}if(P.replacements.length===1)f[m].push([u,l]),p[m].push(M);else{let N=P.replacements.map($=>(i.glyphs.get($).advanceWidth??0)*r),W=N.reduce(($,V)=>$+=V,0),Q=N.map($=>$/W),re=u;for(let $=0;$<Q.length;$++){let V=M*Q[$];f[m].push([re,l]),p[m].push(V),re+=V}}u+=M,v=A}l-=s}let g=[];for(let m=0,y=d.length;m<y;m++)g.push(...d[m].toShapes());return{shapes:g,charWidths:p,lineWidths:o,charCoords:f}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e;return((e=this.font)==null?void 0:e.ascender)??0}get descender(){var e;return((e=this.font)==null?void 0:e.descender)??0}get familyName(){var e;return((e=this.font)==null?void 0:e.names.fontFamily)??""}get subfamilyName(){var e;return((e=this.font)==null?void 0:e.names.fontSubfamily)??""}get unitsPerEm(){var e;return((e=this.font)==null?void 0:e.unitsPerEm)??1}getLineInitialOffsetX(e,t,i,r,s){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(e-=s),i===3?t*.5-e*.5:i===2?t-e:0}getLineInitialOffsetY(e,t,i,r,s){let o=t*e,n=Math.abs(this.ascender-this.descender)*r,h=e-n,a=-this.ascender*r-h/2;return s===3?-(i-o-a):s===2?-(i*.5-o*.5-a):a}createPath(e,t,i,r,s){var a;let o=e.getPath(i,-r,s.fontSize,{kerning:!1,letterSpacing:s.letterSpacing});if(!o){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let n=new ES,h=(e.advanceWidth??1)*t;if(e)for(let c of o.commands){let u=(a=n.currentPath)==null?void 0:a.currentPoint;if(!(u&&c.type!=="Z"&&u.x===c.x&&-u.y===c.y))switch(c.type){case"M":n.moveTo(c.x,-c.y);break;case"L":n.lineTo(c.x,-c.y);break;case"Q":n.quadraticCurveTo(c.x1,-c.y1,c.x,-c.y);break;case"C":n.bezierCurveTo(c.x1,-c.y1,c.x2,-c.y2,c.x,-c.y);break}}return n.subPaths.forEach(c=>{let u=jS(c.curves);u!==void 0&&c.currentPoint.distanceTo(u)>0&&c.lineTo(u.x,u.y)}),{offsetX:h+s.fontSize*s.letterSpacing,path:n}}getCharWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}getTextWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}computeSpaceWidthForLine(e,t,i){let r=this.getCharWidth(" ",i),s=e[t];if(s){let o=this.countSpaces(s.trimEnd());if(i.horizontalAlign===4&&t<e.length-1&&o){let n=i.width,h=this.getTextWidth(s,i);return(n-(h-o*r))/o}}return r}countSpaces(e){return(e.match(/ /g)||[]).length}};function jS(e){if(e.length){let t=e[0];if(t instanceof hi)return t.v1;if(t instanceof $t||t instanceof ir)return t.v0}}var US=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t){let i=this.objects.get(e);return i===void 0?(i=this.createObject(e,t),this.objects.set(e,i)):i.isShared=!0,i}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&i.isShared!==!0)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){let i=this.objects.get(e);t===i&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},Fh=class extends US{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t){let i=ao(e,t,this.flatShading);return i.computeBoundingSphere(),i}},RS={find(e){},markNeedsUpdateRendererDirty:function(){},markGeometryCacheDirty:function(){},addPendingExpandCloner:function(e){},addPendingUpdateCloner(e){},addPendingCommand(e){}},kS=class extends bS{constructor(e){super(),this.shared=e}create(e){return new Tu(e,this.shared)}},Fa=class{constructor(e,t={}){if(this.geometryCache=new Fh(!0),this.geometryCache2=new Fh(!1),this.imageHolderCache=new kS(this),this.thisContext={scene:RS,shared:this},this.deletedMaterial=new Kn(Ft.defaultTwoLayerData("phong"),this.thisContext),this.deletedImage=new Oi(so.emptyImage,this),this.deletedVideo=new Oi(qs.defaultVideo,this),this.materials={},this.images={},this.videos={},this.colors={},this.audios={},this.fonts={},this.penumbraSize=[],this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[i,r]of Object.entries(t.images))this.addImage(i,r);if(t.videos)for(let[i,r]of Object.entries(t.videos))this.addVideo(i,r);if(t.audios)for(let[i,r]of Object.entries(t.audios))this.addAudio(i,r.data);this.reset(e)}setRequestRender(e){this._requestRender=e}reset(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,new Kn(i,this.thisContext));for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.data);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i);this.penumbraSize=e.penumbraSize}addMaterial(e,t){t.uuid=e,this.materials[e]=t}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):new Uu(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new Oi(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new Oi(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new lo(t.r,t.g,t.b,t.a):this.colors[e]=new lo(t.r,t.g,t.b,1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}color(e){let t;if(typeof e=="string"){let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new Ct(0,0,0,0))}else return"a"in e?new Ct(e.r,e.g,e.b,e.a):new Ct(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof vs)return t;{let i=new vs({src:t});return this.audios[e]=i,i}}deleteAudio(e){let t=this.audios[e];t&&(t instanceof vs&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new BS(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof vs&&e.dispose()}),this.audios={},this.geometryCache.dispose(),this.geometryCache2.dispose()}},FS=new Fa(Rn.emptyData()),es=class extends di{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),Sf(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[r,s]of Object.entries(e.props)){let o=i.shared.material(s);this.material[Number(r)]=o}else if(ti(e.path,["material"])&&this.material instanceof ui)"material"in t&&typeof t.material!="string"&&this.material.updateByOp(st.drop(e,1),t.material,i);else if(ti(e.path,["materials","*"])&&Array.isArray(this.material)){let r=e.path[1];if("materials"in t&&r<this.material.length){let s=t.materials[r];typeof s!="string"&&this.material[r].updateByOp(st.drop(e,2),s,i)}}}updateState(e,t){var r,s,o,n,h;super.updateState(e,t),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;if(((r=e.geometry)==null?void 0:r.type)!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe),(s=t.scene)==null||s.markNeedsUpdateRendererDirty()),((o=e.geometry)==null?void 0:o.type)==="NonParametricGeometry"&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(a=>t.shared.material(a).getFlavor(i.flatShading,i.side,i.wireframe)),(n=t.scene)==null||n.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],(h=t.scene)==null||h.markNeedsUpdateRendererDirty())),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let a=0;a<this.material.length;a++)this.material[a]=this.material[a].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe)}disposeMaterial(){this.material&&Qc(this.material).forEach(e=>{e instanceof ui&&(e instanceof Kn||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},pi=class extends es{constructor(e,t,i){super(e,t),this.data=t,this.localGeometry=void 0}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof Pe&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof Fa){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return Ys.is2DParametricMesh(e.type)&&e.depth===0}get is2DType(){return Ys.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),ti(e.path,["geometry"])&&this.updateByPatchedOpGeometry(st.drop(e,1),t.geometry,i)}removeInteractionGeometry(){var e;(e=this.localGeometry)==null||e.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){var r;this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let s=e;if(this.localGeometry===void 0){let c={...this.data.geometry,...s};this.localGeometry=ao(c,t,this.data.flatShading)}let o,n,h;s.scaleBaked?[o,n,h]=s.scaleBaked:{width:o,height:n,depth:h}=s;let a=this.localGeometry.userData;a.sxPrev!==void 0&&$n(this.localGeometry.attributes,o/a.sxPrev,n/a.syPrev,h/a.szPrev),a.sxPrev=o,a.syPrev=n,a.szPrev=h}else{let s={...this.data.geometry,...e};(r=this.localGeometry)==null||r.dispose(),this.localGeometry=ao(s,t,this.data.flatShading)}}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){var s;let r=!1;e.type===0&&e.path.length===0&&Pd(["scaleBaked"],Object.keys(e.props))&&this.geometryCreateDeleyed instanceof Ye&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||((s=i.scene)==null||s.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){e.geometry!==void 0&&this.updateGeometryOnStateUpdate(e.geometry,t),super.updateState(e,t)}updateGeometryGroupsIfNeeded(){var e;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((e=this.geometry.getIndex())==null?void 0:e.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,i.depth*.5):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}};function VS(e){var n,h;if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,r=i.position.array,s=i.normal.array,o=new Float32Array(r.length);for(let a=0;a<r.length;a+=3){let c=`${r[a]}_${r[a+1]}_${r[a+2]}`,u=new T(s[a],s[a+1],s[a+2]);t.has(c)?(n=t.get(c))==null||n.normals.push(u):t.set(c,{normals:[u],result:new T})}t.forEach((a,c)=>{for(let u of a.normals)a.result.add(u);a.result.divideScalar(a.normals.length)});for(let a=0;a<r.length;a+=3){let c=`${r[a]}_${r[a+1]}_${r[a+2]}`,u=(h=t.get(c))==null?void 0:h.result;u&&(o[a]=u.x,o[a+1]=u.y,o[a+2]=u.z)}e.geometry.setAttribute("extrudeNormal",new ge(o,3))}function GS(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=new T;for(let s=0;s<t.length;s+=3)r.set(t[s],t[s+1],t[s+2]).normalize(),i[s]=r.x,i[s+1]=r.y,i[s+2]=r.z;e.geometry.setAttribute("extrudeNormal",new ge(i,3))}function Va(e){if(Array.isArray(e.material)){for(let t of e.material)if(t.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof ui)||e.material.getLayersOfType("outline").length===0)return;e instanceof pi&&e.is2DAndNoDepth?GS(e):VS(e)}function Ga(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=parseInt(e.uuid.replace(/\D/g,"")),s=[Ue.seededRandom(r),Ue.seededRandom(r+1e4),Ue.seededRandom(r+2e4)];for(let o=0;o<t.length;o++)i[o]=s[o%3];e.geometry.setAttribute("randomColor",new ze(i,3))}Ba.then(e=>{});var It=new Li,Lr=new T;function HS(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var Qn=class extends pi{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new me,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){var o,n,h;if(this.skipReactionUpdate===!0)return;let t=(o=this.localGeometry)==null?void 0:o.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:s}=Ye.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=s,i!==void 0&&((n=this.originalGeometry)==null||n.dispose(),this.originalGeometry=i),r!==void 0&&((h=this.subdividedGeometry)==null||h.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,Va(this),Ga(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),e.flatShading!==void 0){let i=this.material;this.material=i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){Ye.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&Ye.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=Ye.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=Ye.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,di.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new tr,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;It.setFromBufferAttribute(t),It.getCenter(i),e.boundingSphere.radius=i.distanceTo(It.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),It.getSize(Lr),this.hasNonUniformScale&&Lr.divide(this.scale);let r={width:Lr.x,height:Lr.y,depth:Lr.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(e){let t=this.originalGeometry;It.min.set(e[0],e[2],e[4]),It.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(It.min.applyMatrix4(this.shearScaleInv),It.max.applyMatrix4(this.shearScaleInv)),t.boundingSphere===null&&(t.boundingSphere=new tr);let i=t.boundingSphere.center;It.getCenter(i),t.boundingSphere.radius=i.distanceTo(It.max)}freeSubdivPointer(){var e,t;this.subdivPointer&&(Ye.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(e=this.originalGeometry)==null||e.dispose(),(t=this.subdividedGeometry)==null||t.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},Vh=-1,WS=1,qS={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},$S={polygon_center:0,edge:1,vertex:2},ys=(e,t)=>(i,r)=>!t||i===0||e===0?0:e*r/100,pe=(e,t)=>{let i=Math.abs(t),r=i*-1;return(e-Vh)*(i-r)/(WS-Vh)+r};function XS(e){let t=[],i={};for(var r=0,s=e.length;r<s;r++){var o=JSON.stringify(e[r].pos.map(n=>Math.round(n*1e4)/1e4));i[o]||(t.push(e[r]),i[o]=!0)}return t}var YS=new T,bs=new T,ZS=new T,KS=new T;function Ji(e,t){let i=ZS.fromArray(e),r=KS.fromArray(t);bs.copy(r).sub(i);let s=bs.length();return bs.normalize().multiplyScalar(s*.5),YS.copy(i).add(bs).toArray()}var mt=new ia,xs=new T,ho=new T,Ai=new T;function QS(e){let t=[];for(let i=0;i<=e.index.count;i++)if(xs.fromArray(e.index.array,i*3),mt.setFromAttributeAndIndices(e.attributes.position,xs.x,xs.y,xs.z),mt.getNormal(ho),mt.getMidpoint(Ai),!(isNaN(Ai.x)||isNaN(Ai.y)||isNaN(Ai.z))){let{a:r,b:s,c:o}=mt,n=r.toArray(),h=s.toArray(),a=o.toArray(),c=r.distanceTo(s),u=s.distanceTo(o),l=o.distanceTo(r),d=Ji(n,h),p=Ji(h,a),f=Ji(a,n),v=[c,u,l],g=Math.max(...v),m=v.filter(x=>Math.round(x)===Math.round(g)).length>1,y=[],w=mt.getMidpoint(Ai).toArray();g===c&&!m&&(y=[p,f,f],w=d),g===u&&!m&&(y=[d,f,f],w=p),g===l&&!m&&(y=[d,p,p],w=f),m&&(y=[d,p,f]),t.push({vertices:[n,h,a],faceCenters:y,midpoint:w,norm:mt.getNormal(ho).toArray()})}return t}function JS(e){let t=[],{position:i}=e.attributes;for(let r=0;r<i.count;r++){mt.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),mt.getNormal(ho),mt.getMidpoint(Ai);let s=mt.a.toArray(),o=mt.b.toArray(),n=mt.c.toArray();t.push({vertices:[s,o,n],faceCenters:[Ji(s,o),Ji(o,n),Ji(n,s)],midpoint:Ai.toArray(),norm:ho.toArray()})}return t}var e2=4,t2=.5,nn=e=>.5*(1-Math.cos(e*Math.PI)),i2=class{constructor(){this.perlin=new Array(4095+1)}noise(e,t=0,i=0){if(this.perlin==null){this.perlin=new Array(4095+1);for(let g=0;g<4095+1;g++)this.perlin[g]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let r=Math.floor(e),s=Math.floor(t),o=Math.floor(i),n=e-r,h=t-s,a=i-o,c,u,l=0,d=.5,p,f,v;for(let g=0;g<e2;g++){let m=r+(s<<4)+(o<<8);c=nn(n),u=nn(h),p=this.perlin[m&4095],p+=c*(this.perlin[m+1&4095]-p),f=this.perlin[m+16&4095],f+=c*(this.perlin[m+16+1&4095]-f),p+=u*(f-p),m+=256,f=this.perlin[m&4095],f+=c*(this.perlin[m+1&4095]-f),v=this.perlin[m+16&4095],v+=c*(this.perlin[m+16+1&4095]-v),f+=u*(v-f),p+=nn(a)*(f-p),l+=p*d,d*=t2,r<<=1,n*=2,s<<=1,h*=2,o<<=1,a*=2,n>=1&&(r++,n--),h>=1&&(s++,h--),a>=1&&(o++,a--)}return l}noiseSeed(e){let t=(()=>{let i,r;return{setSeed(s){r=i=(s??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();t.setSeed(e),this.perlin=new Array(4095+1);for(let i=0;i<4095+1;i++)this.perlin[i]=t.rand()}},r2=i2,Gh=new T,Hh=new me,Wh=new ra;function s2(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="TextGeometry"&&(t=!0)}),t}var ku=class extends pi{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var t;let e=this.dataPatched;return((t=this.font)==null?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign))??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e;return(((e=this.font)==null?void 0:e.ascender)??1)*this.fontScale}get descender(){var e;return(((e=this.font)==null?void 0:e.descender)??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(Hh.copy(i).invert(),Wh.copy(e.ray).applyMatrix4(Hh),Wh.intersectBox(this.singleBBox,Gh))){let r=Gh.applyMatrix4(i),s=e.ray.origin.distanceTo(r);t.push({distance:s,point:r.clone(),object:this})}}},Xe=1e-4,zt,Fu,Vu,Gu,qh=new T,$h=new T;Ba.then(e=>{zt=e,Fu=[zt.get_face_center,zt.get_edge_midpoint,zt.get_vertex_position],Vu=[zt.get_face_normal,zt.get_edge_normal,zt.get_vertex_normal],Gu=[zt.face_count,zt.edge_count,zt.vertex_count]});var o2=new me,n2=new me,Jt=new T,gi=new T,Ir=new T,an=new T,a2=new T,l2=new T,Wt=new r2,Hu=class extends Ea(er){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(this.parent===null)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof jr&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof jr&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(e!==void 0?t=e:t=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"&&!this.parameters.toObject.object&&(t=0),this.parameters.type==="toObject"&&this.objectForSample){for(let r=0,s=this.children.length;r<s;++r)this.remove(this.children[0]);let i=this.children;if(i.length===t)return;if(i.length<t)for(let r=0,s=t-i.length;r<s;++r){let o=new jr(this.object);o.expand(),this.add(o)}else for(let r=0,s=i.length-t;r<s;++r)this.remove(i[r])}else{if(this.children.length===t)return;if(this.children.length<t)for(let i=0,r=t-this.children.length;i<r;++i){let s=new jr(this.object);s.expand(),this.add(s)}else for(let i=0,r=this.children.length-t;i<r;++i)this.remove(this.children[0])}}_updateRadial(e){let t=e.radial,i=t.start*Ue.DEG2RAD,r=t.end*Ue.DEG2RAD,s=i-r,o=new Ms(t.rotation[0],t.rotation[1],t.rotation[2]),n;switch(t.axis){case"z":n=new T(0,0,1);break;case"y":n=new T(0,1,0);break;default:case"x":n=new T(1,0,0);break}let h=e.randomnessObject??si.defaultData([1,1,1]).randomnessObject,a=h.noiseType==="perlin";Wt.noiseSeed(h.seed);let c=Ho((0,Ar.default)(h.seed)),u=ys(h.strength,this.parameters.randomness);for(let[l,d]of this.children.entries()){let p=l*(h.freqScale/10)+h.movement,f=a?Wt.noise(p):c(p,p);d.scale.x=t.scale[0]+u(l,pe(f,h.scale[0]))||Xe,d.scale.y=t.scale[1]+u(l,pe(f,h.scale[1]))||Xe,d.scale.z=t.scale[2]+u(l,pe(f,h.scale[2]))||Xe,d.position.setScalar(0);let v=s/e.count*l-i;switch(t.axis){case"x":d.rotation.set(0,v,0);break;case"y":d.rotation.set(0,0,v);break;case"z":d.rotation.set(v,0,0);break}d.translateOnAxis(n,t.radius),d.position.x+=t.position[0]+u(l,pe(f,h.position[0])),d.position.y+=t.position[1]+u(l,pe(f,h.position[1])),d.position.z+=t.position[2]+u(l,pe(f,h.position[2]));let g=u(l,pe(f,h.rotation[0])),m=u(l,pe(f,h.rotation[1])),y=u(l,pe(f,h.rotation[2]));t.alignment===!0?(d.rotation.x+=o.x+g,d.rotation.y+=o.y+m,d.rotation.z+=o.z+y):d.rotation.set(o.x+g,o.y+m,o.z+y)}}_updateLinear(e){if(e.type!=="linear")throw new Error;let t=e.linear,i=new Ms(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??si.defaultData([1,1,1]).randomnessObject,s=r.noiseType==="perlin";Wt.noiseSeed(r.seed);let o=Ho((0,Ar.default)(r.seed)),n=ys(r.strength,this.parameters.randomness);for(let[h,a]of this.children.entries()){let c=h*(r.freqScale/10)+r.movement,u=s?Wt.noise(c):o(c,c),l=n(h,pe(u,r.rotation[0])),d=n(h,pe(u,r.rotation[1])),p=n(h,pe(u,r.rotation[2]));a.scale.x=1+(t.scale[0]-1)*h+n(h,pe(u,r.scale[0]))||Xe,a.scale.y=1+(t.scale[1]-1)*h+n(h,pe(u,r.scale[1]))||Xe,a.scale.z=1+(t.scale[2]-1)*h+n(h,pe(u,r.scale[2]))||Xe,a.rotation.x=i.x*h+l,a.rotation.y=i.y*h+d,a.rotation.z=i.z*h+p,a.position.x=t.position[0]*h+n(h,pe(u,r.position[0])),a.position.y=t.position[1]*h+n(h,pe(u,r.position[1])),a.position.z=t.position[2]*h+n(h,pe(u,r.position[2]))}}_updateGrid(e){let t=0,i=e.grid,r=e.randomnessObject??si.defaultData([1,1,1]).randomnessObject,s=ys(r.strength,this.parameters.randomness),o=r.noiseType==="perlin";Wt.noiseSeed(r.seed);let n=aw((0,Ar.default)(r.seed));if(i.useCenter===!0){let h={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},a=new T(i.size[0]*(i.count[0]-h.x)*.5,i.size[1]*(i.count[1]-h.y)*.5,i.size[2]*(i.count[2]-h.z)*.5);for(let c=0;c<i.count[0];c++)for(let u=0;u<i.count[1];u++)for(let l=0;l<i.count[2];l++){let d=[(c+1)*(r.freqScale/10)+r.movement,(u+1)*(r.freqScale/10)+r.movement,(l+1)*(r.freqScale/10)+r.movement],p=o?Wt.noise(...d):n(...d),f=this.children[t++];f.scale.x=1+s(t,pe(p,r.scale[0]))||Xe,f.scale.y=1+s(t,pe(p,r.scale[1]))||Xe,f.scale.z=1+s(t,pe(p,r.scale[2]))||Xe;let v=s(t,pe(p,r.rotation[0])),g=s(t,pe(p,r.rotation[1])),m=s(t,pe(p,r.rotation[2]));f.rotation.set(v,g,m),f.position.x=i.size[0]*c-a.x+s(t,pe(p,r.position[0])),f.position.y=i.size[1]*u-a.y+s(t,pe(p,r.position[1])),f.position.z=i.size[2]*l-a.z+s(t,pe(p,r.position[2]))}}else for(let h=0;h<i.count[0];h++)for(let a=0;a<i.count[1];a++)for(let c=0;c<i.count[2];c++){let u=[(h+1)*(r.freqScale/10)+r.movement,(a+1)*(r.freqScale/10)+r.movement,(c+1)*(r.freqScale/10)+r.movement],l=o?Wt.noise(...u):n(...u),d=this.children[t++];d.scale.x=1+s(t,pe(l,r.scale[0]))||Xe,d.scale.y=1+s(t,pe(l,r.scale[1]))||Xe,d.scale.z=1+s(t,pe(l,r.scale[2]))||Xe;let p=s(t,pe(l,r.rotation[0])),f=s(t,pe(l,r.rotation[1])),v=s(t,pe(l,r.rotation[2]));d.rotation.set(p,f,v),d.position.x=i.size[0]*h+s(t,pe(l,r.position[0])),d.position.y=-i.size[1]*a+s(t,pe(l,r.position[1])),d.position.z=-i.size[2]*c+s(t,pe(l,r.position[2]))}}_updateToObject(e){var v;if(e.type!=="toObject")throw new Error;let{toObject:t}=e,i=new Ms(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??si.defaultData([1,1,1]).randomnessObject,s=r.noiseType==="perlin";Wt.noiseSeed(r.seed);let o=Ho((0,Ar.default)(r.seed)),n=ys(r.strength,this.parameters.randomness);if(!t.object){for(let[,g]of this.children.entries())g.position.set(0,0,0),g.scale.setScalar(1),g.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof ku)if(!((v=this.objectForSample.font)!=null&&v.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let h=this.getSubdivData(),a=[],c=g=>{let m=g.length,y=g.map(S=>S[0]).reduce((S,b)=>S+b,0),w=g.map(S=>S[1]).reduce((S,b)=>S+b,0),x=g.map(S=>S[2]).reduce((S,b)=>S+b,0);return[y/m,w/m,x/m]},u=g=>Math.round(g*1e6)/1e6;h.forEach(g=>{let m=h.filter(y=>u(g.pos[0])===u(y.pos[0])&&u(g.pos[1])===u(y.pos[1])&&u(g.pos[2])===u(y.pos[2]));m.length>1?a.push({pos:g.pos,norm:c(m.map(y=>y.norm))}):a.push(g)});let l=XS(a);if(h.length>0){let g=Math.round(l.length*t.count/100);this._updateCount(g)}this.objectForSample.updateMatrixWorld();let d=new lw(this.objectForSample).build(),p=qS[t.axis],f=this.children;d.setRandomGenerator((0,Ar.default)(this.object.uuid+t.seed));for(let[g,m]of f.entries()){let y=g*(r.freqScale/10)+r.movement,w=s?Wt.noise(y):o(y,y),x=n(g,pe(w,r.rotation[0])),S=n(g,pe(w,r.rotation[1])),b=n(g,pe(w,r.rotation[2]));t.spreadType==="random"?d.sample(Ir,an):(l.length&&(Ir.fromArray(l[g].pos),an.fromArray(l[g].norm)),this.objectForSample instanceof Qn&&Ir.applyMatrix4(o2.copy(this.objectForSample.matrixWorld).invert())),Ir.applyMatrix4(this.object.hiddenMatrix.clone().invert()),m.position.copy(Ir),Jt.fromArray(p);let A=t.align==="normal"?an:this.object.getWorldDirection(l2),O=gi.fromArray(t.position);gi.x+=gi.x+n(g,pe(w,r.position[0])),gi.y+=gi.y+n(g,pe(w,r.position[1])),gi.z+=gi.z+n(g,pe(w,r.position[2]));let P=Math.acos(A.dot(Jt)),_=a2.crossVectors(Jt,A).normalize(),C=n2.makeRotationAxis(_,P),M=A.clone().cross(this.object.up).normalize(),N=M.clone().cross(A).normalize(),W=new me().makeBasis(M,A,N),Q=new T(Jt.y,Jt.z,Jt.x).normalize(),re=Q.clone().cross(Jt).normalize(),$=new me().makeBasis(Q,Jt,re).invert(),V=new me().multiplyMatrices(W,$);m.rotation.setFromRotationMatrix(V),O.applyMatrix4(C),m.position.add(O),m.rotation.x=m.rotation.x+i.x+x,m.rotation.y=m.rotation.y+i.y+S,m.rotation.z=m.rotation.z+i.z+b,m.scale.setScalar(1),m.scale.x=m.scale.x+t.scale[0]+n(g,pe(w,r.scale[0]))||Xe,m.scale.y=m.scale.y+t.scale[1]+n(g,pe(w,r.scale[1]))||Xe,m.scale.z=m.scale.z+t.scale[2]+n(g,pe(w,r.scale[2]))||Xe,m.scale.multiply(this.object.scale),m.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType;if(e==="random")return[];if(this.objectForSample instanceof Qn){let t=this.objectForSample,i=$S[e],r=Gu[i],s=Fu[i],o=Vu[i],n=[],h=r(t.subdivPointerNew);for(let a=0;a<=h-1;a++){let c=s(t.subdivPointerNew,a),u=o(t.subdivPointerNew,a);qh.fromArray(c).applyMatrix4(t.matrixWorld),$h.fromArray(u),n.push({pos:qh.toArray(),norm:$h.toArray()})}return n}else return(this.objectForSample.geometry.index?QS(this.objectForSample.geometry):JS(this.objectForSample.geometry)).map((t,i)=>e==="polygon_center"?{pos:t.midpoint,norm:t.norm}:e==="vertex"?[{pos:t.vertices[0],norm:t.norm},{pos:t.vertices[1],norm:t.norm},{pos:t.vertices[2],norm:t.norm}]:e==="edge"?[{pos:t.faceCenters[0],norm:t.norm},{pos:t.faceCenters[1],norm:t.norm},{pos:t.faceCenters[2],norm:t.norm}]:[]).flat()}updateState(e,t){var i;if(this.parameters=So(e),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(i=this.object.parent)==null||i.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let r=t.find(this.parameters.toObject.object);r instanceof di?this.objectForSample=r:this.objectForSample=void 0,this.matrix=new me,this.hiddenMatrix=new me,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,r&&r.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},ts=e=>{var t;return t=class extends e{},t.geometryHelper=new Mi(30,30,30),t},ws=new ra,ln=new tr,Xh=new me,is=(e,t,i,r,s=!1)=>{let o=t,n=e.matrixWorld;if(o.boundingSphere===null&&o.computeBoundingSphere(),ln.copy(o.boundingSphere),ln.applyMatrix4(n),i.ray.intersectsSphere(ln)===!1||(Xh.copy(n).invert(),ws.copy(i.ray).applyMatrix4(Xh),o.boundingBox!==null&&ws.intersectsBox(o.boundingBox)===!1))return;let h,a,c,u,l=o.index,d=o.attributes.position,p=o.drawRange,f,v;if(s===!1){let m=Math.max(0,p.start),y=Math.min(l.count,p.start+p.count);for(f=m,v=y;f<v;f+=3)if(a=l.getX(f),c=l.getX(f+1),u=l.getX(f+2),h=g(e,i,ws,d,a,c,u),h){h.faceIndex=Math.floor(f/3),r.push(h);return}}else{let m=o.attributes.position,y=new T,w=new T,x=new T,S=new T,b=2,A=1/((e.scale.x+e.scale.y+e.scale.z)/3),O=A*A,P=Math.max(0,p.start),_=Math.min(m.count,p.start+p.count);for(let C=P,M=_-1;C<M;C+=b){if(y.fromBufferAttribute(m,C),w.fromBufferAttribute(m,C+1),ws.distanceSqToSegment(y,w,S,x)>O)continue;S.applyMatrix4(e.matrixWorld);let N=i.ray.origin.distanceTo(S);N<i.near||N>i.far||r.push({distance:N,point:x.clone().applyMatrix4(e.matrixWorld),object:e})}}function g(m,y,w,x,S,b,A){let O=new T,P=new T,_=new T,C=new T,M=new T;if(O.fromBufferAttribute(x,S),P.fromBufferAttribute(x,b),_.fromBufferAttribute(x,A),w.intersectTriangle(O,P,_,!1,C)===null)return null;M.copy(C),M.applyMatrix4(m.matrixWorld);let N=y.ray.origin.distanceTo(M);return N<y.near||N>y.far?null:{faceIndex:1,distance:N,point:M.clone(),object:m}}},_s=new T,ht=new yc,h2=class extends Tp{constructor(e){let t=new Pe,i=new Mp({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={},n=new yt(15711266),h=new yt(15711266),a=new yt(2857471);c("n1","n2",n),c("n2","n4",n),c("n4","n3",n),c("n3","n1",n),c("f1","f2",n),c("f2","f4",n),c("f4","f3",n),c("f3","f1",n),c("n1","f1",n),c("n2","f2",n),c("n3","f3",n),c("n4","f4",n),c("p","n1",h),c("p","n2",h),c("p","n3",h),c("p","n4",h),c("u1","u2",a),c("u2","u3",a),c("u3","u1",a);function c(l,d,p){u(l,p),u(d,p)}function u(l,d){r.push(0,0,0),s.push(d.r,d.g,d.b),o[l]===void 0&&(o[l]=[]),o[l].push(r.length/3-1)}t.setAttribute("position",new ge(r,3)),t.setAttribute("color",new ge(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){let e=this.geometry,t=this.pointMap;ht.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,s=.8;_t("n1",t,e,ht,-i,-r,s),_t("n2",t,e,ht,i,-r,s),_t("n3",t,e,ht,-i,r,s),_t("n4",t,e,ht,i,r,s);let o=s;_t("f1",t,e,ht,-i,-r,o),_t("f2",t,e,ht,i,-r,o),_t("f3",t,e,ht,-i,r,o),_t("f4",t,e,ht,i,r,o);let n=o,h=.5;_t("u1",t,e,ht,i*.7*h,r*1.1,n),_t("u2",t,e,ht,-i*.7*h,r*1.1,n),_t("u3",t,e,ht,0,r*(1.1+.9*h),n),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function _t(e,t,i,r,s,o,n){_s.set(s,o,n).unproject(r);let h=t[e];if(h!==void 0){let a=i.getAttribute("position");for(let c=0,u=h.length;c<u;c++)a.setXYZ(h[c],_s.x,_s.y,_s.z)}}var c2=class extends ts(h2){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){is(this.object,this.geometry,e,t,!0)}},Jn;(e=>e.is=t=>"objectHelper"in t)(Jn||(Jn={}));var Oo=(e,t)=>class extends Dd(e){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof Us&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof Mi?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof Us&&(r.visible=!1)}}},hn=790,Ri=new T,cn=new T,dn=new Ac,un=new T,zr=new T,pn=new T,Gr=class extends Oo(yc,c2){constructor(e="",t={...to.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=$r.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;if(t.orthographic.autoZoom){let s=t.orthographic.autoZoomFrustumSize??hn,o=i/r,n=i>r?o:1,h=i>r?1:o;this.orthoCamera=new Qa(-s*.5*n,s*.5*n,s*.5*(1/h),-s*.5*(1/h),-5e4,1e4)}else this.orthoCamera=new Qa(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4);this.perspCamera=new Sc(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){e==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){typeof e=="number"&&(e=new T(e,t,i)),super.lookAt(e),this.getWorldPosition(Ri),this.targetOffset=Ri.distanceTo(e)}getTarget(e=new T){return this.getWorldDirection(cn),this.getWorldPosition(Ri),cn.multiplyScalar(this.targetOffset),e.copy(Ri).add(cn),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(Ri),Ri.distanceTo(e)}updateUp(){this.getWorldQuaternion(dn),un.set(0,0,1).applyQuaternion(dn),zr.copy(er.DEFAULT_UP),this.isUpVectorFlipped&&zr.negate(),zr.applyQuaternion(dn),pn.copy(er.DEFAULT_UP).projectOnPlane(un),this.angleOffsetFromUp=pn.angleTo(zr),this.angleOffsetFromUp*=pn.cross(zr).dot(un)>=0?1:-1}updateTransformState(e){let t=super.updateTransformState(e);return e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),t}getViewFrontToObject(e){let t=e.getWorldPosition(new T),i=e.getWorldDirection(new T).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToObject(e){let t=e.getWorldPosition(new T),i=this.getWorldDirection(new T).multiplyScalar(this.targetOffset);return{position:t.clone().sub(i),target:t}}setViewplaneSize(e,t){if(this.aspect=e/t,this.data.type==="OrthographicCamera"&&this.data.orthographic.autoZoom){let i=this.data.orthographic.autoZoomFrustumSize??hn,r=e>t?this.aspect:1,s=e>t?1:this.aspect;this.left=-i*.5*r,this.right=i*.5*r,this.top=i*.5*(1/s),this.bottom=-i*.5*(1/s)}else this.left=-e*.5,this.right=e*.5,this.top=t*.5,this.bottom=-t*.5;this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,r,s,o){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,t,i,r,s,o):this.orthoCamera.setViewOffset(e,t,i,r,s,o)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom,autoZoom:!0,autoZoomFrustumSize:hn},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return jn(t,e)}updateCameraSubtype(e,t){let i=e==="perspective"?"PerspectiveCamera":"OrthographicCamera";t.zoom!==void 0&&this.setZoom(i,t.zoom),t.near!==void 0&&this.setNear(i,t.near),t.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),e.far!==void 0&&(this.far=e.far),e.orthographic!==void 0&&this.updateCameraSubtype("orthographic",e.orthographic),e.perspective!==void 0&&this.updateCameraSubtype("perspective",e.perspective),e.type!==void 0&&(this.cameraType=e.type),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.type===0&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},Yh=new me,cr=class extends es{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new Pe,this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){var r;if(this.booleanMeshSetAddress!==-1&&!e)return;for(let s=0;s<this.children.length;s++){let o=this.children[s];o instanceof cr&&o.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let s=0;s<this.children.length;s++){let o=this.children[s];if(o instanceof di&&o.dataPatched.visible===!0&&((r=o.geometry.attributes.position)==null?void 0:r.count)>0&&o.geometry.drawRange.count>0){if(o.booleanMeshSetAddress===-1){if((o.geometry.index??o.geometry.getAttribute("position")).count/3<15e5&&(o.booleanMeshSetAddress=ei.getMeshSet(o.geometry,e===!0,t)),o.booleanMeshSetAddress===-1)return;ei.transformMeshSet(o.booleanMeshSetAddress,o.matrix),o.booleanMatrixInvOld.copy(o.matrix).invert(),o.booleanWasTransformed=!1}else o instanceof cr&&o.needsTransformForDownstream===!0?(ei.transformMeshSet(o.booleanMeshSetAddress,o.matrix),o.needsTransformForDownstream=!1):o.booleanWasTransformed===!0&&(Yh.multiplyMatrices(o.matrix,o.booleanMatrixInvOld),ei.transformMeshSet(o.booleanMeshSetAddress,Yh),o.booleanMatrixInvOld.copy(o.matrix).invert(),o.booleanWasTransformed=!1);this.meshSetAddresses.push(o.booleanMeshSetAddress)}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new ge([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return ei.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new Pe,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=ei.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(s){this.booleanMeshSetAddress=0,console.error(s)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,Va(this),Ga(this)}dispose(){super.dispose(),this.geometry.dispose()}},Zh;(e=>{function t(i){return Ee.is(i)&&i instanceof pp}e.is=t})(Zh||(Zh={}));var Ha=(e,t)=>class extends Oo(e,t){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},Nr=e=>e instanceof di,Ss=e=>e!==null&&e instanceof cr,d2=e=>e instanceof Gr,Kh=e=>Jn.is(e),Wa=class extends ts(mp){constructor(e,t=15){super(t),this.object=e,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}raycast(e,t){is(this.object,Wa.geometryHelper,e,t)}update(){}},Qh=class extends Oo(Oc,Wa){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},Wu=class extends ts(gp){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){is(this.object,Wu.geometryHelper,e,t)}},qu=class extends ts(vp){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){is(this.object,qu.geometryHelper,e,t)}},ea=class extends ts(yp){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){is(this.object,ea.geometryHelper,e,t)}update(){if(this.object!==void 0){let e=ea._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let s=0,o=this.cone.material.length;s<o;s++)this.cone.material[s].color.set(r);else this.cone.material.color.set(r)}}},$u=ea;$u._vector=new T;function u2(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var p2=class extends Ha(Pc,Wu){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let s=new Rs(this.shadow.camera);s.visible=!1,this.gizmos.shadowmap=s}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Rs&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&u2(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),i&&this.update()}},f2=class extends Ha(Gp,qu){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let s=new T(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),o=new T(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),n=new Li(s,o),h=new Us(n,new yt(16755200));h.visible=!1,this.gizmos.shadowmap=h,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof Us){let i=this.shadow.camera,r=new T(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),s=new T(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(r,s),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},Jh=new T,ec=new T,tc=new Ac,m2=class extends Ha(Hp,$u){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=Ue.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let s=new Rs(this.shadow.camera);s.visible=!1,this.gizmos.shadowmap=s,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Rs&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),ec.setFromMatrixPosition(this.matrixWorld),tc.setFromRotationMatrix(this.matrixWorld),Jh.copy(this.up).applyQuaternion(tc).negate().multiplyScalar(this.distance),this.target.position.copy(ec).add(Jh),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},g2=class extends pi{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?ja(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Xu=class extends pi{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape()}updateShape(){var r;let e=this.data.geometry.extrusion.shape,t;if(e.type==="Custom"){let s=e.shapeId;if(s!==this._shapeId&&this.detachShape(),s){this._shapeId=s;let o=this._context.scene.find(s);o!=null&&o.data&&(o.attachedPaths.add(this),t=(r=o.geometry.userData)==null?void 0:r.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let s;switch(e.type){case"Rectangle":s=Zd;break;case"Ellipse":s=Na;break;case"Polygon":s=Yd;break;case"Star":s=Kd;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=s.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build(),this.attachedSurfaceCloners.forEach(s=>s.update()))}detachShape(){var e;this._shapeId!==null&&((e=this._context.scene.find(this._shapeId))==null||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e){return super.updateTransformState(e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?ja(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Hr=class extends Oo(Oc,Wa){constructor(e,t,i){super(),t.type==="Instance"&&typeof e=="string"&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,t){let i=t.scene.data.objects.get(e.component);if(i){let r,s;for(let o of hr.rootOverrideProps)e[o]===void 0?(r===void 0&&(r={...e}),r[o]=i.data[o]):(s===void 0&&(s={}),s[o]=e[o]);return this.overrideData=s,r??e}return e}updateByOp(e,t,i,r){let s;if(this.isInstanceRoot&&!r&&(t=this.transformAssignData(t,i),e.type===0&&e.path.length===0&&this.component))for(let o of hr.rootOverrideProps)o in e.props&&e.props[o]===void 0&&(s===void 0&&(s={...e,props:{...e.props}}),s.props[o]=this.component.data[o]);super.updateByOp(s??e,t,i,r)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(this.component===void 0){this.component=e.scene.find(t.component)??null;let i=!1;if(this.component!==this.oldComponent){if(this.oldComponent){let r=0;for(let s of this.children)if(Ee.is(s))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),qa(s),r+=1;else break;this.children.splice(0,r)}i=!0}this.component&&Yu(e,[this.uuid],t.overrides,this,this.component,this.component,0,i),this.oldComponent=this.component}}};function qa(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)Ee.is(i)&&qa(i)}}function ic(e,t,i,r){return e.component===t&&Pd(e.identity,r)?e.overrideData===i?2:1:0}function Yu(e,t,i,r,s,o,n,h){if(n>50)return!1;if(r.component!==s){if(r.component){let c=r.component.instances.indexOf(r);c>=0&&r.component.instances.splice(c,1)}s.instances.push(r),r.component=s}s instanceof Hr&&s.isInstanceRoot&&s.expandInstanceChildren(e);let a=0;for(let c of s.children)if(Ee.is(c)){let u=[...t,...typeof c.identity=="string"?[c.identity]:c.identity],l=io.resolve(i,u,1),d=null,p;if(!h){let f=r.children[a];if(d=Ee.is(f)?f:null,d!==null){let v=ic(d,c,l,u);p=v>=1?d.stateSelection:void 0,v!==2&&(d=null)}if(d===null&&(d=e.scene.findInstance(u)??null,d!==null)){let v=ic(d,c,l,u);if(p=v>=1?d.stateSelection:void 0,v!==2)d=null;else{let g=d.parent.children.indexOf(d);d.parent.children.splice(g,1),r.children.splice(a,0,d),d.parent===r?g<=a&&console.error("not possible"):(d.parent=r,d.matrixWorldNeedsUpdate=!0,d.resetBBoxNeedsUpdate(),d.updateVisible(),e.pendingDeletes.delete(d))}}}if(d===null){let f=l?Ci.apply(c.data,l):c.data;Ei.is(f.type)&&(f={...f,type:"Empty"}),d=oi.createEntity(u,f,e),d.overrideData=l,r.add(d),r.children.splice(r.children.length-1,1),r.children.splice(a,0,d),d.updateState(d.data,e),p&&d.changeSelectedState(p,e),e.scene.registerInstanceAndSetUuid(d)}a+=1,Yu(e,t,i,d,c,o,n+1,h)}if(!h){let c=a;for(;;){let u=r.children[a];if(Ee.is(u))e.pendingDeletes.add(u);else break;a+=1}r.children.splice(c,a-c)}return!0}function v2(e,t,i){let r;return t.geometry.type==="TextGeometry"?new ku(e,t,i):(t.geometry.type==="SubdivGeometry"?r=new Qn(e,t,i):t.geometry.type==="PathGeometry"?r=new Xu(e,t,i):t.geometry.type==="VectorGeometry"?r=new g2(e,t,i):t.geometry.type==="BooleanGeometry"?r=new cr(e,t,i):r=new pi(e,t,i),r)}function $a(e,t,i){return t.type==="Mesh"?v2(e,t,i):t.type==="Empty"?new Qh(e,t):t.type==="PointLight"?new f2(e,t,i):t.type==="SpotLight"?new m2(e,t,i):t.type==="DirectionalLight"?new p2(e,t,i):t.type==="Component"||t.type==="Instance"?new Hr(e,t,i):Ei.is(t.type)?new Gr(e,t):(console.error(t),new Qh(e,t))}oi.createEntity=$a;function y2(e,t,i){let r=$a(e.identity,t,i),s=e.children,o=e.attachedPaths,n=e.parent,h=e.component,a=e.instances,c=e.overrideData,u=e.uuid,l=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(r));for(let d of Object.keys(r))e[d]=r[d];e.children=[...e.children,...s],e.attachedPaths=o,e.parent=n,e.component=h,e.instances=a,e.uuid=u,e.overrideData=c,e.updateState(e.data,i),l&&e.changeSelectedState(l,i),e.resetBBoxNeedsUpdate()}oi.changeEntityProptotype=y2;oi.Cloner=Hu;function b2(e,t,i,r){e.updateByOp(t,i,r,!1)}function rc(e,t){let i=!1,r=t.getLayersOfType("transmission"),s=t.getLayersOfType("outline");return s.length>0&&(e.layers.set(8),r.length>0&&e.layers.enable(3),i=!0,Ga(e),Va(e)),r.length===0&&s.length===0&&e.layers.set(0),i}function sc(e,t){if(!t.layers)return!1;let i=!1,r=t.getLayersOfType("transmission").filter(o=>o.data.visible),s=t.getLayersOfType("outline").filter(o=>o.data.visible);return r.length>0&&(e.layers.set(3),s.length>0&&e.layers.enable(8),i=!0),r.length===0&&s.length===0&&e.layers.set(0),i}function x2(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof es)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)rc(i,i.material[r])&&(t=!0);else rc(i,i.material)&&(t=!0)}),t}function w2(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof es)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)sc(i,i.material[r])&&(t=!0);else sc(i,i.material)&&(t=!0)}),t}var _2=new up,S2=new me,A2=new ra;function oc(e,t,i,r=!1){let s=e.cloner;if(s)for(let o of s.children){let n=S2.copy(o.matrixWorld).invert(),h=A2.copy(t.ray).applyMatrix4(n),a=e.matrixWorld;h.applyMatrix4(a);let c=_2;c.set(h.origin,h.direction),c.near=t.near,c.far=t.far;let u=c.intersectObject(e,!1);u.length>0&&i.push({...u[0],object:r?o:e})}}var O2=class{constructor(){this._constraints=new Map}setConstraint(e,t){t===null?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,r)=>{let s=[r,i],o=i;for(;this._constraints.has(o);)o=this._constraints.get(o),t.has(o)||s.push(o);for(let n=s.length-2;n>=0;n--)if(!t.has(s[n])){let h=e.find(s[n]);h?h.applyPathSnapping(e):console.warn(`missing entity ${s[n]}`),t.add(s[n])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},C2=new vc;C2.wireframe=!0;var nc=new T,Zu=class extends xc{constructor(e,t){super(),this.data=e,this.backupFog=new bp(16777215,.1,2e3),this.fogUseBGColor=!1,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.bgColor=new Ct(1,1,1,1),this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new O2,this.needsRecomputeInstances=!1,this.ambientLight=new xp(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.personalCamera=this.createPersonalCamera(),this.activeCamera=this.personalCamera,this.postprocessing=e.postprocessing,this.init(e,t),this.matrixAutoUpdate=!1}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=w2(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=x2(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this;){let s=r;r=r.parent;let o=r.children.indexOf(s);i.splice(0,0,o)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>qf(i.sortKey,r.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(i===void 0)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}debugEnsureEntity(e){let t=this.find(e);if(t){if(Array.isArray(t.identity)&&this.findInstance(t.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{var t;(t=e.cloner)==null||t.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateTreeByOp(e,t){var i;if(e.path.length===0&&e.type===7){let r=e.parent===null?this:this.find(e.parent);if(r===void 0)throw new Error("unexpected");let s=this.createObject(e.id,e.data,e.children,r,e.localIndex,t);s.updateVisible(),s.resetBBoxNeedsUpdate(),Nr(s)&&Ss(s.parent)&&(s.invalidateUpstreamBooleanData(),s.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(s),this.markToExpandCloner(s)}else if(e.path.length===0&&e.type===8){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markToExpandCloner(r),r.resetBBoxNeedsUpdate(),this.unregisterObject(r);let s=r.parent;this.markNeedsRecomputeInstancesForAncessors(s),this.markNeedsRecomputeInstancesForChildren(r),r.parent.remove(r),Ss(r.parent)&&(r.parent.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Nr(r)&&(r.freeBooleanPointer(),s instanceof cr&&s.invalidateDownstreamBooleanData().recomputeBoolean()),r instanceof Xu&&r.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),this.pathConstraints.removeDependencies(r.uuid)}else if(e.path.length===0&&e.type===9){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(r);let s=r.parent;this.markNeedsRecomputeInstancesForAncessors(s),(i=r.cloner)==null||i.resetOnMove(),this.markToExpandCloner(r);let o=e.parent===null?this:this.find(e.parent);if(o===void 0)throw new Error("unexpected");o.add(r),this.markNeedsRecomputeInstancesForAncessors(o),this.markToExpandCloner(r),r.invalidateClonerTransform(r),r.updateVisible(),r.resetBBoxNeedsUpdate();let n=e.localIndex;o.children.splice(n,0,o.children.pop()),Nr(r)&&(r.invalidateUpstreamBooleanData(),Ss(r.parent)?r.parent.invalidateDownstreamBooleanData().recomputeBoolean():s instanceof cr&&s.invalidateDownstreamBooleanData().recomputeBoolean())}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}updateEntityByOp(e,t,i,r){if(t.type===0){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),t.path.includes("overrides")&&"states"in t.props){let{states:o,rest:n}=t.props;t={...t,props:n},this.markNeedsRecomputeInstances()}t.path[0]==="pathSnapping"&&t.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,t.props.pathId)}let s=this.find(e);if(s)try{b2(s,t,i,{scene:this,shared:r}),s instanceof pi&&s.updateGeometryGroupsIfNeeded()}catch(o){console.error(o)}}get enableFog(){return this.fog!==null}set enableFog(e){this.fog=e===!0?this.backupFog:null}init(e,t){if(this.createChildrenObjects(e.objects,this,t),this.personalCamera.removeFromParent(),this.add(this.personalCamera),this.ambientLight.removeFromParent(),this.add(this.ambientLight),this.setBackgroundColor(ot(e.backgroundColor,t)),this.updateFog(e.fog,t),this.updateAmbientLight(e.environment.ambientLight,t),this.activeCamera=this.personalCamera,e.publish.playCamera!==null){let i=this.find(e.publish.playCamera);i instanceof Gr&&this.switchActiveCamera(i)}this.expandInstances(t,!0),this.traverseEntity(i=>{Ss(i)&&i.recomputeBoolean(),i instanceof Gr&&i.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{(t.data.type==="Component"||t.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){Ee.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{Ee.is(t)&&t.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,r,s,o,n){e&&e!==r.uuid&&r.find(e)&&s.forInstancesRec(h=>{h.isInstanceRoot||(h.data=Gs(h.data,a=>{let c=a.events.data(n.id),u=h.goUp(o);if(u){let l=[...Qc(u.identity),e].join("-"),d=this.entityIdentityToEntity[l];if(d){let p=d.uuid;kt.zoom(c,t)[i]=p}else console.warn("cannot find instance")}}).data)})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof Hr&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((t,i)=>{t.data.events.forEach(r=>{r.data.type==="GameControl"?t.forInstancesRec(s=>{s.isInstanceRoot||(s.data=Gs(s.data,o=>{o.events.delete(r.id)}).data)}):r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",e,t,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",e,t,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",e,t,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,r)),r.data.inActions.forEach(s=>{s.data.type==="Transition"&&this.relativeizeInner(s.data.object,["inActions",s.id],"object",e,t,i,r)}),r.data.outActions.forEach(s=>{s.data.type==="Transition"&&this.relativeizeInner(s.data.object,["outActions",s.id],"object",e,t,i,r)})):"actions"in r.data&&r.data.actions.forEach(s=>{s.data.type==="Transition"&&this.relativeizeInner(s.data.object,["actions",s.id],"object",e,t,i,r)})})}),!0})}expandInstances(e,t){let i=new Set;this.traverseEntity(r=>{if(r instanceof Hr&&r.isInstanceRoot)return r.expandInstanceChildren({scene:this,shared:e,pendingDeletes:i}),t||r.resetBBoxNeedsUpdate(),!0});for(let r of i)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),qa(r)}recomputeInstances(e){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(t=>{t instanceof Hr&&t.isInstanceRoot&&(t.component=void 0)}),this.expandInstances(e,!1))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i=typeof t.identity=="string"?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)Ee.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}createPersonalCamera(){let e=new Gr(Zu.PERSONAL_CAMERA_ID,{...to.defaultData,name:"Personal Camera"});return e.objectHelper.visible=!1,this.registerObjectCreatedInLegacy(e),e}raycast(e){let t=[],i=r=>{for(let s of r.children){let o=s.cloner;Ee.is(s)&&!s.raycastLock&&(s.visible||o!=null&&o.object.data.visible)&&((Nr(s)||Kh(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,t),oc(s,e,t)),i(s))}};return i(this),t}raycastWithClones(e){let t=[],i=r=>{for(let s of r.children){let o=s.cloner;Ee.is(s)&&!s.raycastLock&&(s.visible||o!=null&&o.object.data.visible)&&((Nr(s)||Kh(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,t),oc(s,e,t,!0)),i(s))}};return i(this),t}forEachEntity(e){for(let t of this.children)Ee.is(t)&&e(t)}traverseEntity(e){for(let t of this.children)Ee.is(t)&&t.traverseEntity(e)}traverseObject(e){for(let t of this.children)oo.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)Ee.is(t)&&t.visible&&t.traverseVisibleEntity(e)}updateFog(e,t){this.enableFog=e.enabled,this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=ot(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}dispose(){this.clearScene()}updateAmbientLight(e,t){e.color!==void 0&&(this.ambientLight.color=ot(e.color,t)),e.intensity!==void 0&&(this.ambientLight.intensity=e.intensity),e.groundColor!==void 0&&(this.ambientLight.groundColor=ot(e.groundColor,t)),e.enabled!==void 0&&(this.ambientLight.visible=e.enabled)}switchActiveCamera(e){this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}createChildrenObjects(e,t,i){let r=0;for(let s of e)this.createObject(s.id,s.data,s.children,t,r,i),r+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,r,s,o){var a;let n={scene:this,shared:o},h=$a(e,t,n);return h&&(this.entityByUuid[e]=h,r.add(h),r.children.splice(s,0,r.children.pop()),i.length>0&&(h.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,h,o)),h.updateState(t,n),h instanceof pi&&h.updateGeometryGroupsIfNeeded(),h.updateVisible(),h.cloner&&this.toExpandCloner.add(h),(a=t.pathSnapping)!=null&&a.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),h}getCenter(e){let t=[];for(let r=0,s=e.length;r<s;++r){let{id:o,recursive:n}=e[r],h=this.find(o),a=n?h.recursiveBBox:h.singleBBox;t.push(...a.vertices)}let i=new Li;return i.setFromPoints(t),i.getCenter(nc),nc}copyMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var r;if(e===null){t.identity();return}let i=(r=this.find(e))==null?void 0:r.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof di)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof ui&&e(t.material[i]);else t.material instanceof ui&&e(t.material)})}updateCanvasSize(e,t){this.activeCamera.setViewplaneSize(e,t);let i,r;e>=t?(i=t/e,r=1):(i=1,r=e/t),this.traverseMaterial(s=>{s.getLayersOfType("transmission").forEach(o=>{o.uniforms[`f${o.id}_aspectRatio`].value.x=i,o.uniforms[`f${o.id}_aspectRatio`].value.y=r})})}},ta=Zu;ta.PERSONAL_CAMERA_ID="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera",ta.PERSONAL_CAMERA_EXPORT_ID="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCameraExport";var li;function P2(){return li||(li=new Qp,li.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),li.decoderPending}async function T2(e){if(li){let t={attributeIDs:li.defaultAttributeIDs,attributeTypes:li.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await li.decodeGeometry(new Int8Array(e).buffer,t)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,s])=>({name:r,itemSize:s.itemSize,array:s.array}))}}return null}async function M2(e,t){let[i,r]=jc(_n.deserialize(new Uint8Array(e)));sw(i);let s=[];i.scene.objects.traverse((o,n)=>{n.type==="Mesh"&&n.geometry.type==="NonParametricGeometry"&&n.geometry.data.draco!==void 0&&s.push(n)}),s.length&&await P2();for(let o of s){let n=await T2($e(o.geometry.data.draco));if(n){n.index&&(o.geometry.data.index={array:n.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let h={};n.attributes.forEach(({name:a,array:c,itemSize:u})=>{h[a]={array:c,itemSize:u,type:"Float32Array",normalized:!1}}),o.geometry.data.attributes=h,o.geometry.data.draco=void 0}}return t&&t(i),r.result().data}function E2(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function D2(e){let t=new Set;return e.traverse(i=>{if(i instanceof es)if(Pt(i.material))i.material.forEach(r=>{let s=r;t.has(s)||t.add(s)});else{let r=i.material;t.has(r)||t.add(r)}}),t.forEach(i=>{if(i instanceof Array)return;let r=i.onBeforeCompile.bind(i);if(L2(i)){Object.assign(i,{isMeshStandardMaterial:!0,isMeshPhysicalMaterial:!0,transmission:1,attenuationColor:new yt,specularColor:new yt});let s=0;i.onBeforeCompile=(o,n)=>{r&&r(o,n),o.uniforms=Object.assign({},$p.physical.uniforms,o.uniforms),i.getLayersOfType("transmission").forEach(h=>{if(o.uniforms.transmissionSamplerMap.value){let a=h.color;a&&(a.transmissionSamplerMap.value=o.uniforms.transmissionSamplerMap.value,a.transmissionSamplerSize.value=o.uniforms.transmissionSamplerSize.value)}else s++,s<2&&(i.needsUpdate=!0)})}}else I2(i)||(i.onBeforeCompile=(s,o)=>{r&&r(s,o),i.transparent=!1})}),e}function L2(e){return e.getLayersOfType("transmission").length>0}function I2(e){let t=0;return e.layers.forEach(i=>{if(i.type!=="light"&&i.type!=="fresnel"){let r=i.uniforms["f"+i.id+"_alpha"];r&&(t+=(1-t)*r.value)}}),t<1}function z2(e){return e.traverse(t=>{if(t.type==="Camera"){let i=t;i.type=i.cameraType}}),e}function N2(e){let t=[],i=(r,s=0)=>{let o=s>0?r+s:r;return t.includes(o)?i(r,s+1):o};return e.traverse(r=>{if(t.includes(r.name)){let s=r.name,o=i(r.name);if(r.name=o,r.isMesh){let n=r;n.material instanceof Array?n.material.forEach(h=>{h.name=h.name.replace(s,o)}):n.material.isAsset||(n.material.name=n.material.name.replace(s,o))}}t.push(r.name)}),e}function B2(e){let t=[];return e.traverse(i=>{i instanceof Hu&&t.push(i)}),t.forEach(i=>{let r=i.object,s=i.children.map(n=>{n.updateMatrix();let h=n.geometry.clone().applyMatrix4(n.matrix);return n.matrix.determinant()<0&&E2(h),h}),o=Mc(i.parameters.hideBase?s:[r instanceof di?r.geometry:[],...s]);r instanceof di&&(r.geometry=o),i.removeFromParent(),r.setFromClonerState(null,{scene:e,shared:FS})}),e}function j2(e){return e.traverse(t=>{t.matrixAutoUpdate=!0}),e}function U2(e){Object.values(e.shared.materials).forEach(t=>{fn(t)}),e.scene.objects.traverse((t,i)=>{"material"in i?fn(i.material):"materials"in i&&i.materials.forEach(r=>{fn(r)})})}function fn(e){if(typeof e=="string")return;let t=[];e.layers.forEach((i,r)=>{i.type==="outline"&&t.push(r)}),t.reverse().forEach(i=>{e.layers.delete(i)}),t.length&&console.warn("The Spline Loader currently does not support the outline layer.")}var R2=uo(df(),1),ac="The SplineLoader only accepts .splinecode files that are generated from Spline export panel.",k2=class extends gc{load(e,t,i,r=console.error){let s=new mn(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),e.endsWith(".spline")?console.warn(ac+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(ac),s.load(e,async o=>{try{if(typeof o=="string")throw new Error("The .spline file is not binary!");let n=await this.parse(o);t(n)}catch(n){r(n)}},i,r)}async parse(e){let t=await M2(e,U2);t.version&&(0,R2.default)(t.version,"0.9.339")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/loader to the latest version."),await Promise.all([HS(t)&&E_(),s2(t)&&DS()].filter(Boolean));let i=new Fa(t.shared);Object.values(i.getMaterials()).forEach(o=>Object.assign(o,{isAsset:!0}));let r=new ta(t.scene,i);r.remove(r.personalCamera),t.scene.environment.ambientLight.enabled||r.remove(r.ambientLight);let s=t.scene.publish.playCamera;if(s){let o=r.find(s);o&&d2(o)&&Object.assign(o,{makeDefault:!0})}return r=B2(r),r=D2(r),r=z2(r),r=N2(r),r=j2(r),r}};class F2{constructor(t){this.width=100,this.height=100,typeof t=="object"&&(this.width=t.width??this.width,this.height=t.height??this.height),!(typeof window>"u")&&(this.isDragging=!1,this.scene=new xc,this.camera=new Sc(75,this.width/this.height,.1,1e3),this.camera.position.z=400,this.geometry=new Mi,this.directionalLight=new Pc(2960946,3.7),this.directionalLight.position.set(-150,200,200).normalize(),this.scene.add(this.directionalLight),this.renderer=null,this.starnight=null,this.onLoadModel(),window.addEventListener("mousedown",this.onMouseDown.bind(this)),window.addEventListener("mouseup",this.onMouseUp.bind(this)),window.addEventListener("resize",this.resize),window.addEventListener("mousemove",i=>{this.isDragging&&this.starnight!=null&&(this.mouseX=i.clientX,this.mouseY=i.clientY)}))}async onLoadModel(){self=this,this.loader=new k2,this.loader.load("https://prod.spline.design/6JqM5YunTZGiztNg/scene.splinecode",t=>{self.starnight=t,self.scene.add(self.starnight)})}onMouseDown(t){this.isDragging=!0,this.mouseX=t.clientX,this.mouseY=t.clientY}onMouseUp(t){this.isDragging=!1}resize(){this.renderer.setSize(this.width,this.height),this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix()}animate(){requestAnimationFrame(()=>{this.animate()}),this.starnight!=null&&(this.isDragging?(this.starnight.rotation.y+=((this.mouseX??0)-this.width/2)*5e-5,this.starnight.rotation.x+=((this.mouseY??0)-this.height/2)*5e-5):this.starnight.rotation.y+=.001,this.renderer.render(this.scene,this.camera))}createScene(t){this.renderer=new Xp({antialias:!0,canvas:t,alpha:!0}),this.resize(),this.animate()}}function V2(e){let t;return{c(){t=As("canvas"),this.h()},l(i){t=Os(i,"CANVAS",{class:!0}),Cs(t).forEach(St),this.h()},h(){Ps(t,"class","svelte-f395dx")},m(i,r){vi(i,t,r),e[1](t)},p:To,i:To,o:To,d(i){i&&St(t),e[1](null)}}}function G2(e,t,i){let r;sp(()=>{s()});async function s(){new F2({width:window.innerWidth,height:window.innerHeight}).createScene(r)}function o(n){op[n?"unshift":"push"](()=>{r=n,i(0,r)})}return[r,o]}class H2 extends hc{constructor(t){super(),cc(this,t,G2,V2,dc,{})}}function lc(e){let t,i;return t=new H2({}),{c(){uc(t.$$.fragment)},l(r){pc(t.$$.fragment,r)},m(r,s){fc(t,r,s),i=!0},i(r){i||(Br(t.$$.fragment,r),i=!0)},o(r){Ts(t.$$.fragment,r),i=!1},d(r){mc(t,r)}}}function W2(e){let t,i,r,s,o,n,h,a,c,u,l,d,p,f;t=new cp({props:{innerText:Do(e[2],"titre")}});let v=e[1]>0&&lc();return{c(){uc(t.$$.fragment),i=Mo(),r=As("p"),s=ss("Visit "),o=As("a"),n=ss("kit.svelte.dev"),h=ss(" to read the documentation"),a=Mo(),c=As("a"),u=ss("a propos"),d=Mo(),v&&v.c(),p=Ya(),this.h()},l(g){pc(t.$$.fragment,g),i=Eo(g),r=Os(g,"P",{});var m=Cs(r);s=os(m,"Visit "),o=Os(m,"A",{href:!0});var y=Cs(o);n=os(y,"kit.svelte.dev"),y.forEach(St),h=os(m," to read the documentation"),m.forEach(St),a=Eo(g),c=Os(g,"A",{href:!0});var w=Cs(c);u=os(w,"a propos"),w.forEach(St),d=Eo(g),v&&v.l(g),p=Ya(),this.h()},h(){Ps(o,"href","https://kit.svelte.dev"),Ps(c,"href",l="/"+Do(e[0],"code")+"/about")},m(g,m){fc(t,g,m),vi(g,i,m),vi(g,r,m),wr(r,s),wr(r,o),wr(o,n),wr(r,h),vi(g,a,m),vi(g,c,m),wr(c,u),vi(g,d,m),v&&v.m(g,m),vi(g,p,m),f=!0},p(g,[m]){(!f||m&1&&l!==(l="/"+Do(g[0],"code")+"/about"))&&Ps(c,"href",l),g[1]>0?v?m&2&&Br(v,1):(v=lc(),v.c(),Br(v,1),v.m(p.parentNode,p)):v&&(lp(),Ts(v,1,1,()=>{v=null}),np())},i(g){f||(Br(t.$$.fragment,g),Br(v),f=!0)},o(g){Ts(t.$$.fragment,g),Ts(v),f=!1},d(g){mc(t,g),g&&St(i),g&&St(r),g&&St(a),g&&St(c),g&&St(d),v&&v.d(g),g&&St(p)}}}function q2(e,t,i){let r;ap(e,hp,n=>i(1,r=n));let{data:s}=t,{page_home:o={}}=s;return console.log(o),e.$$set=n=>{"data"in n&&i(0,s=n.data)},[s,r,o]}class iA extends hc{constructor(t){super(),cc(this,t,q2,W2,dc,{data:0})}}export{iA as component,tA as universal};
