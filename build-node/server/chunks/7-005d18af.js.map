{"version":3,"file":"7-005d18af.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(admin)/admin/login/_page.server.js","../../../.svelte-kit/adapter-node/nodes/7.js"],"sourcesContent":["import { f as fail, r as redirect } from \"../../../../../chunks/index.js\";\nimport bcrypt from \"bcrypt\";\nimport { d as db } from \"../../../../../chunks/index5.js\";\nconst actions = {\n  login: async ({ cookies, request }) => {\n    const data = await request.formData();\n    const username = data.get(\"username\");\n    const password = data.get(\"password\");\n    if (typeof username !== \"string\" || typeof password !== \"string\" || !username || !password) {\n      return fail(400, { invalid: true });\n    }\n    const user = await db.user.findUnique({ where: { username } });\n    if (!user) {\n      return fail(400, { credentials: true });\n    }\n    const userPassword = await bcrypt.compare(password, user.passwordHash);\n    if (!userPassword) {\n      return fail(400, { credentials: true });\n    }\n    const authenticatedUser = await db.user.update({\n      where: { username: user.username },\n      data: { userAuthToken: crypto.randomUUID() }\n    });\n    cookies.set(\"session\", authenticatedUser.userAuthToken, {\n      // send cookie for every page\n      path: \"/\",\n      // server side only cookie so you can't use `document.cookie`\n      httpOnly: true,\n      // only requests from same site can send cookies\n      // https://developer.mozilla.org/en-US/docs/Glossary/CSRF\n      sameSite: \"strict\",\n      // only sent over HTTPS in production\n      secure: process.env.NODE_ENV === \"production\",\n      // set cookie to expire after a month\n      maxAge: 60 * 60 * 24 * 30\n    });\n    throw redirect(302, \"/admin/home\");\n  }\n};\nconst load = async (serverloadEvent) => {\n  let { locals } = serverloadEvent;\n  if (locals.user) {\n    throw redirect(302, \"/admin/home\");\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/(admin)/admin/login/_page.server.js';\n\nexport const index = 7;\nexport const component = async () => (await import('../entries/pages/(admin)/admin/login/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/(admin)/admin/login/+page.server.js\";\nexport const imports = [\"_app/immutable/nodes/7.53627d6f.js\",\"_app/immutable/chunks/index.137f5445.js\",\"_app/immutable/chunks/H1.3d9f7839.js\",\"_app/immutable/chunks/index.32dea7b4.js\",\"_app/immutable/chunks/preload-helper.41c905a7.js\",\"_app/immutable/chunks/index.d60425e4.js\"];\nexport const stylesheets = [\"_app/immutable/assets/H1.bb193338.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":";;;;;AAGA,MAAM,OAAO,GAAG;AAChB,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK;AACzC,IAAI,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,QAAQ,EAAE,CAAC;AAC1C,IAAI,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;AAC1C,IAAI,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;AAC1C,IAAI,IAAI,OAAO,QAAQ,KAAK,QAAQ,IAAI,OAAO,QAAQ,KAAK,QAAQ,IAAI,CAAC,QAAQ,IAAI,CAAC,QAAQ,EAAE;AAChG,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;AAC1C,KAAK;AACL,IAAI,MAAM,IAAI,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,KAAK,EAAE,EAAE,QAAQ,EAAE,EAAE,CAAC,CAAC;AACnE,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,CAAC,CAAC;AAC9C,KAAK;AACL,IAAI,MAAM,YAAY,GAAG,MAAM,MAAM,CAAC,OAAO,CAAC,QAAQ,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;AAC3E,IAAI,IAAI,CAAC,YAAY,EAAE;AACvB,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,CAAC,CAAC;AAC9C,KAAK;AACL,IAAI,MAAM,iBAAiB,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC;AACnD,MAAM,KAAK,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE;AACxC,MAAM,IAAI,EAAE,EAAE,aAAa,EAAE,MAAM,CAAC,UAAU,EAAE,EAAE;AAClD,KAAK,CAAC,CAAC;AACP,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,iBAAiB,CAAC,aAAa,EAAE;AAC5D;AACA,MAAM,IAAI,EAAE,GAAG;AACf;AACA,MAAM,QAAQ,EAAE,IAAI;AACpB;AACA;AACA,MAAM,QAAQ,EAAE,QAAQ;AACxB;AACA,MAAM,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,YAAY;AACnD;AACA,MAAM,MAAM,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE;AAC/B,KAAK,CAAC,CAAC;AACP,IAAI,MAAM,QAAQ,CAAC,GAAG,EAAE,aAAa,CAAC,CAAC;AACvC,GAAG;AACH,CAAC,CAAC;AACF,MAAM,IAAI,GAAG,OAAO,eAAe,KAAK;AACxC,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,eAAe,CAAC;AACnC,EAAE,IAAI,MAAM,CAAC,IAAI,EAAE;AACnB,IAAI,MAAM,QAAQ,CAAC,GAAG,EAAE,aAAa,CAAC,CAAC;AACvC,GAAG;AACH,CAAC;;;;;;;;AC1CW,MAAC,KAAK,GAAG,EAAE;AACX,MAAC,SAAS,GAAG,YAAY,CAAC,MAAM,OAAO,4BAAsD,CAAC,EAAE,QAAQ;AAExG,MAAC,SAAS,GAAG,iDAAiD;AAC9D,MAAC,OAAO,GAAG,CAAC,oCAAoC,CAAC,yCAAyC,CAAC,sCAAsC,CAAC,yCAAyC,CAAC,kDAAkD,CAAC,yCAAyC,EAAE;AAC1Q,MAAC,WAAW,GAAG,CAAC,uCAAuC,EAAE;AACzD,MAAC,KAAK,GAAG;;;;"}